!function webpackUniversalModuleDefinition(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("muze",[],factory):"object"==typeof exports?exports.muze=factory():root.muze=factory()}(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=7)}([function(module,exports,__webpack_require__){(function(module){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(e,t){"object"==_typeof(exports)&&"object"==_typeof(module)?module.exports=t():(__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=t)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports={name:"datamodel",description:"Relational algebra compliant in-memory tabular data store",homepage:"https://github.com/chartshq/datamodel",version:"2.0.2",license:"MIT",main:"dist/datamodel.js",author:"Charts.com <support@charts.com>",keywords:["datamodel","data","relational","algebra","model","muze","fusioncharts","table","tabular","operation"],repository:{type:"git",url:"https://github.com/chartshq/datamodel.git"},contributors:[{name:"Akash Goswami",email:"akash@charts.com"},{name:"Subhash Haldar",email:"subhash@charts.com"},{name:"Rousan Ali",email:"rousan@charts.com",url:"https://rousan.io"},{name:"Ujjal Kumar Dutta",email:"ujjal@charts.com"}],dependencies:{"d3-dsv":"^1.0.8"},devDependencies:{"babel-cli":"6.26.0","babel-core":"^6.26.3","babel-eslint":"6.1.2","babel-loader":"^7.1.4","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.7.0","babel-preset-es2015":"^6.24.1","babel-preset-flow":"^6.23.0",chai:"3.5.0","cross-env":"^5.0.5",eslint:"3.19.0","eslint-config-airbnb":"15.1.0","eslint-plugin-import":"2.7.0","eslint-plugin-jsx-a11y":"5.1.1","eslint-plugin-react":"7.3.0","istanbul-instrumenter-loader":"^3.0.0",jsdoc:"3.5.5",json2yaml:"^1.1.0",karma:"1.7.1","karma-chai":"0.1.0","karma-chrome-launcher":"2.1.1","karma-coverage-istanbul-reporter":"^1.3.0","karma-mocha":"1.3.0","karma-spec-reporter":"0.0.31","karma-webpack":"2.0.3",marked:"^0.5.0",mocha:"3.4.2","mocha-webpack":"0.7.0","transform-runtime":"0.0.0",webpack:"^4.12.0","webpack-cli":"^3.0.7","webpack-dev-server":"^3.1.4"},scripts:{test:"npm run lint && npm run ut",ut:"karma start karma.conf.js",utd:"karma start --single-run false --browsers Chrome karma.conf.js ",build:"webpack --mode production",start:"webpack-dev-server --config webpack.config.dev.js --mode development --open",lint:"eslint ./src","lint-errors":"eslint --quiet ./src",docs:"rm -rf yaml && mkdir yaml && jsdoc -c jsdoc.conf.json"}}},function(e,t,n){var r=n(2);e.exports=r.default?r.default:r},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"DataFormat",function(){return o}),n.d(r,"DimensionSubtype",function(){return u}),n.d(r,"MeasureSubtype",function(){return c}),n.d(r,"FieldType",function(){return f}),n.d(r,"FilteringMode",function(){return l});var a={};n.r(a),n.d(a,"DSVArr",function(){return Ve}),n.d(a,"DSVStr",function(){return $e}),n.d(a,"FlatJSON",function(){return Qe}),n.d(a,"Auto",function(){return Ze});var i={};n.r(i),n.d(i,"sum",function(){return _t}),n.d(i,"avg",function(){return Ot}),n.d(i,"min",function(){return Et}),n.d(i,"max",function(){return At}),n.d(i,"first",function(){return jt}),n.d(i,"last",function(){return St}),n.d(i,"count",function(){return Ft}),n.d(i,"sd",function(){return kt});var o={FLAT_JSON:"FlatJSON",DSV_STR:"DSVStr",DSV_ARR:"DSVArr",AUTO:"Auto"},u={CATEGORICAL:"categorical",TEMPORAL:"temporal",GEO:"geo",BINNED:"binned"},c={CONTINUOUS:"continuous"},f={MEASURE:"measure",DIMENSION:"dimension"},l={NORMAL:"normal",INVERSE:"inverse",ALL:"all"};function s(e){return e instanceof Date?e:new Date(e)}function d(e){return e<10?"0"+e:e}function p(e){this.format=e,this.dtParams=void 0,this.nativeDate=void 0}RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},p.TOKEN_PREFIX="%",p.DATETIME_PARAM_SEQUENCE={YEAR:0,MONTH:1,DAY:2,HOUR:3,MINUTE:4,SECOND:5,MILLISECOND:6},p.defaultNumberParser=function(e){return function(t){var n;return isFinite(n=parseInt(t,10))?n:e}},p.defaultRangeParser=function(e,t){return function(n){var r,a=void 0;if(!n)return t;var i=n.toLowerCase();for(a=0,r=e.length;a<r;a++)if(e[a].toLowerCase()===i)return a;return void 0===a?t:null}},p.getTokenDefinitions=function(){var e={short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},t={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{H:{name:"H",index:3,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return s(e).getHours().toString()}},l:{name:"l",index:3,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){var t=s(e).getHours()%12;return(0===t?12:t).toString()}},p:{name:"p",index:3,extract:function extract(){return"(AM|PM)"},parser:function parser(e){return e?e.toLowerCase():null},formatter:function formatter(e){return s(e).getHours()<12?"AM":"PM"}},P:{name:"P",index:3,extract:function extract(){return"(am|pm)"},parser:function parser(e){return e?e.toLowerCase():null},formatter:function formatter(e){return s(e).getHours()<12?"am":"pm"}},M:{name:"M",index:4,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return d(s(e).getMinutes())}},S:{name:"S",index:5,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return d(s(e).getSeconds())}},K:{name:"K",index:6,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return s(e).getMilliseconds().toString()}},a:{name:"a",index:2,extract:function extract(){return"("+e.short.join("|")+")"},parser:p.defaultRangeParser(e.short),formatter:function formatter(t){var n=s(t).getDay();return e.short[n].toString()}},A:{name:"A",index:2,extract:function extract(){return"("+e.long.join("|")+")"},parser:p.defaultRangeParser(e.long),formatter:function formatter(t){var n=s(t).getDay();return e.long[n].toString()}},e:{name:"e",index:2,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return s(e).getDate().toString()}},d:{name:"d",index:2,extract:function extract(){return"(\\d+)"},parser:p.defaultNumberParser(),formatter:function formatter(e){return d(s(e).getDate())}},b:{name:"b",index:1,extract:function extract(){return"("+t.short.join("|")+")"},parser:p.defaultRangeParser(t.short),formatter:function formatter(e){var n=s(e).getMonth();return t.short[n].toString()}},B:{name:"B",index:1,extract:function extract(){return"("+t.long.join("|")+")"},parser:p.defaultRangeParser(t.long),formatter:function formatter(e){var n=s(e).getMonth();return t.long[n].toString()}},m:{name:"m",index:1,extract:function extract(){return"(\\d+)"},parser:function parser(e){return p.defaultNumberParser()(e)-1},formatter:function formatter(e){return d(s(e).getMonth()+1)}},y:{name:"y",index:0,extract:function extract(){return"(\\d{2})"},parser:function parser(e){if(e){var t=e.length;e=e.substring(t-2,t)}var n=p.defaultNumberParser()(e),r=Math.trunc((new Date).getFullYear()/100);return n instanceof Number?100*r+n:""+r+n},formatter:function formatter(e){var t=s(e).getFullYear().toString(),n=void 0;return t&&(n=t.length,t=t.substring(n-2,n)),t}},Y:{name:"Y",index:0,extract:function extract(){return"(\\d{4})"},parser:p.defaultNumberParser(),formatter:function formatter(e){return s(e).getFullYear().toString()}}}},p.getTokenFormalNames=function(){var e=p.getTokenDefinitions();return{HOUR:e.H,HOUR_12:e.l,AMPM_UPPERCASE:e.p,AMPM_LOWERCASE:e.P,MINUTE:e.M,SECOND:e.S,SHORT_DAY:e.a,LONG_DAY:e.A,DAY_OF_MONTH:e.e,DAY_OF_MONTH_CONSTANT_WIDTH:e.d,SHORT_MONTH:e.b,LONG_MONTH:e.B,MONTH_OF_YEAR:e.m,SHORT_YEAR:e.y,LONG_YEAR:e.Y}},p.tokenResolver=function(){var e=p.getTokenDefinitions(),t=function t(){for(var e=0,t=void 0,n=void 0,r=arguments.length;e<r;e++)t=arguments.length<=e?void 0:arguments[e],(arguments.length<=e?void 0:arguments[e])&&(n=t);return n?n[0].parser(n[1]):null};return{YEAR:[e.y,e.Y,t],MONTH:[e.b,e.B,e.m,t],DAY:[e.a,e.A,e.e,e.d,t],HOUR:[e.H,e.l,e.p,e.P,function(e,t,n,r){var a=void 0,i=void 0,o=void 0,u=void 0;return t&&(i=n||r)?("pm"===i[0].parser(i[1])&&(o=!0),a=t):a=t||e,a?(u=a[0].parser(a[1]),o&&(u+=12),u):null}],MINUTE:[e.M,t],SECOND:[e.S,t]}},p.findTokens=function(e){for(var t=p.TOKEN_PREFIX,n=p.getTokenDefinitions(),r=Object.keys(n),a=[],i=void 0,o=void 0;(i=e.indexOf(t,i+1))>=0;)o=e[i+1],-1!==r.indexOf(o)&&a.push({index:i,token:o});return a},p.formatAs=function(e,t){var n,r=s(e),a=p.findTokens(t),i=p.getTokenDefinitions(),o=String(t),u=p.TOKEN_PREFIX,c=void 0,f=void 0,l=void 0;for(l=0,n=a.length;l<n;l++)f=i[c=a[l].token].formatter(r),o=o.replace(new RegExp(u+c,"g"),f);return o},p.prototype.parse=function(e,t){var n=p.tokenResolver(),r=this.extractTokenValue(e),a=p.DATETIME_PARAM_SEQUENCE,i=t&&t.noBreak,o=[],u=[],c=void 0,f=void 0,l=void 0,s=void 0,d=void 0,h=void 0,v=void 0,m=void 0;for(c in n)if({}.hasOwnProperty.call(n,c)){for(u.length=0,l=(f=n[c]).splice(f.length-1,1)[0],d=0,m=f.length;d<m;d++)void 0===(s=r[(h=f[d]).name])?u.push(null):u.push([h,s]);if(null==(v=l.apply(this,u))&&!i)break;o[a[c]]=v}return o},p.prototype.extractTokenValue=function(e){var t,n=this.format,r=p.getTokenDefinitions(),a=p.TOKEN_PREFIX,i=p.findTokens(n),o={},u=void 0,c=void 0,f=void 0,l=void 0,s=void 0,d=void 0;s=String(n);var h=i.map(function(e){return e.token}),v=i.length;for(d=v-1;d>=0;d--)(f=i[d].index)+1!==s.length-1?(void 0===u&&(u=s.length),l=s.substring(f+2,u),s=s.substring(0,f+2)+RegExp.escape(l)+s.substring(u,s.length),u=f):u=f;for(d=0;d<v;d++)c=i[d],s=s.replace(a+c.token,r[c.token].extract());var m=e.match(new RegExp(s))||[];for(m.shift(),d=0,t=h.length;d<t;d++)o[h[d]]=m[d];return o},p.prototype.getNativeDate=function(e){if(e instanceof Date)return e;if(isFinite(e)&&this.format)return new Date(e);var t=this.dtParams=this.parse(e);return t.unshift(null),this.nativeDate=new(Function.prototype.bind.apply(Date,t)),this.nativeDate},p.prototype.formatAs=function(e,t){var n=void 0;return t?n=this.nativeDate=this.getNativeDate(t):(n=this.nativeDate)||(n=this.getNativeDate(t)),p.formatAs(n,e)};var h=function h(e){var t=0;return function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r.forEach(function(n,r){e[r]instanceof Array||(e[r]=Array.from({length:t})),e[r].push(n)}),t++}},v="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)},m="object",y=Object.prototype.toString,b="[object Object]",g="[object Array]";function w(e,t){for(var n=t.length,r=-1;n;){if(e===t[n])return n;n-=1}return r}function _(e,t,n){return(void 0===e?"undefined":v(e))!==m&&(void 0===t?"undefined":v(t))!==m?null:(void 0===t?"undefined":v(t))!==m||null===t?e:((void 0===e?"undefined":v(e))!==m&&(e=t instanceof Array?[]:{}),function e(t,n,r,a,i){var o,u,c,f,l;if(i?(a.push(t),i.push(n)):(a=[t],i=[n]),n instanceof Array)for(o=0;o<n.length;o+=1){try{u=t[o],c=n[o]}catch(e){continue}(void 0===c?"undefined":v(c))!==m?r&&void 0===c||(t[o]=c):(null!==u&&(void 0===u?"undefined":v(u))===m||(u=t[o]=c instanceof Array?[]:{}),-1!==(l=w(c,i))?u=t[o]=a[l]:e(u,c,r,a,i))}else for(o in n){try{u=t[o],c=n[o]}catch(e){continue}if(null!==c&&(void 0===c?"undefined":v(c))===m)(f=y.call(c))===b?(null!==u&&(void 0===u?"undefined":v(u))===m||(u=t[o]={}),-1!==(l=w(c,i))?u=t[o]=a[l]:e(u,c,r,a,i)):f===g?(null!==u&&u instanceof Array||(u=t[o]=[]),-1!==(l=w(c,i))?u=t[o]=a[l]:e(u,c,r,a,i)):t[o]=c;else{if(r&&void 0===c)continue;t[o]=c}}return t}(e,t,n),e)}function O(e){return Array.isArray(e)}var E=function E(){return"id-"+(new Date).getTime()+Math.round(1e4*Math.random())};function A(e,t){if(!O(e)||!O(t))return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function j(e){return e}var S=function S(e){return"string"==typeof e?o.DSV_STR:O(e)&&O(e[0])?o.DSV_ARR:O(e)&&(0===e.length||function(e){return e===Object(e)}(e[0]))?o.FLAT_JSON:null},F={data:{},createNamespace:function createNamespace(e,t){var n=t||E();return this.data[n]={name:n,fields:e,fieldsObj:function fieldsObj(){var e=this._cachedFieldsObj;return e||(e=this._cachedFieldsObj={},this.fields.forEach(function(t){e[t.name()]=t})),e},getMeasure:function getMeasure(){var e=this._cachedMeasure;return e||(e=this._cachedMeasure={},this.fields.forEach(function(t){t.schema().type===f.MEASURE&&(e[t.name()]=t)})),e},getDimension:function getDimension(){var e=this._cachedDimension;return this._cachedDimension||(e=this._cachedDimension={},this.fields.forEach(function(t){t.schema().type===f.DIMENSION&&(e[t.name()]=t)})),e}},this.data[n]}},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),N=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"_value",{enumerable:!1,configurable:!1,writable:!1,value:t}),this.field=n}return k(e,[{key:"toString",value:function value(){return String(this.value)}},{key:"valueOf",value:function value(){return this.value}},{key:"value",get:function get(){return this._value}}]),e}();function D(e,t){e.length>0&&e.split(",").forEach(function(e){var n=e.split("-"),r=+n[0],a=+(n[1]||n[0]);if(a>=r)for(var i=r;i<=a;i+=1)t(i)})}var T=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function M(e,t){var n=[],r=[];return e.fields.forEach(function(e){r.push(e.schema().name)}),t.fields.forEach(function(e){-1!==r.indexOf(e.schema().name)&&n.push(e.schema().name)}),n}var x="select",C="project",I="group",U="compose",V={CROSS:"cross",LEFTOUTER:"leftOuter",RIGHTOUTER:"rightOuter",NATURAL:"natural",FULLOUTER:"fullOuter"};function B(){return!0}function J(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.CROSS,i=[],o=[],u=n||B,c=e.getFieldspace(),f=t.getFieldspace(),l=c.name,s=f.name,d=c.name+"."+f.name,p=M(c,f);if(l===s)throw new Error("DataModels must have different alias names");return c.fields.forEach(function(e){var t=_({},e.schema());-1===p.indexOf(t.name)||r||(t.name=c.name+"."+t.name),i.push(t)}),f.fields.forEach(function(e){var t=_({},e.schema());-1!==p.indexOf(t.name)?r||(t.name=f.name+"."+t.name,i.push(t)):i.push(t)}),D(e._rowDiffset,function(n){var d=!1,h=void 0;D(t._rowDiffset,function(v){var m=[],y={};y[l]={},y[s]={},c.fields.forEach(function(e){m.push(e.partialField.data[n]),y[l][e.name()]=e.partialField.data[n]}),f.fields.forEach(function(e){-1!==p.indexOf(e.schema().name)&&r||m.push(e.partialField.data[v]),y[s][e.name()]=e.partialField.data[v]});var b=nt(y[l]),g=nt(y[s]);if(u(b,g,function(){return e.detachedRoot()},function(){return t.detachedRoot()},{})){var w={};m.forEach(function(e,t){w[i[t].name]=e}),d&&V.CROSS!==a?o[h]=w:(o.push(w),d=!0,h=n)}else if((a===V.LEFTOUTER||a===V.RIGHTOUTER)&&!d){var _={},O=c.fields.length-1;m.forEach(function(e,t){_[i[t].name]=t<=O?e:null}),d=!0,h=n,o.push(_)}})}),new wt(o,i,{name:d})}function G(e,t){var n=""+e,r=""+t;return n<r?-1:n>r?1:0}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G;return e.length>1&&function e(t,n,r,a){if(r===n)return t;var i=n+Math.floor((r-n)/2);return e(t,n,i,a),e(t,i+1,r,a),function(e,t,n,r,a){for(var i=e,o=[],u=t;u<=r;u+=1)o[u]=i[u];for(var c=t,f=n+1,l=t;l<=r;l+=1)c>n?(i[l]=o[f],f+=1):f>r?(i[l]=o[c],c+=1):a(o[c],o[f])<=0?(i[l]=o[c],c+=1):(i[l]=o[f],f+=1)}(t,n,i,r,a),t}(e,0,e.length-1,t),e}function W(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function z(e,t,n){var r=void 0;switch(e){case c.CONTINUOUS:case u.TEMPORAL:r="desc"===t?function(e,t){return t[n]-e[n]}:function(e,t){return e[n]-t[n]};break;default:r=function r(e,_r){var a=""+e[n],i=""+_r[n];return a<i?"desc"===t?1:-1:a>i?"desc"===t?-1:1:0}}return r}function q(e,t){var n=new Map,r=[];return e.forEach(function(e){var a=e[t];n.has(a)?r[n.get(a)][1].push(e):(r.push([a,[e]]),n.set(a,r.length-1))}),r}function X(e,t,n){var r={label:e[0]};return t.reduce(function(t,r,a){return t[r]=e[1].map(function(e){return e[n[a].index]}),t},r),r}function Q(e,t){var n={},r=[],a=[],i=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!A(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t,r){D(e._rowDiffset,function(e){var o={},u="";a.forEach(function(n){var r=t[n].partialField.data[e];u+="-"+r,o[n]=r}),n[u]||(r&&i.push(o),n[u]=!0)})}return e._colIdentifier.split(",").forEach(function(e){var t=c[e];r.push(_({},t.schema())),a.push(t.schema().name)}),s(t,f,!1),s(e,c,!0),new wt(i,r,{name:l})}function Z(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function ee(e){if(O(e)){var t=e.reduce(function(e,t){return null==t?e:e+ +t},null);return Number.isNaN(t)?null:t}return null}function te(e){if(O(e)){var t=ee(e),n=e.length||1;return Number.isNaN(t)||null===t?null:t/n}return null}var ne={sum:ee,avg:te,min:function min(e){if(O(e)){var t=e.filter(function(e){return!(null==e||Number.isNaN(+e))});return t.length?Math.min.apply(Math,Z(t)):null}return null},max:function max(e){if(O(e)){var t=e.filter(function(e){return!(null==e||Number.isNaN(+e))});return t.length?Math.max.apply(Math,Z(t)):null}return null},first:function first(e){return e[0]},last:function last(e){return e[e.length-1]},count:function count(e){return O(e)?e.length:null},std:function std(e){return Math.sqrt(function(e){var t=te(e);return te(e.map(function(e){return Math.pow(e-t,2)}))}(e))}},re="sum",ae=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ie=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=new Map,this.store.set("defReducer",ee),Object.entries(ne).forEach(function(e){t.store.set(e[0],e[1])})}return ae(e,[{key:"defaultReducer",value:function value(){if(!arguments.length)return this.store.get("defReducer");var e=arguments.length<=0?void 0:arguments[0];if("function"==typeof e)this.store.set("defReducer",e);else{if(e=String(e),-1===Object.keys(ne).indexOf(e))throw new Error("Reducer "+e+" not found in registry");this.store.set("defReducer",ne[e])}return this}},{key:"register",value:function value(e,t){var n=this;if("function"!=typeof t)throw new Error("Reducer should be a function");return e=String(e),this.store.set(e,t),function(){n.__unregister(e)}}},{key:"__unregister",value:function value(e){this.store.has(e)&&this.store.delete(e)}},{key:"resolve",value:function value(e){return e instanceof Function?e:this.store.get(e)}}]),e}(),oe=function(){var e=null;return null===e&&(e=new ie),e}(),ue=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function fe(e,t){var n=M(e.getFieldspace(),t.getFieldspace());return function(e,t){var r=!0;return n.forEach(function(n){r=!(e[n].value!==t[n].value||!r)}),r}}function le(e,t){var n={},r=[],a=[],i=[],o=e.getFieldspace(),u=t.getFieldspace(),c=o.fieldsObj(),f=u.fieldsObj(),l=o.name+" union "+u.name;if(!A(e._colIdentifier.split(",").sort(),t._colIdentifier.split(",").sort()))return null;function s(e,t){D(e._rowDiffset,function(e){var r={},o="";a.forEach(function(n){var a=t[n].partialField.data[e];o+="-"+a,r[n]=a}),n[o]||(i.push(r),n[o]=!0)})}return e._colIdentifier.split(",").forEach(function(e){var t=c[e];r.push(_({},t.schema())),a.push(t.schema().name)}),s(e,c),s(t,f),new Dt(i,r,{name:l})}function se(e,t,n){return J(e,t,n,!1,V.LEFTOUTER)}function de(e,t,n){return J(t,e,n,!1,V.RIGHTOUTER)}var pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),he=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.partialField=t,this.rowDiffset=n}return pe(e,[{key:"domain",value:function value(){throw new Error("Not yet implemented")}},{key:"schema",value:function value(){return this.partialField.schema}},{key:"name",value:function value(){return this.partialField.name}},{key:"type",value:function value(){return this.partialField.schema.type}},{key:"subtype",value:function value(){return this.partialField.schema.subtype}},{key:"description",value:function value(){return this.partialField.schema.description}},{key:"displayName",value:function value(){return this.partialField.schema.displayName||this.partialField.schema.name}},{key:"data",value:function value(){var e=this,t=[];return D(this.rowDiffset,function(n){t.push(e.partialField.data[n])}),t}},{key:"formattedData",value:function value(){throw new Error("Not yet implemented")}}]),e}(),ve=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),me=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,he),ve(t,[{key:"domain",value:function value(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"calculateDataDomain",value:function value(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function value(){return this.data()}}]),t}(),ye=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),be=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,me),ye(t,[{key:"subtype",value:function value(){return u.CATEGORICAL}},{key:"calculateDataDomain",value:function value(){var e=this,t=new Set,n=[];return D(this.rowDiffset,function(r){var a=e.partialField.data[r];null!==a&&(t.has(a)||(t.add(a),n.push(a)))}),n}}]),t}(),ge=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),we=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._cachedMinDiff=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,me),ge(t,[{key:"calculateDataDomain",value:function value(){var e=this,t=new Set,n=[];return D(this.rowDiffset,function(r){var a=e.partialField.data[r];null!==a&&(t.has(a)||(t.add(a),n.push(a)))}),n}},{key:"minimumConsecutiveDifference",value:function value(){if(this._cachedMinDiff)return this._cachedMinDiff;for(var e=this.data().sort(function(e,t){return e-t}),t=e.length,n=Number.POSITIVE_INFINITY,r=void 0,a=void 0,i=0,o=1;o<t;o++)r=e[o-1],(a=e[o])!==r&&(n=Math.min(n,a-e[o-1]),i++);return i||(n=null),this._cachedMinDiff=n,this._cachedMinDiff}},{key:"format",value:function value(){return this.partialField.schema.format}},{key:"formattedData",value:function value(){var e=this,t=[];return D(this.rowDiffset,function(n){var r=e.partialField.data[n];null===r?t.push(null):t.push(p.formatAs(r,e.format()))}),t}}]),t}(),_e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Oe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,me),_e(t,[{key:"calculateDataDomain",value:function value(){var e=this.partialField.schema.bins;return[e[0],e[e.length-1]]}},{key:"bins",value:function value(){return this.partialField.schema.bins}}]),t}(),Ee=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ae=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,he),Ee(t,[{key:"domain",value:function value(){return this._cachedDomain||(this._cachedDomain=this.calculateDataDomain()),this._cachedDomain}},{key:"unit",value:function value(){return this.partialField.schema.unit}},{key:"defAggFn",value:function value(){return this.partialField.schema.defAggFn||re}},{key:"numberFormat",value:function value(){var e=this.partialField.schema.numberFormat;return e instanceof Function?e:j}},{key:"calculateDataDomain",value:function value(){throw new Error("Not yet implemented")}},{key:"formattedData",value:function value(){return this.data()}}]),t}(),je=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Se=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ae),je(t,[{key:"subtype",value:function value(){return c.CONTINUOUS}},{key:"calculateDataDomain",value:function value(){var e=this,t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return D(this.rowDiffset,function(r){var a=e.partialField.data[r];null!==a&&(a<t&&(t=a),a>n&&(n=a))}),[t,n]}}]),t}(),Fe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return Fe(e,[{key:"parse",value:function value(){throw new Error("Not yet implemented")}}]),e}(),Ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),De=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,ke),Ne(t,[{key:"parse",value:function value(e){return null==e?null:String(e).trim()}}]),t}(),Te=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Re=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.schema=e,n._dtf=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,ke),Te(t,[{key:"parse",value:function value(e){return null==e?null:this.schema.format?(this._dtf=this._dtf||new p(this.schema.format),this._dtf.getNativeDate(e).getTime()):+new Date(e)}}]),t}(),Pe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Me=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,ke),Pe(t,[{key:"parse",value:function value(e){if(null==e)return null;var t=(e=String(e)).match(/^\s*([+-]?\d+(?:\.\d+)?)\s*-\s*([+-]?\d+(?:\.\d+)?)\s*$/);return t?Number.parseFloat(t[1])+"-"+Number.parseFloat(t[2]):null}}]),t}(),xe=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ce=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,ke),xe(t,[{key:"parse",value:function value(e){return e=parseFloat(e,10),Number.isNaN(e)?null:e}}]),t}(),Ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ue=function(){function e(t,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.schema=r,this.parser=a,this.data=this._sanitize(n)}return Ie(e,[{key:"_sanitize",value:function value(e){var t=this;return e.map(function(e){return t.parser.parse(e)})}}]),e}();function Le(e,t,n){var r={};return n&&n.length||(n=t.map(function(e){return e.name})),n.forEach(function(e,t){r[e]=t}),t.map(function(t){return function(e,t){e=e||[];var n=void 0;switch(t.type){case f.MEASURE:switch(t.subtype){case c.CONTINUOUS:default:return n=new Ue(t.name,e,t,new Ce),new Se(n,"0-"+(e.length-1))}case f.DIMENSION:switch(t.subtype){case u.CATEGORICAL:return n=new Ue(t.name,e,t,new De),new be(n,"0-"+(e.length-1));case u.TEMPORAL:return n=new Ue(t.name,e,t,new Re(t)),new we(n,"0-"+(e.length-1));case u.BINNED:return n=new Ue(t.name,e,t,new Me),new Oe(n,"0-"+(e.length-1));default:return n=new Ue(t.name,e,t,new De),new be(n,"0-"+(e.length-1))}default:return n=new Ue(t.name,e,t,new De),new be(n,"0-"+(e.length-1))}}(e[r[t.name]],t)})}var He={dataFormat:o.AUTO},Ve=function Ve(e,t){t=Object.assign({},{firstRowHeader:!0},t);var n,r=[],a=h(r);return n=t.firstRowHeader?e.splice(0,1)[0]:[],e.forEach(function(e){return a.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e))}),[n,r]},Ye={},Be={},Je=34,Ge=10,Ke=13;function We(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}var ze=function ze(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,a=[],i=e.length,o=0,u=0,c=i<=0,f=!1;function l(){if(c)return Be;if(f)return f=!1,Ye;var t,r,a=o;if(e.charCodeAt(a)===Je){for(;o++<i&&e.charCodeAt(o)!==Je||e.charCodeAt(++o)===Je;);return(t=o)>=i?c=!0:(r=e.charCodeAt(o++))===Ge?f=!0:r===Ke&&(f=!0,e.charCodeAt(o)===Ge&&++o),e.slice(a+1,t-1).replace(/""/g,'"')}for(;o<i;){if((r=e.charCodeAt(t=o++))===Ge)f=!0;else if(r===Ke)f=!0,e.charCodeAt(o)===Ge&&++o;else if(r!==n)continue;return e.slice(a,t)}return c=!0,e.slice(a,i)}for(e.charCodeAt(i-1)===Ge&&--i,e.charCodeAt(i-1)===Ke&&--i;(r=l())!==Be;){for(var s=[];r!==Ye&&r!==Be;)s.push(r),r=l();t&&null==(s=t(s,u++))||a.push(s)}return a}function a(t){return t.map(i).join(e)}function i(e){return null==e?"":t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function parse(e,t){var n,a,i=r(e,function(e,r){if(n)return n(e,r-1);a=e,n=t?function(e,t){var n=We(e);return function(r,a){return t(n(r),a,e)}}(e,t):We(e)});return i.columns=a||[],i},parseRows:r,format:function format(t,n){return null==n&&(n=function(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var r in e)r in t||n.push(t[r]=r)}),n}(t)),[n.map(i).join(e)].concat(t.map(function(t){return n.map(function(e){return i(t[e])}).join(e)})).join("\n")},formatRows:function formatRows(e){return e.map(a).join("\n")}}},qe=ze(","),Xe=(qe.parse,qe.parseRows,qe.format,qe.formatRows,ze("\t"));Xe.parse,Xe.parseRows,Xe.format,Xe.formatRows;var $e=function $e(e,t){t=Object.assign({},{firstRowHeader:!0,fieldSeparator:","},t);var n=ze(t.fieldSeparator);return Ve(n.parseRows(e),t)},Qe=function Qe(e){var t={},n=0,r=void 0,a=[],i=h(a);return e.forEach(function(e){var a=[];for(var o in e)o in t?r=t[o]:(t[o]=n++,r=n-1),a[r]=e[o];i.apply(void 0,a)}),[Object.keys(t),a]},Ze=function Ze(e,t){var n={FlatJSON:Qe,DSVStr:$e,DSVArr:Ve},r=S(e);if(!r)throw new Error("Couldn't detect the data format");return n[r](e,t)},et=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function tt(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function nt(e){var t={};return Object.keys(e).forEach(function(n){t[n]=new N(e[n],n)}),t}var at=function at(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments[3],i=void 0;t!==U?(i={op:t,meta:r,criteria:a},e._derivation.push(i)):(i=[].concat(tt(a)),e._derivation.length=0,(n=e._derivation).push.apply(n,tt(i)))},ot=function ot(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.operation||"and",a=n.filterByMeasure||!1,i=[];i=t.length?t.map(function(e){return n=(t=e).getData(),r=n.schema,i=t.getFieldsConfig(),o=t.getFieldspace().fieldsObj(),u=n.data,c=Object.values(i).reduce(function(e,t){return e[t.def.name]=o[t.def.name].domain(),e},{}),function(e){return!!u.length&&u.some(function(t){return r.every(function(n){if(!(n.name in e))return!0;var r=e[n.name].valueOf();if(a&&n.type===f.MEASURE)return r>=c[n.name][0]&&r<=c[n.name][1];if(n.type!==f.DIMENSION)return!0;var o=i[n.name].index;return t[o]===e[n.name].valueOf()})})};var t,n,r,i,o,u,c}):[function(){return!1}];return"and"===r?e.clone(!1,!1).select(function(e){return i.every(function(t){return t(e)})},{saveChild:!1,mode:l.ALL}):e.clone(!1,!1).select(function(e){return i.some(function(t){return t(e)})},{mode:l.ALL,saveChild:!1})},ut=function ut(e,t,n,r){var a=e.clone(r.saveChild),i=function it(e,t,n,r,a){var i=[],o=-1,u=r.mode,c=void 0,f={},s=function s(){return a.detachedRoot()},d=function d(e){return n(function(e,t){var n={},r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;n[c.name()]=new N(c.partialField.data[t],c)}}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(t,e),e,s,f)},p=void 0;return p=u===l.INVERSE?function(e){return!d(e)}:function(e){return d(e)},D(e,function(e){p(e)&&(-1!==o&&e===o+1?(c=i.length-1,i[c]=i[c].split("-")[0]+"-"+e):i.push(""+e),o=e)}),i.join(",")}(a._rowDiffset,a.getPartialFieldspace().fields,t,n,e);return a._rowDiffset=i,a.__calculateFieldspace().calculateFieldsConfig(),r.saveChild&&at(a,x,{config:n},t),a},ct=function ct(e,t,n,r){var a=e.clone(n.saveChild),i=t;return n.mode===l.INVERSE&&(i=r.filter(function(e){return-1===t.indexOf(e)})),a._colIdentifier=i.join(","),a.__calculateFieldspace().calculateFieldsConfig(),n.saveChild&&at(a,C,{projField:t,config:n,actualProjField:i},null),a},ft=function ft(e){if((e=_({},e)).type||(e.type=f.DIMENSION),!e.subtype)switch(e.type){case f.MEASURE:e.subtype=c.CONTINUOUS;break;default:case f.DIMENSION:e.subtype=u.CATEGORICAL}return e},lt=function lt(e,t,n,r){n=n.map(function(e){return ft(e)}),r=Object.assign(Object.assign({},He),r);var i=a[r.dataFormat];if(!i||"function"!=typeof i)throw new Error("No converter function found for "+r.dataFormat+" format");var u=i(t,r),c=et(u,2),f=c[0],l=c[1],s=Le(l,n,f),d=F.createNamespace(s,r.name);return e._partialFieldspace=d,e._rowDiffset=l.length&&l[0].length?"0-"+(l[0].length-1):"",e._colIdentifier=n.map(function(e){return e.name}).join(),e._dataFormat=r.dataFormat===o.AUTO?S(t):r.dataFormat,e},st=function st(e,t){for(var n=0;n<e.length;++n)if(t===e[n].name)return{type:e[n].subtype||e[n].type,index:n};return null},dt=function dt(e,t){var n,r,a=function(e){var t=e._derivation,n=[],r=void 0;if(t&&1===t.length)switch(r=t[0].op){case x:n=[t[0].criteria];break;case C:n=[t[0].meta.actualProjField];break;case I:r="groupBy",n=[t[0].meta.groupByString.split(","),t[0].criteria]}return{operation:r,params:n}}(t),i=a.operation,o=a.params,u=e[0],c=e[1];return i&&o.length&&(u=(n=e[0])[i].apply(n,tt(o).concat([{saveChild:!1}])),c=(r=e[1])[i].apply(r,tt(o).concat([{saveChild:!1}]))),[u,c]},pt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.nonTraversingModel,o=a.excludeModels||[];t!==i&&((!o.length||-1===o.indexOf(t))&&t.handlePropagation(n,r),t._children.forEach(function(t){var i=dt(n,t),o=et(i,2),u=o[0],c=o[1];e(t,[u,c],r,a)}))},vt=function vt(e,t,n,r){var a=void 0,i=void 0,o=n.propagationNameSpace,u=n.propagateToSource,c=n.sourceId,f=r.propagateInterpolatedValues,l=[];if(null===e&&!0!==r.persistent)l=[{criteria:[]}];else{var s,d=Object.values(o.mutableActions);!1!==u&&(d=d.filter(function(e){return e.config.sourceId!==c}));var p=d.filter(function(e){return(r.filterFn||function(){return!0})(e,r)}).map(function(e){return e.config.criteria}),h=[];if(!1!==u){var v=Object.values(o.mutableActions);v.forEach(function(e){var t=e.config;!1===t.applyOnSource&&t.action===r.action&&t.sourceId!==c&&(h.push(e.model),(a=v.filter(function(t){return t!==e}).map(function(e){return e.config.criteria})).length&&l.push({criteria:a,models:e.model,path:function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return null!==t._parent&&(n.push(t),e(t._parent,n)),n}(e.model)}))})}a=(s=[]).concat.apply(s,[].concat(tt(p),[e])).filter(function(e){return null!==e}),l.push({criteria:a,excludeModels:[].concat(h,tt(r.excludeModels||[]))})}var m=t.model,y=Object.assign({sourceIdentifiers:e,propagationSourceId:c},r),b=t.groupByModel;f&&b&&(i=ot(b,a,{filterByMeasure:f}),pt(b,i,y)),l.forEach(function(e){var t=ot(m,e.criteria),n=e.path;if(n){var r=function(e,t){for(var n=0,r=t.length;n<r;n++){var a=t[n];e=dt(e,a)}return e}(t,n.reverse());e.models.handlePropagation(r,y)}else pt(m,t,y,{excludeModels:e.excludeModels,nonTraversingModel:f&&b})})},mt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),yt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=void 0;this._parent=null,this._derivation=[],this._children=[];for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];1===r.length&&(t=r[0])instanceof e?(this._colIdentifier=t._colIdentifier,this._rowDiffset=t._rowDiffset,this._dataFormat=t._dataFormat,this._parent=t,this._partialFieldspace=this._parent._partialFieldspace,this._fieldStoreName=E(),this.__calculateFieldspace().calculateFieldsConfig()):(lt.apply(void 0,[this].concat(r)),this._fieldStoreName=this._partialFieldspace.name,this.__calculateFieldspace().calculateFieldsConfig(),this._propagationNameSpace={mutableActions:{},immutableActions:{}})}return mt(e,[{key:"getSchema",value:function value(){return this.getFieldspace().fields.map(function(e){return e.schema()})}},{key:"getName",value:function value(){return this._fieldStoreName}},{key:"getFieldspace",value:function value(){return this._fieldspace}},{key:"__calculateFieldspace",value:function value(){return this._fieldspace=function rt(e,t,n){var r=et(e,2),a=r[0],i=r[1],o=i.length?i.split(","):[],l=t.fieldsObj(),s=o.map(function(e){return function(e,t){var n=e.schema;switch(n.type){case f.MEASURE:switch(n.subtype){case c.CONTINUOUS:default:return new Se(e,t)}case f.DIMENSION:switch(n.subtype){case u.CATEGORICAL:return new be(e,t);case u.TEMPORAL:return new we(e,t);case u.BINNED:return new Oe(e,t);default:return new be(e,t)}default:return new be(e,t)}}(l[e].partialField,a)});return F.createNamespace(s,n)}([this._rowDiffset,this._colIdentifier],this.getPartialFieldspace(),this._fieldStoreName),this}},{key:"getPartialFieldspace",value:function value(){return this._partialFieldspace}},{key:"join",value:function value(e,t){return J(this,e,t)}},{key:"naturalJoin",value:function value(e){return J(this,e,fe(this,e),!0)}},{key:"union",value:function value(e){return le(this,e)}},{key:"difference",value:function value(e){return Q(this,e)}},{key:"select",value:function value(e,t){var n={mode:l.NORMAL,saveChild:!0},r={saveChild:(t=Object.assign({},n,t)).saveChild};return t.mode===l.ALL?[ut(this,e,{mode:l.NORMAL},r),ut(this,e,{mode:l.INVERSE},r)]:ut(this,e,t,r)}},{key:"isEmpty",value:function value(){return!this._rowDiffset.length||!this._colIdentifier.length}},{key:"clone",value:function value(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=void 0;if(!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])){var n=this.getData({getAllFields:!0}),r=n.data,a=n.schema,i=r.map(function(e){var t={};return a.forEach(function(n,r){t[n.name]=e[r]}),t});t=new this.constructor(i,a)}else t=new this.constructor(this);return e&&this._children.push(t),t}},{key:"project",value:function value(e,t){var n={mode:l.NORMAL,saveChild:!0};t=Object.assign({},n,t);var r=this.getFieldsConfig(),a=Object.keys(r),i=t.mode,o=e.reduce(function(e,t){return"RegExp"===t.constructor.name?e.push.apply(e,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a.filter(function(e){return-1!==e.search(t)}))):t in r&&e.push(t),e},[]);o=Array.from(new Set(o)).map(function(e){return e.trim()});return i===l.ALL?[ct(this,o,{mode:l.NORMAL,saveChild:t.saveChild},a),ct(this,o,{mode:l.INVERSE,saveChild:t.saveChild},a)]:ct(this,o,t,a)}},{key:"getFieldsConfig",value:function value(){return this._fieldConfig}},{key:"calculateFieldsConfig",value:function value(){return this._fieldConfig=this._fieldspace.fields.reduce(function(e,t,n){return e[t.name()]={index:n,def:{name:t.name(),type:t.type(),subtype:t.subtype()}},e},{}),this}},{key:"dispose",value:function value(){this._parent.removeChild(this),this._parent=null}},{key:"removeChild",value:function value(e){var t=this._children.findIndex(function(t){return t===e});-1===t||this._children.splice(t,1)}},{key:"addParent",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];at(this,U,null,t),this._parent=e,e._children.push(this)}},{key:"getParent",value:function value(){return this._parent}},{key:"getChildren",value:function value(){return this._children}},{key:"getDerivations",value:function value(){return this._derivation}}]),e}(),bt=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},gt=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),wt=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof(t)&&"function"!=typeof t?e:t}(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return i._onPropagation=[],i._sortingDetails=[],i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,yt),gt(t,[{key:"getData",value:function value(e){e=Object.assign({},{order:"row",formatter:null,withUid:!1,getAllFields:!1,sort:[]},e);var t=this.getPartialFieldspace().fields,n=function $(e,t,n,r,a){var i={schema:[],data:[],uids:[]},o=(a=Object.assign({},{addUid:!1,columnWise:!1},a)).addUid,u=r&&r.length>0,c=[];if(n.split(",").forEach(function(t){for(var n=0;n<e.length;n+=1)if(e[n].name()===t){c.push(e[n]);break}}),c.forEach(function(e){i.schema.push(e.schema())}),o&&i.schema.push({name:"uid",type:"identifier"}),D(t,function(e){i.data.push([]);var t=i.data.length-1;c.forEach(function(n,r){i.data[t][r+0]=n.partialField.data[e]}),o&&(i.data[t][c.length]=e),i.uids.push(e),u&&i.data[t].push(e)}),u&&function(e,t){for(var n=e.data,r=e.schema,a=void 0,i=void 0,o=void 0,u=t.length-1;u>=0;u--)a=t[u][0],i=t[u][1],(o=st(r,a))&&("function"==typeof i?K(n,function(e,t){return i(e[o.index],t[o.index])}):O(i)?function(){var e=q(n,o.index),t=i[i.length-1],a=i.slice(0,i.length-1),u=a.map(function(e){return st(r,e)});e.forEach(function(e){e.push(X(e,a,u))}),K(e,function(e,n){var r=e[2],a=n[2];return t(r,a)}),n.length=0,e.forEach(function(e){n.push.apply(n,W(e[1]))})}():(i="desc"===String(i).toLowerCase()?"desc":"asc",K(n,z(o.type,i,o.index))));e.uids=[],n.forEach(function(t){e.uids.push(t.pop())})}(i,r),a.columnWise){var f=Array.apply(void 0,W(Array(i.schema.length))).map(function(){return[]});i.data.forEach(function(e){e.forEach(function(e,t){f[t].push(e)})}),i.data=f}return i}.call(this,this.getPartialFieldspace().fields,this._rowDiffset,e.getAllFields?t.map(function(e){return e.name()}).join():this._colIdentifier,e.sort,{columnWise:"column"===e.order,addUid:!!e.withUid});if(!e.formatter)return n;var r=e.formatter,a=n.data,i=n.schema,o=n.uids,u=i.map(function(e){return e.name}),c=Object.keys(r).reduce(function(e,t){var n=u.indexOf(t);return-1!==n&&e.push([n,r[t]]),e},[]);return"column"===e.order?c.forEach(function(e){var t=e[0],n=e[1];a[t].forEach(function(e,r){a[t][r]=n.call(void 0,e,o[r],i[t])})}):a.forEach(function(e,t){c.forEach(function(n){var r=n[0],a=n[1];e[r]=a.call(void 0,e[r],o[t],i[r])})}),n}},{key:"groupBy",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{saveChild:!0},r=""+e.join(),i=function ce(e,t,n,r){var a=function(e,t){var n=[],r=e.getFieldspace().getDimension();return Object.entries(r).forEach(function(e){var r=ue(e,1)[0];t&&t.length?-1!==t.indexOf(r)&&n.push(r):n.push(r)}),n}(e,t),i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=e.getFieldspace().getMeasure(),a=oe.defaultReducer();return Object.keys(r).forEach(function(e){"string"!=typeof t[e]&&(t[e]=r[e].defAggFn());var i=oe.resolve(t[e]);i?n[e]=i:(n[e]=a,t[e]=re)}),n}(e,n),o=e.getFieldspace(),u=o.fieldsObj(),c=o.name,l=[],s=[],d=[],p={},h=[],v=void 0;Object.entries(u).forEach(function(e){var t=ue(e,2),n=t[0],r=t[1];if(-1!==a.indexOf(n)||i[n])switch(d.push(_({},r.schema())),r.schema().type){case f.MEASURE:s.push(n);break;default:case f.DIMENSION:l.push(n)}});var m=0;D(e._rowDiffset,function(e){var t="";l.forEach(function(n){t=t+"-"+u[n].partialField.data[e]}),void 0===p[t]?(p[t]=m,h.push({}),l.forEach(function(t){h[m][t]=u[t].partialField.data[e]}),s.forEach(function(t){h[m][t]=[u[t].partialField.data[e]]}),m+=1):s.forEach(function(n){h[p[t]][n].push(u[n].partialField.data[e])})});var y={},b=function b(){return e.detachedRoot()};return h.forEach(function(e){var t=e;s.forEach(function(n){t[n]=i[n](e[n],b,y)})}),r?(r.__calculateFieldspace(),v=r):v=new Dt(h,d,{name:c}),v}.apply(void 0,[this,e,t]);return n.saveChild&&(this._children.push(i),at(i,I,{fieldsArr:e,groupByString:r,defaultReducer:oe.defaultReducer()},t)),i._parent=this,i}},{key:"sort",value:function value(e){var t=this.getData({order:"row",sort:e}),n=[t.schema.map(function(e){return e.name})].concat(t.data),r=new this.constructor(n,t.schema,{dataFormat:"DSVArr"});return r._sortingDetails=e,r}},{key:"serialize",value:function value(e,t){e=e||this._dataFormat,t=Object.assign({},{fieldSeparator:","},t);var n=this.getFieldspace().fields,r=n.map(function(e){return e.formattedData()}),a=r[0].length,i=void 0,u=void 0,c=void 0;if(e===o.FLAT_JSON)for(i=[],u=0;u<a;u++){var f={};for(c=0;c<n.length;c++)f[n[c].name()]=r[c][u];i.push(f)}else if(e===o.DSV_STR){for(i=[n.map(function(e){return e.name()}).join(t.fieldSeparator)],u=0;u<a;u++){var l=[];for(c=0;c<n.length;c++)l.push(r[c][u]);i.push(l.join(t.fieldSeparator))}i=i.join("\n")}else{if(e!==o.DSV_ARR)throw new Error("Data type "+e+" is not supported");for(i=[n.map(function(e){return e.name()})],u=0;u<a;u++){var s=[];for(c=0;c<n.length;c++)s.push(r[c][u]);i.push(s)}}return i}},{key:"addField",value:function value(e){var t=e.name();this._colIdentifier+=","+t;var n=this._partialFieldspace;if(n.fieldsObj()[e.name()]){var r=n.fields.findIndex(function(e){return e.name()===t});r>=0&&(n.fields[r]=e)}else n.fields.push(e);return n._cachedFieldsObj=null,n._cachedDimension=null,n._cachedMeasure=null,this.__calculateFieldspace().calculateFieldsConfig(),this}},{key:"calculateVariable",value:function value(e,t,n){var r=this;e=ft(e),n=Object.assign({},{saveChild:!0,replaceVar:!1},n);var a=this.getFieldsConfig(),i=t.slice(0,t.length-1),o=t[t.length-1];if(a[e.name]&&!n.replaceVar)throw new Error(e.name+" field already exists in datamodel");var u=i.map(function(e){var t=a[e];if(!t)throw new Error(e+" is not a valid column name.");return t.index}),c=this.clone(),f=c.getFieldspace().fields,l=u.map(function(e){return f[e]}),s={},d=function d(){return r.detachedRoot()},p=[];D(c._rowDiffset,function(e){var t=l.map(function(t){return t.partialField.data[e]});p[e]=o.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t).concat([e,d,s]))});var h=Le([p],[e],[e.name]),v=bt(h,1)[0];return c.addField(v),n.saveChild&&at(c,"calculatedVariable",{config:e,fields:i},o),c}},{key:"propagate",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=t.isMutableAction,i=t.sourceId,o=t.payload,u=function e(t){return t._parent?e(t._parent):t}(this),c=u._propagationNameSpace,f={groupByModel:function e(t){return t._parent&&t._derivation.find(function(e){return"group"!==e.op})?e(t._parent):t}(this),model:u};return n&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=void 0,a=t.isMutableAction,i=t.criteria,o=t.action+"-"+t.sourceId;r=a?e.mutableActions:e.immutableActions,null===i?delete r[o]:r[o]={model:n,config:t}}(c,t,this),vt(e,f,{propagationNameSpace:c,sourceId:i},Object.assign({payload:o},t)),a&&function(e,t,n){var r=e.immutableActions;for(var a in r){var i=r[a].config,o=n.config.sourceId,u=!n.propConfig.filterImmutableAction||n.propConfig.filterImmutableAction(i,n.config);if(i.sourceId!==o&&u){var c=i.criteria;vt(c,t,{propagationNameSpace:e,propagateToSource:!1,sourceId:o},i)}}}(c,f,{config:t,propConfig:r}),this}},{key:"on",value:function value(e,t){switch(e){case"propagation":this._onPropagation.push(t)}return this}},{key:"unsubscribe",value:function value(e){switch(e){case"propagation":this._onPropagation=[]}return this}},{key:"handlePropagation",value:function value(e,t){var n=this;this._onPropagation.forEach(function(r){return r.call(n,e,t)})}},{key:"bin",value:function value(e,t){var n=this.getFieldsConfig();if(!n[e])throw new Error("Field "+e+" doesn't exist");var r=t.name||e+"_binned";if(n[r])throw new Error("Field "+r+" already exists");var a=function(e,t,n){var r=n.buckets,a=n.binsCount,i=n.binSize,o=n.start,u=n.end,c=e.domain(),f=T(c,2),l=f[0],s=f[1];r||(o=0!==o&&(!o||o>l)?l:o,u=0!==u&&(!u||u<s)?s+1:u,a&&(i=Math.ceil(Math.abs(u-o)/a)),r=function R(e,t,n){for(var r=[],a=t;a<n;)r.push(a),a+=e;return r.push(a),r}(i,o,u)),r[0]>l&&r.unshift(l),r[r.length-1]<=s&&r.push(s+1);for(var d=[],p=0;p<r.length-1;p++)d.push({start:r[p],end:r[p+1]});var h=[];return D(t,function(t){var n=e.partialField.data[t];if(null!==n){var r=function P(e,t){for(var n=0,r=e.length-1,a=void 0,i=void 0;n<=r;){if(t>=(i=e[a=n+Math.floor((r-n)/2)]).start&&t<i.end)return i;t>=i.end?n=a+1:t<i.start&&(r=a-1)}return null}(d,n);h.push(r.start+"-"+r.end)}else h.push(null)}),{binnedData:h,bins:r}}(this.getFieldspace().fieldsObj()[e],this._rowDiffset,t),i=a.binnedData,o=a.bins,c=Le([i],[{name:r,type:f.DIMENSION,subtype:u.BINNED,bins:o}],[r])[0],l=this.clone();return l.addField(c),at(l,"bin",{measureFieldName:e,config:t,binFieldName:r},null),l}},{key:"detachedRoot",value:function value(){return new t(this.serialize(o.FLAT_JSON),this.getSchema())}}],[{key:"Reducers",get:function get(){return oe}}]),t}(),_t=ne.sum,Ot=ne.avg,Et=ne.min,At=ne.max,jt=ne.first,St=ne.last,Ft=ne.count,kt=ne.std,Nt=n(0);wt.Operators={compose:function compose(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var r=e,a=void 0,i=[],o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{saveChild:!0}).saveChild;return t.forEach(function(e){r=e(r),i.push.apply(i,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r._derivation)),a||(a=r)}),o&&r.addParent(e,i),i.length>1&&a.dispose(),r}},bin:function bin(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.bin.apply(e,t)}},select:function select(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.select.apply(e,t)}},project:function project(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.project.apply(e,t)}},groupBy:function groupBy(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.groupBy.apply(e,t)}},calculateVariable:function calculateVariable(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.calculateVariable.apply(e,t)}},sort:function sort(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return e.sort.apply(e,t)}},crossProduct:J,difference:Q,naturalJoin:function naturalJoin(e,t){return J(e,t,fe(e,t),!0)},leftOuterJoin:se,rightOuterJoin:de,fullOuterJoin:function fullOuterJoin(e,t,n){return le(se(e,t,n),de(e,t,n))},union:le},wt.Stats=i,Object.assign(wt,r),wt.DateTimeFormatter=p,wt.DataFormat=o,wt.FilteringMode=l,wt.version=Nt.version;var Dt=t.default=wt}])})}).call(this,__webpack_require__(3)(module))},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){(function(module){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}!function(e,t){"object"==_typeof(exports)&&"object"==_typeof(module)?module.exports=t():(__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=t)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function i(e,t){e.forEach(function(e){void 0!==e&&null!==e&&(t[e]=1)})},o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._set={},i(t,this._set)}return n(e,[{key:"append",value:function value(e){return i(e,this._set),this}},{key:"toArray",value:function value(){return Object.keys(this._set)}}],[{key:"difference",value:function value(t,r){var n=void 0,i=[],o=t._set,u=r._set;for(n in o)({}).hasOwnProperty.call(o,n)&&(n in u||i.push(n));return new e(i)}}]),e}(),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return _typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof(e)};function s(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var l=function l(e){if("object"===(void 0===e?"undefined":a(e))){if(null===e)return!1;if("[object Object]"===Object.prototype.toString.call(e))return"Object"===(e.constructor.toString().match(/^function (.*)\(\)/m)||[])[1]}return!1},c="undefined"==typeof window?{}:window,f=c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame||c.oRequestAnimationFrame||c.msRequestAnimationFrame||function(e){setTimeout(e,16)},h=function e(){return e.__lastTime===(new Date).getTime()?e.__lastTime.toString()+(e.__id++).toString():(e.__id=0,(e.__lastTime=(new Date).getTime()).toString()+(e.__id++).toString())},d=function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=[];return t.forEach(function(e){return n.push.apply(n,s(e))}),n},p=function p(e){var t=[],r=null;return e=e&&"function"==typeof e&&e||function(){},function(n,i){[].push.apply(t,n),null===r&&(r=f(function(){var n=t.slice(0);t.length=0,r=null,n.reduce(function(e,t){return t.__id in e.map?e:(e.map[t.__id]=1,e.unique.push(t),e)},{map:{},unique:[]}).unique.forEach(function(e){return e()}),e(i)}))}},v=function v(e){return function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.map(function(t){var r=e[t];return{name:r.name,qualifiedName:r.qualifiedName,value:r.seed}})}},y=function y(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return{dependencies:t.slice(0,t.length-1),fn:t[t.length-1]}},g=function g(e){var t=[],r={};return e.forEach(function(e){return r[e.qualifiedName]=-1}),function e(n){n.forEach(function(n){var i,o=void 0,u=void 0,a=void 0;(i=n.qualifiedName)in r?-1!==(o=r[i])&&o!==t.length-1&&(u=t.slice(0,o),a=t.slice(o+1),t=u.concat(a),a.forEach(function(e,t){return r[e.qualifiedName]=t+u.length}),r[i]=t.push(n)-1):r[i]=t.push(n)-1,e(n.outgoingEdges)})}(e),t},m={accumulate:function accumulate(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n={};return t.forEach(function(e){Object.assign(n,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e.name,e.value))}),n},identity:function identity(e){return e.value}},_=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fn=t,this.dep=[]}return u(e,[{key:"addDependencies",value:function value(){var e;return(e=this.dep).push.apply(e,arguments),this}},{key:"getDependencies",value:function value(){return this.dep}},{key:"get",value:function value(){return this.fn}}]),e}(),b=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function k(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var w=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=n||{},this.name=t,this.qualifiedName=r,this.edges=[],this.outgoingEdges=[],this._seed=null,this.requireResolve=!0,this.retriever=n.retriever,this.history=[],this.resolver=null,this.electricEdges=[]}return b(e,[{key:"addDependencies",value:function value(){for(var e,t=this,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=this.edges).push.apply(e,n),n.forEach(function(e){return e.outgoingEdges.push(t)}),this}},{key:"addElectricNode",value:function value(e){return this.electricEdges.push(e),this}},{key:"resolve",value:function value(){return this.seed=this.resolver.apply(this,k(this.retrieveDetails())),this.history.push(this.seed),this.requireResolve=!1,this}},{key:"retrieveDetails",value:function value(){return 0===this.edges.length?[{name:this.name,qualifiedName:this.qualifiedName,value:this.seed}]:this.retriever.apply(this,k(this.edges.map(function(e){return e.qualifiedName})))}},{key:"repeatHead",value:function value(){var e=this.history,t=e[e.length-1];return 0===e.length?this:(e.push(t),this)}},{key:"flush",value:function value(){var e=this.history,t=e[e.length-1];return e.length=0,e.push(t),this}},{key:"isRoot",value:function value(){return null===this.name}},{key:"seed",get:function get(){return this._seed},set:function set(e){return this._seed=e,this.requireResolve=!0,this}}]),e}(),q=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.edges=[],this.listeners={nextFrame:[],currentFrame:[]}}return q(e,[{key:"addEdges",value:function value(){var e;return(e=this.edges).push.apply(e,arguments),this}},{key:"regListenerForCurrFrame",value:function value(e){var t=this,r=this.listeners.currentFrame,n=r.push(function(e,t){var r=function r(){t.apply(void 0,s(e.map(function(e){var t=e.history,r=t.length-1;return[t[r-1<0?0:r-1],t[r]]})))};return r.__id=h(),r}(this.edges,e))-1;return function(){t.listeners.currentFrame=r.filter(function(e,t){return t!==n})}}},{key:"regListenerForNextFrame",value:function value(e){var t=this,r=this.listeners.nextFrame,n=r.push(function(e,t){var r=function r(){t.apply(void 0,s(e.map(function(e){var t=e.history;return[t[0],t[t.length-1]]})))};return r.__id=h(),r}(this.edges,e))-1;return function(){t.listeners.nextFrame=r.filter(function(e,t){return t!==n})}}},{key:"hasNextFrameListener",value:function value(){return!!this.listeners.nextFrame.length}}]),e}(),N=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function F(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var O=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.qualifiedNodeMap={},this.retriever=v(this.qualifiedNodeMap),this.root=new w(null,null,{retriever:this.retriever}),this.root.resolver=m.accumulate,this._wholeSet=null,this._propagate=!0,this.propagationOverride={currentFrameListeners:!1,nextFrameListeners:!1},this._schedule=p(function(e){var r=void 0;for(r in e.flushTarget){if(!{}.hasOwnProperty.call(t.qualifiedNodeMap,r))return;t.qualifiedNodeMap[r].flush()}})}return N(e,[{key:"createNodesFrom",value:function value(e,t){var n,r=void 0,i=this.qualifiedNodeMap,u=this.root,a=this.retriever;return function e(t,n,o){var s=void 0,c=void 0,f=void 0,h=void 0;for(s in t)if({}.hasOwnProperty.call(t,s))if(h=new w(s,c=""+n+s,{retriever:a}),i[c]=h,void 0!==(f=o.perv)?f.addDependencies(h):u.addDependencies(h),l(r=t[s]))e(r,""+n+s+".",{perv:h}),h.resolver=m.accumulate;else if(r instanceof _){var d;h.resolver=r.get(),(d=h).addDependencies.apply(d,F(r.getDependencies().map(function(e){return i[e]})))}else h.resolver=m.identity,h.seed=r}(e,null===t?"":t+".",{perv:i[t]}),this._wholeSet=new o(Object.keys(this.qualifiedNodeMap)),(n=this.constructor.getResolvedList(u).concat(u).filter(function(e){return e.requireResolve})).forEach(function(e){return e.resolve()}),g(n).forEach(function(e){return e.resolve()}),this}},{key:"getNodeValue",value:function value(e){if(e in this.qualifiedNodeMap)return this.qualifiedNodeMap[e].seed}},{key:"createElectricNodeOf",value:function value(e,t){var r,n=this,i=e.map(function(e){return n.qualifiedNodeMap[e]}),o=(r=new E).addEdges.apply(r,F(i));return i.forEach(function(e){return e.addElectricNode(o)}),o["regListenerFor"+t.type](t.fn)}},{key:"update",value:function value(){for(var e=void 0,t=void 0,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];var u=[],a=n.map(function(e){return e[0].seed=e[1],e[0]});return a.forEach(function(e){return e.resolve()}),u.push.apply(u,F(d.apply(void 0,F(a.map(function(e){return e.electricEdges}))))),e=new o(a.map(function(e){return e.qualifiedName})),this._propagate?((t=g(a)).forEach(function(e){return e.resolve()}),e.append(t.map(function(e){return e.qualifiedName})),u.push.apply(u,F(d.apply(void 0,F(t.map(function(e){return e.electricEdges}))))),this.__execUniqueElectricEdges(Array.from(new Set(u)),e),this):(this.__execUniqueElectricEdges(u),this._propagate=!0,this)}},{key:"__execUniqueElectricEdges",value:function value(e,t){var r=this,n=[],i=[];return t&&o.difference(this._wholeSet,t).toArray().forEach(function(e){return r.qualifiedNodeMap[e].repeatHead()}),e.forEach(function(e){n.push.apply(n,F(e.listeners.currentFrame))}),e.forEach(function(e){i.push.apply(i,F(e.listeners.nextFrame))}),!this.propagationOverride.currentFrameListeners&&n.forEach(function(e){return e()}),!this.propagationOverride.nextFrameListeners&&this._schedule(i,{flushTarget:t}),this.resetPropagationOverride(),this}},{key:"resetNodeValue",value:function value(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r.map(function(t){return e.qualifiedNodeMap[t]}).map(function(e){return[e,e.seed]});return this.update.apply(this,F(i)),this}},{key:"stopPropagation",value:function value(){return this._propagate=!1,this}},{key:"resetPropagationOverride",value:function value(){return this.propagationOverride.currentFrameListeners=!1,this.propagationOverride.nextFrameListeners=!1,this}},{key:"setPropagationOverride",value:function value(e){return this.propagationOverride[e+"Listeners"]=!0,this}},{key:"getNodeFromQualifiedName",value:function value(e){return this.qualifiedNodeMap[e]}}],[{key:"getResolvedList",value:function value(e){var t=[];return function e(t,r,n){var i=void 0;t.edges.forEach(function(t){e(t,r,n)}),t.isRoot()||(i=t.qualifiedName)in n||(r.push(t),n[i]=1)}(e,t,{}),t}}]),e}(),A=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function P(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._graph=new O,this._lockFlag=!1,this._reqQ=[]}return A(e,[{key:"append",value:function value(){var e=void 0,t=void 0;return 1===arguments.length?(e=null,t=arguments.length<=0?void 0:arguments[0]):(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1]),this._addPropInModel(e,t),this}},{key:"calculatedProp",value:function value(){var e,t,r,n=void 0,i=void 0,o=void 0;return arguments.length>2?(i=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2]):(i=null,n=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1]),t=o(y),(e=r=new _(t.fn)).addDependencies.apply(e,P(t.dependencies)),this._addPropInModel(i,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},n,r)),this}},{key:"_addPropInModel",value:function value(e,t){return this._graph.createNodesFrom(t,e),this}},{key:"on",value:function value(e,t,r){var n,i=e instanceof Array?e:[e],o=this._graph.createElectricNodeOf(i,{type:"CurrFrame",fn:t});return r&&(n=this._graph.stopPropagation().setPropagationOverride("nextFrame")).resetNodeValue.apply(n,P(e)),o}},{key:"next",value:function value(e,t,r){var n,i=e instanceof Array?e:[e],o=this._graph.createElectricNodeOf(i,{type:"NextFrame",fn:t});return r&&(n=this._graph.stopPropagation().setPropagationOverride("currentFrame")).resetNodeValue.apply(n,P(e)),o}},{key:"lock",value:function value(){return this._lockFlag=!0,this._reqQ.length=0,this}},{key:"unlock",value:function value(){return this._lockFlag=!1,this.setProp.apply(this,P(this._reqQ)),this._reqQ.length=0,this}},{key:"prop",value:function value(){var e,t=void 0,r=void 0;switch(e=arguments.length){case 1:t=arguments.length<=0?void 0:arguments[0];break;case 2:t=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1];break;default:return this}return 2===e?(this._lockFlag?this._reqQ.push([t,r]):this.setProp([t,r]),this):this._graph.getNodeValue(t)}},{key:"setProp",value:function value(){for(var e,t=this,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return 0===n.length?this:((e=this._graph).update.apply(e,P(n.map(function(e){return[t._graph.getNodeFromQualifiedName(e[0]),e[1]]}))),this)}},{key:"graph",value:function value(){return this._graph}},{key:"serialize",value:function value(){return this._graph.root.seed}}],[{key:"create",value:function value(t){return(new e)._addPropInModel(null,t)}}]),e}();t.default=j}])})}).call(this,__webpack_require__(3)(module))},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children||(module.children=[]),Object.defineProperty(module,"loaded",{enumerable:!0,get:function get(){return module.l}}),Object.defineProperty(module,"id",{enumerable:!0,get:function get(){return module.i}}),module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _lib2=_interopRequireDefault(__webpack_require__(5)),_containerManager2=_interopRequireDefault(__webpack_require__(8)),slLib=_lib2.default.init("undefined"!=typeof window?window:void 0),doc=slLib.win.document,M=slLib.win.Math,max=M.max,round=M.round,htmlSplCharSpace={" ":"&nbsp;"},documentSupport=slLib.getDocumentSupport(),SVG_BBOX_CORRECTION=documentSupport.isWebKit?0:4.5;function SmartLabelManager(id,container,useEllipses,options){var wrapper,prop,max,prevInstance,isBrowserLess=!1,store=SmartLabelManager.store;if(void 0!==id&&"object"!==_typeof(id)){for(prop in(prevInstance=store[id])&&prevInstance.dispose(),store[id]=this,(options=options||{}).maxCacheLimit=isFinite(max=options.maxCacheLimit)?max:slLib.maxDefaultCacheLimit,"string"==typeof container&&(container=doc.getElementById(container)),(wrapper=slLib.createContainer(container)).innerHTML=slLib.testStrAvg,!documentSupport.isHeadLess&&(documentSupport.isIE||wrapper.offsetHeight||wrapper.offsetWidth)||(isBrowserLess=!0),wrapper.innerHTML="",slLib.parentContainerStyle)wrapper.style[prop]=slLib.parentContainerStyle[prop];this.id=id,this.parentContainer=wrapper,this._containerManager=new _containerManager2.default(wrapper,isBrowserLess,10),this._showNoEllipses=!useEllipses,this._init=!0,this.style={},this.options=options,this.setStyle()}}SmartLabelManager.textToLines=function(smartlabel){return(smartlabel=smartlabel||{}).text?"string"!=typeof smartlabel.text&&(smartlabel.text=smartlabel.text.toString()):smartlabel.text="",smartlabel.lines=smartlabel.text.split(/\n|<br\s*?\/?>/gi),smartlabel},SmartLabelManager.store={},SmartLabelManager.prototype._calCharDimWithCache=function(text,calculateDifference,length){if(!this._init)return!1;var size,csArr,tw,twi,cachedStyle,asymmetricDifference,maxAdvancedCacheLimit=this.options.maxCacheLimit,container=this._container,style=this.style||{},cache=this._advancedCache||(this._advancedCache={}),advancedCacheKey=this._advancedCacheKey||(this._advancedCacheKey=[]),cacheName=text+(style.fontSize||"")+(style.fontFamily||"")+(style.fontWeight||"")+(style.fontStyle||""),cacheInitName=text+"init"+(style.fontSize||"")+(style.fontFamily||"")+(style.fontWeight||"")+(style.fontStyle||"");return htmlSplCharSpace[text]&&(text=htmlSplCharSpace[text]),calculateDifference?void 0===(asymmetricDifference=cache[cacheInitName])&&(container.innerHTML=text.repeat?text.repeat(length):Array(length+1).join(text),tw=container.offsetWidth,container.innerHTML=text,twi=container.offsetWidth,asymmetricDifference=cache[cacheInitName]=(tw-length*twi)/(length+1),advancedCacheKey.push(cacheInitName),advancedCacheKey.length>maxAdvancedCacheLimit&&delete cache[advancedCacheKey.shift()]):asymmetricDifference=0,(cachedStyle=cache[cacheName])?(csArr=cachedStyle.split(","),{width:parseFloat(csArr[0],10),height:parseFloat(csArr[1],10)}):(container.innerHTML=text,size={height:container.offsetHeight,width:container.offsetWidth+asymmetricDifference},cache[cacheName]=size.width+","+size.height,advancedCacheKey.push(cacheName),advancedCacheKey.length>maxAdvancedCacheLimit&&delete cache[advancedCacheKey.shift()],size)},SmartLabelManager.prototype._getWidthFn=function(){var contObj=this._containerObj,container=this._container,svgText=contObj.svgText;return svgText?function(str){var bbox,width;return svgText.textContent=str,(width=(bbox=svgText.getBBox()).width-SVG_BBOX_CORRECTION)<1&&(width=bbox.width),width}:function(str){return container.innerHTML=str,container.offsetWidth}},SmartLabelManager.prototype.setStyle=function(style){return this._init?style!==this.style||this._styleNotSet?(style||(style=this.style),slLib.setLineHeight(style),this.style=style,this._containerObj=sCont=this._containerManager.get(style),this._containerObj?(this._container=sCont.node,this._context=sCont.context,this._cache=sCont.charCache,this._lineHeight=sCont.lineHeight,this._styleNotSet=!1):this._styleNotSet=!0,this):void 0:this;var sCont},SmartLabelManager.prototype.useEllipsesOnOverflow=function(useEllipses){return this._init?(this._showNoEllipses=!useEllipses,this):this},SmartLabelManager.prototype.getSmartText=function(text,maxWidth,maxHeight,noWrap){if(!this._init)return!1;void 0===text||null===text?text="":"string"!=typeof text&&(text=text.toString());var len,trimStr,tempArr,tmpText,maxWidthWithEll,toolText,oriWidth,oriHeight,newCharIndex,nearestChar,tempChar,getWidth,initialLeft,initialTop,getOriSizeImproveObj,spanArr,x,y,minWidth,elem,chr,elemRightMostPoint,elemLowestPoint,lastBR,removeFromIndex,removeFromIndexForEllipses,hasHTMLTag=!1,maxStrWidth=0,lastDash=-1,lastSpace=-1,lastIndexBroken=-1,strWidth=0,strHeight=0,oriTextArr=[],i=0,ellipsesStr=this._showNoEllipses?"":"...",lineHeight=this._lineHeight,context=this._context,container=this._container,sCont=this._containerObj,ellipsesWidth=sCont.ellipsesWidth,dotWidth=sCont.dotWidth,characterArr=[],dashIndex=-1,spaceIndex=-1,lastLineBreak=-1,fastTrim=function fastTrim(str){for(var ws=/\s/,i=(str=str.replace(/^\s\s*/,"")).length;ws.test(str.charAt(i-=1)););return str.slice(0,i+1)},smartLabel={text:text,maxWidth:maxWidth,maxHeight:maxHeight,width:null,height:null,oriTextWidth:null,oriTextHeight:null,oriText:text,isTruncated:!1};if(getWidth=this._getWidthFn(),maxHeight===lineHeight&&(maxHeight*=1.2),container){if(!documentSupport.isBrowserLess){if((hasHTMLTag=slLib.xmlTagRegEx.test(text))?(container.innerHTML=text,smartLabel.oriTextWidth=oriWidth=container.offsetWidth,smartLabel.oriTextHeight=oriHeight=container.offsetHeight):(tmpText=text.replace(slLib.ltgtRegex,function(match){return"&lt;"===match?"<":">"}),getOriSizeImproveObj=this.getOriSize(tmpText,!0),smartLabel.oriTextWidth=oriWidth=getOriSizeImproveObj.width,smartLabel.oriTextHeight=oriHeight=getOriSizeImproveObj.height),oriHeight<=maxHeight&&oriWidth<=maxWidth)return smartLabel.width=smartLabel.oriTextWidth=oriWidth,smartLabel.height=smartLabel.oriTextHeight=oriHeight,smartLabel;if(lineHeight>maxHeight)return smartLabel.text="",smartLabel.width=smartLabel.oriTextWidth=0,smartLabel.height=smartLabel.oriTextHeight=0,smartLabel}if(text=fastTrim(text).replace(/(\s+)/g," "),maxWidthWithEll=this._showNoEllipses?maxWidth:maxWidth-ellipsesWidth,!hasHTMLTag){if(len=(oriTextArr=text.split("")).length,trimStr="",tempArr=[],tempChar=oriTextArr[0],this._cache[tempChar]?minWidth=this._cache[tempChar].width:(minWidth=getWidth(tempChar),this._cache[tempChar]={width:minWidth}),maxWidthWithEll>minWidth)i=(tempArr=text.substr(0,slLib.getNearestBreakIndex(text,maxWidthWithEll,this)).split("")).length;else{if(minWidth>maxWidth)return smartLabel.text="",smartLabel.width=smartLabel.oriTextWidth=smartLabel.height=smartLabel.oriTextHeight=0,smartLabel;ellipsesStr&&((maxWidthWithEll=maxWidth-2*dotWidth)>minWidth?ellipsesStr="..":(maxWidthWithEll=maxWidth-dotWidth)>minWidth?ellipsesStr=".":(maxWidthWithEll=0,ellipsesStr=""))}if(strWidth=getWidth(tempArr.join("")),strHeight=this._lineHeight,noWrap){for(;i<len;i+=1)if(tempChar=tempArr[i]=oriTextArr[i],this._cache[tempChar]?minWidth=this._cache[tempChar].width:(getOriSizeImproveObj&&(minWidth=getOriSizeImproveObj.detailObj[tempChar])||(minWidth=getWidth(tempChar)),this._cache[tempChar]={width:minWidth}),(strWidth+=minWidth)>maxWidthWithEll&&(trimStr||(trimStr=tempArr.slice(0,-1).join("")),strWidth>maxWidth))return smartLabel.text=fastTrim(trimStr)+ellipsesStr,smartLabel.tooltext=smartLabel.oriText,smartLabel.width=getWidth(smartLabel.text),smartLabel.height=this._lineHeight,smartLabel;return smartLabel.text=tempArr.join(""),smartLabel.width=strWidth,smartLabel.height=this._lineHeight,smartLabel}for(;i<len;i+=1)if(" "!==(tempChar=tempArr[i]=oriTextArr[i])||context||(tempChar="&nbsp;"),this._cache[tempChar]?minWidth=this._cache[tempChar].width:(getOriSizeImproveObj&&(minWidth=getOriSizeImproveObj.detailObj[tempChar])||(minWidth=getWidth(tempChar)),this._cache[tempChar]={width:minWidth}),(strWidth+=minWidth)>maxWidthWithEll&&(trimStr||(trimStr=tempArr.slice(0,-1).join("")),strWidth>maxWidth)){if(lastSpace=text.substr(0,tempArr.length).lastIndexOf(" "),lastDash=text.substr(0,tempArr.length).lastIndexOf("-"),lastSpace>lastIndexBroken?(strWidth=getWidth(tempArr.slice(lastIndexBroken+1,lastSpace).join("")),tempArr.splice(lastSpace,1,"<br/>"),lastIndexBroken=lastSpace,newCharIndex=lastSpace+1):lastDash>lastIndexBroken?(lastDash===tempArr.length-1?(strWidth=getWidth(tempArr.slice(lastIndexBroken+1,lastSpace).join("")),tempArr.splice(lastDash,1,"<br/>-")):(strWidth=getWidth(tempArr.slice(lastIndexBroken+1,lastSpace).join("")),tempArr.splice(lastDash,1,"-<br/>")),lastIndexBroken=lastDash,newCharIndex=lastDash+1):(tempArr.splice(tempArr.length-1,1,"<br/>"+oriTextArr[i]),lastLineBreak=tempArr.length-2,strWidth=getWidth(tempArr.slice(lastIndexBroken+1,lastLineBreak+1).join("")),lastIndexBroken=lastLineBreak,newCharIndex=i),(strHeight+=this._lineHeight)>maxHeight)return smartLabel.text=fastTrim(trimStr)+ellipsesStr,smartLabel.tooltext=smartLabel.oriText,smartLabel.width=maxWidth,smartLabel.height=strHeight-this._lineHeight,smartLabel;maxStrWidth=max(maxStrWidth,strWidth),trimStr=null,nearestChar=slLib.getNearestBreakIndex(text.substr(newCharIndex),maxWidthWithEll,this),strWidth=getWidth(text.substr(newCharIndex,nearestChar||1)),tempArr.length<newCharIndex+nearestChar&&(i=(tempArr=tempArr.concat(text.substr(tempArr.length,newCharIndex+nearestChar-tempArr.length).split(""))).length-1)}return maxStrWidth=max(maxStrWidth,strWidth),smartLabel.text=tempArr.join(""),smartLabel.width=maxStrWidth,smartLabel.height=strHeight,smartLabel}for(toolText=text.replace(slLib.spanAdditionRegx,"$2"),text=(text=text.replace(slLib.spanAdditionRegx,slLib.spanAdditionReplacer)).replace(/(<br\s*\/*\>)/g,'<span class="'+[slLib.classNameWithTag," ",slLib.classNameWithTagBR].join("")+'">$1</span>'),container.innerHTML=text,x=0,y=(spanArr=container[documentSupport.childRetriverFn](documentSupport.childRetriverString)).length;x<y;x+=1)elem=spanArr[x],(documentSupport.noClassTesting||slLib.classNameReg.test(elem.className))&&""!==(chr=elem.innerHTML)&&(" "===chr?spaceIndex=characterArr.length:"-"===chr&&(dashIndex=characterArr.length),characterArr.push({spaceIdx:spaceIndex,dashIdx:dashIndex,elem:elem}),oriTextArr.push(chr));if(i=0,len=characterArr.length,(minWidth=characterArr[0].elem.offsetWidth)>maxWidth)return smartLabel.text="",smartLabel.width=smartLabel.oriTextWidth=smartLabel.height=smartLabel.oriTextHeight=0,smartLabel;if(minWidth>maxWidthWithEll&&!this._showNoEllipses&&((maxWidthWithEll=maxWidth-2*dotWidth)>minWidth?ellipsesStr="..":(maxWidthWithEll=maxWidth-dotWidth)>minWidth?ellipsesStr=".":(maxWidthWithEll=0,ellipsesStr="")),initialLeft=characterArr[0].elem.offsetLeft,initialTop=characterArr[0].elem.offsetTop,noWrap)for(;i<len;i+=1)(elemRightMostPoint=(elem=characterArr[i].elem).offsetLeft-initialLeft+elem.offsetWidth)>maxWidthWithEll&&(removeFromIndexForEllipses||(removeFromIndexForEllipses=i),container.offsetWidth>maxWidth&&(removeFromIndex=i,i=len));else for(;i<len;i+=1)elemLowestPoint=(elem=characterArr[i].elem).offsetHeight+(elem.offsetTop-initialTop),lastBR=null,(elemRightMostPoint=elem.offsetLeft-initialLeft+elem.offsetWidth)>maxWidthWithEll?(removeFromIndexForEllipses||(removeFromIndexForEllipses=i),elemRightMostPoint>maxWidth&&(lastSpace=characterArr[i].spaceIdx,lastDash=characterArr[i].dashIdx,lastSpace>lastIndexBroken?(characterArr[lastSpace].elem.innerHTML="<br/>",lastIndexBroken=lastSpace):lastDash>lastIndexBroken?(characterArr[lastDash].elem.innerHTML=lastDash===i?"<br/>-":"-<br/>",lastIndexBroken=lastDash):elem.parentNode.insertBefore(lastBR=doc.createElement("br"),elem),elem.offsetHeight+elem.offsetTop>maxHeight?(lastBR?lastBR.parentNode.removeChild(lastBR):lastIndexBroken===lastDash?characterArr[lastDash].elem.innerHTML="-":characterArr[lastSpace].elem.innerHTML=" ",removeFromIndex=i,i=len):removeFromIndexForEllipses=null)):elemLowestPoint>maxHeight&&(removeFromIndex=i,i=len);if(removeFromIndex<len){for(smartLabel.isTruncated=!0,removeFromIndexForEllipses=removeFromIndexForEllipses||removeFromIndex,i=len-1;i>=removeFromIndexForEllipses;i-=1)(elem=characterArr[i].elem).parentNode.removeChild(elem);for(;i>=0;i-=1)elem=characterArr[i].elem,slLib.classNameBrReg.test(elem.className)?elem.parentNode.removeChild(elem):i=0}return smartLabel.text=container.innerHTML.replace(slLib.spanRemovalRegx,"$1").replace(/\&amp\;/g,"&"),smartLabel.isTruncated&&(smartLabel.text+=ellipsesStr,smartLabel.tooltext=toolText),smartLabel.height=container.offsetHeight,smartLabel.width=container.offsetWidth,smartLabel}return smartLabel.error=new Error("Body Tag Missing!"),smartLabel},SmartLabelManager.prototype.getOriSize=function(text,detailedCalculationFlag){if(!this._init)return!1;var textArr,letter,lSize,i,l,cumulativeSize=0,height=0,indiSizeStore={};if(!detailedCalculationFlag)return this._calCharDimWithCache(text);for(i=0,l=(textArr=text.split("")).length;i<l;i++)letter=textArr[i],lSize=this._calCharDimWithCache(letter,!0,textArr.length),height=max(height,lSize.height),cumulativeSize+=lSize.width,indiSizeStore[letter]=lSize.width;return{width:round(cumulativeSize),height:height,detailObj:indiSizeStore}},SmartLabelManager.prototype.dispose=function(){return this._init?(this._containerManager&&this._containerManager.dispose&&this._containerManager.dispose(),delete this._container,delete this._context,delete this._cache,delete this._containerManager,delete this._containerObj,delete this.id,delete this.style,delete this.parentContainer,delete this._showNoEllipses,this):this},exports.default=SmartLabelManager,module.exports=exports.default},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lib={init:function init(win){var doc=win.document,userAgent=win.navigator.userAgent,ceil=Math.ceil,floor=Math.floor,clsNameSpace="fusioncharts-smartlabel-",containerClass=clsNameSpace+"container",classNameWithTag=clsNameSpace+"tag";return lib={win:win,containerClass:containerClass,classNameWithTag:classNameWithTag,classNameWithTagBR:"fusioncharts-smartlabel-br",maxDefaultCacheLimit:500,classNameReg:new RegExp("\b"+classNameWithTag+"\b"),classNameBrReg:new RegExp("\bfusioncharts-smartlabel-br\b"),spanAdditionRegx:/(<[^<\>]+?\>)|(&(?:[a-z]+|#[0-9]+);|.)/gi,spanAdditionReplacer:'$1<span class="'+classNameWithTag+'">$2</span>',spanRemovalRegx:new RegExp("\\<span[^\\>]+?"+classNameWithTag+"[^\\>]{0,}\\>(.*?)\\<\\/span\\>","ig"),xmlTagRegEx:new RegExp("<[^>][^<]*[^>]+>","i"),ltgtRegex:/&lt;|&gt;/g,brReplaceRegex:/<br\/>/gi,testStrAvg:"WgI",parentContainerStyle:{position:"absolute",top:"-9999em",whiteSpace:"nowrap",padding:"0px",width:"1px",height:"1px",overflow:"hidden"},supportedStyle:{font:"font",fontFamily:"font-family","font-family":"font-family",fontWeight:"font-weight","font-weight":"font-weight",fontSize:"font-size","font-size":"font-size",lineHeight:"line-height","line-height":"line-height",fontStyle:"font-style","font-style":"font-style"},getDocumentSupport:function getDocumentSupport(){var childRetriverFn,childRetriverString,noClassTesting;return doc.getElementsByClassName?(childRetriverFn="getElementsByClassName",childRetriverString=classNameWithTag,noClassTesting=!0):(childRetriverFn="getElementsByTagName",childRetriverString="span",noClassTesting=!1),{isIE:/msie/i.test(userAgent)&&!win.opera,hasSVG:Boolean(win.SVGAngle||doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")),isHeadLess:new RegExp(" HtmlUnit").test(userAgent),isWebKit:new RegExp(" AppleWebKit/").test(userAgent),childRetriverFn:childRetriverFn,childRetriverString:childRetriverString,noClassTesting:noClassTesting}},createContainer:function createContainer(containerParent){var body,container;if(containerParent&&(containerParent.offsetWidth||containerParent.offsetHeight)){if(containerParent.appendChild)return containerParent.appendChild(container=doc.createElement("DIV")),container.className=containerClass,container.setAttribute("aria-hidden","true"),container.setAttribute("role","presentation"),container}else if((body=doc.getElementsByTagName("body")[0])&&body.appendChild)return(container=doc.createElement("DIV")).className=containerClass,container.setAttribute("aria-hidden","true"),container.setAttribute("role","presentation"),1,body.appendChild(container),container},getNearestBreakIndex:function getNearestBreakIndex(text,maxWidth,sl){if(!text||!text.length)return 0;var difference,getWidth=sl._getWidthFn(),charLen=0,increment=0,oriWidth=getWidth(text),avgWidth=oriWidth/text.length;if(difference=maxWidth,charLen=ceil(maxWidth/avgWidth),oriWidth<maxWidth)return text.length-1;for(charLen>text.length&&(difference=maxWidth-oriWidth,charLen=text.length);difference>0;){if(difference=maxWidth-getWidth(text.substr(0,charLen)),!(increment=floor(difference/avgWidth)))return charLen;charLen+=increment}for(;difference<0;){if(difference=maxWidth-getWidth(text.substr(0,charLen)),!(increment=floor(difference/avgWidth)))return charLen;charLen+=increment}return charLen},setLineHeight:function setLineHeight(styleObj){var fSize=styleObj.fontSize=styleObj.fontSize||"12px";return styleObj.lineHeight=styleObj.lineHeight||styleObj["line-height"]||1.2*parseInt(fSize,10)+"px",styleObj}}}};exports.default=lib,module.exports=exports.default},function(module){module.exports={name:"muze",private:!0,version:"1.0.3",description:"Composable visualisation library for web with a data-first approach",homepage:"https://www.charts.com/muze",license:"MIT",author:"Charts.com <support@charts.com>",contributors:[{name:"Akash Ghoswami",email:"akash@charts.com"},{name:"Ranajit Banerjee",email:"ranajit.banerjee@charts.com",url:"https://github.com/ranajitbanerjee"},{name:"Mridul Meharia",email:"mridul@charts.com",url:"https://github.com/mridulmeh"},{name:"Subhash Haldar",email:"subhash@charts.com"},{name:"Sandeep Acharya",email:"sandeep@charts.com"},{name:"Rousan Ali",email:"rousan@charts.com",url:"https://rousan.io"},{name:"Ujjal Kumar Dutta",email:"ujjal@charts.com"}],main:"src/index.js",keywords:["muze","svg","vector","graphics","data-visualization","visualization","renderer","fusioncharts","relational","algebra","relation"],repository:{type:"git",url:"https://github.com/chartshq/muze"},dependencies:{"@chartshq/layout":"^1.0.0","@chartshq/muze-firebolt":"^1.0.0","@chartshq/muze-legend":"^1.0.0","muze-utils":"^1.0.0","@chartshq/visual-cell":"^1.0.0","@chartshq/visual-group":"^1.0.0","@chartshq/visual-layer":"^1.0.0","@chartshq/visual-unit":"^1.0.0"}}},function(module,exports,__webpack_require__){var Muze=__webpack_require__(27);module.exports=Muze.default?Muze.default:Muze},function(module,exports,__webpack_require__){"use strict";var slLib=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(5)).default.init("undefined"!=typeof window?window:void 0),doc=slLib.win.document,documentSupport=slLib.getDocumentSupport(),SVG_BBOX_CORRECTION=documentSupport.isWebKit?0:4.5;function ContainerManager(parentContainer,isBrowserLess,maxContainers){var svg;maxContainers=(maxContainers=maxContainers>5?maxContainers:5)<20?maxContainers:20,this.maxContainers=maxContainers,this.first=null,this.last=null,this.containers={},this.length=0,this.rootNode=parentContainer,isBrowserLess&&((svg=doc.createElementNS("http://www.w3.org/2000/svg","svg")).setAttributeNS("http://www.w3.org/2000/svg","xlink","http://www.w3.org/1999/xlink"),svg.setAttributeNS("http://www.w3.org/2000/svg","height","0"),svg.setAttributeNS("http://www.w3.org/2000/svg","width","0"),this.svgRoot=svg,this.rootNode.appendChild(svg))}ContainerManager.prototype.get=function(style){var diff,key,containerObj,containers=this.containers,len=this.length,max=this.maxContainers,keyStr="";for(key in slLib.supportedStyle)void 0!==style[key]&&(keyStr+=slLib.supportedStyle[key]+":"+style[key]+";");if(!keyStr)return!1;if(containerObj=containers[keyStr])this.first!==containerObj&&(containerObj.prev&&(containerObj.prev.next=containerObj.next),containerObj.next&&(containerObj.next.prev=containerObj.prev),containerObj.next=this.first,containerObj.next.prev=containerObj,this.last===containerObj&&(this.last=containerObj.prev),containerObj.prev=null,this.first=containerObj);else{if(len>=max)for(diff=len-max+1;diff--;)this.removeContainer(this.last);containerObj=this.addContainer(keyStr)}return containerObj},ContainerManager.prototype.addContainer=function(keyStr){var node,container;return this.containers[keyStr]=container={next:null,prev:null,node:null,ellipsesWidth:0,lineHeight:0,dotWidth:0,avgCharWidth:4,keyStr:keyStr,charCache:{}},container.next=this.first,container.next&&(container.next.prev=container),this.first=container,this.last||(this.last=container),this.length+=1,node=container.node=doc.createElement("div"),this.rootNode.appendChild(node),documentSupport.isIE&&!documentSupport.hasSVG?node.style.setAttribute("cssText",keyStr):node.setAttribute("style",keyStr),node.setAttribute("aria-hidden","true"),node.setAttribute("role","presentation"),node.style.display="inline-block",node.innerHTML=slLib.testStrAvg,container.lineHeight=node.offsetHeight,container.avgCharWidth=node.offsetWidth/3,documentSupport.isBrowserLess?((node=container.svgText=doc.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("style",keyStr),this.svgRoot.appendChild(node),node.textContent=slLib.testStrAvg,container.lineHeight=node.getBBox().height,container.avgCharWidth=(node.getBBox().width-SVG_BBOX_CORRECTION)/3,node.textContent="...",container.ellipsesWidth=node.getBBox().width-SVG_BBOX_CORRECTION,node.textContent=".",container.dotWidth=node.getBBox().width-SVG_BBOX_CORRECTION):(node.innerHTML="...",container.ellipsesWidth=node.offsetWidth,node.innerHTML=".",container.dotWidth=node.offsetWidth,node.innerHTML=""),container},ContainerManager.prototype.removeContainer=function(cObj){var keyStr=cObj.keyStr;keyStr&&this.length&&cObj&&(this.length-=1,cObj.prev&&(cObj.prev.next=cObj.next),cObj.next&&(cObj.next.prev=cObj.prev),this.first===cObj&&(this.first=cObj.next),this.last===cObj&&(this.last=cObj.prev),cObj.node.parentNode.removeChild(cObj.node),delete this.containers[keyStr])},ContainerManager.prototype.dispose=function(){var key,containers=this.containers;for(key in this.maxContainers=null,containers)this.removeContainer(containers[key]);this.rootNode.parentNode.removeChild(this.rootNode),this.rootNode=null,this.first=null,this.last=null},module.exports=ContainerManager},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,exports,__webpack_require__){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var scales_namespaceObject={};__webpack_require__.r(scales_namespaceObject),__webpack_require__.d(scales_namespaceObject,"scaleLinear",function(){return linear_linear}),__webpack_require__.d(scales_namespaceObject,"scaleThreshold",function(){return threshold_threshold}),__webpack_require__.d(scales_namespaceObject,"scaleLog",function(){return log}),__webpack_require__.d(scales_namespaceObject,"scalePow",function(){return pow}),__webpack_require__.d(scales_namespaceObject,"scaleIdentity",function(){return identity_identity}),__webpack_require__.d(scales_namespaceObject,"scaleOrdinal",function(){return ordinal}),__webpack_require__.d(scales_namespaceObject,"scaleSequential",function(){return sequential}),__webpack_require__.d(scales_namespaceObject,"scaleQuantize",function(){return quantize_quantize}),__webpack_require__.d(scales_namespaceObject,"scaleQuantile",function(){return quantile_quantile}),__webpack_require__.d(scales_namespaceObject,"schemeCategory10",function(){return category10}),__webpack_require__.d(scales_namespaceObject,"schemeCategory20",function(){return category20}),__webpack_require__.d(scales_namespaceObject,"schemeCategory20b",function(){return category20b}),__webpack_require__.d(scales_namespaceObject,"scaleBand",function(){return band}),__webpack_require__.d(scales_namespaceObject,"scaleTime",function(){return src_time});var color_schemes_namespaceObject={};__webpack_require__.r(color_schemes_namespaceObject),__webpack_require__.d(color_schemes_namespaceObject,"schemeDark2",function(){return Dark2}),__webpack_require__.d(color_schemes_namespaceObject,"schemePaired",function(){return Paired}),__webpack_require__.d(color_schemes_namespaceObject,"schemeAccent",function(){return Accent}),__webpack_require__.d(color_schemes_namespaceObject,"schemePastel1",function(){return Pastel1}),__webpack_require__.d(color_schemes_namespaceObject,"schemePastel2",function(){return Pastel2}),__webpack_require__.d(color_schemes_namespaceObject,"schemeSet1",function(){return Set1}),__webpack_require__.d(color_schemes_namespaceObject,"schemeSet2",function(){return Set2}),__webpack_require__.d(color_schemes_namespaceObject,"schemeSet3",function(){return Set3}),__webpack_require__.d(color_schemes_namespaceObject,"schemeBlues",function(){return Blues_scheme}),__webpack_require__.d(color_schemes_namespaceObject,"schemeBrBG",function(){return BrBG_scheme}),__webpack_require__.d(color_schemes_namespaceObject,"schemePRGn",function(){return PRGn_scheme}),__webpack_require__.d(color_schemes_namespaceObject,"schemePiYG",function(){return PiYG_scheme}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateBrBG",function(){return BrBG}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePRGn",function(){return PRGn}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePiYG",function(){return PiYG}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePuOr",function(){return PuOr}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRdBu",function(){return RdBu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRdGy",function(){return RdGy}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRdYlBu",function(){return RdYlBu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRdYlGn",function(){return RdYlGn}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateSpectral",function(){return Spectral}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateBlues",function(){return Blues}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateGreens",function(){return Greens}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateGreys",function(){return Greys}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateOranges",function(){return Oranges}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePurples",function(){return Purples}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateReds",function(){return Reds}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateViridis",function(){return sequential_multi_viridis}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateInferno",function(){return viridis_inferno}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateMagma",function(){return viridis_magma}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePlasma",function(){return viridis_plasma}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateWarm",function(){return rainbow_warm}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateCool",function(){return rainbow_cool}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateCubehelixDefault",function(){return sequential_multi_cubehelix}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateBuGn",function(){return BuGn}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateBuPu",function(){return BuPu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateGnBu",function(){return GnBu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateOrRd",function(){return OrRd}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePuBuGn",function(){return PuBuGn}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePuBu",function(){return PuBu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolatePuRd",function(){return PuRd}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRdPu",function(){return RdPu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateYlGnBu",function(){return YlGnBu}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateYlGn",function(){return YlGn}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateYlOrBr",function(){return YlOrBr}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateYlOrRd",function(){return YlOrRd}),__webpack_require__.d(color_schemes_namespaceObject,"interpolateRainbow",function(){return sequential_multi_rainbow});var namespace_namespaceObject={};__webpack_require__.r(namespace_namespaceObject),__webpack_require__.d(namespace_namespaceObject,"UNIT_GLOBAL_NAMESPACE",function(){return UNIT_GLOBAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"UNIT_LOCAL_NAMESPACE",function(){return UNIT_LOCAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"LAYER_LOCAL_NAMESPACE",function(){return LAYER_LOCAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"LAYER_GLOBAL_NAMESPACE",function(){return LAYER_GLOBAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"GROUP_GLOBAL_NAMESPACE",function(){return GROUP_GLOBAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"GROUP_LOCAL_NAMESPACE",function(){return GROUP_LOCAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"CANVAS_LOCAL_NAMESPACE",function(){return CANVAS_LOCAL_NAMESPACE}),__webpack_require__.d(namespace_namespaceObject,"CANVAS_GLOBAL_NAMESPACE",function(){return CANVAS_GLOBAL_NAMESPACE});var actions_namespaceObject={};__webpack_require__.r(actions_namespaceObject),__webpack_require__.d(actions_namespaceObject,"DRAG",function(){return DRAG}),__webpack_require__.d(actions_namespaceObject,"HOVER",function(){return HOVER}),__webpack_require__.d(actions_namespaceObject,"SELECTIONDRAG",function(){return SELECTIONDRAG}),__webpack_require__.d(actions_namespaceObject,"CLICK",function(){return CLICK}),__webpack_require__.d(actions_namespaceObject,"LONGTOUCH",function(){return LONGTOUCH}),__webpack_require__.d(actions_namespaceObject,"TOUCHDRAG",function(){return TOUCHDRAG}),__webpack_require__.d(actions_namespaceObject,"ALL_ACTIONS",function(){return ALL_ACTIONS});var enums_selection_namespaceObject={};__webpack_require__.r(enums_selection_namespaceObject),__webpack_require__.d(enums_selection_namespaceObject,"SELECTION_NEW_ENTRY",function(){return SELECTION_NEW_ENTRY}),__webpack_require__.d(enums_selection_namespaceObject,"SELECTION_NEW_EXIT",function(){return SELECTION_NEW_EXIT}),__webpack_require__.d(enums_selection_namespaceObject,"SELECTION_NULL",function(){return SELECTION_NULL}),__webpack_require__.d(enums_selection_namespaceObject,"SELECTION_OLD_ENTRY",function(){return SELECTION_OLD_ENTRY}),__webpack_require__.d(enums_selection_namespaceObject,"SELECTION_OLD_EXIT",function(){return SELECTION_OLD_EXIT});var behaviours_namespaceObject={};__webpack_require__.r(behaviours_namespaceObject),__webpack_require__.d(behaviours_namespaceObject,"BRUSH",function(){return BRUSH}),__webpack_require__.d(behaviours_namespaceObject,"HIGHLIGHT",function(){return HIGHLIGHT}),__webpack_require__.d(behaviours_namespaceObject,"TOOLTIP",function(){return TOOLTIP}),__webpack_require__.d(behaviours_namespaceObject,"FILTER",function(){return FILTER}),__webpack_require__.d(behaviours_namespaceObject,"SELECT",function(){return SELECT});var behavioural_namespaceObject={};__webpack_require__.r(behavioural_namespaceObject),__webpack_require__.d(behavioural_namespaceObject,"HighlightBeahviour",function(){return highlight_HighlightBehaviour}),__webpack_require__.d(behavioural_namespaceObject,"BrushBehaviour",function(){return brush_BrushBehaviour}),__webpack_require__.d(behavioural_namespaceObject,"FilterBehaviour",function(){return filter_FilterBehaviour}),__webpack_require__.d(behavioural_namespaceObject,"SelectBehaviour",function(){return select_SelectBehaviour});var side_effects_namespaceObject={};__webpack_require__.r(side_effects_namespaceObject),__webpack_require__.d(side_effects_namespaceObject,"SelectionBox",function(){return selection_box}),__webpack_require__.d(side_effects_namespaceObject,"Tooltip",function(){return side_effects_tooltip_Tooltip}),__webpack_require__.d(side_effects_namespaceObject,"Crossline",function(){return crossline_Crossline}),__webpack_require__.d(side_effects_namespaceObject,"PlotHighlighter",function(){return plot_highlighter_PlotHighlighter}),__webpack_require__.d(side_effects_namespaceObject,"FilterEffect",function(){return FilterEffect}),__webpack_require__.d(side_effects_namespaceObject,"PersistentAnchors",function(){return persistent_anchors_PersistentAnchors}),__webpack_require__.d(side_effects_namespaceObject,"BrushAnchors",function(){return brush_anchors_BrushAnchors}),__webpack_require__.d(side_effects_namespaceObject,"AnchorEffect",function(){return anchors_AnchorEffect});var axis_orientation_namespaceObject={};__webpack_require__.r(axis_orientation_namespaceObject),__webpack_require__.d(axis_orientation_namespaceObject,"BOTTOM",function(){return axis_orientation_BOTTOM}),__webpack_require__.d(axis_orientation_namespaceObject,"TOP",function(){return axis_orientation_TOP}),__webpack_require__.d(axis_orientation_namespaceObject,"LEFT",function(){return axis_orientation_LEFT}),__webpack_require__.d(axis_orientation_namespaceObject,"RIGHT",function(){return axis_orientation_RIGHT}),__webpack_require__.d(axis_orientation_namespaceObject,"axisOrientationMap",function(){return axisOrientationMap});var scale_type_namespaceObject={};__webpack_require__.r(scale_type_namespaceObject),__webpack_require__.d(scale_type_namespaceObject,"LINEAR",function(){return LINEAR}),__webpack_require__.d(scale_type_namespaceObject,"BAND",function(){return BAND}),__webpack_require__.d(scale_type_namespaceObject,"TIME",function(){return TIME}),__webpack_require__.d(scale_type_namespaceObject,"COLOR",function(){return scale_type_COLOR}),__webpack_require__.d(scale_type_namespaceObject,"ORDINAL",function(){return ORDINAL}),__webpack_require__.d(scale_type_namespaceObject,"QUANTIZE",function(){return QUANTIZE}),__webpack_require__.d(scale_type_namespaceObject,"QUANTILE",function(){return QUANTILE}),__webpack_require__.d(scale_type_namespaceObject,"LOG",function(){return LOG}),__webpack_require__.d(scale_type_namespaceObject,"POW",function(){return POW}),__webpack_require__.d(scale_type_namespaceObject,"IDENTITY",function(){return scale_type_IDENTITY}),__webpack_require__.d(scale_type_namespaceObject,"SEQUENTIAL",function(){return SEQUENTIAL}),__webpack_require__.d(scale_type_namespaceObject,"THRESHOLD",function(){return THRESHOLD});var layer_types_namespaceObject={};__webpack_require__.r(layer_types_namespaceObject),__webpack_require__.d(layer_types_namespaceObject,"AREA_LAYER",function(){return layer_types_AREA_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"ARC_LAYER",function(){return layer_types_ARC_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"LINE_LAYER",function(){return layer_types_LINE_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"TEXT_LAYER",function(){return layer_types_TEXT_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"POINT_LAYER",function(){return layer_types_POINT_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"BAR_LAYER",function(){return layer_types_BAR_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"TICK_LAYER",function(){return layer_types_TICK_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"SIMPLE_LAYER",function(){return layer_types_SIMPLE_LAYER}),__webpack_require__.d(layer_types_namespaceObject,"BASE_LAYER",function(){return layer_types_BASE_LAYER});var firebolt_behavioural_namespaceObject={};__webpack_require__.r(firebolt_behavioural_namespaceObject),__webpack_require__.d(firebolt_behavioural_namespaceObject,"SelectBehaviour",function(){return behavioural_select_SelectBehaviour});var firebolt_side_effects_namespaceObject={};__webpack_require__.r(firebolt_side_effects_namespaceObject),__webpack_require__.d(firebolt_side_effects_namespaceObject,"SelectionBox",function(){return side_effects_selection_box}),__webpack_require__.d(firebolt_side_effects_namespaceObject,"LegendHighlighter",function(){return legend_highlighter_LegendHighlighter});var operators_namespaceObject={};__webpack_require__.r(operators_namespaceObject),__webpack_require__.d(operators_namespaceObject,"share",function(){return operators_share}),__webpack_require__.d(operators_namespaceObject,"html",function(){return operators_html});var ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN},bisector=function(compare){return 1===compare.length&&(compare=function ascendingComparator(f){return function(d,x){return ascending(f(d),x)}}(compare)),{left:function left(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function right(a,x,lo,hi){for(null==lo&&(lo=0),null==hi&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}};var ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisect=(ascendingBisect.left,bisectRight);var number=function(x){return null===x?NaN:+x},array_array=Array.prototype,src_range=(array_array.slice,array_array.map,function(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;for(var i=-1,n=0|Math.max(0,Math.ceil((stop-start)/step)),range=new Array(n);++i<n;)range[i]=start+i*step;return range}),e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2),src_ticks=function(start,stop,count){var reverse,n,ticks,step,i=-1;if(count=+count,(start=+start)===(stop=+stop)&&count>0)return[start];if((reverse=stop<start)&&(n=start,start=stop,stop=n),0===(step=tickIncrement(start,stop,count))||!isFinite(step))return[];if(step>0)for(start=Math.ceil(start/step),stop=Math.floor(stop/step),ticks=new Array(n=Math.ceil(stop-start+1));++i<n;)ticks[i]=(start+i)*step;else for(start=Math.floor(start*step),stop=Math.ceil(stop*step),ticks=new Array(n=Math.ceil(start-stop+1));++i<n;)ticks[i]=(start-i)/step;return reverse&&ticks.reverse(),ticks};function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;return error>=e10?step1*=10:error>=e5?step1*=5:error>=e2&&(step1*=2),stop<start?-step1:step1}var quantile=function(values,p,valueof){if(null==valueof&&(valueof=number),n=values.length){if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values);return value0+(+valueof(values[i0+1],i0+1,values)-value0)*(i-i0)}};function map_Map(){}function map_map(object,f){var map=new map_Map;if(object instanceof map_Map)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(null==f)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f(o=object[i],i,object),o)}else if(object)for(var key in object)map.set(key,object[key]);return map}map_Map.prototype=map_map.prototype={constructor:map_Map,has:function has(key){return"$"+key in this},get:function get(key){return this["$"+key]},set:function set(key,value){return this["$"+key]=value,this},remove:function remove(key){var property="$"+key;return property in this&&delete this[property]},clear:function clear(){for(var property in this)"$"===property[0]&&delete this[property]},keys:function keys(){var keys=[];for(var property in this)"$"===property[0]&&keys.push(property.slice(1));return keys},values:function values(){var values=[];for(var property in this)"$"===property[0]&&values.push(this[property]);return values},entries:function entries(){var entries=[];for(var property in this)"$"===property[0]&&entries.push({key:property.slice(1),value:this[property]});return entries},size:function size(){var size=0;for(var property in this)"$"===property[0]&&++size;return size},empty:function empty(){for(var property in this)if("$"===property[0])return!1;return!0},each:function each(f){for(var property in this)"$"===property[0]&&f(this[property],property.slice(1),this)}};var src_map=map_map,src_nest=function(){var _sortValues,_rollup,nest,keys=[],_sortKeys=[];function apply(array,depth,createResult,setResult){if(depth>=keys.length)return null!=_sortValues&&array.sort(_sortValues),null!=_rollup?_rollup(array):array;for(var keyValue,value,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=src_map(),result=createResult();++i<n;)(values=valuesByKey.get(keyValue=key(value=array[i])+""))?values.push(value):valuesByKey.set(keyValue,[value]);return valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))}),result}return nest={object:function object(array){return apply(array,0,createObject,setObject)},map:function map(array){return apply(array,0,createMap,setMap)},entries:function entries(array){return function _entries(map,depth){if(++depth>keys.length)return map;var array,sortKey=_sortKeys[depth-1];return null!=_rollup&&depth>=keys.length?array=map.entries():(array=[],map.each(function(v,k){array.push({key:k,values:_entries(v,depth)})})),null!=sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}(apply(array,0,createMap,setMap),0)},key:function key(d){return keys.push(d),nest},sortKeys:function sortKeys(order){return _sortKeys[keys.length-1]=order,nest},sortValues:function sortValues(order){return _sortValues=order,nest},rollup:function rollup(f){return _rollup=f,nest}}};function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return src_map()}function setMap(map,key,value){map.set(key,value)}function set_Set(){}var proto=src_map.prototype;function set_set(object,f){var set=new set_Set;if(object instanceof set_Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(null==f)for(;++i<n;)set.add(object[i]);else for(;++i<n;)set.add(f(object[i],i,object))}return set}set_Set.prototype=set_set.prototype={constructor:set_Set,has:proto.has,add:function add(value){return this["$"+(value+="")]=value,this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};var src_array_array=Array.prototype,src_array_map=src_array_array.map,array_slice=src_array_array.slice,implicit={name:"implicit"};function ordinal(range){var index=src_map(),domain=[],unknown=implicit;function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}return range=null==range?[]:array_slice.call(range),scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=src_map();for(var d,key,i=-1,n=_.length;++i<n;)index.has(key=(d=_[i])+"")||index.set(key,domain.push(d));return scale},scale.range=function(_){return arguments.length?(range=array_slice.call(_),scale):range.slice()},scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown},scale.copy=function(){return ordinal().domain(domain).range(range).unknown(unknown)},scale}function band(){var step,bandwidth,scale=ordinal().unknown(void 0),domain=scale.domain,ordinalRange=scale.range,range=[0,1],round=!1,paddingInner=0,paddingOuter=0,align=.5;function rescale(){var n=domain().length,reverse=range[1]<range[0],start=range[reverse-0],stop=range[1-reverse];step=(stop-start)/Math.max(1,n-paddingInner+2*paddingOuter),round&&(step=Math.floor(step)),start+=(stop-start-step*(n-paddingInner))*align,bandwidth=step*(1-paddingInner),round&&(start=Math.round(start),bandwidth=Math.round(bandwidth));var values=src_range(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}return delete scale.unknown,scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.range=function(_){return arguments.length?(range=[+_[0],+_[1]],rescale()):range.slice()},scale.rangeRound=function(_){return range=[+_[0],+_[1]],round=!0,rescale()},scale.bandwidth=function(){return bandwidth},scale.step=function(){return step},scale.round=function(_){return arguments.length?(round=!!_,rescale()):round},scale.padding=function(_){return arguments.length?(paddingInner=paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingInner},scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner},scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter},scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align},scale.copy=function(){return band().domain(domain()).range(range).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)},scale.invertExtent=function(r0,r1){var a,b,t,hiIndex,lo=+r0,hi=arguments.length>1?+r1:lo,reverse=range[1]<range[0],values=reverse?ordinalRange().reverse():ordinalRange(),n=values.length-1;if(values.push(values[n]+this.step()),hi<lo&&(t=lo,lo=hi,hi=t),!(hi<values[0]||lo>range[1-reverse]))return a=Math.max(0,getClosestIndexOf(values,lo)),hiIndex=getClosestIndexOf(values,hi),b=lo===hi?a:Math.max(a,hiIndex-1),reverse&&(t=a,a=n-b,b=n-t),a>b?void 0:domain().slice(a,b+1)},scale.invert=function(r0,r1){var a,t,lo=+r0,hi=arguments.length>1?+r1:lo,reverse=range[1]<range[0],values=reverse?ordinalRange().reverse():ordinalRange(),n=values.length-1;if(hi<lo&&(t=lo,lo=hi,hi=t),!(hi<values[0]||lo>range[1-reverse]))return a=Math.max(0,getClosestIndexOf(values,lo,"left")),domain()[reverse?n-a:a]},rescale()}function getClosestIndexOf(arr,value,side){for(var highVal,mid,d1,low=0,high=arr.length-1;low<high;)mid=Math.floor((low+high)/2),d1=Math.abs(arr[mid]-value),Math.abs(arr[mid+1]-value)<=d1?low=mid+1:high=mid;return side?(highVal=arr[high])===value?high:highVal>value?0===high?high:"left"===side?high-1:high:high===arr.length-1?high:"left"===side?high:high+1:high}var define=function(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype,prototype.constructor=constructor};function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition)prototype[key]=definition[key];return prototype}function Color(){}var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_color(format){var m;return format=(format+"").trim().toLowerCase(),(m=reHex3.exec(format))?new Rgb((m=parseInt(m[1],16))>>8&15|m>>4&240,m>>4&15|240&m,(15&m)<<4|15&m,1):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(255*m[1]/100,255*m[2]/100,255*m[3]/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(255*m[1]/100,255*m[2]/100,255*m[3]/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):"transparent"===format?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,255&n,1)}function rgba(r,g,b,a){return a<=0&&(r=g=b=NaN),new Rgb(r,g,b,a)}function rgbConvert(o){return o instanceof Color||(o=color_color(o)),o?new Rgb((o=o.rgb()).r,o.g,o.b,o.opacity):new Rgb}function color_rgb(r,g,b,opacity){return 1===arguments.length?rgbConvert(r):new Rgb(r,g,b,null==opacity?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r,this.g=+g,this.b=+b,this.opacity=+opacity}function _hex(value){return((value=Math.max(0,Math.min(255,Math.round(value)||0)))<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){return a<=0?h=s=l=NaN:l<=0||l>=1?h=s=NaN:s<=0&&(h=NaN),new Hsl(h,s,l,a)}function hsl(h,s,l,opacity){return 1===arguments.length?function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(o instanceof Color||(o=color_color(o)),!o)return new Hsl;if(o instanceof Hsl)return o;var r=(o=o.rgb()).r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;return s?(h=r===max?(g-b)/s+6*(g<b):g===max?(b-r)/s+2:(r-g)/s+4,s/=l<.5?max+min:2-max-min,h*=60):s=l>0&&l<1?0:h,new Hsl(h,s,l,o.opacity)}(h):new Hsl(h,s,l,null==opacity?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function hsl2rgb(h,m1,m2){return 255*(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)}define(Color,color_color,{displayable:function displayable(){return this.rgb().displayable()},hex:function hex(){return this.rgb().hex()},toString:function toString(){return this.rgb()+""}}),define(Rgb,color_rgb,extend(Color,{brighter:function brighter(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function darker(k){return k=null==k?.7:Math.pow(.7,k),new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function rgb(){return this},displayable:function displayable(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function hex(){return"#"+_hex(this.r)+_hex(this.g)+_hex(this.b)},toString:function toString(){var a=this.opacity;return(1===(a=isNaN(a)?1:Math.max(0,Math.min(1,a)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}})),define(Hsl,hsl,extend(Color,{brighter:function brighter(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function darker(k){return k=null==k?.7:Math.pow(.7,k),new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function rgb(){var h=this.h%360+360*(this.h<0),s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,Xn=.96422,Yn=1,Zn=.82521,lab_t0=4/29,lab_t1=6/29,t2=3*lab_t1*lab_t1,t3=lab_t1*lab_t1*lab_t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}o instanceof Rgb||(o=rgbConvert(o));var x,z,r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn);return r===g&&g===b?x=z=y:(x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn),z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)),new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function lab(l,a,b,opacity){return 1===arguments.length?labConvert(l):new Lab(l,a,b,null==opacity?1:opacity)}function Lab(l,a,b,opacity){this.l=+l,this.a=+a,this.b=+b,this.opacity=+opacity}function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+lab_t0}function lab2xyz(t){return t>lab_t1?t*t*t:t2*(t-lab_t0)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(o instanceof Lab||(o=labConvert(o)),0===o.a&&0===o.b)return new Hcl(NaN,0,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function hcl(h,c,l,opacity){return 1===arguments.length?hclConvert(h):new Hcl(h,c,l,null==opacity?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h,this.c=+c,this.l=+l,this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function brighter(k){return new Lab(this.l+18*(null==k?1:k),this.a,this.b,this.opacity)},darker:function darker(k){return new Lab(this.l-18*(null==k?1:k),this.a,this.b,this.opacity)},rgb:function rgb(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;return new Rgb(lrgb2rgb(3.1338561*(x=Xn*lab2xyz(x))-1.6168667*(y=Yn*lab2xyz(y))-.4906146*(z=Zn*lab2xyz(z))),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function brighter(k){return new Hcl(this.h,this.c,this.l+18*(null==k?1:k),this.opacity)},darker:function darker(k){return new Hcl(this.h,this.c,this.l-18*(null==k?1:k),this.opacity)},rgb:function rgb(){return labConvert(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,cubehelix_D=-.90649,E=1.97294,ED=E*cubehelix_D,EB=E*B,BC_DA=B*C-cubehelix_D*A;function cubehelix_cubehelix(h,s,l,opacity){return 1===arguments.length?function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);o instanceof Rgb||(o=rgbConvert(o));var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/cubehelix_D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}(h):new Cubehelix(h,s,l,null==opacity?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h,this.s=+s,this.l=+l,this.opacity=+opacity}function basis(t1,v0,v1,v2,v3){var t2=t1*t1,t3=t2*t1;return((1-3*t1+3*t2-t3)*v0+(4-6*t2+3*t3)*v1+(1+3*t1+3*t2-3*t3)*v2+t3*v3)/6}define(Cubehelix,cubehelix_cubehelix,extend(Color,{brighter:function brighter(k){return k=null==k?1/.7:Math.pow(1/.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function darker(k){return k=null==k?.7:Math.pow(.7,k),new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function rgb(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+cubehelix_D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));var src_constant=function(x){return function(){return x}};function linear(a,d){return function(t){return a+t*d}}function color_hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):src_constant(isNaN(a)?b:a)}function gamma(y){return 1==(y=+y)?nogamma:function(a,b){return b-a?function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}(a,b,y):src_constant(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):src_constant(isNaN(a)?b:a)}var src_rgb=function rgbGamma(y){var color=gamma(y);function rgb(start,end){var r=color((start=color_rgb(start)).r,(end=color_rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.r=r(t),start.g=g(t),start.b=b(t),start.opacity=opacity(t),start+""}}return rgb.gamma=rgbGamma,rgb}(1);function rgbSpline(spline){return function(colors){var i,color,n=colors.length,r=new Array(n),g=new Array(n),b=new Array(n);for(i=0;i<n;++i)color=color_rgb(colors[i]),r[i]=color.r||0,g[i]=color.g||0,b[i]=color.b||0;return r=spline(r),g=spline(g),b=spline(b),color.opacity=1,function(t){return color.r=r(t),color.g=g(t),color.b=b(t),color+""}}}var rgbBasis=rgbSpline(function(values){var n=values.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,n-1):Math.floor(t*n),v1=values[i],v2=values[i+1],v0=i>0?values[i-1]:2*v1-v2,v3=i<n-1?values[i+2]:2*v2-v1;return basis((t-i/n)*n,v0,v1,v2,v3)}}),src_number=(rgbSpline(function(values){var n=values.length;return function(t){var i=Math.floor(((t%=1)<0?++t:t)*n),v0=values[(i+n-1)%n],v1=values[i%n],v2=values[(i+1)%n],v3=values[(i+2)%n];return basis((t-i/n)*n,v0,v1,v2,v3)}}),function(a,b){return b-=a=+a,function(t){return a+b*t}});function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");var src_string=function(a,b){var am,bm,bs,bi=reA.lastIndex=reB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=reA.exec(a))&&(bm=reB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:src_number(am,bm)})),bi=reB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?function one(b){return function(t){return b(t)+""}}(q[0].x):function string_zero(b){return function(){return b}}(b):(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})};function value_typeof(obj){return(value_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var cssNode,cssRoot,cssView,svgNode,src_value=function(a,b){var c,t=value_typeof(b);return null==b||"boolean"===t?src_constant(b):("number"===t?src_number:"string"===t?(c=color_color(b))?(b=c,src_rgb):src_string:b instanceof color_color?src_rgb:b instanceof Date?function(a,b){var d=new Date;return b-=a=+a,function(t){return d.setTime(a+b*t),d}}:Array.isArray(b)?function(a,b){var i,nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb);for(i=0;i<na;++i)x[i]=src_value(a[i],b[i]);for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<na;++i)c[i]=x[i](t);return c}}:"function"!=typeof b.valueOf&&"function"!=typeof b.toString||isNaN(b)?function(a,b){var k,i={},c={};for(k in null!==a&&"object"===_typeof(a)||(a={}),null!==b&&"object"===_typeof(b)||(b={}),b)k in a?i[k]=src_value(a[k],b[k]):c[k]=b[k];return function(t){for(k in i)c[k]=i[k](t);return c}}:src_number)(a,b)},src_round=function(a,b){return b-=a=+a,function(t){return Math.round(a+b*t)}},degrees=180/Math.PI,decompose_identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},decompose=function(a,b,c,d,e,f){var scaleX,scaleY,skewX;return(scaleX=Math.sqrt(a*a+b*b))&&(a/=scaleX,b/=scaleX),(skewX=a*c+b*d)&&(c-=a*skewX,d-=b*skewX),(scaleY=Math.sqrt(c*c+d*d))&&(c/=scaleY,d/=scaleY,skewX/=scaleY),a*d<b*c&&(a=-a,b=-b,skewX=-skewX,scaleX=-scaleX),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}};function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}return function(a,b){var s=[],q=[];return a=parse(a),b=parse(b),function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:src_number(xa,xb)},{i:i-2,x:src_number(ya,yb)})}else(xb||yb)&&s.push("translate("+xb+pxComma+yb+pxParen)}(a.translateX,a.translateY,b.translateX,b.translateY,s,q),function rotate(a,b,s,q){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:src_number(a,b)})):b&&s.push(pop(s)+"rotate("+b+degParen)}(a.rotate,b.rotate,s,q),function skewX(a,b,s,q){a!==b?q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:src_number(a,b)}):b&&s.push(pop(s)+"skewX("+b+degParen)}(a.skewX,b.skewX,s,q),function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:src_number(xa,xb)},{i:i-2,x:src_number(ya,yb)})}else 1===xb&&1===yb||s.push(pop(s)+"scale("+xb+","+yb+")")}(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}}var interpolateTransformCss=interpolateTransform(function parseCss(value){return"none"===value?decompose_identity:(cssNode||(cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView),cssNode.style.transform=value,value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform"),cssRoot.removeChild(cssNode),value=value.slice(7,-1).split(","),decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5]))},"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(function parseSvg(value){return null==value?decompose_identity:(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",value),(value=svgNode.transform.baseVal.consolidate())?(value=value.matrix,decompose(value.a,value.b,value.c,value.d,value.e,value.f)):decompose_identity)},", ",")",")");Math.SQRT2;function hsl_hsl(hue){return function(start,end){var h=hue((start=hsl(start)).h,(end=hsl(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(t),start.opacity=opacity(t),start+""}}}hsl_hsl(color_hue);var hslLong=hsl_hsl(nogamma);function hcl_hcl(hue){return function(start,end){var h=hue((start=hcl(start)).h,(end=hcl(end)).h),c=nogamma(start.c,end.c),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.c=c(t),start.l=l(t),start.opacity=opacity(t),start+""}}}hcl_hcl(color_hue),hcl_hcl(nogamma);function src_cubehelix_cubehelix(hue){return function cubehelixGamma(y){function cubehelix(start,end){var h=hue((start=cubehelix_cubehelix(start)).h,(end=cubehelix_cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){return start.h=h(t),start.s=s(t),start.l=l(Math.pow(t,y)),start.opacity=opacity(t),start+""}}return y=+y,cubehelix.gamma=cubehelixGamma,cubehelix}(1)}src_cubehelix_cubehelix(color_hue);var cubehelixLong=src_cubehelix_cubehelix(nogamma);function piecewise_piecewise(interpolate,values){for(var i=0,n=values.length-1,v=values[0],I=new Array(n<0?0:n);i<n;)I[i]=interpolate(v,v=values[++i]);return function(t){var i=Math.max(0,Math.min(n-1,Math.floor(t*=n)));return I[i](t-i)}}var d3_scale_src_constant=function(x){return function(){return x}},d3_scale_src_number=function(x){return+x},continuous_unit=[0,1];function deinterpolateLinear(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:d3_scale_src_constant(b)}function bimap(domain,range,deinterpolate,reinterpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];return d1<d0?(d0=deinterpolate(d1,d0),r0=reinterpolate(r1,r0)):(d0=deinterpolate(d0,d1),r0=reinterpolate(r0,r1)),function(x){return r0(d0(x))}}function polymap(domain,range,deinterpolate,reinterpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;for(domain[j]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++i<j;)d[i]=deinterpolate(domain[i],domain[i+1]),r[i]=reinterpolate(range[i],range[i+1]);return function(x){var i=bisect(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp())}function continuous(deinterpolate,reinterpolate){var piecewise,output,input,domain=continuous_unit,range=continuous_unit,interpolate=src_value,clamp=!1;function rescale(){return piecewise=Math.min(domain.length,range.length)>2?polymap:bimap,output=input=null,scale}function scale(x){return(output||(output=piecewise(domain,range,clamp?function deinterpolateClamp(deinterpolate){return function(a,b){var d=deinterpolate(a=+a,b=+b);return function(x){return x<=a?0:x>=b?1:d(x)}}}(deinterpolate):deinterpolate,interpolate)))(+x)}return scale.invert=function(y){return(input||(input=piecewise(range,domain,deinterpolateLinear,clamp?function reinterpolateClamp(reinterpolate){return function(a,b){var r=reinterpolate(a=+a,b=+b);return function(t){return t<=0?a:t>=1?b:r(t)}}}(reinterpolate):reinterpolate)))(+y)},scale.domain=function(_){return arguments.length?(domain=src_array_map.call(_,d3_scale_src_number),rescale()):domain.slice()},scale.range=function(_){return arguments.length?(range=array_slice.call(_),rescale()):range.slice()},scale.rangeRound=function(_){return range=array_slice.call(_),interpolate=src_round,rescale()},scale.clamp=function(_){return arguments.length?(clamp=!!_,rescale()):clamp},scale.interpolate=function(_){return arguments.length?(interpolate=_,rescale()):interpolate},rescale()}var formatDecimal=function(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]},src_exponent=function(x){return(x=formatDecimal(Math.abs(x)))?x[1]:NaN},re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;this.fill=match[1]||" ",this.align=match[2]||">",this.sign=match[3]||"-",this.symbol=match[4]||"",this.zero=!!match[5],this.width=match[6]&&+match[6],this.comma=!!match[7],this.precision=match[8]&&+match[8].slice(1),this.trim=!!match[9],this.type=match[10]||""}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var prefixExponent,defaultLocale_locale,defaultLocale_format,defaultLocale_formatPrefix,formatTrim=function(s){out:for(var i1,n=s.length,i=1,i0=-1;i<n;++i)switch(s[i]){case".":i0=i1=i;break;case"0":0===i0&&(i0=i),i1=i;break;default:if(i0>0){if(!+s[i])break out;i0=0}}return i0>0?s.slice(0,i0)+s.slice(i1+1):s},formatRounded=function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")},formatTypes={"%":function _(x,p){return(100*x).toFixed(p)},b:function b(x){return Math.round(x).toString(2)},c:function c(x){return x+""},d:function d(x){return Math.round(x).toString(10)},e:function e(x,p){return x.toExponential(p)},f:function f(x,p){return x.toFixed(p)},g:function g(x,p){return x.toPrecision(p)},o:function o(x){return Math.round(x).toString(8)},p:function p(x,_p){return formatRounded(100*x,_p)},r:formatRounded,s:function(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(exponent/3))))+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]},X:function X(x){return Math.round(x).toString(16).toUpperCase()},x:function x(_x){return Math.round(_x).toString(16)}},src_identity=function(x){return x},prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],src_locale=function(locale){var group=locale.grouping&&locale.thousands?function(grouping,thousands){return function(value,width){for(var i=value.length,t=[],j=0,g=grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=grouping[j=(j+1)%grouping.length];return t.reverse().join(thousands)}}(locale.grouping,locale.thousands):src_identity,currency=locale.currency,decimal=locale.decimal,numerals=locale.numerals?function(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}}(locale.numerals):src_identity,percent=locale.percent||"%";function newFormat(specifier){var fill=(specifier=formatSpecifier(specifier)).fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;"n"===type?(comma=!0,type="g"):formatTypes[type]||(null==precision&&(precision=12),trim=!0,type="g"),(zero||"0"===fill&&"="===align)&&(zero=!0,fill="0",align="=");var prefix="$"===symbol?currency[0]:"#"===symbol&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix="$"===symbol?currency[1]:/[%p]/.test(type)?percent:"",formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);function format(value){var i,n,c,valuePrefix=prefix,valueSuffix=suffix;if("c"===type)valueSuffix=formatType(value)+valueSuffix,value="";else{var valueNegative=(value=+value)<0;if(value=formatType(Math.abs(value),precision),trim&&(value=formatTrim(value)),valueNegative&&0==+value&&(valueNegative=!1),valuePrefix=(valueNegative?"("===sign?sign:"-":"-"===sign||"("===sign?"":sign)+valuePrefix,valueSuffix=("s"===type?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&"("===sign?")":""),maybeSuffix)for(i=-1,n=value.length;++i<n;)if(48>(c=value.charCodeAt(i))||c>57){valueSuffix=(46===c?decimal+value.slice(i+1):value.slice(i))+valueSuffix,value=value.slice(0,i);break}}comma&&!zero&&(value=group(value,1/0));var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";switch(comma&&zero&&(value=group(padding+value,padding.length?width-valueSuffix.length:1/0),padding=""),align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix}return numerals(value)}return precision=null==precision?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision)),format.toString=function(){return specifier+""},format}return{format:newFormat,formatPrefix:function formatPrefix(specifier,value){var f=newFormat(((specifier=formatSpecifier(specifier)).type="f",specifier)),e=3*Math.max(-8,Math.min(8,Math.floor(src_exponent(value)/3))),k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}}};!function defaultLocale(definition){return defaultLocale_locale=src_locale(definition),defaultLocale_format=defaultLocale_locale.format,defaultLocale_formatPrefix=defaultLocale_locale.formatPrefix,defaultLocale_locale}({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var src_tickFormat=function(domain,count,specifier){var precision,start=domain[0],stop=domain[domain.length-1],step=tickStep(start,stop,null==count?10:count);switch((specifier=formatSpecifier(null==specifier?",f":specifier)).type){case"s":var value=Math.max(Math.abs(start),Math.abs(stop));return null!=specifier.precision||isNaN(precision=function(step,value){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(src_exponent(value)/3)))-src_exponent(Math.abs(step)))}(step,value))||(specifier.precision=precision),defaultLocale_formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":null!=specifier.precision||isNaN(precision=function(step,max){return step=Math.abs(step),max=Math.abs(max)-step,Math.max(0,src_exponent(max)-src_exponent(step))+1}(step,Math.max(Math.abs(start),Math.abs(stop))))||(specifier.precision=precision-("e"===specifier.type));break;case"f":case"%":null!=specifier.precision||isNaN(precision=function(step){return Math.max(0,-src_exponent(Math.abs(step)))}(step))||(specifier.precision=precision-2*("%"===specifier.type))}return defaultLocale_format(specifier)};function linearish(scale){var domain=scale.domain;return scale.ticks=function(count){var d=domain();return src_ticks(d[0],d[d.length-1],null==count?10:count)},scale.tickFormat=function(count,specifier){return src_tickFormat(domain(),count,specifier)},scale.nice=function(count){null==count&&(count=10);var step,d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1];return stop<start&&(step=start,start=stop,stop=step,step=i0,i0=i1,i1=step),(step=tickIncrement(start,stop,count))>0?step=tickIncrement(start=Math.floor(start/step)*step,stop=Math.ceil(stop/step)*step,count):step<0&&(step=tickIncrement(start=Math.ceil(start*step)/step,stop=Math.floor(stop*step)/step,count)),step>0?(d[i0]=Math.floor(start/step)*step,d[i1]=Math.ceil(stop/step)*step,domain(d)):step<0&&(d[i0]=Math.ceil(start*step)/step,d[i1]=Math.floor(stop*step)/step,domain(d)),scale},scale}function linear_linear(){var scale=continuous(deinterpolateLinear,src_number);return scale.copy=function(){return copy(scale,linear_linear())},linearish(scale)}function identity_identity(){var domain=[0,1];function scale(x){return+x}return scale.invert=scale,scale.domain=scale.range=function(_){return arguments.length?(domain=src_array_map.call(_,d3_scale_src_number),scale):domain.slice()},scale.copy=function(){return identity_identity().domain(domain)},linearish(scale)}var nice=function(domain,interval){var t,i0=0,i1=(domain=domain.slice()).length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(t=i0,i0=i1,i1=t,t=x0,x0=x1,x1=t),domain[i0]=interval.floor(x0),domain[i1]=interval.ceil(x1),domain};function log_deinterpolate(a,b){return(b=Math.log(b/a))?function(x){return Math.log(x/a)/b}:d3_scale_src_constant(b)}function log_reinterpolate(a,b){return a<0?function(t){return-Math.pow(-b,t)*Math.pow(-a,1-t)}:function(t){return Math.pow(b,t)*Math.pow(a,1-t)}}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return 10===base?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:10===base&&Math.log10||2===base&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function log(){var scale=continuous(log_deinterpolate,log_reinterpolate).domain([1,10]),domain=scale.domain,base=10,logs=logp(10),pows=powp(10);function rescale(){return logs=logp(base),pows=powp(base),domain()[0]<0&&(logs=reflect(logs),pows=reflect(pows)),scale}return scale.base=function(_){return arguments.length?(base=+_,rescale()):base},scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()},scale.ticks=function(count){var r,d=domain(),u=d[0],v=d[d.length-1];(r=v<u)&&(i=u,u=v,v=i);var p,k,t,i=logs(u),j=logs(v),n=null==count?10:+count,z=[];if(!(base%1)&&j-i<n){if(i=Math.round(i)-1,j=Math.round(j)+1,u>0){for(;i<j;++i)for(k=1,p=pows(i);k<base;++k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}}else for(;i<j;++i)for(k=base-1,p=pows(i);k>=1;--k)if(!((t=p*k)<u)){if(t>v)break;z.push(t)}}else z=src_ticks(i,j,Math.min(j-i,n)).map(pows);return r?z.reverse():z},scale.tickFormat=function(count,specifier){if(null==specifier&&(specifier=10===base?".0e":","),"function"!=typeof specifier&&(specifier=defaultLocale_format(specifier)),count===1/0)return specifier;null==count&&(count=10);var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));return i*base<base-.5&&(i*=base),i<=k?specifier(d):""}},scale.nice=function(){return domain(nice(domain(),{floor:function floor(x){return pows(Math.floor(logs(x)))},ceil:function ceil(x){return pows(Math.ceil(logs(x)))}}))},scale.copy=function(){return copy(scale,log().base(base))},scale}function raise(x,exponent){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}function pow(){var exponent=1,scale=continuous(function deinterpolate(a,b){return(b=raise(b,exponent)-(a=raise(a,exponent)))?function(x){return(raise(x,exponent)-a)/b}:d3_scale_src_constant(b)},function reinterpolate(a,b){return b=raise(b,exponent)-(a=raise(a,exponent)),function(t){return raise(a+b*t,1/exponent)}}),domain=scale.domain;return scale.exponent=function(_){return arguments.length?(exponent=+_,domain(domain())):exponent},scale.copy=function(){return copy(scale,pow().exponent(exponent))},linearish(scale)}function quantile_quantile(){var domain=[],range=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range.length);for(thresholds=new Array(n-1);++i<n;)thresholds[i-1]=quantile(domain,i/n);return scale}function scale(x){if(!isNaN(x=+x))return range[bisect(thresholds,x)]}return scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]},scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var d,i=0,n=_.length;i<n;++i)null==(d=_[i])||isNaN(d=+d)||domain.push(d);return domain.sort(ascending),rescale()},scale.range=function(_){return arguments.length?(range=array_slice.call(_),rescale()):range.slice()},scale.quantiles=function(){return thresholds.slice()},scale.copy=function(){return quantile_quantile().domain(domain).range(range)},scale}function quantize_quantize(){var x0=0,x1=1,n=1,domain=[.5],range=[0,1];function scale(x){if(x<=x)return range[bisect(domain,x,0,n)]}function rescale(){var i=-1;for(domain=new Array(n);++i<n;)domain[i]=((i+1)*x1-(i-n)*x0)/(n+1);return scale}return scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]},scale.range=function(_){return arguments.length?(n=(range=array_slice.call(_)).length-1,rescale()):range.slice()},scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]},scale.copy=function(){return quantize_quantize().domain([x0,x1]).range(range)},linearish(scale)}function threshold_threshold(){var domain=[.5],range=[0,1],n=1;function scale(x){if(x<=x)return range[bisect(domain,x,0,n)]}return scale.domain=function(_){return arguments.length?(domain=array_slice.call(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()},scale.range=function(_){return arguments.length?(range=array_slice.call(_),n=Math.min(domain.length,range.length-1),scale):range.slice()},scale.invertExtent=function(y){var i=range.indexOf(y);return[domain[i-1],domain[i]]},scale.copy=function(){return threshold_threshold().domain(domain).range(range)},scale}var interval_t0=new Date,interval_t1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}return interval.floor=interval,interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date},interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1},interval.offset=function(date,step){return offseti(date=new Date(+date),null==step?1:Math.floor(step)),date},interval.range=function(start,stop,step){var previous,range=[];if(start=interval.ceil(start),step=null==step?1:Math.floor(step),!(start<stop&&step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range},interval.filter=function(test){return newInterval(function(date){if(date>=date)for(;floori(date),!test(date);)date.setTime(date-1)},function(date,step){if(date>=date)if(step<0)for(;++step<=0;)for(;offseti(date,-1),!test(date););else for(;--step>=0;)for(;offseti(date,1),!test(date););})},count&&(interval.count=function(start,end){return interval_t0.setTime(+start),interval_t1.setTime(+end),floori(interval_t0),floori(interval_t1),Math.floor(count(interval_t0,interval_t1))},interval.every=function(step){return step=Math.floor(step),isFinite(step)&&step>0?step>1?interval.filter(field?function(d){return field(d)%step==0}:function(d){return interval.count(0,d)%step==0}):interval:null}),interval}var millisecond_millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond_millisecond.every=function(k){return k=Math.floor(k),isFinite(k)&&k>0?k>1?newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k}):millisecond_millisecond:null};var src_millisecond=millisecond_millisecond,durationMinute=(millisecond_millisecond.range,6e4),durationWeek=6048e5,second_second=newInterval(function(date){date.setTime(1e3*Math.floor(date/1e3))},function(date,step){date.setTime(+date+1e3*step)},function(start,end){return(end-start)/1e3},function(date){return date.getUTCSeconds()}),src_second=second_second,minute_minute=(second_second.range,newInterval(function(date){date.setTime(Math.floor(date/durationMinute)*durationMinute)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()})),src_minute=minute_minute,hour_hour=(minute_minute.range,newInterval(function(date){var offset=date.getTimezoneOffset()*durationMinute%36e5;offset<0&&(offset+=36e5),date.setTime(36e5*Math.floor((+date-offset)/36e5)+offset)},function(date,step){date.setTime(+date+36e5*step)},function(start,end){return(end-start)/36e5},function(date){return date.getHours()})),src_hour=hour_hour,day_day=(hour_hour.range,newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/864e5},function(date){return date.getDate()-1})),src_day=day_day;day_day.range;function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7),date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+7*step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),month_month=(sunday.range,monday.range,tuesday.range,wednesday.range,thursday.range,friday.range,saturday.range,newInterval(function(date){date.setDate(1),date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+12*(end.getFullYear()-start.getFullYear())},function(date){return date.getMonth()})),src_month=month_month,year_year=(month_month.range,newInterval(function(date){date.setMonth(0,1),date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()}));year_year.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k),date.setMonth(0,1),date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)}):null};var src_year=year_year,utcMinute=(year_year.range,newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()})),utcHour=(utcMinute.range,newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+36e5*step)},function(start,end){return(end-start)/36e5},function(date){return date.getUTCHours()})),utcDay=(utcHour.range,newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/864e5},function(date){return date.getUTCDate()-1})),src_utcDay=utcDay;utcDay.range;function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+7*step)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcMonth=(utcSunday.range,utcMonday.range,utcTuesday.range,utcWednesday.range,utcThursday.range,utcFriday.range,utcSaturday.range,newInterval(function(date){date.setUTCDate(1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+12*(end.getUTCFullYear()-start.getUTCFullYear())},function(date){return date.getUTCMonth()})),utcYear=(utcMonth.range,newInterval(function(date){date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()}));utcYear.every=function(k){return isFinite(k=Math.floor(k))&&k>0?newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k),date.setUTCMonth(0,1),date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)}):null};var src_utcYear=utcYear;utcYear.range;function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);return date.setFullYear(d.y),date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));return date.setUTCFullYear(d.y),date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}var src_defaultLocale_locale,timeFormat,utcFormat,utcParse,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function locale_pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){for(var map={},i=-1,n=names.length;++i<n;)map[names[i].toLowerCase()]=i;return map}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=1e3*+n[0],i+n[0].length):-1}function formatDayOfMonth(d,p){return locale_pad(d.getDate(),p,2)}function formatHour24(d,p){return locale_pad(d.getHours(),p,2)}function formatHour12(d,p){return locale_pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return locale_pad(1+src_day.count(src_year(d),d),p,3)}function formatMilliseconds(d,p){return locale_pad(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return locale_pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return locale_pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return locale_pad(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return 0===day?7:day}function formatWeekNumberSunday(d,p){return locale_pad(sunday.count(src_year(d),d),p,2)}function formatWeekNumberISO(d,p){var day=d.getDay();return d=day>=4||0===day?thursday(d):thursday.ceil(d),locale_pad(thursday.count(src_year(d),d)+(4===src_year(d).getDay()),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return locale_pad(monday.count(src_year(d),d),p,2)}function locale_formatYear(d,p){return locale_pad(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return locale_pad(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+locale_pad(z/60|0,"0",2)+locale_pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return locale_pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return locale_pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return locale_pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return locale_pad(1+src_utcDay.count(src_utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return locale_pad(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return locale_pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return locale_pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return locale_pad(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return 0===dow?7:dow}function formatUTCWeekNumberSunday(d,p){return locale_pad(utcSunday.count(src_utcYear(d),d),p,2)}function formatUTCWeekNumberISO(d,p){var day=d.getUTCDay();return d=day>=4||0===day?utcThursday(d):utcThursday.ceil(d),locale_pad(utcThursday.count(src_utcYear(d),d)+(4===src_utcYear(d).getUTCDay()),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return locale_pad(utcMonday.count(src_utcYear(d),d),p,2)}function formatUTCYear(d,p){return locale_pad(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return locale_pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}!function defaultLocale_defaultLocale(definition){return src_defaultLocale_locale=function formatLocale(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths,periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths),formats={a:function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]},A:function formatWeekday(d){return locale_weekdays[d.getDay()]},b:function formatShortMonth(d){return locale_shortMonths[d.getMonth()]},B:function formatMonth(d){return locale_months[d.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:locale_formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},utcFormats={a:function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]},A:function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]},b:function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]},B:function formatUTCMonth(d){return locale_months[d.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},parses={a:function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1},A:function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1},b:function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1},B:function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1},c:function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1},Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)},X:function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function newFormat(specifier,formats){return function(date){var c,pad,format,string=[],i=-1,j=0,n=specifier.length;for(date instanceof Date||(date=new Date(+date));++i<n;)37===specifier.charCodeAt(i)&&(string.push(specifier.slice(j,i)),null!=(pad=pads[c=specifier.charAt(++i)])?c=specifier.charAt(++i):pad="e"===c?" ":"0",(format=formats[c])&&(c=format(date,pad)),string.push(c),j=i+1);return string.push(specifier.slice(j,i)),string.join("")}}function newParse(specifier,newDate){return function(string){var week,day,d=newYear(1900);if(parseSpecifier(d,specifier,string+="",0)!=string.length)return null;if("Q"in d)return new Date(d.Q);if("p"in d&&(d.H=d.H%12+12*d.p),"V"in d){if(d.V<1||d.V>53)return null;"w"in d||(d.w=1),"Z"in d?(week=(day=(week=utcDate(newYear(d.y))).getUTCDay())>4||0===day?utcMonday.ceil(week):utcMonday(week),week=src_utcDay.offset(week,7*(d.V-1)),d.y=week.getUTCFullYear(),d.m=week.getUTCMonth(),d.d=week.getUTCDate()+(d.w+6)%7):(week=(day=(week=newDate(newYear(d.y))).getDay())>4||0===day?monday.ceil(week):monday(week),week=src_day.offset(week,7*(d.V-1)),d.y=week.getFullYear(),d.m=week.getMonth(),d.d=week.getDate()+(d.w+6)%7)}else("W"in d||"U"in d)&&("w"in d||(d.w="u"in d?d.u%7:"W"in d?1:0),day="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay(),d.m=0,d.d="W"in d?(d.w+6)%7+7*d.W-(day+5)%7:d.w+7*d.U-(day+6)%7);return"Z"in d?(d.H+=d.Z/100|0,d.M+=d.Z%100,utcDate(d)):newDate(d)}}function parseSpecifier(d,specifier,string,j){for(var c,parse,i=0,n=specifier.length,m=string.length;i<n;){if(j>=m)return-1;if(37===(c=specifier.charCodeAt(i++))){if(c=specifier.charAt(i++),!(parse=parses[c in pads?specifier.charAt(i++):c])||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}return formats.x=newFormat(locale_date,formats),formats.X=newFormat(locale_time,formats),formats.c=newFormat(locale_dateTime,formats),utcFormats.x=newFormat(locale_date,utcFormats),utcFormats.X=newFormat(locale_time,utcFormats),utcFormats.c=newFormat(locale_dateTime,utcFormats),{format:function format(specifier){var f=newFormat(specifier+="",formats);return f.toString=function(){return specifier},f},parse:function parse(specifier){var p=newParse(specifier+="",localDate);return p.toString=function(){return specifier},p},utcFormat:function utcFormat(specifier){var f=newFormat(specifier+="",utcFormats);return f.toString=function(){return specifier},f},utcParse:function utcParse(specifier){var p=newParse(specifier,utcDate);return p.toString=function(){return specifier},p}}}(definition),timeFormat=src_defaultLocale_locale.format,src_defaultLocale_locale.parse,utcFormat=src_defaultLocale_locale.utcFormat,utcParse=src_defaultLocale_locale.utcParse,src_defaultLocale_locale}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Date.prototype.toISOString||utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");+new Date("2000-01-01T00:00:00.000Z")||utcParse("%Y-%m-%dT%H:%M:%S.%LZ");var time_durationSecond=1e3,time_durationMinute=60*time_durationSecond,time_durationHour=60*time_durationMinute,time_durationDay=24*time_durationHour,time_durationWeek=7*time_durationDay,durationMonth=30*time_durationDay,durationYear=365*time_durationDay;function time_date(t){return new Date(t)}function time_number(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(deinterpolateLinear,src_number),invert=scale.invert,domain=scale.domain,formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y"),tickIntervals=[[second,1,time_durationSecond],[second,5,5*time_durationSecond],[second,15,15*time_durationSecond],[second,30,30*time_durationSecond],[minute,1,time_durationMinute],[minute,5,5*time_durationMinute],[minute,15,15*time_durationMinute],[minute,30,30*time_durationMinute],[hour,1,time_durationHour],[hour,3,3*time_durationHour],[hour,6,6*time_durationHour],[hour,12,12*time_durationHour],[day,1,time_durationDay],[day,2,2*time_durationDay],[week,1,time_durationWeek],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(null==interval&&(interval=10),"number"==typeof interval){var target=Math.abs(stop-start)/interval,i=bisector(function(i){return i[2]}).right(tickIntervals,target);i===tickIntervals.length?(step=tickStep(start/durationYear,stop/durationYear,interval),interval=year):i?(step=(i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i])[1],interval=i[0]):(step=Math.max(tickStep(start,stop,interval),1),interval=millisecond)}return null==step?interval:interval.every(step)}return scale.invert=function(y){return new Date(invert(y))},scale.domain=function(_){return arguments.length?domain(src_array_map.call(_,time_number)):domain().map(time_date)},scale.ticks=function(interval,step){var t,d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0;return r&&(t=t0,t0=t1,t1=t),t=(t=tickInterval(interval,t0,t1,step))?t.range(t0,t1+1):[],r?t.reverse():t},scale.tickFormat=function(count,specifier){return null==specifier?tickFormat:format(specifier)},scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale},scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))},scale}var src_time=function(){return calendar(src_year,src_month,sunday,src_day,src_hour,src_minute,src_second,src_millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])},src_colors=function(s){return s.match(/.{6}/g).map(function(x){return"#"+x})},category10=src_colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),category20b=src_colors("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),category20=(src_colors("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),src_colors("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"));cubehelixLong(cubehelix_cubehelix(300,.5,0),cubehelix_cubehelix(-240,.5,1)),cubehelixLong(cubehelix_cubehelix(-100,.75,.35),cubehelix_cubehelix(80,1.5,.8)),cubehelixLong(cubehelix_cubehelix(260,.75,.35),cubehelix_cubehelix(80,1.5,.8)),cubehelix_cubehelix();function ramp(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}ramp(src_colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),ramp(src_colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ramp(src_colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ramp(src_colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function sequential(interpolator){var x0=0,x1=1,clamp=!1;function scale(x){var t=(x-x0)/(x1-x0);return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}return scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],scale):[x0,x1]},scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp},scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator},scale.copy=function(){return sequential(interpolator).domain([x0,x1]).clamp(clamp)},linearish(scale)}var d3_scale_chromatic_src_colors=function(specifier){for(var n=specifier.length/6|0,colors=new Array(n),i=0;i<n;)colors[i]="#"+specifier.slice(6*i,6*++i);return colors},Accent=(d3_scale_chromatic_src_colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),d3_scale_chromatic_src_colors("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666")),Dark2=d3_scale_chromatic_src_colors("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),Paired=d3_scale_chromatic_src_colors("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Pastel1=d3_scale_chromatic_src_colors("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),Pastel2=d3_scale_chromatic_src_colors("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),Set1=d3_scale_chromatic_src_colors("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),Set2=d3_scale_chromatic_src_colors("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),Set3=d3_scale_chromatic_src_colors("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),src_ramp=function(scheme){return rgbBasis(scheme[scheme.length-1])},BrBG_scheme=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(d3_scale_chromatic_src_colors),BrBG=src_ramp(BrBG_scheme),PRGn_scheme=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(d3_scale_chromatic_src_colors),PRGn=src_ramp(PRGn_scheme),PiYG_scheme=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(d3_scale_chromatic_src_colors),PiYG=src_ramp(PiYG_scheme),PuOr=src_ramp(new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(d3_scale_chromatic_src_colors)),RdBu=src_ramp(new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(d3_scale_chromatic_src_colors)),RdGy=src_ramp(new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(d3_scale_chromatic_src_colors)),RdYlBu=src_ramp(new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(d3_scale_chromatic_src_colors)),RdYlGn=src_ramp(new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(d3_scale_chromatic_src_colors)),Spectral=src_ramp(new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(d3_scale_chromatic_src_colors)),BuGn=src_ramp(new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(d3_scale_chromatic_src_colors)),BuPu=src_ramp(new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(d3_scale_chromatic_src_colors)),GnBu=src_ramp(new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(d3_scale_chromatic_src_colors)),OrRd=src_ramp(new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(d3_scale_chromatic_src_colors)),PuBuGn=src_ramp(new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(d3_scale_chromatic_src_colors)),PuBu=src_ramp(new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(d3_scale_chromatic_src_colors)),PuRd=src_ramp(new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(d3_scale_chromatic_src_colors)),RdPu=src_ramp(new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(d3_scale_chromatic_src_colors)),YlGnBu=src_ramp(new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(d3_scale_chromatic_src_colors)),YlGn=src_ramp(new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(d3_scale_chromatic_src_colors)),YlOrBr=src_ramp(new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(d3_scale_chromatic_src_colors)),YlOrRd=src_ramp(new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(d3_scale_chromatic_src_colors)),Blues_scheme=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(d3_scale_chromatic_src_colors),Blues=src_ramp(Blues_scheme),Greens=src_ramp(new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(d3_scale_chromatic_src_colors)),Greys=src_ramp(new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(d3_scale_chromatic_src_colors)),Purples=src_ramp(new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(d3_scale_chromatic_src_colors)),Reds=src_ramp(new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(d3_scale_chromatic_src_colors)),Oranges=src_ramp(new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(d3_scale_chromatic_src_colors)),sequential_multi_cubehelix=cubehelixLong(cubehelix_cubehelix(300,.5,0),cubehelix_cubehelix(-240,.5,1)),rainbow_warm=cubehelixLong(cubehelix_cubehelix(-100,.75,.35),cubehelix_cubehelix(80,1.5,.8)),rainbow_cool=cubehelixLong(cubehelix_cubehelix(260,.75,.35),cubehelix_cubehelix(80,1.5,.8)),rainbow_c=cubehelix_cubehelix(),sequential_multi_rainbow=function(t){(t<0||t>1)&&(t-=Math.floor(t));var ts=Math.abs(t-.5);return rainbow_c.h=360*t-100,rainbow_c.s=1.5-1.5*ts,rainbow_c.l=.8-.9*ts,rainbow_c+""};color_rgb(),Math.PI,Math.PI;function viridis_ramp(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}var sequential_multi_viridis=viridis_ramp(d3_scale_chromatic_src_colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),viridis_magma=viridis_ramp(d3_scale_chromatic_src_colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),viridis_inferno=viridis_ramp(d3_scale_chromatic_src_colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),viridis_plasma=viridis_ramp(d3_scale_chromatic_src_colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921")),UNIT_GLOBAL_NAMESPACE="app.units",UNIT_LOCAL_NAMESPACE="local.units",LAYER_LOCAL_NAMESPACE="local.layers",LAYER_GLOBAL_NAMESPACE="app.layers",GROUP_GLOBAL_NAMESPACE="app.group",GROUP_LOCAL_NAMESPACE="local.group",CANVAS_LOCAL_NAMESPACE="local.canvas",CANVAS_GLOBAL_NAMESPACE="app.canvas",reserved_fields={ROW_ID:"__id__"},common_props={ACTION_INF:"actionInf",ON_LAYER_DRAW:"onLayerDraw",MATRIX_CREATED:"matrixCreated"},dist_datamodel=__webpack_require__(0),datamodel_default=__webpack_require__.n(dist_datamodel),src_array_slice=Array.prototype.slice,d3_axis_src_identity=function(x){return x},axis_top=1,axis_right=2,axis_bottom=3,axis_left=4,epsilon=1e-6;function translateX(x){return"translate("+(x+.5)+",0)"}function translateY(y){return"translate(0,"+(y+.5)+")"}function entering(){return!this.__axis}function axis_axis(orient,scale){var tickArguments=[],tickValues=null,tickFormat=null,tickTransform=null,tickSizeInner=6,tickSizeOuter=6,tickPadding=3,k=orient===axis_top||orient===axis_left?-1:1,x=orient===axis_left||orient===axis_right?"x":"y",transform=orient===axis_top||orient===axis_bottom?translateX:translateY;function axis(context){var values=null==tickValues?scale.ticks?scale.ticks.apply(scale,tickArguments):scale.domain():tickValues,format=null==tickFormat?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments):d3_axis_src_identity:tickFormat,spacing=Math.max(tickSizeInner,0)+tickPadding,range=scale.range(),range0=+range[0]+.5,range1=+range[range.length-1]+.5,position=(scale.bandwidth?function axis_center(scale){var offset=Math.max(0,scale.bandwidth()-1)/2;return scale.round()&&(offset=Math.round(offset)),function(d){return+scale(d)+offset}}:function axis_number(scale){return function(d){return+scale(d)}})(scale.copy()),selection=context.selection?context.selection():context,path=selection.selectAll(".domain").data([null]),tick=selection.selectAll(".tick").data(values,scale).order(),tickExit=tick.exit(),tickEnter=tick.enter().append("g").attr("class","tick"),line=tick.select("line"),text=tick.select("text");path=path.merge(path.enter().insert("path",".tick").attr("class","domain").attr("stroke","#000")),tick=tick.merge(tickEnter),line=line.merge(tickEnter.append("line").attr("stroke","#000").attr(x+"2",k*tickSizeInner)),text=text.merge(tickEnter.append("text").attr("fill","#000").attr(x,k*spacing).attr("dy",orient===axis_top?"0em":orient===axis_bottom?"0.71em":"0.32em")).style("transform",tickTransform),context!==selection&&(path=path.transition(context),tick=tick.transition(context),line=line.transition(context),text=text.transition(context),tickExit=tickExit.transition(context).attr("opacity",epsilon).attr("transform",function(d){return isFinite(d=position(d))?transform(d):this.getAttribute("transform")}),tickEnter.attr("opacity",epsilon).attr("transform",function(d){var p=this.parentNode.__axis;return transform(p&&isFinite(p=p(d))?p:position(d))})),tickExit.remove(),path.attr("d",orient===axis_left||orient==axis_right?"M"+k*tickSizeOuter+","+range0+"H0.5V"+range1+"H"+k*tickSizeOuter:"M"+range0+","+k*tickSizeOuter+"V0.5H"+range1+"V"+k*tickSizeOuter),tick.attr("opacity",1).attr("transform",function(d){return transform(position(d))}),line.attr(x+"2",k*tickSizeInner),text.attr(x,k*spacing).text(format),selection.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",orient===axis_right?"start":orient===axis_left?"end":"middle"),selection.each(function(){this.__axis=position})}return axis.scale=function(_){return arguments.length?(scale=_,axis):scale},axis.tickTransform=function(_){return arguments.length?(tickTransform=_,axis):tickTransform},axis.ticks=function(){return tickArguments=src_array_slice.call(arguments),axis},axis.tickArguments=function(_){return arguments.length?(tickArguments=null==_?[]:src_array_slice.call(_),axis):tickArguments.slice()},axis.tickValues=function(_){return arguments.length?(tickValues=null==_?null:src_array_slice.call(_),axis):tickValues&&tickValues.slice()},axis.tickFormat=function(_){return arguments.length?(tickFormat=_,axis):tickFormat},axis.tickSize=function(_){return arguments.length?(tickSizeInner=tickSizeOuter=+_,axis):tickSizeInner},axis.tickSizeInner=function(_){return arguments.length?(tickSizeInner=+_,axis):tickSizeInner},axis.tickSizeOuter=function(_){return arguments.length?(tickSizeOuter=+_,axis):tickSizeOuter},axis.tickPadding=function(_){return arguments.length?(tickPadding=+_,axis):tickPadding},axis}var pi=Math.PI,tau=2*pi,tauEpsilon=tau-1e-6;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path_path(){return new Path}Path.prototype=path_path.prototype={constructor:Path,moveTo:function moveTo(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function lineTo(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function quadraticCurveTo(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function bezierCurveTo(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function arcTo(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=x1)+","+(this._y1=y1);else if(l01_2>1e-6)if(Math.abs(y01*x21-y21*x01)>1e-6&&r){var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;Math.abs(t01-1)>1e-6&&(this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)),this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}else this._+="L"+(this._x1=x1)+","+(this._y1=y1);else;},arc:function arc(x,y,r,a0,a1,ccw){x=+x,y=+y;var dx=(r=+r)*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);null===this._x1?this._+="M"+x0+","+y0:(Math.abs(this._x1-x0)>1e-6||Math.abs(this._y1-y0)>1e-6)&&(this._+="L"+x0+","+y0),r&&(da<0&&(da=da%tau+tau),da>tauEpsilon?this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0):da>1e-6&&(this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))))},rect:function rect(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function toString(){return this._}};var src_path=path_path,d3_shape_src_constant=function(x){return function constant(){return x}},abs=Math.abs,atan2=Math.atan2,cos=Math.cos,math_max=Math.max,math_min=Math.min,sin=Math.sin,math_sqrt=Math.sqrt,math_epsilon=1e-12,math_pi=Math.PI,halfPi=math_pi/2,math_tau=2*math_pi;function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/math_sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*math_sqrt(math_max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function Linear(context){this._context=context}Linear.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y)}}};var curve_linear=function(context){return new Linear(context)};function point_x(p){return p[0]}function point_y(p){return p[1]}var src_line=function(){var x=point_x,y=point_y,defined=d3_shape_src_constant(!0),context=null,curve=curve_linear,output=null;function line(data){var i,d,buffer,n=data.length,defined0=!1;for(null==context&&(output=curve(buffer=src_path())),i=0;i<=n;++i)!(i<n&&defined(d=data[i],i,data))===defined0&&((defined0=!defined0)?output.lineStart():output.lineEnd()),defined0&&output.point(+x(d,i,data),+y(d,i,data));if(buffer)return output=null,buffer+""||null}return line.x=function(_){return arguments.length?(x="function"==typeof _?_:d3_shape_src_constant(+_),line):x},line.y=function(_){return arguments.length?(y="function"==typeof _?_:d3_shape_src_constant(+_),line):y},line.defined=function(_){return arguments.length?(defined="function"==typeof _?_:d3_shape_src_constant(!!_),line):defined},line.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),line):curve},line.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),line):context},line},src_area=function(){var x0=point_x,x1=null,y0=d3_shape_src_constant(0),y1=point_y,defined=d3_shape_src_constant(!0),context=null,curve=curve_linear,output=null;function area(data){var i,j,k,d,buffer,n=data.length,defined0=!1,x0z=new Array(n),y0z=new Array(n);for(null==context&&(output=curve(buffer=src_path())),i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0)if(defined0=!defined0)j=i,output.areaStart(),output.lineStart();else{for(output.lineEnd(),output.lineStart(),k=i-1;k>=j;--k)output.point(x0z[k],y0z[k]);output.lineEnd(),output.areaEnd()}defined0&&(x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data),output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i]))}if(buffer)return output=null,buffer+""||null}function arealine(){return src_line().defined(defined).curve(curve).context(context)}return area.x=function(_){return arguments.length?(x0="function"==typeof _?_:d3_shape_src_constant(+_),x1=null,area):x0},area.x0=function(_){return arguments.length?(x0="function"==typeof _?_:d3_shape_src_constant(+_),area):x0},area.x1=function(_){return arguments.length?(x1=null==_?null:"function"==typeof _?_:d3_shape_src_constant(+_),area):x1},area.y=function(_){return arguments.length?(y0="function"==typeof _?_:d3_shape_src_constant(+_),y1=null,area):y0},area.y0=function(_){return arguments.length?(y0="function"==typeof _?_:d3_shape_src_constant(+_),area):y0},area.y1=function(_){return arguments.length?(y1=null==_?null:"function"==typeof _?_:d3_shape_src_constant(+_),area):y1},area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)},area.lineY1=function(){return arealine().x(x0).y(y1)},area.lineX1=function(){return arealine().x(x1).y(y0)},area.defined=function(_){return arguments.length?(defined="function"==typeof _?_:d3_shape_src_constant(!!_),area):defined},area.curve=function(_){return arguments.length?(curve=_,null!=context&&(output=curve(context)),area):curve},area.context=function(_){return arguments.length?(null==_?context=output=null:output=curve(context=_),area):context},area},src_descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},d3_shape_src_identity=function(d){return d};curveRadial(curve_linear);function Radial(curve){this._curve=curve}function curveRadial(curve){function radial(context){return new Radial(curve(context))}return radial._curve=curve,radial}Radial.prototype={areaStart:function areaStart(){this._curve.areaStart()},areaEnd:function areaEnd(){this._curve.areaEnd()},lineStart:function lineStart(){this._curve.lineStart()},lineEnd:function lineEnd(){this._curve.lineEnd()},point:function point(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};var d3_shape_src_array_slice=Array.prototype.slice;var symbol_circle={draw:function draw(context,size){var r=Math.sqrt(size/math_pi);context.moveTo(r,0),context.arc(0,0,r,0,math_tau)}},symbol_cross={draw:function draw(context,size){var r=Math.sqrt(size/5)/2;context.moveTo(-3*r,-r),context.lineTo(-r,-r),context.lineTo(-r,-3*r),context.lineTo(r,-3*r),context.lineTo(r,-r),context.lineTo(3*r,-r),context.lineTo(3*r,r),context.lineTo(r,r),context.lineTo(r,3*r),context.lineTo(-r,3*r),context.lineTo(-r,r),context.lineTo(-3*r,r),context.closePath()}},tan30=Math.sqrt(1/3),tan30_2=2*tan30,diamond={draw:function draw(context,size){var y=Math.sqrt(size/tan30_2),x=y*tan30;context.moveTo(0,-y),context.lineTo(x,0),context.lineTo(0,y),context.lineTo(-x,0),context.closePath()}},kr=Math.sin(math_pi/10)/Math.sin(7*math_pi/10),kx=Math.sin(math_tau/10)*kr,ky=-Math.cos(math_tau/10)*kr,star={draw:function draw(context,size){var r=Math.sqrt(.8908130915292852*size),x=kx*r,y=ky*r;context.moveTo(0,-r),context.lineTo(x,y);for(var i=1;i<5;++i){var a=math_tau*i/5,c=Math.cos(a),s=Math.sin(a);context.lineTo(s*r,-c*r),context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}},square={draw:function draw(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}},sqrt3=Math.sqrt(3),triangle={draw:function draw(context,size){var y=-Math.sqrt(size/(3*sqrt3));context.moveTo(0,2*y),context.lineTo(-sqrt3*y,-y),context.lineTo(sqrt3*y,-y),context.closePath()}},wye_s=Math.sqrt(3)/2,wye_k=1/Math.sqrt(12),wye_a=3*(wye_k/2+1),wye={draw:function draw(context,size){var r=Math.sqrt(size/wye_a),x0=r/2,y0=r*wye_k,x1=x0,y1=r*wye_k+r,x2=-x1,y2=y1;context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.lineTo(-.5*x0-wye_s*y0,wye_s*x0+-.5*y0),context.lineTo(-.5*x1-wye_s*y1,wye_s*x1+-.5*y1),context.lineTo(-.5*x2-wye_s*y2,wye_s*x2+-.5*y2),context.lineTo(-.5*x0+wye_s*y0,-.5*y0-wye_s*x0),context.lineTo(-.5*x1+wye_s*y1,-.5*y1-wye_s*x1),context.lineTo(-.5*x2+wye_s*y2,-.5*y2-wye_s*x2),context.closePath()}},noop=function(){};function _point(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}Basis.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function lineEnd(){switch(this._point){case 3:_point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}};function BasisClosed(context){this._context=context}BasisClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x2=x,this._y2=y;break;case 1:this._point=2,this._x3=x,this._y3=y;break;case 2:this._point=3,this._x4=x,this._y4=y,this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:_point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}};function BasisOpen(context){this._context=context}BasisOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function lineEnd(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:_point(this,x,y)}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y}};function Bundle(context,beta){this._basis=new Basis(context),this._beta=beta}Bundle.prototype={lineStart:function lineStart(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function lineEnd(){var x=this._x,y=this._y,j=x.length-1;if(j>0)for(var t,x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1;++i<=j;)t=i/j,this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy));this._x=this._y=null,this._basis.lineEnd()},point:function point(x,y){this._x.push(+x),this._y.push(+y)}};(function custom(beta){function bundle(context){return 1===beta?new Basis(context):new Bundle(context,beta)}return bundle.beta=function(beta){return custom(+beta)},bundle})(.85);function cardinal_point(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context,this._k=(1-tension)/6}Cardinal.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:cardinal_point(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2,this._x1=x,this._y1=y;break;case 2:this._point=3;default:cardinal_point(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(tension){function cardinal(context){return new Cardinal(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal})(0);function CardinalClosed(context,tension){this._context=context,this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:cardinal_point(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal})(0);function CardinalOpen(context,tension){this._context=context,this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function lineEnd(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:cardinal_point(this,x,y)}this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}return cardinal.tension=function(tension){return custom(+tension)},cardinal})(0);function catmullRom_point(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>math_epsilon){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n,y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>math_epsilon){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m,y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context,this._alpha=alpha}CatmullRom.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:catmullRom_point(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curve_catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context,this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function point(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=x,this._y3=y;break;case 1:this._point=2,this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3,this._x5=x,this._y5=y;break;default:catmullRom_point(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom})(.5);function CatmullRomOpen(context,alpha){this._context=context,this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){if(x=+x,y=+y,this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:catmullRom_point(this,x,y)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=x,this._y0=this._y1,this._y1=this._y2,this._y2=y}};(function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}return catmullRom.alpha=function(alpha){return custom(+alpha)},catmullRom})(.5);function LinearClosed(context){this._context=context}LinearClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){this._point&&this._context.closePath()},point:function point(x,y){x=+x,y=+y,this._point?this._context.lineTo(x,y):(this._point=1,this._context.moveTo(x,y))}};function monotone_sign(x){return x<0?-1:1}function slope3(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(monotone_sign(s0)+monotone_sign(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function monotone_point(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}function MonotoneY(context){this._context=new ReflectContext(context)}function ReflectContext(context){this._context=context}function Natural(context){this._context=context}function controlPoints(x){var i,m,n=x.length-1,a=new Array(n),b=new Array(n),r=new Array(n);for(a[0]=0,b[0]=2,r[0]=x[0]+2*x[1],i=1;i<n-1;++i)a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1];for(a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n],i=1;i<n;++i)m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1];for(a[n-1]=r[n-1]/b[n-1],i=n-2;i>=0;--i)a[i]=(r[i]-a[i+1])/b[i];for(b[n-1]=(x[n]+a[n-1])/2,i=0;i<n-1;++i)b[i]=2*x[i+1]-a[i+1];return[a,b]}MonotoneX.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:monotone_point(this,this._t0,slope2(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function point(x,y){var t1=NaN;if(y=+y,(x=+x)!==this._x1||y!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3,monotone_point(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:monotone_point(this,this._t0,t1=slope3(this,x,y))}this._x0=this._x1,this._x1=x,this._y0=this._y1,this._y1=y,this._t0=t1}}},(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)},ReflectContext.prototype={moveTo:function moveTo(x,y){this._context.moveTo(y,x)},closePath:function closePath(){this._context.closePath()},lineTo:function lineTo(x,y){this._context.lineTo(y,x)},bezierCurveTo:function bezierCurveTo(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}},Natural.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=[],this._y=[]},lineEnd:function lineEnd(){var x=this._x,y=this._y,n=x.length;if(n)if(this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]),2===n)this._context.lineTo(x[1],y[1]);else for(var px=controlPoints(x),py=controlPoints(y),i0=0,i1=1;i1<n;++i0,++i1)this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function point(x,y){this._x.push(+x),this._y.push(+y)}};function Step(context,t){this._context=context,this._t=t}Step.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=this._y=NaN,this._point=0},lineEnd:function lineEnd(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function point(x,y){switch(x=+x,y=+y,this._point){case 0:this._point=1,this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,y),this._context.lineTo(x,y);else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y),this._context.lineTo(x1,y)}}this._x=x,this._y=y}};var curve_step=function(context){return new Step(context,.5)};function stepBefore(context){return new Step(context,0)}function stepAfter(context){return new Step(context,1)}var none=function(series,order){if((n=series.length)>1)for(var j,s0,n,i=1,s1=series[order[0]],m=s1.length;i<n;++i)for(s0=s1,s1=series[order[i]],j=0;j<m;++j)s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]},order_none=function(series){for(var n=series.length,o=new Array(n);--n>=0;)o[n]=n;return o};function stackValue(d,key){return d[key]}var order_ascending=function(series){var sums=series.map(ascending_sum);return order_none(series).sort(function(a,b){return sums[a]-sums[b]})};function ascending_sum(series){for(var v,s=0,i=-1,n=series.length;++i<n;)(v=+series[i][1])&&(s+=v);return s}function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}(function custom(e){function polyIn(t){return Math.pow(t,e)}return e=+e,polyIn.exponent=custom,polyIn})(3),function custom(e){function polyOut(t){return 1-Math.pow(1-t,e)}return e=+e,polyOut.exponent=custom,polyOut}(3);var polyInOut=function custom(e){function polyInOut(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,polyInOut.exponent=custom,polyInOut}(3);Math.PI;var b1=4/11,b2=6/11,b3=8/11,b4=.75,b5=9/11,b6=10/11,b7=.9375,b8=21/22,b9=63/64,b0=1/b1/b1;function bounceOut(t){return(t=+t)<b1?b0*t*t:t<b3?b0*(t-=b2)*t+b4:t<b6?b0*(t-=b5)*t+b7:b0*(t-=b8)*t+b9}(function custom(s){function backIn(t){return t*t*((s+1)*t-s)}return s=+s,backIn.overshoot=custom,backIn})(1.70158),function custom(s){function backOut(t){return--t*t*((s+1)*t+s)+1}return s=+s,backOut.overshoot=custom,backOut}(1.70158);var backInOut=function custom(s){function backInOut(t){return((t*=2)<1?t*t*((s+1)*t-s):(t-=2)*t*((s+1)*t+s)+2)/2}return s=+s,backInOut.overshoot=custom,backInOut}(1.70158),elastic_tau=2*Math.PI,elasticOut=(function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=elastic_tau);function elasticIn(t){return a*Math.pow(2,10*--t)*Math.sin((s-t)/p)}return elasticIn.amplitude=function(a){return custom(a,p*elastic_tau)},elasticIn.period=function(p){return custom(a,p)},elasticIn}(1,.3),function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=elastic_tau);function elasticOut(t){return 1-a*Math.pow(2,-10*(t=+t))*Math.sin((t+s)/p)}return elasticOut.amplitude=function(a){return custom(a,p*elastic_tau)},elasticOut.period=function(p){return custom(a,p)},elasticOut}(1,.3)),d3_voronoi_src_constant=(function custom(a,p){var s=Math.asin(1/(a=Math.max(1,a)))*(p/=elastic_tau);function elasticInOut(t){return((t=2*t-1)<0?a*Math.pow(2,10*t)*Math.sin((s-t)/p):2-a*Math.pow(2,-10*t)*Math.sin((s+t)/p))/2}return elasticInOut.amplitude=function(a){return custom(a,p*elastic_tau)},elasticInOut.period=function(p){return custom(a,p)},elasticInOut}(1,.3),function(x){return function(){return x}});function src_point_x(d){return d[0]}function src_point_y(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}function RedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function RedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function RedBlackFirst(node){for(;node.L;)node=node.L;return node}RedBlackTree.prototype={constructor:RedBlackTree,insert:function insert(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else this._?(after=RedBlackFirst(this._),node.P=null,node.N=after,after.P=after.L=node,parent=after):(node.P=node.N=null,this._=node,parent=null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)parent===(grandpa=parent.U).L?(uncle=grandpa.R)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(RedBlackRotateLeft(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,RedBlackRotateRight(this,grandpa)):(uncle=grandpa.L)&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(RedBlackRotateRight(this,parent),parent=(after=parent).U),parent.C=!1,grandpa.C=!0,RedBlackRotateLeft(this,grandpa)),parent=after.U;this._.C=!1},remove:function remove(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var sibling,next,red,parent=node.U,left=node.L,right=node.R;if(next=left?right?RedBlackFirst(right):left:right,parent?parent.L===node?parent.L=next:parent.R=next:this._=next,left&&right?(red=next.C,next.C=node.C,next.L=left,left.U=next,next!==right?(parent=next.U,next.U=node.U,node=next.R,parent.L=node,next.R=right,right.U=next):(next.U=parent,parent=next,node=next.R)):(red=node.C,node=next),node&&(node.U=parent),!red)if(node&&node.C)node.C=!1;else{do{if(node===this._)break;if(node===parent.L){if((sibling=parent.R).C&&(sibling.C=!1,parent.C=!0,RedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.R&&sibling.R.C||(sibling.L.C=!1,sibling.C=!0,RedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,RedBlackRotateLeft(this,parent),node=this._;break}}else if((sibling=parent.L).C&&(sibling.C=!1,parent.C=!0,RedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.L&&sibling.L.C||(sibling.R.C=!1,sibling.C=!0,RedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,RedBlackRotateRight(this,parent),node=this._;break}sibling.C=!0,node=parent,parent=parent.U}while(!node.C);node&&(node.C=!1)}}};var src_RedBlackTree=RedBlackTree;function createEdge(left,right,v0,v1){var edge=[null,null],index=Diagram_edges.push(edge)-1;return edge.left=left,edge.right=right,v0&&setEdgeEnd(edge,left,right,v0),v1&&setEdgeEnd(edge,right,left,v1),Diagram_cells[left.index].halfedges.push(index),Diagram_cells[right.index].halfedges.push(index),edge}function createBorderEdge(left,v0,v1){var edge=[v0,v1];return edge.left=left,edge}function setEdgeEnd(edge,left,right,vertex){edge[0]||edge[1]?edge.left===right?edge[1]=vertex:edge[0]=vertex:(edge[0]=vertex,edge.left=left,edge.right=right)}function clipEdge(edge,x0,y0,x1,y1){var r,a=edge[0],b=edge[1],ax=a[0],ay=a[1],t0=0,t1=1,dx=b[0]-ax,dy=b[1]-ay;if(r=x0-ax,dx||!(r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return!(t0>0||t1<1)||(t0>0&&(edge[0]=[ax+t0*dx,ay+t0*dy]),t1<1&&(edge[1]=[ax+t1*dx,ay+t1*dy]),!0)}}}}}function connectEdge(edge,x0,y0,x1,y1){var v1=edge[1];if(v1)return!0;var fm,fb,v0=edge[0],left=edge.left,right=edge.right,lx=left[0],ly=left[1],rx=right[0],ry=right[1],fx=(lx+rx)/2,fy=(ly+ry)/2;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(v0){if(v0[1]>=y1)return}else v0=[fx,y0];v1=[fx,y1]}else{if(v0){if(v0[1]<y0)return}else v0=[fx,y1];v1=[fx,y0]}}else if(fb=fy-(fm=(lx-rx)/(ry-ly))*fx,fm<-1||fm>1)if(lx>rx){if(v0){if(v0[1]>=y1)return}else v0=[(y0-fb)/fm,y0];v1=[(y1-fb)/fm,y1]}else{if(v0){if(v0[1]<y0)return}else v0=[(y1-fb)/fm,y1];v1=[(y0-fb)/fm,y0]}else if(ly<ry){if(v0){if(v0[0]>=x1)return}else v0=[x0,fm*x0+fb];v1=[x1,fm*x1+fb]}else{if(v0){if(v0[0]<x0)return}else v0=[x1,fm*x1+fb];v1=[x0,fm*x0+fb]}return edge[0]=v0,edge[1]=v1,!0}function cellHalfedgeAngle(cell,edge){var site=cell.site,va=edge.left,vb=edge.right;return site===vb&&(vb=va,va=site),vb?Math.atan2(vb[1]-va[1],vb[0]-va[0]):(site===va?(va=edge[1],vb=edge[0]):(va=edge[0],vb=edge[1]),Math.atan2(va[0]-vb[0],vb[1]-va[1]))}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}var firstCircle,circlePool=[];function attachCircle(arc){var lArc=arc.P,rArc=arc.N;if(lArc&&rArc){var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite!==rSite){var bx=cSite[0],by=cSite[1],ax=lSite[0]-bx,ay=lSite[1]-by,cx=rSite[0]-bx,cy=rSite[1]-by,d=2*(ax*cy-ay*cx);if(!(d>=-Diagram_epsilon2)){var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,circle=circlePool.pop()||new function Circle(){RedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null};circle.arc=arc,circle.site=cSite,circle.x=x+bx,circle.y=(circle.cy=y+by)+Math.sqrt(x*x+y*y),arc.circle=circle;for(var before=null,node=circles._;node;)if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(!node.L){before=node.P;break}node=node.L}else{if(!node.R){before=node;break}node=node.R}circles.insert(before,circle),before||(firstCircle=circle)}}}}function detachCircle(arc){var circle=arc.circle;circle&&(circle.P||(firstCircle=circle.N),circles.remove(circle),circlePool.push(circle),RedBlackNode(circle),arc.circle=null)}var beachPool=[];function createBeach(site){var beach=beachPool.pop()||new function Beach(){RedBlackNode(this),this.edge=this.site=this.circle=null};return beach.site=site,beach}function detachBeach(beach){detachCircle(beach),beaches.remove(beach),beachPool.push(beach),RedBlackNode(beach)}function removeBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex=[x,y],previous=beach.P,next=beach.N,disappearing=[beach];detachBeach(beach);for(var lArc=previous;lArc.circle&&Math.abs(x-lArc.circle.x)<Diagram_epsilon&&Math.abs(y-lArc.circle.cy)<Diagram_epsilon;)previous=lArc.P,disappearing.unshift(lArc),detachBeach(lArc),lArc=previous;disappearing.unshift(lArc),detachCircle(lArc);for(var rArc=next;rArc.circle&&Math.abs(x-rArc.circle.x)<Diagram_epsilon&&Math.abs(y-rArc.circle.cy)<Diagram_epsilon;)next=rArc.N,disappearing.push(rArc),detachBeach(rArc),rArc=next;disappearing.push(rArc),detachCircle(rArc);var iArc,nArcs=disappearing.length;for(iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],(rArc=disappearing[nArcs-1]).edge=createEdge(lArc.site,rArc.site,null,vertex),attachCircle(lArc),attachCircle(rArc)}function addBeach(site){for(var lArc,rArc,dxl,dxr,x=site[0],directrix=site[1],node=beaches._;node;)if((dxl=leftBreakPoint(node,directrix)-x)>Diagram_epsilon)node=node.L;else{if(!((dxr=x-rightBreakPoint(node,directrix))>Diagram_epsilon)){dxl>-Diagram_epsilon?(lArc=node.P,rArc=node):dxr>-Diagram_epsilon?(lArc=node,rArc=node.N):lArc=rArc=node;break}if(!node.R){lArc=node;break}node=node.R}!function createCell(site){return Diagram_cells[site.index]={site:site,halfedges:[]}}(site);var newArc=createBeach(site);if(beaches.insert(lArc,newArc),lArc||rArc){if(lArc===rArc)return detachCircle(lArc),rArc=createBeach(lArc.site),beaches.insert(newArc,rArc),newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site),attachCircle(lArc),void attachCircle(rArc);if(rArc){detachCircle(lArc),detachCircle(rArc);var lSite=lArc.site,ax=lSite[0],ay=lSite[1],bx=site[0]-ax,by=site[1]-ay,rSite=rArc.site,cx=rSite[0]-ax,cy=rSite[1]-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex=[(cy*hb-by*hc)/d+ax,(bx*hc-cx*hb)/d+ay];setEdgeEnd(rArc.edge,lSite,rSite,vertex),newArc.edge=createEdge(lSite,site,null,vertex),rArc.edge=createEdge(site,rSite,null,vertex),attachCircle(lArc),attachCircle(rArc)}else newArc.edge=createEdge(lArc.site,newArc.site)}}function leftBreakPoint(arc,directrix){var site=arc.site,rfocx=site[0],rfocy=site[1],pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-1/0;var lfocx=(site=lArc.site)[0],lfocy=site[1],plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}function rightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return leftBreakPoint(rArc,directrix);var site=arc.site;return site[1]===directrix?site[0]:1/0}var beaches,Diagram_cells,circles,Diagram_edges,Diagram_epsilon=1e-6,Diagram_epsilon2=1e-12;function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,extent){var x,y,circle,site=sites.sort(lexicographic).pop();for(Diagram_edges=[],Diagram_cells=new Array(sites.length),beaches=new src_RedBlackTree,circles=new src_RedBlackTree;;)if(circle=firstCircle,site&&(!circle||site[1]<circle.y||site[1]===circle.y&&site[0]<circle.x))site[0]===x&&site[1]===y||(addBeach(site),x=site[0],y=site[1]),site=sites.pop();else{if(!circle)break;removeBeach(circle.arc)}if(function sortCellHalfedges(){for(var cell,halfedges,j,m,i=0,n=Diagram_cells.length;i<n;++i)if((cell=Diagram_cells[i])&&(m=(halfedges=cell.halfedges).length)){var index=new Array(m),array=new Array(m);for(j=0;j<m;++j)index[j]=j,array[j]=cellHalfedgeAngle(cell,Diagram_edges[halfedges[j]]);for(index.sort(function(i,j){return array[j]-array[i]}),j=0;j<m;++j)array[j]=halfedges[index[j]];for(j=0;j<m;++j)halfedges[j]=array[j]}}(),extent){var x0=+extent[0][0],y0=+extent[0][1],x1=+extent[1][0],y1=+extent[1][1];!function clipEdges(x0,y0,x1,y1){for(var edge,i=Diagram_edges.length;i--;)connectEdge(edge=Diagram_edges[i],x0,y0,x1,y1)&&clipEdge(edge,x0,y0,x1,y1)&&(Math.abs(edge[0][0]-edge[1][0])>Diagram_epsilon||Math.abs(edge[0][1]-edge[1][1])>Diagram_epsilon)||delete Diagram_edges[i]}(x0,y0,x1,y1),function clipCells(x0,y0,x1,y1){var iCell,cell,site,iHalfedge,halfedges,nHalfedges,start,startX,startY,end,endX,endY,nCells=Diagram_cells.length,cover=!0;for(iCell=0;iCell<nCells;++iCell)if(cell=Diagram_cells[iCell]){for(site=cell.site,iHalfedge=(halfedges=cell.halfedges).length;iHalfedge--;)Diagram_edges[halfedges[iHalfedge]]||halfedges.splice(iHalfedge,1);for(iHalfedge=0,nHalfedges=halfedges.length;iHalfedge<nHalfedges;)endX=(end=cellHalfedgeEnd(cell,Diagram_edges[halfedges[iHalfedge]]))[0],endY=end[1],startX=(start=cellHalfedgeStart(cell,Diagram_edges[halfedges[++iHalfedge%nHalfedges]]))[0],startY=start[1],(Math.abs(endX-startX)>Diagram_epsilon||Math.abs(endY-startY)>Diagram_epsilon)&&(halfedges.splice(iHalfedge,0,Diagram_edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<Diagram_epsilon&&y1-endY>Diagram_epsilon?[x0,Math.abs(startX-x0)<Diagram_epsilon?startY:y1]:Math.abs(endY-y1)<Diagram_epsilon&&x1-endX>Diagram_epsilon?[Math.abs(startY-y1)<Diagram_epsilon?startX:x1,y1]:Math.abs(endX-x1)<Diagram_epsilon&&endY-y0>Diagram_epsilon?[x1,Math.abs(startX-x1)<Diagram_epsilon?startY:y0]:Math.abs(endY-y0)<Diagram_epsilon&&endX-x0>Diagram_epsilon?[Math.abs(startY-y0)<Diagram_epsilon?startX:x0,y0]:null))-1),++nHalfedges);nHalfedges&&(cover=!1)}if(cover){var dx,dy,d2,dc=1/0;for(iCell=0,cover=null;iCell<nCells;++iCell)(cell=Diagram_cells[iCell])&&(d2=(dx=(site=cell.site)[0]-x0)*dx+(dy=site[1]-y0)*dy)<dc&&(dc=d2,cover=cell);if(cover){var v00=[x0,y0],v01=[x0,y1],v11=[x1,y1],v10=[x1,y0];cover.halfedges.push(Diagram_edges.push(createBorderEdge(site=cover.site,v00,v01))-1,Diagram_edges.push(createBorderEdge(site,v01,v11))-1,Diagram_edges.push(createBorderEdge(site,v11,v10))-1,Diagram_edges.push(createBorderEdge(site,v10,v00))-1)}}for(iCell=0;iCell<nCells;++iCell)(cell=Diagram_cells[iCell])&&(cell.halfedges.length||delete Diagram_cells[iCell])}(x0,y0,x1,y1)}this.edges=Diagram_edges,this.cells=Diagram_cells,beaches=circles=Diagram_edges=Diagram_cells=null}Diagram.prototype={constructor:Diagram,polygons:function polygons(){var edges=this.edges;return this.cells.map(function(cell){var polygon=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges[i])});return polygon.data=cell.site.data,polygon})},triangles:function triangles(){var triangles=[],edges=this.edges;return this.cells.forEach(function(cell,i){if(m=(halfedges=cell.halfedges).length)for(var halfedges,m,s0,site=cell.site,j=-1,e1=edges[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;++j<m;)s0=s1,s1=(e1=edges[halfedges[j]]).left===site?e1.right:e1.left,s0&&s1&&i<s0.index&&i<s1.index&&triangleArea(site,s0,s1)<0&&triangles.push([site.data,s0.data,s1.data])}),triangles},links:function links(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function find(x,y,radius){for(var i0,cell,that=this,i1=that._found||0,n=that.cells.length;!(cell=that.cells[i1]);)if(++i1>=n)return null;var dx=x-cell.site[0],dy=y-cell.site[1],d2=dx*dx+dy*dy;do{cell=that.cells[i0=i1],i1=null,cell.halfedges.forEach(function(e){var edge=that.edges[e],v=edge.left;if(v!==cell.site&&v||(v=edge.right)){var vx=x-v[0],vy=y-v[1],v2=vx*vx+vy*vy;v2<d2&&(d2=v2,i1=v.index)}})}while(null!==i1);return that._found=i0,null==radius||d2<=radius*radius?cell.site:null}};var src_voronoi=function(){var x=src_point_x,y=src_point_y,extent=null;function voronoi(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x(d,i,data)/Diagram_epsilon)*Diagram_epsilon,Math.round(y(d,i,data)/Diagram_epsilon)*Diagram_epsilon];return s.index=i,s.data=d,s}),extent)}return voronoi.polygons=function(data){return voronoi(data).polygons()},voronoi.links=function(data){return voronoi(data).links()},voronoi.triangles=function(data){return voronoi(data).triangles()},voronoi.x=function(_){return arguments.length?(x="function"==typeof _?_:d3_voronoi_src_constant(+_),voronoi):x},voronoi.y=function(_){return arguments.length?(y="function"==typeof _?_:d3_voronoi_src_constant(+_),voronoi):y},voronoi.extent=function(_){return arguments.length?(extent=null==_?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]},voronoi.size=function(_){return arguments.length?(extent=null==_?null:[[0,0],[+_[0],+_[1]]],voronoi):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]},voronoi},hyperdis=__webpack_require__(2),hyperdis_default=__webpack_require__.n(hyperdis);function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var DataSystem_selection=function(){function Selection(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Selection),this._data=[],this._idMap={},this._dataMap={},this._mode="",this._enterdata=[],this._exitdata=[]}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Selection,[{key:"getObjects",value:function getObjects(){return Object.values(this._idMap)}},{key:"data",value:function data(newData,idGetter){var _this=this;if(idGetter){this._data=[],this._idGetter=idGetter;var tempMap={};newData.forEach(function(){var index=idGetter.apply(void 0,arguments);tempMap[index]=arguments.length<=0?void 0:arguments[0]});var purgedIds=[];return Object.keys(this._idMap).forEach(function(id){tempMap[id]||purgedIds.push(id)}),Object.keys(tempMap).forEach(function(id){_this._idMap[id]?(_this._idMap[id]=tempMap[id],_this._data.push(tempMap[id])):_this._enterdata.push(tempMap[id])}),purgedIds.forEach(function(id){var purged=_this._idMap[id];_this._exitdata.push(purged),delete _this._idMap[id]}),this}if(newData.length>this._data.length)for(var i=this._data.length;i<newData.length;i+=1)this._enterdata.push(newData[i]);else{for(var temp=newData.length,_i=temp;_i<this._data.length;_i+=1){var purged=this._data[_i];delete this._idMap[purged.id],this._exitdata.push(purged)}this._data=this._data.slice(temp,this._data.length)}return this}},{key:"append",value:function append(callback){var _this2=this;return this["_".concat(this._mode,"data")].forEach(function(){var data=arguments.length<=0?void 0:arguments[0],id=_this2._idGetter?_this2._idGetter.apply(_this2,arguments):data.id||(arguments.length<=1?void 0:arguments[1]);_this2._idMap[id]=callback.apply(void 0,arguments),_this2._dataMap[id]=data}),this._mode="",this}},{key:"enter",value:function enter(){return this._mode="enter",this}},{key:"attr",value:function attr(key,value){return this._data.forEach(function(item){return item.attr(key,value)}),this}},{key:"merge",value:function merge(selection){var _this3=this;return selection._data.forEach(function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];var id=_this3._idGetter?_this3._idGetter.apply(_this3,params):params[0].id||params[1];_this3._idMap[id]=params[0],_this3._data.push(params[0])}),this._enterdata=[],this}},{key:"exit",value:function exit(){return this._mode="exit",this}},{key:"each",value:function each(fn){var _this4=this;return Object.keys(this._idMap).forEach(function(e,i){fn(_this4._idMap[e],_this4._dataMap[e],i)}),this}},{key:"map",value:function map(fn){var _this5=this;return Object.keys(this._idMap).forEach(function(){for(var _len2=arguments.length,params=new Array(_len2),_key2=0;_key2<_len2;_key2++)params[_key2]=arguments[_key2];var key=params[0];_this5._idMap[key]=fn.apply(void 0,[_this5._idMap[key]].concat(params,[_this5._dataMap[key]]))}),this}},{key:"remove",value:function remove(){this["_".concat(this._mode,"data")].forEach(function(item){return item.remove()}),""===this._mode&&this.each(function(e){return e.remove()}),this["_".concat(this._mode,"data")]=[],this._mode=""}}]),Selection}();var _stackOrders,_stackOffsets;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function common_utils_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function common_utils_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function common_utils_createClass(Constructor,protoProps,staticProps){return protoProps&&common_utils_defineProperties(Constructor.prototype,protoProps),staticProps&&common_utils_defineProperties(Constructor,staticProps),Constructor}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function common_utils_typeof(obj){return(common_utils_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}window.HTMLElement;var isSimpleObject=function isSimpleObject(obj){if("object"===common_utils_typeof(obj)){if(null===obj)return!1;if("[object Object]"===Object.prototype.toString.call(obj))return"Object"===(obj.constructor.toString().match(/^function (.*)\(\)/m)||[])[1]}return!1},getUniqueId=function getUniqueId(){return"id-".concat((new Date).getTime()).concat(Math.round(1e4*Math.random()))},clone=function clone(o){var v,output={};for(var key in o)({}).hasOwnProperty.call(o,key)&&(v=o[key],output[key]=isSimpleObject(v)?clone(v):v);return output},sanitizeIP_typeObj=function typeObj(keys,obj){if("object"!==common_utils_typeof(obj))return Error("Argument type object expected");var nonExistentKeys=function checkExistence(keys,obj){var nonExistentKeys=[];return keys.forEach(function(key){key in obj||nonExistentKeys.push(key)}),nonExistentKeys}(keys,obj);return nonExistentKeys.length?Error("Missing keys from parameter ".concat(nonExistentKeys.join(", "))):obj},getMax=function getMax(data,field){return Math.max.apply(Math,_toConsumableArray(data.filter(function(d){return!isNaN(d[field])}).map(function(d){return d[field]})))},getMin=function getMin(data,field){return Math.min.apply(Math,_toConsumableArray(data.filter(function(d){return!isNaN(d[field])}).map(function(d){return d[field]})))},common_utils_getDomainFromData=function getDomainFromData(data,fields,fieldType){var _ref,domain,domArr;switch(data=data[0]instanceof Array?data:[data],fieldType){case dist_datamodel.DimensionSubtype.CATEGORICAL:domain=(_ref=[]).concat.apply(_ref,_toConsumableArray(data.map(function(arr){return arr.map(function(d){return d[fields[0]]}).filter(function(d){return void 0!==d})})));break;default:domArr=data.map(function(arr){var firstMin=getMin(arr,fields[0]),secondMin=getMin(arr,fields[1]),firstMax=getMax(arr,fields[0]),secondMax=getMax(arr,fields[1]);return[Math.min(firstMin,secondMin),Math.max(firstMax,secondMax)]}),domain=[Math.min.apply(Math,_toConsumableArray(domArr.map(function(d){return d[0]}))),Math.max.apply(Math,_toConsumableArray(domArr.map(function(d){return d[1]})))]}return domain},common_utils_unionDomain=function unionDomain(domains,fieldType){var domain,_ref2;(domains=domains.filter(function(dom){return dom&&dom.length}),fieldType===dist_datamodel.DimensionSubtype.CATEGORICAL)?domain=domain=(_ref2=[]).concat.apply(_ref2,_toConsumableArray(domains)):domain=[Math.min.apply(Math,_toConsumableArray(domains.map(function(d){return d[0]}))),Math.max.apply(Math,_toConsumableArray(domains.map(function(d){return d[1]})))];return domain},symbolFns={circle:symbol_circle,cross:symbol_cross,diamond:diamond,square:square,star:star,wye:wye,triangle:triangle},easeFns={cubic:cubicInOut,bounce:bounceOut,linear:function src_linear_linear(t){return+t},elastic:elasticOut,back:backInOut,poly:polyInOut,circle:function circleInOut(t){return((t*=2)<=1?1-Math.sqrt(1-t*t):Math.sqrt(1-(t-=2)*t)+1)/2}},common_utils_getClosestIndexOf=function getClosestIndexOf(arr,value,side){for(var mid,d1,low=0,high=arr.length-1;low<high;)mid=Math.floor((low+high)/2),d1=Math.abs(arr[mid]-value),Math.abs(arr[mid+1]-value)<=d1?low=mid+1:high=mid;if(!side)return high;var highVal=arr[high];return highVal===value?high:highVal>value?0===high?high:"left"===side?high-1:high:high===arr.length-1?high:"left"===side?high:high+1},getWindow=function getWindow(){return window},getQualifiedClassName=(requestAnimationFrame,cancelAnimationFrame,function getQualifiedClassName(cls,id,prefix){return cls=cls.replace(/^\.*/,""),["".concat(prefix,"-").concat(cls),"".concat(prefix,"-").concat(cls,"-").concat(id)]}),defaultValue=function defaultValue(param,value){return void 0===param||"object"===common_utils_typeof(param)&&!param?value:param},getDependencyOrder=function getDependencyOrder(graph){for(var dependencyOrder=[],visited={},keys=Object.keys(graph),visit=function visit(name){if(dependencyOrder.length===keys.length)return!0;visited[name]=!0;for(var edges=graph[name],e=0;e<edges.length;e++){var dep=edges[e];visited[dep]||visit(dep)}return dependencyOrder.push(name),!1},i=0;i<keys.length&&!visit(keys[i]);i++);return dependencyOrder},objectIterator=function objectIterator(obj,fn){for(var key in obj)Object.hasOwnProperty.call(obj,key)&&fn(key,obj)},common_utils_Voronoi=function(){function Voronoi(data){common_utils_classCallCheck(this,Voronoi),this._voronoi=src_voronoi().x(function(d){return d.x}).y(function(d){return d.y}),this.data(data)}return common_utils_createClass(Voronoi,[{key:"data",value:function data(_data){return _data&&(this._voronoiFn=this._voronoi(_data)),this}},{key:"find",value:function find(x,y,radius){return this._voronoiFn.find(x,y,radius)}}]),Voronoi}(),addListenerToNamespace=function addListenerToNamespace(namespaceInf,fn,context){var key=namespaceInf.key,namespace=namespaceInf.namespace;namespace?(!context._listeners[namespace]&&(context._listeners[namespace]=[]),key||(key=Object.keys(context._listeners[namespace]).length),context._listeners[namespace][key]=fn):(key=Object.keys(context._listeners).length,context._listeners[key]=fn)},getObjProp=function getObjProp(obj){if(void 0===obj||null===obj)return obj;for(var retObj=obj,_len=arguments.length,fields=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)fields[_key-1]=arguments[_key];for(var i=0,len=fields.length;i<len&&(void 0!==(retObj=retObj[fields[i]])&&null!==retObj);i++);return retObj},common_utils_Store=function(){function Store(config){common_utils_classCallCheck(this,Store),this.model=hyperdis_default.a.create(config),this._listeners={}}return common_utils_createClass(Store,[{key:"serialize",value:function serialize(){return this.model.serialize()}},{key:"commit",value:function commit(propName,value){this.model.prop(propName,value)}},{key:"registerChangeListener",value:function registerChangeListener(propNames,callBack,instantCall){var namespaceInf=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},props=propNames;Array.isArray(propNames)||(props=[propNames]);var fn=this.model.next(props,callBack,instantCall);return addListenerToNamespace(namespaceInf,fn,this),this}},{key:"registerImmediateListener",value:function registerImmediateListener(propNames,callBack,instantCall){var namespaceInf=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},props=propNames;Array.isArray(propNames)||(props=[propNames]);var fn=this.model.on(props,callBack,instantCall);return addListenerToNamespace(namespaceInf,fn,this),this}},{key:"get",value:function get(propName){return this.model.prop(propName)}},{key:"computed",value:function computed(propName,callBack){return this.model.calculatedProp(propName,callBack)}},{key:"append",value:function append(propName,value){return this.model.append(propName,value),this}},{key:"unsubscribeAll",value:function unsubscribeAll(){return Object.values(this._listeners).forEach(function(fn){return fn()}),this}},{key:"unsubscribe",value:function unsubscribe(){var namespaceInf=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},namespace=namespaceInf.namespace,key=namespaceInf.key,listeners=this._listeners[namespace];if(key){var fn=getObjProp(listeners,key);fn&&fn()}else Object.values(listeners).forEach(function(fn){return fn()}),this._listeners[namespace]=[];return this}}]),Store}(),intSanitizer=function intSanitizer(val){var arr=val.toString().match(/(\d+)(px)*/g);return arr?parseInt(arr[0],10):null},common_utils_transactor=function transactor(holder,options,model){var conf,namespaceInf=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},store=model&&model instanceof hyperdis_default.a?model:hyperdis_default.a.create({}),stateProps={};for(var prop in options)if({}.hasOwnProperty.call(options,prop)){var addAsMethod=!(conf=options[prop]).meta||conf.meta.addAsMethod,nameSpaceProp=void 0,namespace=namespaceInf.namespace;nameSpaceProp=namespace?"".concat(namespace,".").concat(prop):prop,store.prop("".concat(nameSpaceProp))||(stateProps[prop]=conf.value),!1!==addAsMethod&&(holder[prop]=function(context,meta,nsProp){return function(){for(var val,compareTo,_len2=arguments.length,params=new Array(_len2),_key2=0;_key2<_len2;_key2++)params[_key2]=arguments[_key2];var paramsLen=params.length,prevVal=store.prop(nsProp);if(paramsLen){var spreadParams=meta&&meta.spreadParams;val=params;var values=[];if(meta){for(var i=0;i<paramsLen;i++){val=params[i];var sanitization=meta.sanitization&&(spreadParams?meta.sanitization[i]:meta.sanitization),typeCheck=meta.typeCheck&&(spreadParams?meta.typeCheck[i]:meta.typeCheck);if(sanitization&&"function"==typeof sanitization&&(val=sanitization(val,prevVal,holder)),typeCheck)if("function"==typeof typeCheck){var typeExpected=meta.typeExpected;typeExpected&&spreadParams&&(typeExpected=typeExpected[i]),compareTo=typeExpected||!0,typeCheck(val)===compareTo&&values.push(val)}else if("string"==typeof typeCheck){if("constructor"===typeCheck){var _typeExpected=spreadParams?meta.typeExpected[i]:meta.typeExpected;val&&val.constructor.name===_typeExpected&&values.push(val)}}else values.push(val);else values.push(val)}var preset=meta.preset,oldValues=context.prop(nsProp);preset&&preset(values[0],holder),spreadParams&&oldValues.forEach(function(value,i){void 0===values[i]&&(values[i]=value)}),values.length&&context.prop(nsProp,spreadParams?values:values[0])}else context.prop(nsProp,spreadParams?val:val[0]);return holder}return context.prop(nsProp)}}(store,conf.meta,nameSpaceProp))}if(void 0===namespaceInf.namespace)store.append(stateProps);else{var _namespace=namespaceInf.namespace;store.append(_namespace,stateProps)}return[holder,store]},generateGetterSetters=function generateGetterSetters(context,props){Object.entries(props).forEach(function(propInfo){var prop=propInfo[0],typeChecker=propInfo[1].typeChecker,defVal=propInfo[1].defaultValue,sanitization=propInfo[1].sanitization,prototype=context.constructor.prototype;Object.hasOwnProperty.call(prototype,prop)||(defVal&&(context["_".concat(prop)]=defVal),context[prop]=function(){if(arguments.length){var value=arguments.length<=0?void 0:arguments[0];return sanitization&&(value=sanitization(context,arguments.length<=0?void 0:arguments[0])),typeChecker&&!typeChecker(value)?context["_".concat(prop)]:(context["_".concat(prop)]=value,context)}return context["_".concat(prop)]})})},common_utils_isEqual=function isEqual(type){return function(oldVal,newVal){return"Array"===type?!!oldVal&&function arraysEqual(arr1,arr2){if(arr1.length!==arr2.length)return!1;for(var i=arr1.length;i>=0;i--)if(arr1[i]!==arr2[i])return!1;return!0}(oldVal,newVal):"Object"===type?Object.is(oldVal,newVal):oldVal===newVal}},ERROR_MSG={INTERFACE_IMPL:"Method not implemented"},mergeRecursive=function mergeRecursive(source,sink){for(var prop in sink)isSimpleObject(source[prop])&&isSimpleObject(sink[prop])?mergeRecursive(source[prop],sink[prop]):sink[prop]instanceof Object&&sink[prop].constructor===Object?(source[prop]={},mergeRecursive(source[prop],sink[prop])):source[prop]=sink[prop];return source},common_utils_createSelection=function createSelection(sel,appendObj,data,idFn){var selection=sel||function dataSelect(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new DataSystem_selection(data)}([]),mergedSelection=(selection=selection.data(data,idFn)).enter().append(appendObj).merge(selection);return selection.exit()&&selection.exit().remove(),mergedSelection},common_utils_interpolator=function interpolator(){return src_value},common_utils_numberInterpolator=function numberInterpolator(){return src_number},common_utils_piecewiseInterpolator=function piecewiseInterpolator(){return piecewise_piecewise};var rgbToHsv=function rgbToHsv(r,g,b){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r=+r,g=+g,b=+b,a=+a,r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return[h,s,l,a]},detectColor=function detectColor(col){return/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/.test(col)||/rgba?\(((25[0-5]|2[0-4]\d|1\d{1,2}|\d\d?)\s*,\s*?){2}(25[0-5]|2[0-4]\d|1\d{1,2}|\d\d?)\s*,?\s*([01]\.?\d*?)?\)/.test(col)?"rgb":/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(col)||/^hsla\((0|360|35\d|3[0-4]\d|[12]\d\d|0?\d?\d),(0|100|\d{1,2})%,(0|100|\d{1,2})%,(0?\.\d|1(\.0)?)\)$/.test(col)?"hsl":/^#([0-9a-f]{3}){1,2}$/i.test(col)?"hex":col},getDataModelFromRange=function getDataModelFromRange(dataModel,criteria,mode){if(null===criteria)return null;var selFields=Object.keys(criteria);return dataModel.select(function selFn(fields){return selFields.every(function(field){var val=fields[field].value,range=criteria[field][0]instanceof Array?criteria[field][0]:criteria[field];return"string"==typeof range[0]?void 0!==range.find(function(d){return d===val}):!range||val>=range[0]&&val<=range[1]})},{saveChild:!1,mode:mode})},common_utils_getDataModelFromIdentifiers=function getDataModelFromIdentifiers(dataModel,identifiers,mode){var filteredDataModel;if(identifiers instanceof Array){var fieldsConfig=dataModel.getFieldsConfig(),dataArr=identifiers.slice(1,identifiers.length);if(identifiers instanceof Function)filteredDataModel=identifiers(dataModel,{},!1);else if(identifiers instanceof Array&&identifiers[0].length){var filteredSchema=identifiers[0].filter(function(d){return d in fieldsConfig});filteredDataModel=dataModel.select(function(fields){var include=!0;return filteredSchema.forEach(function(propField,idx){var value=fields[propField].valueOf(),index=dataArr.findIndex(function(d){return d[idx]===value});include=include&&-1!==index}),include},{saveChild:!1,mode:mode})}}else filteredDataModel=getDataModelFromRange(dataModel,identifiers,mode);return filteredDataModel},common_utils_registerListeners=function registerListeners(context,listenerMap){for(var _len3=arguments.length,params=new Array(_len3>2?_len3-2:0),_key3=2;_key3<_len3;_key3++)params[_key3-2]=arguments[_key3];var propListenerMap=listenerMap.apply(void 0,[context].concat(params));for(var key in propListenerMap)if({}.hasOwnProperty.call(propListenerMap,key)){var namespace=params[0],ns=null;namespace&&(ns=namespace.local);var mapObj=propListenerMap[key],propType=mapObj.type,props=mapObj.props,listenerFn=mapObj.listener;context.store()[propType](props,listenerFn,!1,{namespace:ns})}},isValidValue=function isValidValue(value){return!isNaN(value)&&value!==-1/0&&value!==1/0},toArray=function toArray(arr){return arr instanceof Array?arr:[arr]},common_utils_getSymbol=function getSymbol(type){return function(){var type=d3_shape_src_constant(symbol_circle),size=d3_shape_src_constant(64),context=null;function symbol(){var buffer;if(context||(context=buffer=src_path()),type.apply(this,arguments).draw(context,+size.apply(this,arguments)),buffer)return context=null,buffer+""||null}return symbol.type=function(_){return arguments.length?(type="function"==typeof _?_:d3_shape_src_constant(_),symbol):type},symbol.size=function(_){return arguments.length?(size="function"==typeof _?_:d3_shape_src_constant(+_),symbol):size},symbol.context=function(_){return arguments.length?(context=null==_?null:_,symbol):context},symbol}().type(symbolFns[type])},stackOrders=(_defineProperty(_stackOrders={},"none",order_none),_defineProperty(_stackOrders,"ascending",order_ascending),_defineProperty(_stackOrders,"descending",function(series){return order_ascending(series).reverse()}),_stackOrders),stackOffsets=(_defineProperty(_stackOffsets={},"diverging",function(series,order){if((n=series.length)>1)for(var i,d,dy,yp,yn,n,j=0,m=series[order[0]].length;j<m;++j)for(yp=yn=0,i=0;i<n;++i)(dy=(d=series[order[i]][j])[1]-d[0])>=0?(d[0]=yp,d[1]=yp+=dy):dy<0?(d[1]=yn,d[0]=yn+=dy):d[0]=yp}),_defineProperty(_stackOffsets,"none",none),_defineProperty(_stackOffsets,"expand",function(series,order){if((n=series.length)>0){for(var i,n,y,j=0,m=series[0].length;j<m;++j){for(y=i=0;i<n;++i)y+=series[i][j][1]||0;if(y)for(i=0;i<n;++i)series[i][j][1]/=y}none(series,order)}}),_defineProperty(_stackOffsets,"wiggle",function(series,order){if((n=series.length)>0&&(m=(s0=series[order[0]]).length)>0){for(var s0,m,n,y=0,j=1;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){for(var si=series[order[i]],sij0=si[j][1]||0,s3=(sij0-(si[j-1][1]||0))/2,k=0;k<i;++k){var sk=series[order[k]];s3+=(sk[j][1]||0)-(sk[j-1][1]||0)}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y,s1&&(y-=s2/s1)}s0[j-1][1]+=s0[j-1][0]=y,none(series,order)}}),_stackOffsets),common_utils_stack=function stack(params){return function(){var keys=d3_shape_src_constant([]),order=order_none,offset=none,value=stackValue;function stack(data){var i,oz,kz=keys.apply(this,arguments),m=data.length,n=kz.length,sz=new Array(n);for(i=0;i<n;++i){for(var sij,ki=kz[i],si=sz[i]=new Array(m),j=0;j<m;++j)si[j]=sij=[0,+value(data[j],ki,j,data)],sij.data=data[j];si.key=ki}for(i=0,oz=order(sz);i<n;++i)sz[oz[i]].index=i;return offset(sz,oz),sz}return stack.keys=function(_){return arguments.length?(keys="function"==typeof _?_:d3_shape_src_constant(d3_shape_src_array_slice.call(_)),stack):keys},stack.value=function(_){return arguments.length?(value="function"==typeof _?_:d3_shape_src_constant(+_),stack):value},stack.order=function(_){return arguments.length?(order=null==_?order_none:"function"==typeof _?_:d3_shape_src_constant(d3_shape_src_array_slice.call(_)),stack):order},stack.offset=function(_){return arguments.length?(offset=null==_?none:_,stack):offset},stack}().keys(params.keys).offset(stackOffsets[params.offset]).order(stackOrders[params.order])(params.data)},pathInterpolators={curveLinear:curve_linear,curveStepAfter:stepAfter,curveStepBefore:stepBefore,curveStep:curve_step,curveCatmullRom:curve_catmullRom,stepAfter:stepAfter,catmullRom:curve_catmullRom,step:curve_step,stepBefore:stepBefore,linear:curve_linear},Symbols={axisLeft:function axisLeft(scale){return axis_axis(axis_left,scale)},axisRight:function axisRight(scale){return axis_axis(axis_right,scale)},axisTop:function axisTop(scale){return axis_axis(axis_top,scale)},axisBottom:function axisBottom(scale){return axis_axis(axis_bottom,scale)},line:src_line,area:src_area,pie:function(){var value=d3_shape_src_identity,sortValues=src_descending,sort=null,startAngle=d3_shape_src_constant(0),endAngle=d3_shape_src_constant(math_tau),padAngle=d3_shape_src_constant(0);function pie(data){var i,j,k,a1,v,n=data.length,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(math_tau,Math.max(-math_tau,endAngle.apply(this,arguments)-a0)),p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1);for(i=0;i<n;++i)(v=arcs[index[i]=i]=+value(data[i],i,data))>0&&(sum+=v);for(null!=sortValues?index.sort(function(i,j){return sortValues(arcs[i],arcs[j])}):null!=sort&&index.sort(function(i,j){return sort(data[i],data[j])}),i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1)j=index[i],a1=a0+((v=arcs[j])>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p};return arcs}return pie.value=function(_){return arguments.length?(value="function"==typeof _?_:d3_shape_src_constant(+_),pie):value},pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues},pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:d3_shape_src_constant(+_),pie):padAngle},pie},arc:function(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=d3_shape_src_constant(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(context||(context=buffer=src_path()),r1<r0&&(r=r1,r1=r0,r0=r),r1>math_epsilon)if(da>math_tau-math_epsilon)context.moveTo(r1*cos(a0),r1*sin(a0)),context.arc(0,0,r1,a0,a1,!cw),r0>math_epsilon&&(context.moveTo(r0*cos(a1),r0*sin(a1)),context.arc(0,0,r0,a1,a0,cw));else{var t0,t1,a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>math_epsilon&&(padRadius?+padRadius.apply(this,arguments):math_sqrt(r0*r0+r1*r1)),rc=math_min(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc;if(rp>math_epsilon){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));(da0-=2*p0)>math_epsilon?(a00+=p0*=cw?1:-1,a10-=p0):(da0=0,a00=a10=(a0+a1)/2),(da1-=2*p1)>math_epsilon?(a01+=p1*=cw?1:-1,a11-=p1):(da1=0,a01=a11=(a0+a1)/2)}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>math_epsilon){var x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00);if(da<math_pi){var oc=da0>math_epsilon?function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=(x32*(y0-y2)-y32*(x0-x2))/(y32*x10-x32*y10);return[x0+t*x10,y0+t*y10]}(x01,y01,x00,y00,x11,y11,x10,y10):[x10,y10],ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(function acos(x){return x>1?0:x<-1?math_pi:Math.acos(x)}((ax*bx+ay*by)/(math_sqrt(ax*ax+ay*ay)*math_sqrt(bx*bx+by*by)))/2),lc=math_sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=math_min(rc,(r0-lc)/(kc-1)),rc1=math_min(rc,(r1-lc)/(kc+1))}}da1>math_epsilon?rc1>math_epsilon?(t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw),t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw),context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01),rc1<rc?context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw),context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):(context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw)):context.moveTo(x01,y01),r0>math_epsilon&&da0>math_epsilon?rc0>math_epsilon?(t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw),t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw),context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01),rc0<rc?context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw):(context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw),context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw),context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw))):context.arc(0,0,r0,a10,a00,cw):context.lineTo(x10,y10)}else context.moveTo(0,0);if(context.closePath(),buffer)return context=null,buffer+""||null}return arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-math_pi/2;return[cos(a)*r,sin(a)*r]},arc.innerRadius=function(_){return arguments.length?(innerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):innerRadius},arc.outerRadius=function(_){return arguments.length?(outerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):outerRadius},arc.cornerRadius=function(_){return arguments.length?(cornerRadius="function"==typeof _?_:d3_shape_src_constant(+_),arc):cornerRadius},arc.padRadius=function(_){return arguments.length?(padRadius=null==_?null:"function"==typeof _?_:d3_shape_src_constant(+_),arc):padRadius},arc.startAngle=function(_){return arguments.length?(startAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):startAngle},arc.endAngle=function(_){return arguments.length?(endAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):endAngle},arc.padAngle=function(_){return arguments.length?(padAngle="function"==typeof _?_:d3_shape_src_constant(+_),arc):padAngle},arc.context=function(_){return arguments.length?(context=null==_?null:_,arc):context},arc},nest:src_nest},Scales={band:band},getSmallestDiff=function getSmallestDiff(points){for(var minDiff=(points=points.sort(function(a,b){return a-b}))[1]-points[0],i=2;i<points.length;i++)minDiff=Math.min(minDiff,points[i]-points[i-1]);return minDiff},timeFormats={millisecond:"%A, %b %e, %H:%M:%S.%L",second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",month:"%B %Y",year:"%Y"},timeDurations=[["millisecond","second","minute","hour","day","month","year"],[1,1e3,6e4,36e5,864e5,2592e6,31536e6]],common_utils_formatTemporal=function formatTemporal(value,interval){var nearestInterval=function getNearestInterval(interval){var index=common_utils_getClosestIndexOf(timeDurations[1],interval);return timeDurations[0][index]}(interval);return dist_datamodel.DateTimeFormatter.formatAs(value,timeFormats[nearestInterval])},common_utils_retrieveNearestGroupByReducers=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,function retrieveNearestGroupByReducers(dataModel){var nearestReducers={},next=dataModel;do{var derivations=next.getDerivations();if(derivations){var groupDerivation=derivations.reverse().find(function(derivation){return"group"===derivation.op});if(groupDerivation){nearestReducers=groupDerivation.criteria||{};break}}}while(next=next.getParent());for(var filteredReducers={},measures=dataModel.getFieldspace().getMeasure(),_len4=arguments.length,measureFieldNames=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)measureFieldNames[_key4-1]=arguments[_key4];return measureFieldNames.forEach(function(measureName){if(nearestReducers[measureName])filteredReducers[measureName]=nearestReducers[measureName];else{var measureField=measures[measureName];measureField&&(filteredReducers[measureName]=measureField.defAggFn())}}),filteredReducers}),xhtml="http://www.w3.org/1999/xhtml",src_namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},src_namespace=function(name){var prefix=name+="",i=prefix.indexOf(":");return i>=0&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),src_namespaces.hasOwnProperty(prefix)?{space:src_namespaces[prefix],local:name}:name};var creator=function(name){var fullname=src_namespace(name);return(fullname.local?function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}:function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}})(fullname)};function selector_none(){}var src_selector=function(selector){return null==selector?selector_none:function(){return this.querySelector(selector)}};function selectorAll_empty(){return[]}var selectorAll=function(selector){return null==selector?selectorAll_empty:function(){return this.querySelectorAll(selector)}},matcher=function matcher(selector){return function(){return this.matches(selector)}};if("undefined"!=typeof document){var matcher_element=document.documentElement;if(!matcher_element.matches){var vendorMatches=matcher_element.webkitMatchesSelector||matcher_element.msMatchesSelector||matcher_element.mozMatchesSelector||matcher_element.oMatchesSelector;matcher=function matcher(selector){return function(){return vendorMatches.call(this,selector)}}}}var src_matcher=matcher,sparse=function(update){return new Array(update.length)};function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument,this.namespaceURI=parent.namespaceURI,this._next=null,this._parent=parent,this.__data__=datum}EnterNode.prototype={constructor:EnterNode,appendChild:function appendChild(child){return this._parent.insertBefore(child,this._next)},insertBefore:function insertBefore(child,next){return this._parent.insertBefore(child,next)},querySelector:function querySelector(selector){return this._parent.querySelector(selector)},querySelectorAll:function querySelectorAll(selector){return this._parent.querySelectorAll(selector)}};var keyPrefix="$";function bindIndex(parent,group,enter,update,exit,data){for(var node,i=0,groupLength=group.length,dataLength=data.length;i<dataLength;++i)(node=group[i])?(node.__data__=data[i],update[i]=node):enter[i]=new EnterNode(parent,data[i]);for(;i<groupLength;++i)(node=group[i])&&(exit[i]=node)}function bindKey(parent,group,enter,update,exit,data,key){var i,node,keyValue,nodeByKeyValue={},groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength);for(i=0;i<groupLength;++i)(node=group[i])&&(keyValues[i]=keyValue=keyPrefix+key.call(node,node.__data__,i,group),keyValue in nodeByKeyValue?exit[i]=node:nodeByKeyValue[keyValue]=node);for(i=0;i<dataLength;++i)(node=nodeByKeyValue[keyValue=keyPrefix+key.call(parent,data[i],i,data)])?(update[i]=node,node.__data__=data[i],nodeByKeyValue[keyValue]=null):enter[i]=new EnterNode(parent,data[i]);for(i=0;i<groupLength;++i)(node=group[i])&&nodeByKeyValue[keyValues[i]]===node&&(exit[i]=node)}function sort_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}var src_window=function(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView};function styleValue(node,name){return node.style.getPropertyValue(name)||src_window(node).getComputedStyle(node,null).getPropertyValue(name)}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node,this._names=classArray(node.getAttribute("class")||"")}function classedAdd(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.add(names[i])}function classedRemove(node,names){for(var list=classList(node),i=-1,n=names.length;++i<n;)list.remove(names[i])}ClassList.prototype={add:function add(name){this._names.indexOf(name)<0&&(this._names.push(name),this._node.setAttribute("class",this._names.join(" ")))},remove:function remove(name){var i=this._names.indexOf(name);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function contains(name){return this._names.indexOf(name)>=0}};function textRemove(){this.textContent=""}function htmlRemove(){this.innerHTML=""}function raise_raise(){this.nextSibling&&this.parentNode.appendChild(this)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function constantNull(){return null}function remove_remove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function selection_cloneShallow(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function selection_cloneDeep(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var filterEvents={},on_event=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"}));function filterContextListener(listener,index,group){return listener=contextListener(listener,index,group),function(event){var related=event.relatedTarget;related&&(related===this||8&related.compareDocumentPosition(this))||listener.call(this,event)}}function contextListener(listener,index,group){return function(event1){var event0=on_event;on_event=event1;try{listener.call(this,this.__data__,index,group)}finally{on_event=event0}}}function onRemove(typename){return function(){var on=this.__on;if(on){for(var o,j=0,i=-1,m=on.length;j<m;++j)o=on[j],typename.type&&o.type!==typename.type||o.name!==typename.name?on[++i]=o:this.removeEventListener(o.type,o.listener,o.capture);++i?on.length=i:delete this.__on}}}function onAdd(typename,value,capture){var wrap=filterEvents.hasOwnProperty(typename.type)?filterContextListener:contextListener;return function(d,i,group){var o,on=this.__on,listener=wrap(value,i,group);if(on)for(var j=0,m=on.length;j<m;++j)if((o=on[j]).type===typename.type&&o.name===typename.name)return this.removeEventListener(o.type,o.listener,o.capture),this.addEventListener(o.type,o.listener=listener,o.capture=capture),void(o.value=value);this.addEventListener(typename.type,listener,capture),o={type:typename.type,name:typename.name,value:value,listener:listener,capture:capture},on?on.push(o):this.__on=[o]}}function customEvent(event1,listener,that,args){var event0=on_event;event1.sourceEvent=on_event,on_event=event1;try{return listener.apply(that,args)}finally{on_event=event0}}function dispatchEvent(node,type,params){var window=src_window(node),event=window.CustomEvent;"function"==typeof event?event=new event(type,params):(event=window.document.createEvent("Event"),params?(event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail):event.initEvent(type,!1,!1)),node.dispatchEvent(event)}var selection_root=[null];function selection_Selection(groups,parents){this._groups=groups,this._parents=parents}function selection_selection(){return new selection_Selection([[document.documentElement]],selection_root)}selection_Selection.prototype=selection_selection.prototype={constructor:selection_Selection,select:function(select){"function"!=typeof select&&(select=src_selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode);return new selection_Selection(subgroups,this._parents)},selectAll:function(select){"function"!=typeof select&&(select=selectorAll(select));for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&(subgroups.push(select.call(node,node.__data__,i,group)),parents.push(node));return new selection_Selection(subgroups,parents)},filter:function(match){"function"!=typeof match&&(match=src_matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new selection_Selection(subgroups,this._parents)},data:function(value,key){if(!value)return data=new Array(this.size()),j=-1,this.each(function(d){data[++j]=d}),data;var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;"function"!=typeof value&&(value=function(x){return function(){return x}}(value));for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=value.call(parent,parent&&parent.__data__,j,parents),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength);bind(parent,group,enterGroup,updateGroup,exit[j]=new Array(groupLength),data,key);for(var previous,next,i0=0,i1=0;i0<dataLength;++i0)if(previous=enterGroup[i0]){for(i0>=i1&&(i1=i0+1);!(next=updateGroup[i1])&&++i1<dataLength;);previous._next=next||null}}return(update=new selection_Selection(update,parents))._enter=enter,update._exit=exit,update},enter:function(){return new selection_Selection(this._enter||this._groups.map(sparse),this._parents)},exit:function(){return new selection_Selection(this._exit||this._groups.map(sparse),this._parents)},merge:function(selection){for(var groups0=this._groups,groups1=selection._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new selection_Selection(merges,this._parents)},order:function(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;)for(var node,group=groups[j],i=group.length-1,next=group[i];--i>=0;)(node=group[i])&&(next&&next!==node.nextSibling&&next.parentNode.insertBefore(node,next),next=node);return this},sort:function(compare){function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}compare||(compare=sort_ascending);for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var node,group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(sortgroup[i]=node);sortgroup.sort(compareNode)}return new selection_Selection(sortgroups,this._parents).order()},call:function(){var callback=arguments[0];return arguments[0]=this,callback.apply(null,arguments),this},nodes:function(){var nodes=new Array(this.size()),i=-1;return this.each(function(){nodes[++i]=this}),nodes},node:function(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}return null},size:function(){var size=0;return this.each(function(){++size}),size},empty:function(){return!this.node()},each:function(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j)for(var node,group=groups[j],i=0,n=group.length;i<n;++i)(node=group[i])&&callback.call(node,node.__data__,i,group);return this},attr:function(name,value){var fullname=src_namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((null==value?fullname.local?function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}:function attrRemove(name){return function(){this.removeAttribute(name)}}:"function"==typeof value?fullname.local?function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttributeNS(fullname.space,fullname.local):this.setAttributeNS(fullname.space,fullname.local,v)}}:function attrFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?this.removeAttribute(name):this.setAttribute(name,v)}}:fullname.local?function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}:function attrConstant(name,value){return function(){this.setAttribute(name,value)}})(fullname,value))},style:function(name,value,priority){return arguments.length>1?this.each((null==value?function styleRemove(name){return function(){this.style.removeProperty(name)}}:"function"==typeof value?function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);null==v?this.style.removeProperty(name):this.style.setProperty(name,v,priority)}}:function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}})(name,value,null==priority?"":priority)):styleValue(this.node(),name)},property:function(name,value){return arguments.length>1?this.each((null==value?function propertyRemove(name){return function(){delete this[name]}}:"function"==typeof value?function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);null==v?delete this[name]:this[name]=v}}:function propertyConstant(name,value){return function(){this[name]=value}})(name,value)):this.node()[name]},classed:function(name,value){var names=classArray(name+"");if(arguments.length<2){for(var list=classList(this.node()),i=-1,n=names.length;++i<n;)if(!list.contains(names[i]))return!1;return!0}return this.each(("function"==typeof value?function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}:value?function classedTrue(names){return function(){classedAdd(this,names)}}:function classedFalse(names){return function(){classedRemove(this,names)}})(names,value))},text:function(value){return arguments.length?this.each(null==value?textRemove:("function"==typeof value?function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}}:function textConstant(value){return function(){this.textContent=value}})(value)):this.node().textContent},html:function(value){return arguments.length?this.each(null==value?htmlRemove:("function"==typeof value?function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}}:function htmlConstant(value){return function(){this.innerHTML=value}})(value)):this.node().innerHTML},raise:function(){return this.each(raise_raise)},lower:function(){return this.each(lower)},append:function(name){var create="function"==typeof name?name:creator(name);return this.select(function(){return this.appendChild(create.apply(this,arguments))})},insert:function(name,before){var create="function"==typeof name?name:creator(name),select=null==before?constantNull:"function"==typeof before?before:src_selector(before);return this.select(function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)})},remove:function(){return this.each(remove_remove)},clone:function(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)},datum:function(value){return arguments.length?this.property("__data__",value):this.node().__data__},on:function(typename,value,capture){var i,t,typenames=function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");return i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),{type:t,name:name}})}(typename+""),n=typenames.length;if(!(arguments.length<2)){for(on=value?onAdd:onRemove,null==capture&&(capture=!1),i=0;i<n;++i)this.each(on(typenames[i],value,capture));return this}var on=this.node().__on;if(on)for(var o,j=0,m=on.length;j<m;++j)for(i=0,o=on[j];i<n;++i)if((t=typenames[i]).type===o.type&&t.name===o.name)return o.value},dispatch:function(type,params){return this.each(("function"==typeof params?function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}:function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}})(type,params))}};var src_selection=selection_selection,src_select=function(selector){return"string"==typeof selector?new selection_Selection([[document.querySelector(selector)]],[document.documentElement]):new selection_Selection([[selector]],selection_root)},nextId=0;function Local(){this._="@"+(++nextId).toString(36)}Local.prototype=function local(){return new Local}.prototype={constructor:Local,get:function get(node){for(var id=this._;!(id in node);)if(!(node=node.parentNode))return;return node[id]},set:function set(node,value){return node[this._]=value},remove:function remove(node){return this._ in node&&delete node[this._]},toString:function toString(){return this._}};var sourceEvent=function(){for(var source,current=on_event;source=current.sourceEvent;)current=source;return current},src_point=function(node,event){var svg=node.ownerSVGElement||node;if(svg.createSVGPoint){var point=svg.createSVGPoint();return point.x=event.clientX,point.y=event.clientY,[(point=point.matrixTransform(node.getScreenCTM().inverse())).x,point.y]}var rect=node.getBoundingClientRect();return[event.clientX-rect.left-node.clientLeft,event.clientY-rect.top-node.clientTop]},mouse=function(node){var event=sourceEvent();return event.changedTouches&&(event=event.changedTouches[0]),src_point(node,event)},src_touch=function(node,touches,identifier){arguments.length<3&&(identifier=touches,touches=sourceEvent().changedTouches);for(var touch,i=0,n=touches?touches.length:0;i<n;++i)if((touch=touches[i]).identifier===identifier)return src_point(node,touch);return null},dispatch_noop={value:function value(){}};function dispatch_dispatch(){for(var t,i=0,n=arguments.length,_={};i<n;++i){if(!(t=arguments[i]+"")||t in _)throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function dispatch_get(type,name){for(var c,i=0,n=type.length;i<n;++i)if((c=type[i]).name===name)return c.value}function dispatch_set(type,name,callback){for(var i=0,n=type.length;i<n;++i)if(type[i].name===name){type[i]=dispatch_noop,type=type.slice(0,i).concat(type.slice(i+1));break}return null!=callback&&type.push({name:name,value:callback}),type}Dispatch.prototype=dispatch_dispatch.prototype={constructor:Dispatch,on:function on(typename,callback){var t,_=this._,T=function dispatch_parseTypenames(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0&&(name=t.slice(i+1),t=t.slice(0,i)),t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}(typename+"",_),i=-1,n=T.length;if(!(arguments.length<2)){if(null!=callback&&"function"!=typeof callback)throw new Error("invalid callback: "+callback);for(;++i<n;)if(t=(typename=T[i]).type)_[t]=dispatch_set(_[t],typename.name,callback);else if(null==callback)for(t in _)_[t]=dispatch_set(_[t],typename.name,null);return this}for(;++i<n;)if((t=(typename=T[i]).type)&&(t=dispatch_get(_[t],typename.name)))return t},copy:function copy(){var copy={},_=this._;for(var t in _)copy[t]=_[t].slice();return new Dispatch(copy)},call:function call(type,that){if((n=arguments.length-2)>0)for(var n,t,args=new Array(n),i=0;i<n;++i)args[i]=arguments[i+2];if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(i=0,n=(t=this._[type]).length;i<n;++i)t[i].value.apply(that,args)},apply:function apply(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i)t[i].value.apply(that,args)}};var src_dispatch=dispatch_dispatch;function nopropagation(){on_event.stopImmediatePropagation()}var noevent=function(){on_event.preventDefault(),on_event.stopImmediatePropagation()},nodrag=function(view){var root=view.document.documentElement,selection=src_select(view).on("dragstart.drag",noevent,!0);"onselectstart"in root?selection.on("selectstart.drag",noevent,!0):(root.__noselect=root.style.MozUserSelect,root.style.MozUserSelect="none")};var d3_drag_src_constant=function(x){return function(){return x}};function DragEvent(target,type,subject,id,active,x,y,dx,dy,dispatch){this.target=target,this.type=type,this.subject=subject,this.identifier=id,this.active=active,this.x=x,this.y=y,this.dx=dx,this.dy=dy,this._=dispatch}function defaultFilter(){return!on_event.button}function defaultContainer(){return this.parentNode}function defaultSubject(d){return null==d?{x:on_event.x,y:on_event.y}:d}function defaultTouchable(){return"ontouchstart"in this}DragEvent.prototype.on=function(){var value=this._.on.apply(this._,arguments);return value===this._?this:value};var src_drag=function(){var mousedownx,mousedowny,mousemoving,touchending,filter=defaultFilter,container=defaultContainer,subject=defaultSubject,touchable=defaultTouchable,gestures={},listeners=src_dispatch("start","drag","end"),active=0,clickDistance2=0;function drag(selection){selection.on("mousedown.drag",mousedowned).filter(touchable).on("touchstart.drag",touchstarted).on("touchmove.drag",touchmoved).on("touchend.drag touchcancel.drag",touchended).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function mousedowned(){if(!touchending&&filter.apply(this,arguments)){var gesture=beforestart("mouse",container.apply(this,arguments),mouse,this,arguments);gesture&&(src_select(on_event.view).on("mousemove.drag",mousemoved,!0).on("mouseup.drag",mouseupped,!0),nodrag(on_event.view),nopropagation(),mousemoving=!1,mousedownx=on_event.clientX,mousedowny=on_event.clientY,gesture("start"))}}function mousemoved(){if(noevent(),!mousemoving){var dx=on_event.clientX-mousedownx,dy=on_event.clientY-mousedowny;mousemoving=dx*dx+dy*dy>clickDistance2}gestures.mouse("drag")}function mouseupped(){src_select(on_event.view).on("mousemove.drag mouseup.drag",null),function yesdrag(view,noclick){var root=view.document.documentElement,selection=src_select(view).on("dragstart.drag",null);noclick&&(selection.on("click.drag",noevent,!0),setTimeout(function(){selection.on("click.drag",null)},0)),"onselectstart"in root?selection.on("selectstart.drag",null):(root.style.MozUserSelect=root.__noselect,delete root.__noselect)}(on_event.view,mousemoving),noevent(),gestures.mouse("end")}function touchstarted(){if(filter.apply(this,arguments)){var i,gesture,touches=on_event.changedTouches,c=container.apply(this,arguments),n=touches.length;for(i=0;i<n;++i)(gesture=beforestart(touches[i].identifier,c,src_touch,this,arguments))&&(nopropagation(),gesture("start"))}}function touchmoved(){var i,gesture,touches=on_event.changedTouches,n=touches.length;for(i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(noevent(),gesture("drag"))}function touchended(){var i,gesture,touches=on_event.changedTouches,n=touches.length;for(touchending&&clearTimeout(touchending),touchending=setTimeout(function(){touchending=null},500),i=0;i<n;++i)(gesture=gestures[touches[i].identifier])&&(nopropagation(),gesture("end"))}function beforestart(id,container,point,that,args){var s,dx,dy,p=point(container,id),sublisteners=listeners.copy();if(customEvent(new DragEvent(drag,"beforestart",s,id,active,p[0],p[1],0,0,sublisteners),function(){return null!=(on_event.subject=s=subject.apply(that,args))&&(dx=s.x-p[0]||0,dy=s.y-p[1]||0,!0)}))return function gesture(type){var n,p0=p;switch(type){case"start":gestures[id]=gesture,n=active++;break;case"end":delete gestures[id],--active;case"drag":p=point(container,id),n=active}customEvent(new DragEvent(drag,type,s,id,n,p[0]+dx,p[1]+dy,p[0]-p0[0],p[1]-p0[1],sublisteners),sublisteners.apply,sublisteners,[type,that,args])}}return drag.filter=function(_){return arguments.length?(filter="function"==typeof _?_:d3_drag_src_constant(!!_),drag):filter},drag.container=function(_){return arguments.length?(container="function"==typeof _?_:d3_drag_src_constant(_),drag):container},drag.subject=function(_){return arguments.length?(subject="function"==typeof _?_:d3_drag_src_constant(_),drag):subject},drag.touchable=function(_){return arguments.length?(touchable="function"==typeof _?_:d3_drag_src_constant(!!_),drag):touchable},drag.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?drag:value},drag.clickDistance=function(_){return arguments.length?(clickDistance2=(_=+_)*_,drag):Math.sqrt(clickDistance2)},drag};function timer_typeof(obj){return(timer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var taskHead,taskTail,timer_frame=0,timeout=0,timer_interval=0,pokeDelay=1e3,clockLast=0,clockNow=0,clockSkew=0,clock="object"===("undefined"==typeof performance?"undefined":timer_typeof(performance))&&performance.now?performance:Date,setFrame="object"===("undefined"==typeof window?"undefined":timer_typeof(window))&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}function timer_timer(callback,delay,time){var t=new Timer;return t.restart(callback,delay,time),t}function wake(){clockNow=(clockLast=clock.now())+clockSkew,timer_frame=timeout=0;try{!function timerFlush(){now(),++timer_frame;for(var e,t=taskHead;t;)(e=clockNow-t._time)>=0&&t._call.call(null,e),t=t._next;--timer_frame}()}finally{timer_frame=0,function nap(){var t0,t2,t1=taskHead,time=1/0;for(;t1;)t1._call?(time>t1._time&&(time=t1._time),t0=t1,t1=t1._next):(t2=t1._next,t1._next=null,t1=t0?t0._next=t2:taskHead=t2);taskTail=t0,sleep(time)}(),clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;delay>pokeDelay&&(clockSkew-=delay,clockLast=now)}function sleep(time){timer_frame||(timeout&&(timeout=clearTimeout(timeout)),time-clockNow>24?(time<1/0&&(timeout=setTimeout(wake,time-clock.now()-clockSkew)),timer_interval&&(timer_interval=clearInterval(timer_interval))):(timer_interval||(clockLast=clock.now(),timer_interval=setInterval(poke,pokeDelay)),timer_frame=1,setFrame(wake)))}Timer.prototype=timer_timer.prototype={constructor:Timer,restart:function restart(callback,delay,time){if("function"!=typeof callback)throw new TypeError("callback is not a function");time=(null==time?now():+time)+(null==delay?0:+delay),this._next||taskTail===this||(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=callback,this._time=time,sleep()},stop:function stop(){this._call&&(this._call=null,this._time=1/0,sleep())}};var src_timeout=function(callback,delay,time){var t=new Timer;return delay=null==delay?0:+delay,t.restart(function(elapsed){t.stop(),callback(elapsed+delay)},delay,time),t},emptyOn=src_dispatch("start","end","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6,transition_schedule=function(node,name,id,index,group,timing){var schedules=node.__transition;if(schedules){if(id in schedules)return}else node.__transition={};!function schedule_create(node,id,self){var tween,schedules=node.__transition;function start(elapsed){var i,j,n,o;if(self.state!==SCHEDULED)return stop();for(i in schedules)if((o=schedules[i]).name===self.name){if(o.state===STARTED)return src_timeout(start);o.state===RUNNING?(o.state=ENDED,o.timer.stop(),o.on.call("interrupt",node,node.__data__,o.index,o.group),delete schedules[i]):+i<id&&(o.state=ENDED,o.timer.stop(),delete schedules[i])}if(src_timeout(function(){self.state===STARTED&&(self.state=RUNNING,self.timer.restart(tick,self.delay,self.time),tick(elapsed))}),self.state=STARTING,self.on.call("start",node,node.__data__,self.index,self.group),self.state===STARTING){for(self.state=STARTED,tween=new Array(n=self.tween.length),i=0,j=-1;i<n;++i)(o=self.tween[i].value.call(node,node.__data__,self.index,self.group))&&(tween[++j]=o);tween.length=j+1}}function tick(elapsed){for(var t=elapsed<self.duration?self.ease.call(null,elapsed/self.duration):(self.timer.restart(stop),self.state=ENDING,1),i=-1,n=tween.length;++i<n;)tween[i].call(null,t);self.state===ENDING&&(self.on.call("end",node,node.__data__,self.index,self.group),stop())}function stop(){for(var i in self.state=ENDED,self.timer.stop(),delete schedules[id],schedules)return;delete node.__transition}schedules[id]=self,self.timer=timer_timer(function schedule(elapsed){self.state=SCHEDULED,self.timer.restart(start,self.delay,self.time),self.delay<=elapsed&&start(elapsed-self.delay)},0,self.time)}(node,id,{name:name,index:index,group:group,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:CREATED})};function init(node,id){var schedule=schedule_get(node,id);if(schedule.state>CREATED)throw new Error("too late; already scheduled");return schedule}function schedule_set(node,id){var schedule=schedule_get(node,id);if(schedule.state>STARTING)throw new Error("too late; already started");return schedule}function schedule_get(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id]))throw new Error("transition not found");return schedule}function tweenValue(transition,name,value){var id=transition._id;return transition.each(function(){var schedule=schedule_set(this,id);(schedule.value||(schedule.value={}))[name]=value.apply(this,arguments)}),function(node){return schedule_get(node,id).value[name]}}var transition_interpolate=function(a,b){var c;return("number"==typeof b?src_number:b instanceof color_color?src_rgb:(c=color_color(b))?(b=c,src_rgb):src_string)(a,b)};var transition_selection_Selection=src_selection.prototype.constructor;var transition_id=0;function Transition(groups,parents,name,id){this._groups=groups,this._parents=parents,this._name=name,this._id=id}function newId(){return++transition_id}var selection_prototype=src_selection.prototype;Transition.prototype=function src_transition_transition(name){return src_selection().transition(name)}.prototype={constructor:Transition,select:function(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=src_selector(select));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,subnode,group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),i=0;i<n;++i)(node=group[i])&&(subnode=select.call(node,node.__data__,i,group))&&("__data__"in node&&(subnode.__data__=node.__data__),subgroup[i]=subnode,transition_schedule(subgroup[i],name,id,i,subgroup,schedule_get(node,id)));return new Transition(subgroups,this._parents,name,id)},selectAll:function(select){var name=this._name,id=this._id;"function"!=typeof select&&(select=selectorAll(select));for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)if(node=group[i]){for(var child,children=select.call(node,node.__data__,i,group),inherit=schedule_get(node,id),k=0,l=children.length;k<l;++k)(child=children[k])&&transition_schedule(child,name,id,k,children,inherit);subgroups.push(children),parents.push(node)}return new Transition(subgroups,parents,name,id)},filter:function(match){"function"!=typeof match&&(match=src_matcher(match));for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j)for(var node,group=groups[j],n=group.length,subgroup=subgroups[j]=[],i=0;i<n;++i)(node=group[i])&&match.call(node,node.__data__,i,group)&&subgroup.push(node);return new Transition(subgroups,this._parents,this._name,this._id)},merge:function(transition){if(transition._id!==this._id)throw new Error;for(var groups0=this._groups,groups1=transition._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j)for(var node,group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),i=0;i<n;++i)(node=group0[i]||group1[i])&&(merge[i]=node);for(;j<m0;++j)merges[j]=groups0[j];return new Transition(merges,this._parents,this._name,this._id)},selection:function(){return new transition_selection_Selection(this._groups,this._parents)},transition:function(){for(var name=this._name,id0=this._id,id1=newId(),groups=this._groups,m=groups.length,j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)if(node=group[i]){var inherit=schedule_get(node,id0);transition_schedule(node,name,id1,i,group,{time:inherit.time+inherit.delay+inherit.duration,delay:0,duration:inherit.duration,ease:inherit.ease})}return new Transition(groups,this._parents,name,id1)},call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:function(name,listener){var id=this._id;return arguments.length<2?schedule_get(this.node(),id).on.on(name):this.each(function onFunction(id,name,listener){var on0,on1,sit=function on_start(name){return(name+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");return i>=0&&(t=t.slice(0,i)),!t||"start"===t})}(name)?init:schedule_set;return function(){var schedule=sit(this,id),on=schedule.on;on!==on0&&(on1=(on0=on).copy()).on(name,listener),schedule.on=on1}}(id,name,listener))},attr:function(name,value){var fullname=src_namespace(name),i="transform"===fullname?interpolateTransformSvg:transition_interpolate;return this.attrTween(name,"function"==typeof value?(fullname.local?function attr_attrFunctionNS(fullname,interpolate,value){var value00,value10,interpolate0;return function(){var value0,value1=value(this);if(null!=value1)return(value0=this.getAttributeNS(fullname.space,fullname.local))===value1?null:value0===value00&&value1===value10?interpolate0:interpolate0=interpolate(value00=value0,value10=value1);this.removeAttributeNS(fullname.space,fullname.local)}}:function attr_attrFunction(name,interpolate,value){var value00,value10,interpolate0;return function(){var value0,value1=value(this);if(null!=value1)return(value0=this.getAttribute(name))===value1?null:value0===value00&&value1===value10?interpolate0:interpolate0=interpolate(value00=value0,value10=value1);this.removeAttribute(name)}})(fullname,i,tweenValue(this,"attr."+name,value)):null==value?(fullname.local?function attr_attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}:function attr_attrRemove(name){return function(){this.removeAttribute(name)}})(fullname):(fullname.local?function attr_attrConstantNS(fullname,interpolate,value1){var value00,interpolate0;return function(){var value0=this.getAttributeNS(fullname.space,fullname.local);return value0===value1?null:value0===value00?interpolate0:interpolate0=interpolate(value00=value0,value1)}}:function attr_attrConstant(name,interpolate,value1){var value00,interpolate0;return function(){var value0=this.getAttribute(name);return value0===value1?null:value0===value00?interpolate0:interpolate0=interpolate(value00=value0,value1)}})(fullname,i,value+""))},attrTween:function(name,value){var key="attr."+name;if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;var fullname=src_namespace(name);return this.tween(key,(fullname.local?function attrTweenNS(fullname,value){function tween(){var node=this,i=value.apply(node,arguments);return i&&function(t){node.setAttributeNS(fullname.space,fullname.local,i(t))}}return tween._value=value,tween}:function attrTween(name,value){function tween(){var node=this,i=value.apply(node,arguments);return i&&function(t){node.setAttribute(name,i(t))}}return tween._value=value,tween})(fullname,value))},style:function(name,value,priority){var i="transform"==(name+="")?interpolateTransformCss:transition_interpolate;return null==value?this.styleTween(name,function style_styleRemove(name,interpolate){var value00,value10,interpolate0;return function(){var value0=styleValue(this,name),value1=(this.style.removeProperty(name),styleValue(this,name));return value0===value1?null:value0===value00&&value1===value10?interpolate0:interpolate0=interpolate(value00=value0,value10=value1)}}(name,i)).on("end.style."+name,function styleRemoveEnd(name){return function(){this.style.removeProperty(name)}}(name)):this.styleTween(name,"function"==typeof value?function style_styleFunction(name,interpolate,value){var value00,value10,interpolate0;return function(){var value0=styleValue(this,name),value1=value(this);return null==value1&&(this.style.removeProperty(name),value1=styleValue(this,name)),value0===value1?null:value0===value00&&value1===value10?interpolate0:interpolate0=interpolate(value00=value0,value10=value1)}}(name,i,tweenValue(this,"style."+name,value)):function style_styleConstant(name,interpolate,value1){var value00,interpolate0;return function(){var value0=styleValue(this,name);return value0===value1?null:value0===value00?interpolate0:interpolate0=interpolate(value00=value0,value1)}}(name,i,value+""),priority)},styleTween:function(name,value,priority){var key="style."+(name+="");if(arguments.length<2)return(key=this.tween(key))&&key._value;if(null==value)return this.tween(key,null);if("function"!=typeof value)throw new Error;return this.tween(key,function styleTween(name,value,priority){function tween(){var node=this,i=value.apply(node,arguments);return i&&function(t){node.style.setProperty(name,i(t),priority)}}return tween._value=value,tween}(name,value,null==priority?"":priority))},text:function(value){return this.tween("text","function"==typeof value?function text_textFunction(value){return function(){var value1=value(this);this.textContent=null==value1?"":value1}}(tweenValue(this,"text",value)):function text_textConstant(value){return function(){this.textContent=value}}(null==value?"":value+""))},remove:function(){return this.on("end.remove",function removeFunction(id){return function(){var parent=this.parentNode;for(var i in this.__transition)if(+i!==id)return;parent&&parent.removeChild(this)}}(this._id))},tween:function(name,value){var id=this._id;if(name+="",arguments.length<2){for(var t,tween=schedule_get(this.node(),id).tween,i=0,n=tween.length;i<n;++i)if((t=tween[i]).name===name)return t.value;return null}return this.each((null==value?function tweenRemove(id,name){var tween0,tween1;return function(){var schedule=schedule_set(this,id),tween=schedule.tween;if(tween!==tween0)for(var i=0,n=(tween1=tween0=tween).length;i<n;++i)if(tween1[i].name===name){(tween1=tween1.slice()).splice(i,1);break}schedule.tween=tween1}}:function tweenFunction(id,name,value){var tween0,tween1;if("function"!=typeof value)throw new Error;return function(){var schedule=schedule_set(this,id),tween=schedule.tween;if(tween!==tween0){tween1=(tween0=tween).slice();for(var t={name:name,value:value},i=0,n=tween1.length;i<n;++i)if(tween1[i].name===name){tween1[i]=t;break}i===n&&tween1.push(t)}schedule.tween=tween1}})(id,name,value))},delay:function(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?function delayFunction(id,value){return function(){init(this,id).delay=+value.apply(this,arguments)}}:function delayConstant(id,value){return value=+value,function(){init(this,id).delay=value}})(id,value)):schedule_get(this.node(),id).delay},duration:function(value){var id=this._id;return arguments.length?this.each(("function"==typeof value?function durationFunction(id,value){return function(){schedule_set(this,id).duration=+value.apply(this,arguments)}}:function durationConstant(id,value){return value=+value,function(){schedule_set(this,id).duration=value}})(id,value)):schedule_get(this.node(),id).duration},ease:function(value){var id=this._id;return arguments.length?this.each(function easeConstant(id,value){if("function"!=typeof value)throw new Error;return function(){schedule_set(this,id).ease=value}}(id,value)):schedule_get(this.node(),id).ease}};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function transition_inherit(node,id){for(var timing;!(timing=node.__transition)||!(timing=timing[id]);)if(!(node=node.parentNode))return defaultTiming.time=now(),defaultTiming;return timing}src_selection.prototype.interrupt=function(name){return this.each(function(){!function(node,name){var schedule,active,i,schedules=node.__transition,empty=!0;if(schedules){for(i in name=null==name?null:name+"",schedules)(schedule=schedules[i]).name===name?(active=schedule.state>STARTING&&schedule.state<ENDING,schedule.state=ENDED,schedule.timer.stop(),active&&schedule.on.call("interrupt",node,node.__data__,schedule.index,schedule.group),delete schedules[i]):empty=!1;empty&&delete node.__transition}}(this,name)})},src_selection.prototype.transition=function(name){var id,timing;name instanceof Transition?(id=name._id,name=name._name):(id=newId(),(timing=defaultTiming).time=now(),name=null==name?null:name+"");for(var groups=this._groups,m=groups.length,j=0;j<m;++j)for(var node,group=groups[j],n=group.length,i=0;i<n;++i)(node=group[i])&&transition_schedule(node,name,id,i,group,timing||transition_inherit(node,id));return new Transition(groups,this._parents,name,id)};function renderer_utils_typeof(obj){return(renderer_utils_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var renderer_utils_selectElement=function selectElement(element){return src_select(element)},makeElement=function makeElement(parent,elemType,data,selector){var callbacks=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},keyFn=arguments.length>5?arguments[5]:void 0;(parent instanceof HTMLElement||parent instanceof SVGElement)&&(parent=renderer_utils_selectElement(parent));var filter,selectorVal=selector?selector[0]:null,selectorType=null,actualSelector=null,element=null,enterSel=null,mergeSel=null;selectorVal?"#"===selectorVal?(selectorType="id",actualSelector=selector):(selectorType="class",actualSelector="."===selector[0]?selector:".".concat(selector)):(actualSelector=elemType,filter=!0),element=parent.selectAll(actualSelector),filter&&(element=element.filter(function(){return this.parentNode===parent.node()})),enterSel=(element=element.data(data,keyFn)).enter().append(elemType||"div"),callbacks.enter&&enterSel.each(function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];callbacks.enter.apply(callbacks,[renderer_utils_selectElement(this)].concat(params))}),mergeSel=enterSel.merge(element),callbacks.update&&mergeSel.each(function(){for(var _len2=arguments.length,params=new Array(_len2),_key2=0;_key2<_len2;_key2++)params[_key2]=arguments[_key2];callbacks.update.apply(callbacks,[renderer_utils_selectElement(this)].concat(params))}),"class"===selectorType?mergeSel.classed("."===selectorVal?selector.substring(1,selector.length):selector,!0):"id"===selectorType&&mergeSel.attr("id",selector.substring(1,selector.length));var exitSel=element.exit();return callbacks.exit?exitSel.each(function(){for(var _len3=arguments.length,params=new Array(_len3),_key3=0;_key3<_len3;_key3++)params[_key3]=arguments[_key3];callbacks.exit.apply(callbacks,[renderer_utils_selectElement(this)].concat(params))}):exitSel.remove(),mergeSel},applyStyle=function applyStyle(elem,styleObj){return Object.entries(styleObj).forEach(function(d){elem.style(d[0],d[1])},void 0),elem},setElementAttrs=function setElementAttrs(element,attrs){for(var key in attrs)({}).hasOwnProperty.call(attrs,key)&&element.attr(key,attrs[key])},renderer_utils_setAttrs=function setAttrs(element,attrs,className){return element instanceof src_selection||(element=renderer_utils_selectElement(element)),void 0!==className?element.selectAll(".".concat(className)).each(function(){setElementAttrs(src_select(this),attrs)}):setElementAttrs(element,attrs),element},renderer_utils_setStyles=function setStyles(element,styles){for(var key in element instanceof src_selection||(element=renderer_utils_selectElement(element)),styles)({}).hasOwnProperty.call(styles,key)&&element.style(key,styles[key]);return element},renderer_utils_createElements=function createElements(params){var data,sel,container=src_select(params.container);"number"==typeof(data=params.data)&&(data=Array(data).fill().map(function(d,i){return i})),sel=container.selectAll(params.selector).data(data),(sel=container.selectAll(params.selector).filter(function(){return this.parentNode===container.node()}).data(params.data)).enter().append(params.append).merge(sel).each(function(d,i){params.each(d,src_select(this),i)}).attr("class",params.className||""),sel.exit().remove()},renderer_utils_getClientPoint=function getClientPoint(){var pos=src_point.apply(void 0,arguments);return{x:pos[0],y:pos[1]}},renderer_utils_getEvent=function getEvent(){return on_event},renderer_utils_getD3Drag=function getD3Drag(){return src_drag},renderer_utils_getSmartComputedStyle=function getSmartComputedStyle(group,css){var textEl,mandatoryStyle={"fill-opacity":0},className="string"==typeof css?css:css instanceof Array?css.join(" "):void 0;textEl=group.node()instanceof HTMLElement?group.append("div").html("W"):group.append("text").text("W"),className?textEl.attr("class",className):"object"===renderer_utils_typeof(css)&&(delete css["fill-opacity"],mergeRecursive(mandatoryStyle,css)),textEl.style(mandatoryStyle);var computedStyle=window.getComputedStyle(textEl.node()),styleForSmartLabel={fontSize:computedStyle.fontSize,fontFamily:computedStyle.fontFamily,fontWeight:computedStyle.fontWeight,fontStyle:computedStyle.fontStyle};return textEl.remove(),styleForSmartLabel},hasTouch=function hasTouch(){return"ontouchstart"in document.documentElement},SmartlabelManager=__webpack_require__(4),SmartlabelManager_default=__webpack_require__.n(SmartlabelManager),events=["initialized","beforeupdate","updated","beforedraw","drawn","beforeremove","removed","animationend"],EVENT_LIST=[];["canvas","unit","layer","axis","facet-headers","legend","caption"].forEach(function(composition){events.forEach(function(event){EVENT_LIST.push("".concat(composition,".").concat(event))})});var event_list=EVENT_LIST;function lifecycle_manager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var lifecycle_manager_resolver=function resolver(resolveFn){return function(notification){return resolveFn(notification)}},hasOwn=function hasOwn(source,property){return Object.prototype.hasOwnProperty.call(source,property)},lifecycle_manager=function(){function LifeCycleManager(){!function lifecycle_manager_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LifeCycleManager),this._eventList=event_list,this._promises=new Map,this._notifiers={},this._lifeCycles={},this._unreleasedLifeCycles={},this._boot()}return function lifecycle_manager_createClass(Constructor,protoProps,staticProps){return protoProps&&lifecycle_manager_defineProperties(Constructor.prototype,protoProps),staticProps&&lifecycle_manager_defineProperties(Constructor,staticProps),Constructor}(LifeCycleManager,[{key:"_boot",value:function _boot(){this._notifiers=this._eventList.reduce(function(acc,name){return acc[name]=lifecycle_manager_resolver,acc},{}),this._preparePromises()}},{key:"retrieve",value:function retrieve(eventName){return this._promises.get(eventName)}},{key:"_makeNotifierPromise",value:function _makeNotifierPromise(eventName){var _this=this;return new Promise(function(resolve){_this._notifiers[eventName]=lifecycle_manager_resolver(resolve)})}},{key:"_preparePromises",value:function _preparePromises(){var _this2=this;this._eventList.forEach(function(eventName){var promise=_this2._makeNotifierPromise(eventName);_this2._promises.set(eventName,promise),function createPromise(promise,eventName,context){promise.then(function(){var prm=context._makeNotifierPromise(eventName);context._promises.set(eventName,prm),createPromise(prm,eventName,context)})}(promise,eventName,_this2)})}},{key:"_resolvePromise",value:function _resolvePromise(eventName,notification){this._notifiers[eventName](notification)}},{key:"notify",value:function notify(notification){var composition=notification.formalName||notification.client.constructor.formalName();notification.formalName=composition,this._releasePromisesFromCache(),this._notify(composition,notification)}},{key:"_notify",value:function _notify(composition,notification){var stage=notification.action,eventName="".concat(composition,".").concat(stage);this._resolvePromise(eventName,notification);var promise=this.retrieve(eventName);this._lifeCycles[composition]&&this._lifeCycles[composition][stage]?this._callLifeCycleCallback(composition,stage,promise):this._cachePromise(composition,stage,promise)}},{key:"_callLifeCycleCallback",value:function _callLifeCycleCallback(composition,stage,promise){var eventName="".concat(composition,".").concat(stage);this._lifeCycles[composition][stage](promise),this._resetTargetPromise(eventName)}},{key:"_releasePromisesFromCache",value:function _releasePromisesFromCache(){var _this3=this;Object.keys(this._unreleasedLifeCycles).forEach(function(composition){Object.keys(_this3._unreleasedLifeCycles[composition]).forEach(function(stage){if(_this3._lifeCycles[composition]&&_this3._lifeCycles[composition][stage]){var promise=_this3._unreleasedLifeCycles[composition][stage];_this3._callLifeCycleCallback(composition,stage,promise),delete _this3._unreleasedLifeCycles[composition][stage]}})})}},{key:"_cachePromise",value:function _cachePromise(composition,stage,promise){hasOwn(this._unreleasedLifeCycles,composition)||(this._unreleasedLifeCycles[composition]={}),hasOwn(this._unreleasedLifeCycles[composition],stage)||(this._unreleasedLifeCycles[composition][stage]={}),this._unreleasedLifeCycles[composition][stage]=promise}},{key:"register",value:function register(){var lifeCycles=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._lifeCycles=lifeCycles,this._releasePromisesFromCache()}},{key:"_resetTargetPromise",value:function _resetTargetPromise(eventName){var _this4=this;setTimeout(function(){_this4._notifiers[eventName]=lifecycle_manager_resolver,_this4._promises.set(eventName,_this4._makeNotifierPromise(eventName))},0)}}]),LifeCycleManager}(),DRAG="drag",HOVER="hover",SELECTIONDRAG="selectiondrag",CLICK="click",LONGTOUCH="longtouch",TOUCHDRAG="touchdrag",ALL_ACTIONS="*",SELECTION_NEW_ENTRY=1,SELECTION_NEW_EXIT=-1,SELECTION_NULL=0,SELECTION_OLD_ENTRY=2,SELECTION_OLD_EXIT=-2;function selection_set_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var src_selection_set=function(){function SelectionSet(completeSet,_volatile){!function selection_set_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectionSet),this.completeSet=completeSet,this._set=completeSet.reduce(function(obj,key){return obj[key]=SELECTION_NULL,obj},{}),this._volatile=_volatile,this._completeSetCount=completeSet.length,this._lockedSelection={},this._resetted=!0}return function selection_set_createClass(Constructor,protoProps,staticProps){return protoProps&&selection_set_defineProperties(Constructor.prototype,protoProps),staticProps&&selection_set_defineProperties(Constructor,staticProps),Constructor}(SelectionSet,[{key:"add",value:function add(ids){this._resetted=!1;var set=this._set;for(var key in ids.forEach(function(i){set[i]=SELECTION_NEW_ENTRY}),set)set[key]!==SELECTION_NEW_ENTRY&&set[key]!==SELECTION_OLD_ENTRY&&(set[key]=set[key]<0?SELECTION_OLD_EXIT:SELECTION_NEW_EXIT);return this}},{key:"update",value:function update(ids){var set=this._set;return ids.forEach(function(i){set[i]=SELECTION_OLD_ENTRY}),this}},{key:"updateEntry",value:function updateEntry(){var set=this._set;for(var key in set)set[key]=set[key]===SELECTION_NEW_ENTRY?SELECTION_OLD_ENTRY:set[key];return this}},{key:"updateExit",value:function updateExit(){var set=this._set;for(var key in set)set[key]=set[key]===SELECTION_NEW_EXIT?SELECTION_OLD_EXIT:set[key];return this}},{key:"remove",value:function remove(ids){this._resetted=!1;var set=this._set;for(var key in ids.forEach(function(i){set[i]=SELECTION_NEW_EXIT}),set)set[key]!==SELECTION_NEW_EXIT&&set[key]!==SELECTION_OLD_EXIT&&(set[key]=0===set[key]?SELECTION_NEW_ENTRY:SELECTION_OLD_ENTRY);return this}},{key:"getSets",value:function getSets(){var set=this._set,retObj={entrySet:[[],[]],exitSet:[[],[]],completeSet:[]};for(var key in set)set[key]>0?(set[key]===SELECTION_OLD_ENTRY&&retObj.entrySet[0].push(key),set[key]===SELECTION_NEW_ENTRY&&retObj.entrySet[1].push(key)):set[key]<0&&(set[key]===SELECTION_OLD_EXIT&&retObj.exitSet[0].push(key),set[key]===SELECTION_NEW_EXIT&&retObj.exitSet[1].push(key)),retObj.completeSet.push(key);return["entrySet","exitSet"].forEach(function(type){retObj[type]=retObj[type].map(function(e){return e.map(Number)})}),retObj.completeSet=retObj.completeSet.map(Number),retObj}},{key:"reset",value:function reset(ids){var set=this._set;if(ids)ids.forEach(function(i){set[i]=SELECTION_NULL});else{var lockedSel=this._lockedSelection;for(var key in set)key in lockedSel||(set[key]=SELECTION_NULL)}return this._resetted=!0,this}},{key:"getEntrySet",value:function getEntrySet(){var set=this._set,addSet=[];for(var key in set)set[key]===SELECTION_NEW_ENTRY&&addSet.push(key);return addSet}},{key:"getExistingEntrySet",value:function getExistingEntrySet(addSet){var set=this._set;return addSet.filter(function(d){return set[d]===SELECTION_NEW_ENTRY||set[d]===SELECTION_OLD_ENTRY})}},{key:"getExistingExitSet",value:function getExistingExitSet(removeSet){var set=this._set;return removeSet.filter(function(d){return set[d]===SELECTION_NEW_EXIT||set[d]===SELECTION_OLD_EXIT})}},{key:"getOldEntry",value:function getOldEntry(){var set=this._set,updateSet=[];for(var key in set)set[key]===SELECTION_OLD_ENTRY&&updateSet.push(key);return updateSet}},{key:"getOldExit",value:function getOldExit(){var set=this._set,updateSet=[];for(var key in set)set[key]===SELECTION_OLD_EXIT&&updateSet.push(key);return updateSet}},{key:"getExitSet",value:function getExitSet(){var set=this._set,removeSet=[];for(var key in set)set[key]===SELECTION_NEW_EXIT&&removeSet.push(key);return removeSet}},{key:"getCompleteSet",value:function getCompleteSet(){var set=this._set,completeSet=[];for(var key in set)completeSet.push(key);return completeSet}},{key:"getCompleteSetCount",value:function getCompleteSetCount(){return this._completeSetCount}},{key:"resetted",value:function resetted(){return this._resetted}},{key:"toggle",value:function toggle(){var set=this._set;for(var key in set)set[key]===SELECTION_NEW_ENTRY?set[key]=SELECTION_NEW_EXIT:set[key]===SELECTION_NEW_EXIT?set[key]=SELECTION_NEW_ENTRY:set[key]===SELECTION_OLD_ENTRY?set[key]=SELECTION_OLD_EXIT:set[key]=SELECTION_OLD_ENTRY;return this}}]),SelectionSet}();function helper_toConsumableArray(arr){return function helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var changeSideEffectAvailability=function changeSideEffectAvailability(context,fn,toEnable){var sideEffects=context.sideEffects();for(var key in sideEffects)if({}.hasOwnProperty.call(sideEffects,key)){var change=!0;fn&&!1===fn(key)&&(change=!1),change&&(toEnable?sideEffects[key].enable():sideEffects[key].disable())}},getMergedSet=function getMergedSet(set){return helper_toConsumableArray(new Set([].concat(helper_toConsumableArray(set[0]),helper_toConsumableArray(set[1]))))},conditionsMap={newEntry:[SELECTION_NEW_ENTRY],oldEntry:[SELECTION_OLD_ENTRY],mergedEnter:[SELECTION_NEW_ENTRY,SELECTION_OLD_ENTRY],newExit:[SELECTION_NEW_EXIT],oldExit:[SELECTION_OLD_EXIT],mergedExit:[SELECTION_NEW_EXIT,SELECTION_OLD_EXIT],complete:[]},getSetInfo=function getSetInfo(type,set,config){var model=null,filteredDataModel=config.filteredDataModel,selectionSet=config.selectionSet;return config.propagationData?filteredDataModel&&(model="mergedEnter"===type?filteredDataModel[0]:filteredDataModel[1]):model=selectionSet.resetted()?null:function getModelFromSet(type,model,set){return model?model.select(function(fields,i){return conditionsMap[type].some(function(condition){return set[i]===condition})},{saveChild:!1}):null}(type,config.dataModel,config.selectionSet._set),{uids:set,length:set.length,model:model}};function firebolt_typeof(obj){return(firebolt_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function firebolt_toConsumableArray(arr){return function firebolt_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function firebolt_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function firebolt_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function firebolt_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var firebolt_Firebolt=function(){function Firebolt(context,actions,sideEffects,behaviourEffectMap){!function firebolt_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Firebolt),this.context=context,this._sideEffectDefinitions={},this._sideEffects={},this._propagationInf={},this._actions={behavioural:{},physical:{}},this._selectionSet={},this._volatileSelectionSet={},this._propagationFields={},this._sourceSideEffects={selectionBox:function selectionBox(){return!1}},this._propagationBehaviourMap={},this._sourceBehaviours={},this._actionBehaviourMap={},this._config={},this._behaviourEffectMap={},this._entryExitSet={},this._actionHistory={},this._queuedSideEffects={},this.mapSideEffects(behaviourEffectMap),this.registerBehaviouralActions(actions.behavioural),this.registerSideEffects(sideEffects),this.registerPhysicalBehaviouralMap(actions.physicalBehaviouralMap),this.registerPhysicalActions(actions.physical)}return function firebolt_createClass(Constructor,protoProps,staticProps){return protoProps&&firebolt_defineProperties(Constructor.prototype,protoProps),staticProps&&firebolt_defineProperties(Constructor,staticProps),Constructor}(Firebolt,[{key:"config",value:function config(){return arguments.length?(this._config=mergeRecursive(this._config,arguments.length<=0?void 0:arguments[0]),this):this._config}},{key:"mapSideEffects",value:function mapSideEffects(behEffectMap){var behaviourEffectMap=this._behaviourEffectMap;for(var key in behEffectMap)if({}.hasOwnProperty.call(behEffectMap,key)){var sideEffects=behEffectMap[key]||[],preventDefaultActions=!1,effectNames=void 0;isSimpleObject(sideEffects)?(effectNames=sideEffects.effects,preventDefaultActions=sideEffects.preventDefaultActions):effectNames=sideEffects,!behaviourEffectMap[key]&&(behaviourEffectMap[key]=[]),this._behaviourEffectMap[key]=firebolt_toConsumableArray(new Set(preventDefaultActions?effectNames:[].concat(firebolt_toConsumableArray(behaviourEffectMap[key]),firebolt_toConsumableArray(effectNames))))}return this}},{key:"registerBehaviouralActions",value:function registerBehaviouralActions(actions){var behaviours=function initializeBehaviouralActions(context,actions){var dispatchableBehaviours={};return(actions=actions instanceof Array?actions:Object.values(actions)).forEach(function(Action){dispatchableBehaviours[Action.formalName()]=new Action(context)}),dispatchableBehaviours}(this,actions);return this.prepareSelectionSets(behaviours),Object.assign(this._actions.behavioural,behaviours),this}},{key:"prepareSelectionSets",value:function prepareSelectionSets(){return this}},{key:"registerSideEffects",value:function registerSideEffects(sideEffects){for(var key in sideEffects)this._sideEffectDefinitions[sideEffects[key].formalName()]=sideEffects[key];return this.initializeSideEffects(),this}},{key:"applySideEffects",value:function applySideEffects(sideEffects,selectionSet,payload){var _this=this,sideEffectStore=this.sideEffects(),actionHistory=this._actionHistory,queuedSideEffects=this._queuedSideEffects;return sideEffects.forEach(function(sideEffect){var options,name,effects=sideEffect.effects,behaviours=sideEffect.behaviours,combinedSet=function unionSets(context,behaviours){var combinedSet={},models={mergedEnter:null,mergedExit:null};return behaviours.forEach(function(behaviour){var entryExitSet=context._entryExitSet[behaviour];entryExitSet&&(combinedSet=Object.assign(combinedSet,clone(entryExitSet)),["mergedEnter","mergedExit"].forEach(function(type){var model=entryExitSet[type].model,existingModel=models[type];existingModel=existingModel?"".concat(model.getSchema().map(function(d){return d.name}).sort())==="".concat(existingModel.getSchema().map(function(d){return d.name}).sort())?models[type]=model.union(existingModel):model:models[type]=model,combinedSet[type].model=existingModel}))}),combinedSet}(_this,behaviours);effects.forEach(function(effect){"object"===firebolt_typeof(effect)?(name=effect.name,options=effect.options):name=effect;var sideEffectInstance=sideEffectStore[name];sideEffectInstance.isEnabled()&&(!sideEffectInstance.constructor.mutates()&&Object.values(actionHistory).some(function(d){return d.isMutableAction})?queuedSideEffects["".concat(name,"-").concat(behaviours.join())]={name:name,params:[combinedSet,payload,options]}:_this.dispatchSideEffect(name,combinedSet,payload,options))})}),this}},{key:"dispatchSideEffect",value:function dispatchSideEffect(name,selectionSet,payload){var options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},sideEffectStore=this.sideEffects(),sideEffect=sideEffectStore[name],disable=!1;options.filter&&options.filter(sideEffect)&&(disable=!0),!disable&&sideEffectStore[name].apply(selectionSet,payload,options)}},{key:"registerPropagationBehaviourMap",value:function registerPropagationBehaviourMap(map){return this._propagationBehaviourMap=Object.assign(this._propagationBehaviourMap,map||{}),this}},{key:"dispatchBehaviour",value:function dispatchBehaviour(behaviour,payload){var propagationInfo=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},propagate=void 0===propagationInfo.propagate||propagationInfo.propagate,action=this._actions.behavioural[behaviour],sideEffects=function getSideEffects(behaviour,behaviourEffectMap){var sideEffects=[];for(var key in behaviourEffectMap){var behaviours=key.split(",");behaviours.some(function(d){return d===behaviour})&&sideEffects.push({effects:behaviourEffectMap[key],behaviours:behaviours})}return sideEffects}(behaviour,this._behaviourEffectMap);if(this._propagationInf=propagationInfo,action){var selectionSet=action.dispatch(payload),propagationSelectionSet=this.getPropagationSelectionSet(selectionSet);this._entryExitSet[behaviour]=propagationSelectionSet;var shouldApplySideEffects=this.shouldApplySideEffects(propagate);if(propagate&&this.propagate(behaviour,payload,selectionSet.find(function(d){return d.sourceSelectionSet}),sideEffects),shouldApplySideEffects){var applicableSideEffects=this.getApplicableSideEffects(sideEffects,payload,propagationInfo);this.applySideEffects(applicableSideEffects,propagationSelectionSet,payload)}}return this}},{key:"getPropagationSelectionSet",value:function getPropagationSelectionSet(selectionSet){return selectionSet.find(function(d){return!d.sourceSelectionSet})}},{key:"shouldApplySideEffects",value:function shouldApplySideEffects(){return!0}},{key:"changeBehaviourStateOnPropagation",value:function changeBehaviourStateOnPropagation(behaviour,value){return value instanceof Function?this._sourceBehaviours[behaviour]=value:this._sourceBehaviours[behaviour]=function(){return value},this}},{key:"changeSideEffectStateOnPropagation",value:function changeSideEffectStateOnPropagation(sideEffect,value){value instanceof Function?this._sourceSideEffects[sideEffect]=value:this._sourceSideEffects[sideEffect]=function(){return value}}},{key:"propagate",value:function propagate(){return this}},{key:"sideEffects",value:function sideEffects(){return arguments.length?(this._sideEffects=arguments.length<=0?void 0:arguments[0],this):this._sideEffects}},{key:"enableSideEffects",value:function enableSideEffects(fn){return changeSideEffectAvailability(this,fn,!0),this}},{key:"disableSideEffects",value:function disableSideEffects(fn){return changeSideEffectAvailability(this,fn,!1),this}},{key:"dissociateBehaviour",value:function dissociateBehaviour(behaviour,physicalAction){var actionBehaviourMap=this._actionBehaviourMap;for(var key in actionBehaviourMap)if(key===physicalAction){var behaviourMap=actionBehaviourMap[key];behaviourMap.behaviours=behaviourMap.behaviours.filter(function(d){return d!==behaviour}),this.mapActionsAndBehaviour(key)}return this}},{key:"dissociateSideEffect",value:function dissociateSideEffect(sideEffect,behaviour){var behaviourEffectMap=this._behaviourEffectMap;return behaviourEffectMap[behaviour]=behaviourEffectMap[behaviour].filter(function(d){return(d.name||d)!==sideEffect}),this}},{key:"getApplicableSideEffects",value:function getApplicableSideEffects(sideEffects){return sideEffects}},{key:"attachPropagationListener",value:function attachPropagationListener(dataModel){return dataModel.unsubscribe("propagation"),dataModel.on("propagation",this.onDataModelPropagation()),this}},{key:"onDataModelPropagation",value:function onDataModelPropagation(){var _this2=this;return function(propValue){var payload=propValue.payload,action=payload.action;_this2.dispatchBehaviour(action,payload,{propagate:!1})}}},{key:"createSelectionSet",value:function createSelectionSet(uniqueIds,behaviouralActions){var behaviours=behaviouralActions||this._actions.behavioural,selectionSet=this._selectionSet,volatileSelectionSet=this._volatileSelectionSet;for(var key in behaviours)({}).hasOwnProperty.call(behaviours,key)&&(selectionSet[key]=new src_selection_set(uniqueIds),volatileSelectionSet[key]=new src_selection_set(uniqueIds,!0));return this._volatileSelectionSet=volatileSelectionSet,this.selectionSet(selectionSet),this}},{key:"selectionSet",value:function selectionSet(){return arguments.length?(this._selectionSet=arguments.length<=0?void 0:arguments[0],this):this._selectionSet}},{key:"initializeSideEffects",value:function initializeSideEffects(){var sideEffectDefinitions=this._sideEffectDefinitions;return this.sideEffects(function initializeSideEffects(context,sideEffects){var sideEffectsMap=context._sideEffects,config=context.config();return(sideEffects=sideEffects instanceof Array?sideEffects:Object.values(sideEffects)).forEach(function(SideEffect){var formalName=SideEffect.formalName(),sideEffectInstance=sideEffectsMap[formalName];sideEffectsMap[formalName]=sideEffectInstance||new SideEffect(context);var sideEffectConf=config[formalName];sideEffectConf&&sideEffectsMap[formalName].config(sideEffectConf)}),sideEffectsMap}(this,sideEffectDefinitions)),this}},{key:"registerPhysicalActions",value:function registerPhysicalActions(actions){var initedActions=function initializePhysicalActions(context,actions){var physicalActions={};for(var name in actions)({}).hasOwnProperty.call(name,actions)||(physicalActions[name]=actions[name](context));return physicalActions}(this,actions);return Object.assign(this._actions.physical,initedActions),this}},{key:"propagateWith",value:function propagateWith(action,fields){var append=arguments.length>2&&void 0!==arguments[2]&&arguments[2],behaviouralActions=this._actions.behavioural;if(fields.length){if(action===ALL_ACTIONS)for(var key in behaviouralActions)this._propagationFields[key]={fields:fields,append:append};else this._propagationFields[action]={fields:fields,append:append};return this}return this._propagationFields}},{key:"mapActionsAndBehaviour",value:function mapActionsAndBehaviour(phyAction){var initedPhysicalActions=this._actions.physical,map=this._actionBehaviourMap;for(var action in map)if(!{}.hasOwnProperty.call(action,map)&&action===(phyAction||action)){var target=void 0,mapObj=map[action];target=mapObj.target;var touch=mapObj.touch;target||(target=this.context.getDefaultTargetContainer()),(hasTouch()?!0===touch||void 0===touch:!touch)&&this.bindActionWithBehaviour(initedPhysicalActions[action],target,mapObj.behaviours)}return this}},{key:"registerPhysicalBehaviouralMap",value:function registerPhysicalBehaviouralMap(map){return this._actionBehaviourMap=mergeRecursive(this._actionBehaviourMap,map),this}},{key:"bindActionWithBehaviour",value:function bindActionWithBehaviour(action,targets,behaviourList){var _this3=this;return"string"==typeof targets&&(targets=[targets]),targets.forEach(function(target){var mount=_this3.context.mount(),nodes=target.node instanceof Function?target:renderer_utils_selectElement(mount).selectAll(target);nodes.empty()||(nodes instanceof Array?nodes.forEach(function(node){action(renderer_utils_selectElement(node),behaviourList)}):action(nodes,behaviourList))}),this}},{key:"getPropagationInf",value:function getPropagationInf(){return this._propagationInf}},{key:"getAddSetFromCriteria",value:function getAddSetFromCriteria(criteria){var propagationInf=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},context=this.context,filteredDataModel=propagationInf.data?propagationInf.data:context.getDataModelFromIdentifiers(criteria,"all"),xFields=context.fields().x||[],yFields=context.fields().y||[],xMeasures=xFields.every(function(field){return field.type()===dist_datamodel.FieldType.MEASURE}),yMeasures=yFields.every(function(field){return field.type()===dist_datamodel.FieldType.MEASURE});return{model:filteredDataModel,uids:null===criteria?null:propagationInf.data?function filterPropagationModel(model,propModel,measures){var filteredModel,_propModel$getData=propModel.getData(),data=_propModel$getData.data,schema=_propModel$getData.schema;if(schema.length){var fieldMap=model.getFieldsConfig();filteredModel=model.select(function(fields){return data.some(function(row){return schema.every(function(propField,idx){return!(measures||propField.name in fieldMap&&fieldMap[propField.name].def.type!==dist_datamodel.FieldType.MEASURE)||row[idx]===fields[propField.name].valueOf()})})},{saveChild:!1})}else filteredModel=propModel;return filteredModel}(this.getFullData(),propagationInf.data[0],xMeasures&&yMeasures).getData().uids:filteredDataModel[0].getData().uids}}},{key:"getSelectionSets",value:function getSelectionSets(action){var sourceId=this.context.id(),propagationSource=(this._propagationInf||{}).sourceId,applicableSelectionSets=[];return propagationSource!==sourceId&&(applicableSelectionSets=[this._volatileSelectionSet[action]]),propagationSource&&applicableSelectionSets.push(this.selectionSet()[action]),applicableSelectionSets}},{key:"getFullData",value:function getFullData(){return this.context.data()}},{key:"resetted",value:function resetted(){return this._resetted}},{key:"getEntryExitSet",value:function getEntryExitSet(behaviour){return this._entryExitSet[behaviour]}}]),Firebolt}();function generic_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var generic_GenericBehaviour=function(){function GenericBehaviour(firebolt){!function generic_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GenericBehaviour),this.firebolt=firebolt,this._enabled=!0}return function generic_createClass(Constructor,protoProps,staticProps){return protoProps&&generic_defineProperties(Constructor.prototype,protoProps),staticProps&&generic_defineProperties(Constructor,staticProps),Constructor}(GenericBehaviour,[{key:"dispatch",value:function dispatch(payload){var _this=this,criteria=payload.criteria,firebolt=this.firebolt,formalName=this.constructor.formalName(),selectionSets=firebolt.getSelectionSets(formalName),_this$firebolt$getAdd=this.firebolt.getAddSetFromCriteria(criteria,this.firebolt.getPropagationInf()),filteredDataModel=_this$firebolt$getAdd.model,uids=_this$firebolt$getAdd.uids;return selectionSets.map(function(selectionSet){return _this.setSelectionSet(uids,selectionSet),_this.getEntryExitSet(selectionSet,filteredDataModel,payload)})}},{key:"setSelectionSet",value:function setSelectionSet(){return this}},{key:"getEntryExitSet",value:function getEntryExitSet(selectionSet,filteredDataModel,payload){var _selectionSet$getSets=selectionSet.getSets(),entrySet=_selectionSet$getSets.entrySet,exitSet=_selectionSet$getSets.exitSet,completeSet=_selectionSet$getSets.completeSet,propagationInf=this.firebolt.getPropagationInf(),dataModel=this.firebolt.getFullData(),setConfig={isSourceFieldPresent:propagationInf.isSourceFieldPresent,dataModel:dataModel,filteredDataModel:filteredDataModel,propagationData:propagationInf.data,selectionSet:selectionSet};return{entrySet:[getSetInfo("oldEntry",entrySet[0],setConfig),getSetInfo("newEntry",entrySet[1],setConfig)],exitSet:[getSetInfo("oldEntry",exitSet[0],setConfig),getSetInfo("newExit",exitSet[1],setConfig)],mergedEnter:getSetInfo("mergedEnter",getMergedSet(entrySet),setConfig),mergedExit:getSetInfo("mergedExit",getMergedSet(exitSet),setConfig),completeSet:getSetInfo("complete",completeSet,setConfig),isSourceFieldPresent:propagationInf.isSourceFieldPresent,fields:function getSourceFields(propagationInf){var criteria=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},sourceIdentifiers=propagationInf.sourceIdentifiers;return sourceIdentifiers?sourceIdentifiers.getSchema().map(function(d){return d.name}):criteria instanceof Array?criteria[0]:Object.keys(criteria||{})}(propagationInf,payload.criteria),sourceSelectionSet:!0===selectionSet._volatile}}},{key:"enable",value:function enable(){this._enabled=!0}},{key:"disable",value:function disable(){this._enabled=!1}},{key:"isEnabled",value:function isEnabled(){return this._enabled}}],[{key:"mutates",value:function mutates(){return!1}}]),GenericBehaviour}();function volatile_typeof(obj){return(volatile_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function volatile_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){return!call||"object"!==volatile_typeof(call)&&"function"!=typeof call?function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var volatile_VolatileBehaviour=function(_GenericBehaviour){function VolatileBehaviour(){return function volatile_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VolatileBehaviour),_possibleConstructorReturn(this,_getPrototypeOf(VolatileBehaviour).apply(this,arguments))}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(VolatileBehaviour,generic_GenericBehaviour),function volatile_createClass(Constructor,protoProps,staticProps){return protoProps&&volatile_defineProperties(Constructor.prototype,protoProps),staticProps&&volatile_defineProperties(Constructor,staticProps),Constructor}(VolatileBehaviour,[{key:"setSelectionSet",value:function setSelectionSet(addSet,selectionSet){if(null===addSet)selectionSet.reset();else if(addSet.length){var existingAddSet=addSet.filter(function(d){return selectionSet._set[d]===SELECTION_NEW_ENTRY||selectionSet._set[d]===SELECTION_OLD_ENTRY});selectionSet.updateExit();var entrySet=selectionSet.getSets().entrySet;selectionSet.reset(getMergedSet(entrySet)),selectionSet.add(addSet),selectionSet.update(existingAddSet)}else selectionSet.remove(selectionSet.getCompleteSet())}}]),VolatileBehaviour}(),BRUSH="brush",HIGHLIGHT="highlight",TOOLTIP="tooltip",FILTER="filter",SELECT="select";function highlight_typeof(obj){return(highlight_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function highlight_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function highlight_possibleConstructorReturn(self,call){return!call||"object"!==highlight_typeof(call)&&"function"!=typeof call?function highlight_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function highlight_getPrototypeOf(o){return(highlight_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function highlight_setPrototypeOf(o,p){return(highlight_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var highlight_HighlightBehaviour=function(_VolatileBehaviour){function HighlightBehaviour(){return function highlight_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightBehaviour),highlight_possibleConstructorReturn(this,highlight_getPrototypeOf(HighlightBehaviour).apply(this,arguments))}return function highlight_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&highlight_setPrototypeOf(subClass,superClass)}(HighlightBehaviour,volatile_VolatileBehaviour),function highlight_createClass(Constructor,protoProps,staticProps){return protoProps&&highlight_defineProperties(Constructor.prototype,protoProps),staticProps&&highlight_defineProperties(Constructor,staticProps),Constructor}(HighlightBehaviour,null,[{key:"formalName",value:function formalName(){return HIGHLIGHT}}]),HighlightBehaviour}();function brush_typeof(obj){return(brush_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function brush_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function brush_possibleConstructorReturn(self,call){return!call||"object"!==brush_typeof(call)&&"function"!=typeof call?function brush_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function brush_getPrototypeOf(o){return(brush_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function brush_setPrototypeOf(o,p){return(brush_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var brush_BrushBehaviour=function(_VolatileBehaviour){function BrushBehaviour(){return function brush_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BrushBehaviour),brush_possibleConstructorReturn(this,brush_getPrototypeOf(BrushBehaviour).apply(this,arguments))}return function brush_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&brush_setPrototypeOf(subClass,superClass)}(BrushBehaviour,volatile_VolatileBehaviour),function brush_createClass(Constructor,protoProps,staticProps){return protoProps&&brush_defineProperties(Constructor.prototype,protoProps),staticProps&&brush_defineProperties(Constructor,staticProps),Constructor}(BrushBehaviour,null,[{key:"formalName",value:function formalName(){return BRUSH}}]),BrushBehaviour}();function filter_typeof(obj){return(filter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function filter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function filter_possibleConstructorReturn(self,call){return!call||"object"!==filter_typeof(call)&&"function"!=typeof call?function filter_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function filter_getPrototypeOf(o){return(filter_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function filter_setPrototypeOf(o,p){return(filter_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var filter_FilterBehaviour=function(_VolatileBehaviour){function FilterBehaviour(){return function filter_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FilterBehaviour),filter_possibleConstructorReturn(this,filter_getPrototypeOf(FilterBehaviour).apply(this,arguments))}return function filter_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&filter_setPrototypeOf(subClass,superClass)}(FilterBehaviour,volatile_VolatileBehaviour),function filter_createClass(Constructor,protoProps,staticProps){return protoProps&&filter_defineProperties(Constructor.prototype,protoProps),staticProps&&filter_defineProperties(Constructor,staticProps),Constructor}(FilterBehaviour,null,[{key:"formalName",value:function formalName(){return FILTER}},{key:"mutates",value:function mutates(){return!0}}]),FilterBehaviour}();function persistent_typeof(obj){return(persistent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function persistent_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function persistent_possibleConstructorReturn(self,call){return!call||"object"!==persistent_typeof(call)&&"function"!=typeof call?function persistent_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function persistent_getPrototypeOf(o){return(persistent_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function persistent_setPrototypeOf(o,p){return(persistent_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var persistent_PersistentBehaviour=function(_GenericBehaviour){function PersistentBehaviour(){return function persistent_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PersistentBehaviour),persistent_possibleConstructorReturn(this,persistent_getPrototypeOf(PersistentBehaviour).apply(this,arguments))}return function persistent_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&persistent_setPrototypeOf(subClass,superClass)}(PersistentBehaviour,generic_GenericBehaviour),function persistent_createClass(Constructor,protoProps,staticProps){return protoProps&&persistent_defineProperties(Constructor.prototype,protoProps),staticProps&&persistent_defineProperties(Constructor,staticProps),Constructor}(PersistentBehaviour,[{key:"setSelectionSet",value:function setSelectionSet(addSet,selectionSet){if(null===addSet)selectionSet.reset();else if(addSet.length){var propagationInf=this.firebolt.getPropagationInf(),existingAddSet=addSet.filter(function(d){return selectionSet._set[d]===SELECTION_NEW_ENTRY||selectionSet._set[d]===SELECTION_OLD_ENTRY});if(!1===propagationInf.propagate){selectionSet.updateExit();var entrySet=selectionSet.getSets().entrySet;selectionSet.reset(getMergedSet(entrySet)),selectionSet.add(addSet),selectionSet.update(existingAddSet)}else{existingAddSet.length?(selectionSet.updateExit(),selectionSet.remove(existingAddSet)):(selectionSet.updateEntry(),selectionSet.add(addSet));var exitSet=selectionSet.getSets().exitSet,mergedExitSet=getMergedSet(exitSet),completeSetCount=selectionSet.getCompleteSet().length;mergedExitSet.length===completeSetCount&&selectionSet.reset()}}else selectionSet.remove(selectionSet.getCompleteSet());return this}}]),PersistentBehaviour}();function select_typeof(obj){return(select_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function select_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function select_possibleConstructorReturn(self,call){return!call||"object"!==select_typeof(call)&&"function"!=typeof call?function select_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function select_getPrototypeOf(o){return(select_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function select_setPrototypeOf(o,p){return(select_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var _physicalActions,select_SelectBehaviour=function(_PersistentBehaviour){function SelectBehaviour(){return function select_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectBehaviour),select_possibleConstructorReturn(this,select_getPrototypeOf(SelectBehaviour).apply(this,arguments))}return function select_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&select_setPrototypeOf(subClass,superClass)}(SelectBehaviour,persistent_PersistentBehaviour),function select_createClass(Constructor,protoProps,staticProps){return protoProps&&select_defineProperties(Constructor.prototype,protoProps),staticProps&&select_defineProperties(Constructor,staticProps),Constructor}(SelectBehaviour,null,[{key:"formalName",value:function formalName(){return SELECT}}]),SelectBehaviour}(),drag_action_config=function getDragActionConfig(sourceInfo,config,fieldsConfig){if(!sourceInfo.axes.x&&!sourceInfo.axes.y)return{criteria:null};var axes=sourceInfo.axes,xAxis=axes.x[0],yAxis=axes.y[0],axisFields=sourceInfo.fields,xField=axisFields.x[0].getMembers()[0],yField=axisFields.y[0].getMembers()[0],xFieldType=fieldsConfig[xField].def.subtype,yFieldType=fieldsConfig[yField].def.subtype,dimensions={},stPos=config.startPos,endPos=config.endPos;if(stPos.x===endPos.x&&stPos.y===endPos.y)return{criteria:null};var dragDim=xFieldType===dist_datamodel.MeasureSubtype.CONTINUOUS?yFieldType===dist_datamodel.MeasureSubtype.CONTINUOUS?["x","y"]:["y"]:["x"],criteria={},isXDimension=xFieldType===dist_datamodel.DimensionSubtype.CATEGORICAL,isYDimension=yFieldType===dist_datamodel.DimensionSubtype.CATEGORICAL,xRange="band"===xAxis.constructor.type()?xAxis.scale().invertExtent(stPos.x,endPos.x):xAxis.invert(stPos.x,endPos.x),yRange="band"===yAxis.constructor.type()?yAxis.scale().invertExtent(stPos.y,endPos.y):yAxis.invert(stPos.y,endPos.y),selectedDomains={x:stPos.x===endPos.x?[]:isXDimension?xRange:xRange.sort(function(a,b){return a-b}),y:stPos.y===endPos.y?[]:isYDimension?yRange:yRange.sort(function(a,b){return a-b})},rangeObj={};if(2===dragDim.length){if(rangeObj[xField]=selectedDomains.x,rangeObj[yField]=selectedDomains.y,xField===yField){var xdom=selectedDomains.x,ydom=selectedDomains.y,min=xdom[0]>ydom[0]?ydom:xdom,max=min===ydom?xdom:ydom;min[1]<max[0]?rangeObj[xField]=[]:rangeObj[xField]=[max[0],min[1]<max[1]?min[1]:max[1]],dimensions.x=[stPos.x,endPos.x],dimensions.y=[stPos.y,endPos.y]}}else criteria[dragDim[0]]=selectedDomains[dragDim[0]]||[],"x"===dragDim[0]?(rangeObj[xField]=criteria.x,xFieldType===dist_datamodel.DimensionSubtype.CATEGORICAL&&(dimensions.x=config.snap&&stPos.x!==endPos.x?xAxis.getNearestRange(stPos.x,endPos.x):[stPos.x,endPos.x])):(rangeObj[yField]=criteria.y,yFieldType===dist_datamodel.DimensionSubtype.CATEGORICAL&&(dimensions.y=config.snap&&stPos.y!==endPos.y?yAxis.getNearestRange(stPos.y,endPos.y):[stPos.y,endPos.y]));return{criteria:rangeObj,dimensions:dimensions}},drag_event_attachDragEvent=function attachDragEvent(targetEl,behaviours,firebolt,touch){var drawingInf,touchStart,startPos={},endPos={},d3Drag=renderer_utils_getD3Drag();targetEl.call(d3Drag().on("start",function(){var event=renderer_utils_getEvent();startPos={x:event.x,y:event.y},drawingInf=firebolt.context.getDrawingContext(),touchStart=(new Date).getTime()}).on("drag",function(){var event=renderer_utils_getEvent();if(endPos={x:event.x,y:event.y},!(touch&&Math.abs(startPos.x-endPos.x)<=5)){endPos.x=Math.max(0,Math.min(endPos.x,drawingInf.width)),endPos.y=Math.max(0,Math.min(endPos.y,drawingInf.height));var payload=drag_action_config(firebolt.context.getSourceInfo(),{startPos:startPos,endPos:endPos},firebolt.context.data().getFieldsConfig());behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,payload)})}}).on("end",function(){var event=renderer_utils_getEvent();endPos={x:event.x,y:event.y};var duration=(new Date).getTime()-touchStart;if(!(touch&&duration>100&&Math.abs(startPos.x-endPos.x)<=5)){endPos.x=Math.max(0,Math.min(endPos.x,drawingInf.width)),endPos.y=Math.max(0,Math.min(endPos.y,drawingInf.height));var payload=drag_action_config(firebolt.context.getSourceInfo(),{startPos:startPos,endPos:endPos,snap:!0},firebolt.context.data().getFieldsConfig());payload.dragEnd=!0,behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,payload)})}}))},physical_hover=function hover(firebolt){return function(targetEl,behaviours){var dispatchBehaviour=function dispatchBehaviour(args){var event=renderer_utils_getEvent(),context=firebolt.context,mode=context.config().interaction.tooltip.mode,pos=renderer_utils_getClientPoint(context.getDrawingContext().svgContainer,event),nearestPoint=context.getNearestPoint(pos.x,pos.y,{getAllPoints:"consolidated"===mode||"fragmented"===mode,data:args,event:event}),payload={criteria:nearestPoint?nearestPoint.id:null,showInPosition:nearestPoint.showInPosition,target:nearestPoint.target,position:pos,mode:mode};behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,payload)}),event.stopPropagation()};targetEl.on("mouseover",dispatchBehaviour).on("mousemove",dispatchBehaviour).on("mouseout",function(){behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,{criteria:null})})})}},helpers_generatePayloadFromEvent=function generatePayloadFromEvent(args,event,firebolt){var context=firebolt.context,pos=renderer_utils_getClientPoint(context.getDrawingContext().svgContainer,event.touches?event.touches[0]:event),nearestPoint=context.getNearestPoint(pos.x,pos.y,{data:args,event:event});return{criteria:nearestPoint?nearestPoint.id:null,showInPosition:nearestPoint.showInPosition,target:nearestPoint.target,position:pos}},physical_click=function click(firebolt){return function(targetEl,behaviours){targetEl.on("click",function dispatchBehaviour(args){var event=renderer_utils_getEvent(),payload=helpers_generatePayloadFromEvent(args,event,firebolt);behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,payload)}),event.stopPropagation()})}};function physical_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var physicalActions=(physical_defineProperty(_physicalActions={},DRAG,function drag(firebolt){return function(targetEl,behaviours){drag_event_attachDragEvent(targetEl,behaviours,firebolt)}}),physical_defineProperty(_physicalActions,HOVER,physical_hover),physical_defineProperty(_physicalActions,CLICK,physical_click),physical_defineProperty(_physicalActions,LONGTOUCH,function longtouch(firebolt){return function(targetEl,behaviours){var event,touchEnd;touchEnd=!1,event=renderer_utils_getEvent(),targetEl.on("touchstart",function(args){event=renderer_utils_getEvent(),touchEnd=!1,setTimeout(function(){touchEnd?behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,{criteria:null})}):function dispatchBehaviour(args){var payload=helpers_generatePayloadFromEvent(args,event,firebolt);behaviours.forEach(function(beh){return firebolt.dispatchBehaviour(beh,payload)}),event.stopPropagation()}(args)},100)}).on("touchend",function(){touchEnd=!0})}}),physical_defineProperty(_physicalActions,TOUCHDRAG,function touchdrag(firebolt){return function(targetEl,behaviours){drag_event_attachDragEvent(targetEl,behaviours,firebolt,!0)}}),_physicalActions);function generic_sideeffect_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var generic=function(){function GenericSideEffect(firebolt){!function generic_sideeffect_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GenericSideEffect),this.firebolt=firebolt,this._enabled=!0,this._strategy="default",this._config={},this._id=getUniqueId(),this._strategies={},this.config(this.constructor.defaultConfig())}return function generic_sideeffect_createClass(Constructor,protoProps,staticProps){return protoProps&&generic_sideeffect_defineProperties(Constructor.prototype,protoProps),staticProps&&generic_sideeffect_defineProperties(Constructor,staticProps),Constructor}(GenericSideEffect,[{key:"config",value:function config(){return arguments.length?(this._config=mergeRecursive(this._config,arguments.length<=0?void 0:arguments[0]),this):this._config}},{key:"disable",value:function disable(){return this._enabled=!1,this}},{key:"enable",value:function enable(){return this._enabled=!0,this}},{key:"isEnabled",value:function isEnabled(){return this._enabled}},{key:"apply",value:function apply(){return this}},{key:"addStrategy",value:function addStrategy(name,fn){return this._strategies[name]=fn,this}}],[{key:"defaultConfig",value:function defaultConfig(){return{}}},{key:"formalName",value:function formalName(){return"generic"}},{key:"target",value:function target(){return"all"}},{key:"mutates",value:function mutates(){return!1}}]),GenericSideEffect}();function surrogate_typeof(obj){return(surrogate_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function surrogate_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function surrogate_possibleConstructorReturn(self,call){return!call||"object"!==surrogate_typeof(call)&&"function"!=typeof call?function surrogate_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function surrogate_getPrototypeOf(o){return(surrogate_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function surrogate_setPrototypeOf(o,p){return(surrogate_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var SurrogateSideEffect=function(_GenericSideEffect){function SurrogateSideEffect(){return function surrogate_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SurrogateSideEffect),surrogate_possibleConstructorReturn(this,surrogate_getPrototypeOf(SurrogateSideEffect).apply(this,arguments))}return function surrogate_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&surrogate_setPrototypeOf(subClass,superClass)}(SurrogateSideEffect,generic),function surrogate_createClass(Constructor,protoProps,staticProps){return protoProps&&surrogate_defineProperties(Constructor.prototype,protoProps),staticProps&&surrogate_defineProperties(Constructor,staticProps),Constructor}(SurrogateSideEffect,[{key:"applyInteractionStyle",value:function applyInteractionStyle(set){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var interactionType=arguments.length>2?arguments[2]:void 0,apply=arguments.length>3?arguments[3]:void 0;return this.firebolt.context.layers().forEach(function(layer){return!1!==layer.config().interactive&&layer.applyInteractionStyle(interactionType,set.uids,apply)}),this}}]),SurrogateSideEffect}();function spawnable_typeof(obj){return(spawnable_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function spawnable_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function spawnable_possibleConstructorReturn(self,call){return!call||"object"!==spawnable_typeof(call)&&"function"!=typeof call?function spawnable_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function spawnable_getPrototypeOf(o){return(spawnable_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function spawnable_setPrototypeOf(o,p){return(spawnable_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var spawnable_SpawnableSideEffect=function(_GenericSideEffect){function SpawnableSideEffect(){return function spawnable_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SpawnableSideEffect),spawnable_possibleConstructorReturn(this,spawnable_getPrototypeOf(SpawnableSideEffect).apply(this,arguments))}return function spawnable_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&spawnable_setPrototypeOf(subClass,superClass)}(SpawnableSideEffect,generic),function spawnable_createClass(Constructor,protoProps,staticProps){return protoProps&&spawnable_defineProperties(Constructor.prototype,protoProps),staticProps&&spawnable_defineProperties(Constructor,staticProps),Constructor}(SpawnableSideEffect,[{key:"createElement",value:function createElement(container,elemType,data,className,callbacks){return makeElement(container,elemType,data,className,callbacks)}},{key:"drawingContext",value:function drawingContext(){return arguments.length?(this._drawingContext=arguments.length<=0?void 0:arguments[0],this):this._drawingContext()}},{key:"show",value:function show(){return this}},{key:"hide",value:function hide(){return this}}]),SpawnableSideEffect}();__webpack_require__(9);function helper_slicedToArray(arr,i){return function helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var helper_changeVisibility=function changeVisibility(context,sideEffectGroup,visible){var config=context.config(),className=config.defClassName,classPrefix=config.classPrefix;renderer_utils_selectElement(sideEffectGroup).selectAll(".".concat(classPrefix,"-").concat(className)).style("display",visible?"block":"none")};function selection_box_typeof(obj){return(selection_box_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function selection_box_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function selection_box_possibleConstructorReturn(self,call){return!call||"object"!==selection_box_typeof(call)&&"function"!=typeof call?function selection_box_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function selection_box_getPrototypeOf(o){return(selection_box_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function selection_box_setPrototypeOf(o,p){return(selection_box_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var selection_box=function(_SpawnableSideEffect){function SelectionBox(){return function selection_box_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectionBox),selection_box_possibleConstructorReturn(this,selection_box_getPrototypeOf(SelectionBox).apply(this,arguments))}return function selection_box_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&selection_box_setPrototypeOf(subClass,superClass)}(SelectionBox,spawnable_SpawnableSideEffect),function selection_box_createClass(Constructor,protoProps,staticProps){return protoProps&&selection_box_defineProperties(Constructor.prototype,protoProps),staticProps&&selection_box_defineProperties(Constructor,staticProps),Constructor}(SelectionBox,[{key:"apply",value:function apply(selectionSet,payload){var x,y,width,height,config=this._config,boxConf=config.box,firebolt=this.firebolt,drawingInf=this.drawingContext(),mountPoint=drawingInf.sideEffectGroup,unitWidth=drawingInf.width,unitHeight=drawingInf.height,classPrefix=config.classPrefix,selectionGroupClassName=config.defClassName;if(null===payload.criteria)return this.hide(drawingInf),this;var sourceInf=firebolt.context.getSourceInfo(),_getBoxDimensionsFrom=function getBoxDimensionsFromPayload(payload,axes,axisFields){var x1,x2,y1,y2,xRange,yRange,direction,criteria=payload.criteria,dimensions=payload.dimensions||{},xDim=dimensions.x,yDim=dimensions.y;if(null===criteria)return null;var xAxis=axes.x[0],yAxis=axes.y[0],xLinear="linear"===xAxis.constructor.type(),yLinear="linear"===yAxis.constructor.type(),xField="".concat(axisFields.x[0]),yField="".concat(axisFields.y[0]),xCriteria=criteria[xField],yCriteria=criteria[yField];if(xCriteria&&xCriteria[0]instanceof Array?(xRange=xCriteria[0],yRange=xCriteria[1]):(xRange=xCriteria||[],yRange=yCriteria||[]),direction=xCriteria&&yCriteria?"both":xCriteria?"vertical":"horizontal",xRange&&xRange.length)if("band"===yAxis.constructor.type()&&xLinear)x1=x2=void 0,direction="horizontal";else{var x1Val,x2Val,domain=xAxis.domain(),bandScale="band"===xAxis.constructor.type();if(bandScale){var x1DomainIndex=domain.indexOf(xRange[0]),x2DomainIndex=domain.indexOf(xRange[xRange.length-1]),_sort2=helper_slicedToArray([x1DomainIndex,x2DomainIndex].sort(function(a,b){return a-b}),2);x1DomainIndex=_sort2[0],x2DomainIndex=_sort2[1],x1Val=domain[x1DomainIndex],x2Val=domain[x2DomainIndex]}else x1Val=xRange[0],x2Val=xRange[xRange.length-1];x1=xAxis.getScaleValue(x1Val),x2=xAxis.getScaleValue(x2Val),x2+=bandScale?xAxis.getUnitWidth():0}else x1=x2=void 0;if(yRange&&yRange.length)if("band"===xAxis.constructor.type()&&yLinear)y1=y2=void 0,direction="vertical";else{var y1Val,y2Val,_domain=yAxis.domain();if("band"===yAxis.constructor.type()){var y1DomainIndex=_domain.indexOf(yRange[0]),y2DomainIndex=_domain.indexOf(yRange[yRange.length-1]),_sort4=helper_slicedToArray([y1DomainIndex,y2DomainIndex].sort(function(a,b){return b-a}),2);y1DomainIndex=_sort4[0],y2DomainIndex=_sort4[1],y1Val=_domain[y1DomainIndex],y2Val=_domain[y2DomainIndex]}else y1Val=yRange[0],y2Val=yRange[yRange.length-1];y1=yAxis.getScaleValue(y1Val),y2=yAxis.getScaleValue(y2Val),y2+="band"===yAxis.constructor.type()?yAxis.getUnitWidth():0}else y1=y2=void 0;if(yLinear&&xLinear||!payload.dragEnd){if(xDim){var _xDim=helper_slicedToArray(xDim,2);x1=_xDim[0],x2=_xDim[1]}if(yDim){var _yDim=helper_slicedToArray(yDim,2);y1=_yDim[0],y2=_yDim[1]}}return{dimension:{x1:x1,x2:x2,y1:y1,y2:y2},direction:direction}}(payload,sourceInf.axes,sourceInf.fields),dimension=_getBoxDimensionsFrom.dimension,direction=_getBoxDimensionsFrom.direction,transition=payload.dragEnd&&config.transition;"both"===direction||"vertical"===direction?(x=Math.min(dimension.x1,dimension.x2),width=Math.abs(dimension.x2-dimension.x1)):(x=0,width=unitWidth),"both"===direction||"horizontal"===direction?(y=Math.min(dimension.y1,dimension.y2),height=Math.abs(dimension.y2-dimension.y1)):(height=unitHeight,y=0),this.show(drawingInf);var points=[{x:x,y:y,width:width,height:height}],sideEffect=this,selection=makeElement(renderer_utils_selectElement(mountPoint),"g",[1],".".concat(classPrefix,"-").concat(selectionGroupClassName)).selectAll("rect").data(points),selectionBox=selection.enter().append("rect").each(function(){!function selectionBoxDrag(firebolt){return function(targetEl,behaviours){var subject,drawingInf,context=firebolt.context,onDrag=function onDrag(payload){behaviours.forEach(function(action){return firebolt.dispatchBehaviour(action,payload)})},d3Drag=renderer_utils_getD3Drag();targetEl.call(d3Drag().on("start",function(){var event=renderer_utils_getEvent();drawingInf=context.getDrawingContext(),subject=event.subject}).on("drag",function(){var event=renderer_utils_getEvent();subject.x+=event.dx,subject.y+=event.dy;var width=drawingInf.width,height=drawingInf.height,x=Math.min(width-subject.width,Math.max(subject.x,0)),y=Math.min(height-subject.height,Math.max(subject.y,0)),y2=y+subject.height,x2=x+subject.width;if(x>=0&&x2<=width&&y>=0&&y2<=height){var payload=drag_action_config(context.getSourceInfo(),{startPos:{x:x,y:y},endPos:{x:x2,y:y2}},context.data().getFieldsConfig());onDrag(payload)}}).on("end",function(){var width=drawingInf.width,height=drawingInf.height,x=Math.min(width-subject.width,Math.max(subject.x,0)),y=Math.min(height-subject.height,Math.max(subject.y,0)),y2=y+subject.height,x2=x+subject.width;if(x>=0&&x2<=width&&y>=0&&y2<=height){var payload=drag_action_config(context.getSourceInfo(),{startPos:{x:x,y:y},endPos:{x:x2,y:y2},snap:!0},context.data().getFieldsConfig());payload.dragEnd=!0,onDrag(payload)}}))}}(firebolt)(renderer_utils_selectElement(this),["brush"],sideEffect)}).merge(selection).each(function(attrs){var element=renderer_utils_selectElement(this);for(var key in transition&&(element=element.transition().duration(transition.duration)),attrs)({}).hasOwnProperty.call(attrs,key)&&isValidValue(attrs[key])&&element.attr(key,attrs[key])}),boxClassName=getQualifiedClassName(boxConf.defClassName,this._id,classPrefix);return selectionBox.classed(boxClassName.join(" "),!0),selectionBox.classed(boxConf.className,!0),this}},{key:"hide",value:function hide(drawingInf){helper_changeVisibility(this,drawingInf.sideEffectGroup,!1)}},{key:"show",value:function show(drawingInf){helper_changeVisibility(this,drawingInf.sideEffectGroup,!0)}}],[{key:"defaultConfig",value:function defaultConfig(){return{defClassName:"selection-box-group",className:"",classPrefix:"muze",box:{defClassName:"selection-box",className:""},transition:{duration:200}}}},{key:"formalName",value:function formalName(){return"selectionBox"}}]),SelectionBox}(),INITIAL_STYLE={position:"absolute",width:0,height:0},default_config_defaultConfig={classPrefix:"muze",defClassName:"tooltip-box",connectorClassName:"tooltip-connectors",className:"",row:{margin:0},content:{spacing:5,iconContainerSize:10,iconScale:1,iconShape:"circle",iconColor:"#ff0000",rowMargin:"0px",margin:10,separator:":",className:"tooltip-content-container",parentClassName:"tooltip-content-parent-container"},arrow:{size:10,disabled:!1,defClassName:"tooltip-arrow",className:"",color:"rgba(195,195,195,0.85)"}},helper_getArrowPos=function getArrowPos(orient,dim,measurement,config){var arrowPos,x=measurement.x,y=measurement.y,boxHeight=measurement.boxHeight,boxWidth=measurement.boxWidth,arrowWidth=config.arrow.disabled?0:config.arrow.size;if("left"===orient||"right"===orient){var start=0,diff=boxHeight/2,plotBottom=dim.y+dim.height,boxBottom=y+boxHeight;dim.y>y?(start=dim.y-y,diff=(plotBottom>=boxBottom?boxBottom-dim.y:dim.height)/2):boxBottom>plotBottom&&(diff=Math.abs(y-(dim.y+dim.height))/2),arrowPos=start+diff-arrowWidth/2}else{var _start=0,_diff=boxWidth/2,plotRight=dim.x+dim.width,boxRight=x+boxWidth;dim.x>x?(_start=dim.x-x,_diff=(plotRight>=boxRight?boxRight-dim.x:dim.width)/2):boxRight>plotRight&&(_diff=Math.abs(x-(dim.x+dim.width))/2),arrowPos=_start+_diff-arrowWidth/2}return arrowPos},helper_placeArrow=function placeArrow(context,position,arrowPos){var tooltipArrow=context._tooltipArrow,tooltipBackground=context._tooltipBackground,config=context._config,classPrefix=config.classPrefix,arrowConf=config.arrow,className=getQualifiedClassName(arrowConf.defClassName,context._id,config.classPrefix);tooltipArrow.style("display","block"),tooltipArrow.attr("class","".concat(className.join(" "))),"left"===position||"right"===position?(tooltipArrow.style("top","".concat(arrowPos,"px")),tooltipArrow.style("left",""),tooltipBackground.style("top","".concat(arrowPos,"px")),tooltipBackground.style("left","")):("bottom"===position?tooltipArrow.style("top","100%"):tooltipArrow.style("top","-".concat(arrowConf.size,"px")),tooltipArrow.style("left","".concat(arrowPos,"px")),"bottom"===position?tooltipBackground.style("top","100%"):tooltipBackground.style("top","-".concat(arrowConf.size+3,"px")),tooltipBackground.style("left","".concat(arrowPos,"px"))),tooltipArrow.classed("".concat(classPrefix,"-tooltip-arrow"),!0),tooltipArrow.classed("".concat(classPrefix,"-tooltip-arrow-").concat(context._arrowOrientation),!1),tooltipArrow.classed("".concat(classPrefix,"-tooltip-arrow-").concat(position),!0),tooltipBackground.classed("".concat(classPrefix,"-tooltip-background-arrow"),!0),tooltipBackground.classed("".concat(classPrefix,"-tooltip-background-arrow-").concat(context._arrowOrientation),!1),tooltipBackground.classed("".concat(classPrefix,"-tooltip-background-arrow-").concat(position),!0)};__webpack_require__(10);function _construct(Parent,args,Class){return(_construct=function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&strategy_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function strategy_setPrototypeOf(o,p){return(strategy_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function strategy_toConsumableArray(arr){return function strategy_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function strategy_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function strategy_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function strategy_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var strategy_formatters=function formatters(formatter){var _ref;return strategy_defineProperty(_ref={},dist_datamodel.DimensionSubtype.TEMPORAL,function(value,interval){return common_utils_formatTemporal(value,interval)}),strategy_defineProperty(_ref,dist_datamodel.MeasureSubtype.CONTINUOUS,function(value){return formatter(value?value.toFixed(2):value)}),strategy_defineProperty(_ref,dist_datamodel.DimensionSubtype.CATEGORICAL,function(value){return value}),_ref},strategy_getDefaultTooltipFormatterFn=function getDefaultTooltipFormatterFn(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:strategy_formatters()[dist_datamodel.DimensionSubtype.CATEGORICAL]},strategy_buildTooltipData=function buildTooltipData(dataModel){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},context=arguments.length>2?arguments[2]:void 0,fieldValues=[],dataObj=dataModel.getData(),data=dataObj.data,schema=dataObj.schema,separator=config.separator,fieldsConfig=dataModel.getFieldsConfig(),fieldspace=dataModel.getFieldspace(),dimensionMeasureMap=context.dimensionMeasureMap,axes=context.axes,detailFields=context.detailFields||[],dimensions=schema.filter(function(d){return d.type===dist_datamodel.FieldType.DIMENSION}),measures=schema.filter(function(d){return d.type===dist_datamodel.FieldType.MEASURE}),containsDetailField=schema.find(function(d){return-1!==detailFields.indexOf(d.name)}),timeDiffs=context.timeDiffs,dataLen=data.length,getRowContent=function getRowContent(field,type){var value,formattedValue,measureIndex,values=[],index=fieldsConfig[field].index,interval=fieldsConfig[field].def.subtype===dist_datamodel.DimensionSubtype.TEMPORAL?timeDiffs[field]:0,formatterFn=strategy_getDefaultTooltipFormatterFn(strategy_formatters(function(val){return val})[type]);if(null!==value){var uniqueVals=type===dist_datamodel.MeasureSubtype.CONTINUOUS?data.map(function(d){return d[index]}):strategy_toConsumableArray(new Set(data.map(function(d){return d[index]})));uniqueVals=uniqueVals.filter(function(d){return""!==d});var colorAxis=axes.color[0],shapeAxis=axes.shape[0],sizeAxis=axes.size[0],isRetinalField=(colorAxis||shapeAxis||sizeAxis)&&dataLen>1&&type!==dist_datamodel.MeasureSubtype.CONTINUOUS;uniqueVals.forEach(function(val,i){var key,associatedMeasures=dimensionMeasureMap[field];if(associatedMeasures&&associatedMeasures.length&&dataLen>1){key=val;var icon={value:""};if(isRetinalField&&(icon={type:"icon",color:colorAxis.getColor(val),shape:shapeAxis.getShape(val),size:sizeAxis.getSize(val)*config.iconScale}),associatedMeasures.length>1){var formattedKey=type===dist_datamodel.DimensionSubtype.TEMPORAL?formatterFn(key,interval):key;values.push([icon,"".concat(formattedKey)]),associatedMeasures.forEach(function(measure){measureIndex=fieldsConfig[measure].index,value=data[i][measureIndex];var numberFormat=fieldspace.fields[measureIndex].numberFormat(),measureFormatter=strategy_getDefaultTooltipFormatterFn(strategy_formatters(numberFormat)[dist_datamodel.MeasureSubtype.CONTINUOUS]);formattedValue=measureFormatter(value,interval),values.push([{value:"".concat(measure).concat(separator),style:{"margin-left":"".concat(config.margin,"px}")},className:"".concat(config.classPrefix,"-tooltip-key")},{value:"".concat(formattedValue),className:"".concat(config.classPrefix,"-tooltip-value")}])})}else{measureIndex=fieldsConfig[associatedMeasures[0]].index,value=data[i][measureIndex];var numberFormat=fieldspace.fields[measureIndex].numberFormat(),measureFormatter=strategy_getDefaultTooltipFormatterFn(strategy_formatters(numberFormat)[dist_datamodel.MeasureSubtype.CONTINUOUS]);formattedValue=measureFormatter(value,interval);var _formattedKey=type===dist_datamodel.DimensionSubtype.TEMPORAL?formatterFn(key,interval):key;values.push([icon,{value:"".concat(_formattedKey),className:"".concat(config.classPrefix,"-tooltip-key")},{value:"".concat(formattedValue),className:"".concat(config.classPrefix,"-tooltip-value")}])}}else key=field,formattedValue=formatterFn(value=val,interval),values.push([{value:"".concat(key).concat(separator),className:"".concat(config.classPrefix,"-tooltip-key")},{value:"".concat(formattedValue),className:"".concat(config.classPrefix,"-tooltip-value")}])})}return values},displayFormat="keyValue";if(dataLen>1&&containsDetailField)fieldValues=function getTabularData(data,schema,fieldspace,timeDiffs){var rows=[];return rows.push(schema.map(function(d){return d.name})),data.forEach(function(d){var row=[];schema.forEach(function(fieldObj,i){var interval=fieldObj.subtype===dist_datamodel.DimensionSubtype.TEMPORAL?timeDiffs[fieldObj.name]:0,numberFormat=fieldObj.type===dist_datamodel.FieldType.MEASURE&&fieldspace.fields[i].numberFormat(),value=strategy_getDefaultTooltipFormatterFn(strategy_formatters(numberFormat)[fieldObj.subtype])(d[i],interval);row.push(value)}),rows.push(row)}),rows}(data,schema,fieldspace,timeDiffs),displayFormat="table";else{dimensions.forEach(function(item){var type=item.subtype?item.subtype:item.type;fieldValues=[].concat(strategy_toConsumableArray(fieldValues),strategy_toConsumableArray(getRowContent(item.name,type)))});var allMeasures=strategy_toConsumableArray(_construct(Set,strategy_toConsumableArray(Object.values(dimensionMeasureMap))));(dataLen>1?measures.filter(function(d){return-1===allMeasures.indexOf(d.name)}):measures).forEach(function(item){var type=item.subtype?item.subtype:item.type;fieldValues=[].concat(strategy_toConsumableArray(fieldValues),strategy_toConsumableArray(getRowContent(item.name,type)))})}return{content:fieldValues,displayFormat:displayFormat}},strategy_strategy={keyValue:function keyValue(data,config,context){return strategy_buildTooltipData(data,config,context)}},DEFAULT_STRATEGY="keyValue";function content_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var content_Content=function(){function Content(){!function content_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Content),this._model=null,this._strategy=DEFAULT_STRATEGY,this._formatter=null,this._config=this.constructor.defaultConfig()}return function content_createClass(Constructor,protoProps,staticProps){return protoProps&&content_defineProperties(Constructor.prototype,protoProps),staticProps&&content_defineProperties(Constructor,staticProps),Constructor}(Content,[{key:"config",value:function config(){return arguments.length>0?(this._config=mergeRecursive(this._config,arguments.length<=0?void 0:arguments[0]),this):this._config}},{key:"update",value:function update(item){return this._model=item.model,this._strategy=void 0!==item.strategy?item.strategy:DEFAULT_STRATEGY,this._formatter=item.formatter,this}},{key:"context",value:function context(ctx){return this._context=ctx,this}},{key:"render",value:function render(mount){var data,config=this._config,iconContainerSize=config.iconContainerSize,formatter=this._formatter,rowMargin=config.rowMargin,model=this._model;if(this._mount=mount,(data=model instanceof Array?model:formatter instanceof Function?formatter(this._model,this._context):strategy_strategy[this._strategy](this._model,this.config(),this._context))instanceof Function)mount.html(data());else{var content=data,displayFormat="default";isSimpleObject(data)&&(content=data.content,displayFormat=data.displayFormat);var body=makeElement(mount,"div",[displayFormat],"".concat(config.classPrefix,"-tooltip-content"),{},function(d){return d});if("table"===displayFormat){var table=makeElement(body,"table",[1],"".concat(config.classPrefix,"-tooltip-table")),tbody=makeElement(table,"tbody",[1],"".concat(config.classPrefix,"-tooltip-table-tbody")),rows=makeElement(tbody,"tr",content,"".concat(config.classPrefix,"-tooltip-table-row"));rows.each(function(d,i){renderer_utils_selectElement(this).classed("".concat(config.classPrefix,"-tooltip-table-row-").concat(i),!0)}),makeElement(rows,"td",function(d){return d},"".concat(config.classPrefix,"-tooltip-table-cell")).each(function(d){renderer_utils_selectElement(this).html(d)})}else{var _rows=makeElement(body,"div",content,"".concat(config.classPrefix,"-tooltip-row")),_cells=makeElement(_rows,"span",function(d){return d},"".concat(config.classPrefix,"-tooltip-content"));_cells.attr("class","".concat(config.classPrefix,"-tooltip-content")),renderer_utils_setStyles(_rows,{margin:rowMargin}),renderer_utils_setStyles(_cells,{display:"inline-block","margin-right":"".concat(config.spacing,"px")}),_cells.each(function(d){var el=renderer_utils_selectElement(this);if(el.html(""),d instanceof Object)if("icon"===d.type){var svg=makeElement(el,"svg",[1]),path=makeElement(svg,"path",[1]),shape=d.shape instanceof Function?d.shape:common_utils_getSymbol(d.shape);renderer_utils_setAttrs(svg,{x:0,y:0,width:iconContainerSize,height:iconContainerSize}),renderer_utils_setAttrs(path,{d:shape.size(d.size)(),transform:"translate(".concat(iconContainerSize/2,", ").concat(iconContainerSize/2,")")}),renderer_utils_setStyles(path,{fill:d.color}),renderer_utils_setStyles(svg,{width:"".concat(iconContainerSize,"px"),height:"".concat(iconContainerSize,"px")})}else el.html(d.value),d.className&&el.classed(d.className,!0),renderer_utils_setStyles(el,d.style);else el.html(d)})}}return this}},{key:"clear",value:function clear(){return this._model=null,this}}],[{key:"defaultConfig",value:function defaultConfig(){var config=default_config_defaultConfig.content;return config.classPrefix=default_config_defaultConfig.classPrefix,config}}]),Content}();function tooltip_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var tooltip_Tooltip=function(){function Tooltip(htmlContainer,svgContainer){!function tooltip_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tooltip);var connectorContainer=svgContainer;this._id=getUniqueId(),this._config={},this.config({});var tooltipConf=this._config,classPrefix=tooltipConf.classPrefix,contentClass=tooltipConf.content.parentClassName,container=makeElement(htmlContainer,"div",[1],"".concat(classPrefix,"-tooltip-container"));this._container=container,this._tooltipContainer=container.append("div").style("position","absolute"),this._contentContainer=this._tooltipContainer.append("div").attr("class","".concat(classPrefix,"-").concat(contentClass)),this._tooltipBackground=this._tooltipContainer.append("div").style("position","relative"),this._tooltipArrow=this._tooltipContainer.append("div"),svgContainer||(connectorContainer=htmlContainer.append("svg").style("pointer-events","none")),this._contents={},this._tooltipConnectorContainer=renderer_utils_selectElement(connectorContainer).append("g").attr("class","".concat(tooltipConf.classPrefix,"-").concat(tooltipConf.connectorClassName));var id=this._id,defClassName=tooltipConf.defClassName,qualifiedClassName=getQualifiedClassName(defClassName,id,tooltipConf.classPrefix);renderer_utils_setStyles(this._tooltipArrow,INITIAL_STYLE),renderer_utils_setStyles(this._tooltipBackground,INITIAL_STYLE),this.addClass(qualifiedClassName.join(" ")),this.addClass(tooltipConf.className),this.hide()}return function tooltip_createClass(Constructor,protoProps,staticProps){return protoProps&&tooltip_defineProperties(Constructor.prototype,protoProps),staticProps&&tooltip_defineProperties(Constructor,staticProps),Constructor}(Tooltip,[{key:"config",value:function config(){if(arguments.length>0){var defConf=mergeRecursive({},this.constructor.defaultConfig());return this._config=mergeRecursive(defConf,arguments.length<=0?void 0:arguments[0]),this}return this._config}},{key:"addClass",value:function addClass(className){return this._tooltipContainer.classed(className,!0),this}},{key:"context",value:function context(){return arguments.length?(this._context=arguments.length<=0?void 0:arguments[0],this):this._context}},{key:"content",value:function content(name,data){var contentConfig=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},config=this.config(),classPrefix=config.classPrefix,contentClass=config.content.className,formatter=config.formatter,className=contentConfig.className||"".concat(classPrefix,"-").concat(contentClass,"-").concat(name),content=this._contents[name]=this._contents[name]||new content_Content,container=makeElement(this._contentContainer,"div",[contentConfig.order],className);container.attr("class","".concat(classPrefix,"-").concat(contentClass," ").concat(className)),function reorderContainers(parentContainer,className){parentContainer.selectAll(className).sort(function(a,b){return a-b})}(this._contentContainer,".".concat(classPrefix,"-").concat(contentClass));var contentConf=config.content;return contentConfig.classPrefix=this._config.classPrefix,content.config(contentConf),null===data?(content.clear(),container.remove(),delete this._contents[name]):(content.update({model:data,formatter:contentConfig.formatter||formatter}),content.context(this._context),content.render(container)),Object.keys(this._contents).length||this.hide(),this}},{key:"getContents",value:function getContents(){return Object.values(this._contents)}},{key:"position",value:function position(x,y){var conf=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!Object.keys(this._contents).length)return this.hide(),this;this.show();var target=this._target,repositionArrow=conf.repositionArrow;if(target&&repositionArrow){var node=this._tooltipContainer.node(),config=this._config,arrowDisabled=config.arrow.disabled,arrowWidth=arrowDisabled?0:config.arrow.size,arrowOrient=this._arrowOrientation,outsidePlot="left"===arrowOrient||"right"===arrowOrient?y+node.offsetHeight-arrowWidth<target.y||y>target.y+target.height:x+node.offsetWidth-arrowWidth<target.x||x>target.x+target.width;if(!arrowDisabled)if(outsidePlot){var path;this._tooltipArrow.style("display","none"),this._tooltipBackground.style("display","none"),this._tooltipConnectorContainer.style("display","block");var connector=this._tooltipConnectorContainer.selectAll("path").data([1]),enter=connector.enter().append("path");"left"===arrowOrient?path="M ".concat(x," ").concat(y+node.offsetHeight/2," L ").concat(target.x+target.width)+" ".concat(target.y+target.height/2):"right"===arrowOrient?path="M ".concat(x+node.offsetWidth," ").concat(y+node.offsetHeight/2)+" L ".concat(target.x," ").concat(target.y+target.height/2):"bottom"===arrowOrient&&(path="M ".concat(x+node.offsetWidth/2," ").concat(y+node.offsetHeight)+" L ".concat(target.x+target.width/2," ").concat(target.y)),enter.merge(connector).attr("d",path).style("display","block")}else{var arrowPos=helper_getArrowPos(arrowOrient,target,{x:x,y:y,boxHeight:node.offsetHeight,boxWidth:node.offsetWidth},this._config);helper_placeArrow(this,this._arrowOrientation,arrowPos),this._tooltipConnectorContainer.style("display","none")}}var offset=this._offset||{x:0,y:0};return this._tooltipContainer.style("left","".concat(offset.x+x,"px")).style("top","".concat(offset.y+y,"px")),this}},{key:"positionRelativeTo",value:function positionRelativeTo(dim){var obj,_this=this,tooltipConf=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},orientation=tooltipConf.orientation;if(this.show(),!dim)return this.hide(),this;var extent=this._extent,node=this._tooltipContainer.node();this._tooltipContainer.style("top","0px").style("left","0px");var offsetWidth=node.offsetWidth+2,offsetHeight=node.offsetHeight+2,config=this._config,offset=this._offset,arrowDisabled=config.arrow.disabled,arrowSize=arrowDisabled?0:config.arrow.size,draw=void 0===tooltipConf.draw||tooltipConf.draw,topSpace=dim.y,dimX=dim.x+dim.width+offset.x,rightSpace=extent.width-dimX,leftSpace=dim.x+offset.x-extent.x,positionTop=topSpace>offsetHeight+arrowSize,positionRight=rightSpace>=offsetWidth+arrowSize,positionLeft=leftSpace>=offsetWidth+arrowSize;return this._target=dim,orientation||(orientation=positionTop?"vertical":positionRight||positionLeft?"horizontal":"vertical"),"horizontal"===orientation?obj=function positionHorizontal(){var position,x=dim.x+dim.width,y=dim.y;return positionRight?(position="left",x+=arrowSize):positionLeft?(x=dim.x-offsetWidth,position="right",x-=arrowSize):(position="left",x+=arrowSize),dim.height<offsetHeight&&(y=Math.max(0,dim.y+dim.height/2-offsetHeight/2)),{position:position,arrowPos:helper_getArrowPos(position,dim,{x:x,y:y,boxHeight:offsetHeight,boxWidth:offsetWidth},_this._config),x:x,y:y}}():"vertical"===orientation&&(obj=function positionVertical(){var position,y,x=dim.x-offsetWidth/2+dim.width/2;return extent.width-(dim.x+offset.x)<offsetWidth?x=extent.width-offsetWidth-offset.x:x+offset.x<extent.x&&(x=extent.x),positionTop?(y=dim.y-offsetHeight-arrowSize,position="bottom"):(y=dim.y+dim.height+arrowSize,position="top"),{position:position,arrowPos:helper_getArrowPos(position,dim,{x:x,y:y,boxHeight:offsetHeight,boxWidth:offsetWidth},_this._config),x:x,y:y}}()),this._position={x:obj.x,y:obj.y},this._arrowPos=obj.arrowPos,arrowDisabled?(this._tooltipArrow.style("display","none"),this._tooltipBackground.style("display","none")):helper_placeArrow(this,obj.position,obj.arrowPos),this._arrowOrientation=obj.position,draw&&this.position(obj.x,obj.y),this}},{key:"hide",value:function hide(){return this._tooltipContainer.style("display","none"),this._tooltipConnectorContainer.style("display","none"),this}},{key:"show",value:function show(){return this._tooltipContainer.style("display","block"),this}},{key:"extent",value:function extent(_extent){return this._extent=_extent,this}},{key:"offset",value:function offset(_offset){return this._offset=_offset,this}},{key:"remove",value:function remove(){return this._tooltipContainer.remove(),this._tooltipBackground.remove(),this._tooltipConnectorContainer.remove(),this}}],[{key:"defaultConfig",value:function defaultConfig(){return default_config_defaultConfig}}]),Tooltip}();function strategies_toConsumableArray(arr){return function strategies_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function strategies_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function strategies_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var strategies_strategies={showSelectedItems:function showSelectedItems(dm){var dataObj=dm.getData(),measures=dataObj.schema.filter(function(d){return d.type===dist_datamodel.FieldType.MEASURE}),aggregatedModel=dm.groupBy([""],measures.reduce(function(acc,v){return acc[v.name]="count"===v.defAggFn?"sum":v.defAggFn,acc},{})),fieldsObj=dm.getFieldspace().fieldsObj(),fieldsConf=aggregatedModel.getFieldsConfig(),values=[{value:"".concat(dataObj.data.length),style:{"font-weight":"bold"}},"Items Selected"],measureNames=measures.map(function(d){return d.name});return measureNames.length&&(values=[].concat(strategies_toConsumableArray(values),["(".concat(fieldsObj[measureNames[0]].defAggFn().toUpperCase(),") ").concat(measureNames[0]),{value:"".concat(aggregatedModel.getData().data[0][fieldsConf[measureNames[0]].index].toFixed(2)),style:{"font-weight":"bold"}}])),[values]}};__webpack_require__(11);function tooltip_typeof(obj){return(tooltip_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function tooltip_toConsumableArray(arr){return function tooltip_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function tooltip_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function tooltip_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function side_effects_tooltip_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function tooltip_possibleConstructorReturn(self,call){return!call||"object"!==tooltip_typeof(call)&&"function"!=typeof call?function tooltip_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function tooltip_getPrototypeOf(o){return(tooltip_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function tooltip_setPrototypeOf(o,p){return(tooltip_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var side_effects_tooltip_Tooltip=function(_SpawnableSideEffect){function Tooltip(){var _getPrototypeOf2,_this;!function side_effects_tooltip_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Tooltip);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=tooltip_possibleConstructorReturn(this,(_getPrototypeOf2=tooltip_getPrototypeOf(Tooltip)).call.apply(_getPrototypeOf2,[this].concat(params))))._tooltips={},_this._strategies=strategies_strategies,_this._strategy="default",_this}return function tooltip_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&tooltip_setPrototypeOf(subClass,superClass)}(Tooltip,spawnable_SpawnableSideEffect),function side_effects_tooltip_createClass(Constructor,protoProps,staticProps){return protoProps&&side_effects_tooltip_defineProperties(Constructor.prototype,protoProps),staticProps&&side_effects_tooltip_defineProperties(Constructor,staticProps),Constructor}(Tooltip,[{key:"apply",value:function apply(selectionSet,payload){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},totalHeight=0,totalWidth=0,dataModel=selectionSet.mergedEnter.model,context=this.firebolt.context,drawingInf=this.drawingContext();if(dataModel.isEmpty()||null===payload.criteria||!1===selectionSet.isSourceFieldPresent)return this.hide(options,null),this;var tooltips=this._tooltips,config=this.config(),boundBox={width:drawingInf.width,height:drawingInf.height},showInPosition=payload.showInPosition,pad=config.padding,dataModels=[],fragmented="fragmented"===config.mode,sourceInf=context.getSourceInfo(),fields=sourceInf.fields,showVertically=!!(!!fields.x[0]&&fields.x[0].type()===dist_datamodel.FieldType.DIMENSION),tooltipPos=payload.position,boxes=[],enter={},uids=dataModel.getData().uids;fragmented?dataModels.push.apply(dataModels,tooltip_toConsumableArray(uids.map(function(d){return dataModel.select(function(fieldsArr,i){return i===d},{saveChild:!1})}))):dataModels.push(dataModel);var target=payload.target,targetFields=[];if(target){targetFields=target[0]||[];for(var sourceFields=payload.sourceFields,indices=[],i=0,len=targetFields.length;i<len;i++)-1!==sourceFields.indexOf(targetFields[i])&&indices.push(i);target=target.map(function(d){return d.filter(function(v,i){return-1!==indices.indexOf(i)})})}for(var plotDimensions=context.getPlotPointsFromIdentifiers(target||payload.criteria,{getBBox:!0}),_i=0;_i<dataModels.length;_i++){var plotDim=plotDimensions[_i];if(fragmented){var dimensions=dataModels[_i].getData().schema.filter(function(d){return d.type===dist_datamodel.FieldType.DIMENSION}).map(function(d){return d.name});plotDim=(plotDim=context.getPlotPointsFromIdentifiers(dataModels[_i].project(dimensions),{getBBox:!0}))&&plotDim[0]}var dt=dataModels[_i];config.fields&&(dt=dt.project(config.fields,{saveChild:!1})),config.dataTransform&&(dt=config.dataTransform(dt,_i)),enter[_i]=!0;var layoutContainer=drawingInf.parentContainer,parentContainerDimensions=drawingInf.parentContainerDimensions,layoutBoundBox=layoutContainer.getBoundingClientRect(),unitBoundBox=drawingInf.htmlContainer.getBoundingClientRect(),offsetLeft=unitBoundBox.left-layoutBoundBox.left,offsetTop=unitBoundBox.top-layoutBoundBox.top,tooltipInst=tooltips[_i]=tooltips[_i]||new tooltip_Tooltip(layoutContainer,drawingInf.svgContainer);sourceInf.payload=payload,sourceInf.firebolt=this.firebolt,sourceInf.detailFields=context.detailFields(),sourceInf.timeDiffs=context.timeDiffsByField(),tooltipInst.context(sourceInf);var strategy=strategies_strategies[options.strategy];if(tooltipInst.content(options.strategy||this._strategy,dt,{formatter:strategy,order:options.order}).config(this.config()).extent({x:0,y:0,width:parentContainerDimensions.width,height:parentContainerDimensions.height}).offset({x:offsetLeft+(config.offset.x||0),y:offsetTop+(config.offset.y||0)}),showInPosition)tooltipInst.position(tooltipPos.x+pad,tooltipPos.y+pad);else{if(!plotDim){tooltipInst.hide();break}tooltipInst.positionRelativeTo({x:plotDim.x,y:plotDim.y,width:plotDim.width||0,height:plotDim.height||0},{orientation:fragmented?showVertically?"horizontal":"vertical":void 0})}if(fragmented){var position=tooltipInst._position,tooltipBoundBox=tooltipInst._tooltipContainer.node().getBoundingClientRect();if(totalHeight+=tooltipBoundBox.height+pad,totalWidth+=tooltipBoundBox.width+pad,showVertically?totalHeight>drawingInf.height:totalWidth>drawingInf.width)break;boxes.push({x:position.x,y:position.y,width:tooltipBoundBox.width,height:tooltipBoundBox.height,tooltip:tooltipInst})}}for(var key in tooltips)if(!enter[key]){var tooltip=tooltips[key];tooltip.content(payload.action,null),tooltip.getContents().length||(tooltip.remove(),delete tooltips[key])}return fragmented&&(!function spaceOutBoxes(boxes,extent,showVertically){var y,height,x,width,i,len=boxes.length,spaceOutIfOverlap=function spaceOutIfOverlap(firstBox,secondBox,opposite){x=firstBox.x,width=firstBox.width,y=firstBox.y,height=firstBox.height;var bottom=y+height,right=x+width;showVertically?(opposite?y<secondBox.y+secondBox.height:bottom>secondBox.y)&&(secondBox.y=opposite?firstBox.y-secondBox.height-5:bottom+5):(opposite?x<secondBox.x+secondBox.width:right>secondBox.x)&&(secondBox.x=opposite?firstBox.x-secondBox.width-5:right+5)};for(boxes.sort(function(a,b){return showVertically?a.y-b.y:a.x-b.x}),i=0,i=0;i<len-1;i++)spaceOutIfOverlap(boxes[i],boxes[i+1]);if(boxes[i].y+boxes[i].height>extent.height||boxes[i].x+boxes[i].width>extent.width)for(showVertically?boxes[i].y-=boxes[i].height+boxes[i].y-extent.height:boxes[i].x-=boxes[i].width+boxes[i].x-extent.width,i=len-1;i>0;i--)spaceOutIfOverlap(boxes[i],boxes[i-1],!0)}(boxes,boundBox,showVertically),boxes.forEach(function(box){return box.tooltip.position(box.x,box.y,{repositionArrow:!0})})),this}},{key:"hide",value:function hide(options){var tooltips=this._tooltips;for(var key in tooltips)if({}.hasOwnProperty.call(tooltips,key)){var strategy=options.strategy||this._strategy;tooltips[key].content(strategy,null),tooltips[key].hide()}}}],[{key:"defaultConfig",value:function defaultConfig(){return{padding:5,offset:{x:0,y:0}}}},{key:"formalName",value:function formalName(){return"tooltip"}}]),Tooltip}();__webpack_require__(12);function crossline_typeof(obj){return(crossline_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function crossline_toConsumableArray(arr){return function crossline_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function crossline_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function crossline_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function crossline_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function crossline_possibleConstructorReturn(self,call){return!call||"object"!==crossline_typeof(call)&&"function"!=typeof call?function crossline_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function crossline_getPrototypeOf(o){return(crossline_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function crossline_setPrototypeOf(o,p){return(crossline_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var crossline_Crossline=function(_SpawnableSideEffect){function Crossline(){return function crossline_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Crossline),crossline_possibleConstructorReturn(this,crossline_getPrototypeOf(Crossline).apply(this,arguments))}return function crossline_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&crossline_setPrototypeOf(subClass,superClass)}(Crossline,spawnable_SpawnableSideEffect),function crossline_createClass(Constructor,protoProps,staticProps){return protoProps&&crossline_defineProperties(Constructor.prototype,protoProps),staticProps&&crossline_defineProperties(Constructor,staticProps),Constructor}(Crossline,[{key:"apply",value:function apply(selectionSet,payload){var height,bandWidth,px,width,_this=this,_this$config=this.config(),className=_this$config.className,bandClass=_this$config.bandClass,lineClass=_this$config.lineClass,dataModel=selectionSet.mergedEnter.model,drawingInf=this.drawingContext();if(payload.criteria&&dataModel&&dataModel.isEmpty())return this;if(null===payload.criteria||!dataModel)return this.hide(),this;var dataObj=dataModel.getData(),sourceInf=this.firebolt.context.getSourceInfo(),axes=sourceInf.axes,axisFields=sourceInf.fields,fields=selectionSet.fields,data=dataObj.data,fieldsConfig=dataModel.getFieldsConfig(),svgContainer=drawingInf.sideEffectGroup,elemData=[];if(fields.forEach(function(field){var fieldIndex=fieldsConfig[field]&&fieldsConfig[field].index,dataArr=data.map(function(d){return d[fieldIndex]}),axisIndex=[["x",0],["x",1],["y",0],["y",1]].find(function(arr){var fieldInst=axisFields[arr[0]][arr[1]];return fieldInst&&fieldInst.type()===dist_datamodel.FieldType.DIMENSION&&-1!==fieldInst.getMembers().indexOf(field)});if(void 0!==axisIndex&&data.length){var type=axisIndex[0],axis=axes[type][axisIndex[1]],value=dataArr[0];bandWidth=axis.getUnitWidth()||0,px=axis.getScaleValue(value)+bandWidth/2+drawingInf.xOffset;var plotWidth=Math.max.apply(Math,crossline_toConsumableArray(_this.firebolt.context.layers().map(function(layer){return layer.getPlotSpan()[type]}))),pad=Math.max.apply(Math,crossline_toConsumableArray(_this.firebolt.context.layers().map(function(layer){return layer.getPlotPadding()[type]})));height=drawingInf.height,width=drawingInf.width;var startPx=px-plotWidth/2-pad/2,endPx=px+plotWidth/2+pad/2,dataPoint={};dataPoint.d="y"===type?"M 0 ".concat(startPx," L 0 ").concat(endPx," L ").concat(width," ").concat(endPx," L ").concat(width," ").concat(startPx," Z"):"M ".concat(startPx," 0 L ").concat(endPx," 0 L ").concat(endPx," ").concat(height," L ").concat(startPx," ").concat(height," Z"),dataPoint.className=plotWidth?bandClass:lineClass,elemData.push(dataPoint)}}),elemData.length){var parentGroup=this.createElement(svgContainer,"g",[1],className);this.createElement(parentGroup,"path",elemData).attr("d",function(d){return d.d}).style("pointer-events","none").attr("class",function(d){return d.className})}return this}},{key:"hide",value:function hide(){var className=this.config().className,drawingInf=this.drawingContext();renderer_utils_selectElement(drawingInf.sideEffectGroup).selectAll(".".concat(className)).remove()}}],[{key:"defaultConfig",value:function defaultConfig(){return{className:"".concat("muze","-crossline-group"),bandClass:"".concat("muze","-crossband"),lineClass:"".concat("muze","-crossline")}}},{key:"formalName",value:function formalName(){return"crossline"}}]),Crossline}(),strategy_strategies={fade:function fadeFn(set,context,strategy){var mergedEnter=set.mergedEnter,mergedExit=set.mergedExit,exitSet=set.exitSet,completeSet=set.completeSet;mergedEnter.length||mergedExit.length?(context.applyInteractionStyle(exitSet[1],{},strategy,!0),context.applyInteractionStyle(mergedEnter,{},strategy,!1)):context.applyInteractionStyle(completeSet,{},strategy,!1)},focus:function focus(set,context){var mergedEnter=set.mergedEnter,mergedExit=set.mergedExit,completeSet=set.completeSet;mergedEnter.length||mergedExit.length?(context.applyInteractionStyle(mergedExit,{},"focus",!0),context.applyInteractionStyle(mergedEnter,{},"focus",!1)):context.applyInteractionStyle(completeSet,{},"focus",!1)},highlight:function highlight(set,context){var mergedEnter=set.mergedEnter,mergedExit=set.mergedExit,entrySet=set.entrySet,exitSet=set.exitSet,completeSet=set.completeSet;mergedEnter.length||mergedExit.length?(context.applyInteractionStyle(entrySet[1],{},"highlight",!0),context.applyInteractionStyle(exitSet[1],{},"highlight",!1)):context.applyInteractionStyle(completeSet,{},"highlight",!1)}};function plot_highlighter_typeof(obj){return(plot_highlighter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function plot_highlighter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function plot_highlighter_possibleConstructorReturn(self,call){return!call||"object"!==plot_highlighter_typeof(call)&&"function"!=typeof call?function plot_highlighter_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function plot_highlighter_getPrototypeOf(o){return(plot_highlighter_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function plot_highlighter_setPrototypeOf(o,p){return(plot_highlighter_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var plot_highlighter_PlotHighlighter=function(_SurrogateSideEffect){function PlotHighlighter(){var _getPrototypeOf2,_this;!function plot_highlighter_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PlotHighlighter);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=plot_highlighter_possibleConstructorReturn(this,(_getPrototypeOf2=plot_highlighter_getPrototypeOf(PlotHighlighter)).call.apply(_getPrototypeOf2,[this].concat(params))))._strategy="highlight",_this._strategies=strategy_strategies,_this}return function plot_highlighter_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&plot_highlighter_setPrototypeOf(subClass,superClass)}(PlotHighlighter,SurrogateSideEffect),function plot_highlighter_createClass(Constructor,protoProps,staticProps){return protoProps&&plot_highlighter_defineProperties(Constructor.prototype,protoProps),staticProps&&plot_highlighter_defineProperties(Constructor,staticProps),Constructor}(PlotHighlighter,[{key:"apply",value:function apply(selectionSet,payload){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},strategy=this._strategies[options.strategy||this._strategy];return!1!==selectionSet.isSourceFieldPresent&&strategy(selectionSet,this,options.strategy||this._strategy),this}}],[{key:"formalName",value:function formalName(){return"highlighter"}},{key:"target",value:function target(){return"visual-unit"}}]),PlotHighlighter}();function side_effects_filter_typeof(obj){return(side_effects_filter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function side_effects_filter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function side_effects_filter_possibleConstructorReturn(self,call){return!call||"object"!==side_effects_filter_typeof(call)&&"function"!=typeof call?function side_effects_filter_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function side_effects_filter_getPrototypeOf(o){return(side_effects_filter_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function side_effects_filter_setPrototypeOf(o,p){return(side_effects_filter_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var FilterEffect=function(_SurrogateSideEffect){function FilterEffect(){return function side_effects_filter_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FilterEffect),side_effects_filter_possibleConstructorReturn(this,side_effects_filter_getPrototypeOf(FilterEffect).apply(this,arguments))}return function side_effects_filter_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&side_effects_filter_setPrototypeOf(subClass,superClass)}(FilterEffect,SurrogateSideEffect),function side_effects_filter_createClass(Constructor,protoProps,staticProps){return protoProps&&side_effects_filter_defineProperties(Constructor.prototype,protoProps),staticProps&&side_effects_filter_defineProperties(Constructor,staticProps),Constructor}(FilterEffect,[{key:"apply",value:function apply(selectionSet,payload){var context=this.firebolt.context,entryModel=selectionSet.mergedEnter.model;return null===payload.criteria?context.clearCaching().resetData():context.enableCaching().data(entryModel),this}}],[{key:"formalName",value:function formalName(){return"filter"}},{key:"target",value:function target(){return"visual-unit"}},{key:"mutates",value:function mutates(){return!0}}]),FilterEffect}();__webpack_require__(13);function anchors_typeof(obj){return(anchors_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function anchors_slicedToArray(arr,i){return function anchors_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function anchors_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function anchors_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function anchors_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function anchors_possibleConstructorReturn(self,call){return!call||"object"!==anchors_typeof(call)&&"function"!=typeof call?function anchors_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function anchors_getPrototypeOf(o){return(anchors_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function anchors_setPrototypeOf(o,p){return(anchors_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var anchors_addLayer=function addLayer(layerDefs,layerRegistry,context,sideEffect){var layers=[];return layerDefs&&layerDefs.forEach(function(layerDef){var mark=layerDef.mark,layerCls=layerRegistry[mark];if(layerCls&&layerCls.shouldDrawAnchors()){var depLayerEncoding=layerDef.def.encoding,encoding={x:getObjProp(depLayerEncoding,"x","field"),y:getObjProp(depLayerEncoding,"y","field"),color:getObjProp(depLayerEncoding,"color","field"),size:{field:getObjProp(depLayerEncoding,"size","field"),value:sideEffect.defaultSizeValue()}},name="".concat(layerDef.def.name,"-").concat(sideEffect.constructor.formalName()),layerObj={instances:context.addLayer({name:name,mark:"point",className:sideEffect.constructor.defaultConfig().className,encoding:encoding,transform:{type:"identity"},transition:sideEffect.getTransitionConfig(),calculateDomain:!1,source:function source(dm){return dm.select(function(){return!1},{saveChild:!1})},interactive:!1,render:!1}),linkedLayer:layerDef.def.name};layers.push(layerObj)}}),layers},anchors_AnchorEffect=function(_SpawnableSideEffect){function AnchorEffect(){var _getPrototypeOf2,_this;!function anchors_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AnchorEffect);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=anchors_possibleConstructorReturn(this,(_getPrototypeOf2=anchors_getPrototypeOf(AnchorEffect)).call.apply(_getPrototypeOf2,[this].concat(params))))._layersMap={},_this.addAnchorLayers(),_this}return function anchors_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&anchors_setPrototypeOf(subClass,superClass)}(AnchorEffect,spawnable_SpawnableSideEffect),function anchors_createClass(Constructor,protoProps,staticProps){return protoProps&&anchors_defineProperties(Constructor.prototype,protoProps),staticProps&&anchors_defineProperties(Constructor,staticProps),Constructor}(AnchorEffect,[{key:"addAnchorLayers",value:function addAnchorLayers(){var _this2=this,context=this.firebolt.context,metaInf=context.metaInf(),layerRegistry=context.registry().layerRegistry,layerDefsVal=context.layerDef();return context.store().registerImmediateListener("".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE,".").concat(metaInf.namespace,".layerDef"),function(_ref){var layerDefs=anchors_slicedToArray(_ref,2)[1];_this2._layers=anchors_addLayer(layerDefs,layerRegistry,context,_this2)}),this._layers=anchors_addLayer(layerDefsVal,layerRegistry,context,this),this}},{key:"getTransitionConfig",value:function getTransitionConfig(){return{disabled:!0}}},{key:"defaultSizeValue",value:function defaultSizeValue(){return 100}},{key:"apply",value:function apply(selectionSet){var self=this,dataModel=selectionSet.mergedEnter.model;if(!1!==selectionSet.isSourceFieldPresent){var sideEffectGroup=this.drawingContext().sideEffectGroup,className="".concat(this.config().className),layers=this._layers,parentGroup=this.createElement(sideEffectGroup,"g",[1],"".concat(className,"-container"));this.createElement(parentGroup,"g",Object.values(layers)).each(function(layer){var instances=layer.instances,elems=self.createElement(this,"g",instances,className),_linkedLayer$getTrans2=anchors_slicedToArray(self.firebolt.context.getLayerByName(layer.linkedLayer).getTransformedDataFromIdentifiers(dataModel),2),transformedData=_linkedLayer$getTrans2[0],schema=_linkedLayer$getTrans2[1],transformedDataModel=new datamodel_default.a(transformedData,schema);elems.each(function(d,i){instances[i].data(transformedDataModel).mount(this)})})}return this}}],[{key:"target",value:function target(){return"visual-unit"}},{key:"defaultConfig",value:function defaultConfig(){return{className:"".concat("muze","-anchors-group")}}},{key:"formalName",value:function formalName(){return"anchors"}}]),AnchorEffect}();function persistent_anchors_typeof(obj){return(persistent_anchors_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function persistent_anchors_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function persistent_anchors_possibleConstructorReturn(self,call){return!call||"object"!==persistent_anchors_typeof(call)&&"function"!=typeof call?function persistent_anchors_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function persistent_anchors_getPrototypeOf(o){return(persistent_anchors_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function persistent_anchors_setPrototypeOf(o,p){return(persistent_anchors_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var persistent_anchors_PersistentAnchors=function(_AnchorEffect){function PersistentAnchors(){return function persistent_anchors_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PersistentAnchors),persistent_anchors_possibleConstructorReturn(this,persistent_anchors_getPrototypeOf(PersistentAnchors).apply(this,arguments))}return function persistent_anchors_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&persistent_anchors_setPrototypeOf(subClass,superClass)}(PersistentAnchors,anchors_AnchorEffect),function persistent_anchors_createClass(Constructor,protoProps,staticProps){return protoProps&&persistent_anchors_defineProperties(Constructor.prototype,protoProps),staticProps&&persistent_anchors_defineProperties(Constructor,staticProps),Constructor}(PersistentAnchors,[{key:"getTransitionConfig",value:function getTransitionConfig(){return{disabled:!0}}}],[{key:"formalName",value:function formalName(){return"persistent-anchors"}},{key:"defaultConfig",value:function defaultConfig(){return{className:"".concat("muze","-persistent-anchors")}}}]),PersistentAnchors}();function brush_anchors_typeof(obj){return(brush_anchors_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function brush_anchors_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function brush_anchors_possibleConstructorReturn(self,call){return!call||"object"!==brush_anchors_typeof(call)&&"function"!=typeof call?function brush_anchors_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function brush_anchors_getPrototypeOf(o){return(brush_anchors_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function brush_anchors_setPrototypeOf(o,p){return(brush_anchors_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var _behaviourEffectMap,brush_anchors_BrushAnchors=function(_AnchorEffect){function BrushAnchors(){return function brush_anchors_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BrushAnchors),brush_anchors_possibleConstructorReturn(this,brush_anchors_getPrototypeOf(BrushAnchors).apply(this,arguments))}return function brush_anchors_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&brush_anchors_setPrototypeOf(subClass,superClass)}(BrushAnchors,anchors_AnchorEffect),function brush_anchors_createClass(Constructor,protoProps,staticProps){return protoProps&&brush_anchors_defineProperties(Constructor.prototype,protoProps),staticProps&&brush_anchors_defineProperties(Constructor,staticProps),Constructor}(BrushAnchors,[{key:"getTransitionConfig",value:function getTransitionConfig(){return{disabled:!0}}}],[{key:"formalName",value:function formalName(){return"brush-anchors"}},{key:"defaultConfig",value:function defaultConfig(){return{className:"".concat("muze","-brush-anchors")}}}]),BrushAnchors}();function behaviour_effect_map_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var behaviour_effect_map_behaviourEffectMap=(behaviour_effect_map_defineProperty(_behaviourEffectMap={},BRUSH,["selectionBox",{name:"highlighter",options:{strategy:"fade"}},"brush-anchors"]),behaviour_effect_map_defineProperty(_behaviourEffectMap,"".concat(BRUSH,",").concat(SELECT),[{name:"tooltip",options:{strategy:"showSelectedItems",order:0,filter:function filter(context){return"fragmented"===context.config().mode}}}]),behaviour_effect_map_defineProperty(_behaviourEffectMap,HIGHLIGHT,[{name:"highlighter",options:{strategy:"highlight"}},"crossline",{name:"tooltip",options:{order:9999}},"anchors"]),behaviour_effect_map_defineProperty(_behaviourEffectMap,FILTER,["filter"]),behaviour_effect_map_defineProperty(_behaviourEffectMap,SELECT,[{name:"highlighter",options:{strategy:"focus"}},"persistent-anchors"]),_behaviourEffectMap),STACK="stack",ANGLE="angle",RADIUS="radius",SIZE="size",COLOR="color",SHAPE="shape",ENCODING={X:"x",Y:"y",X0:"x0",Y0:"y0"},area_default_config_defaultConfig={classPrefix:"muze",defClassName:"layer-area",className:"",interpolate:"linear",transform:{type:STACK},interaction:{},nearestPointThreshold:10,encoding:{color:{},x:{},y:{},y0:{},strokeOpacity:{value:1}},transition:{effect:"cubic",duration:1e3},connectNullData:!1};function simple_layer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _axisOrientationMap,simple_layer_SimpleLayer=function(){function SimpleLayer(){!function simple_layer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleLayer)}return function simple_layer_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_layer_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_layer_defineProperties(Constructor,staticProps),Constructor}(SimpleLayer,[{key:"formalName",value:function formalName(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"dependencies",value:function dependencies(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"config",value:function config(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"data",value:function data(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"serialize",value:function serialize(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"id",value:function id(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"normalizeTransformedData",value:function normalizeTransformedData(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getTransformedData",value:function getTransformedData(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"_calculateDomainFromData",value:function _calculateDomainFromData(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getDomain",value:function getDomain(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getNearestPoint",value:function getNearestPoint(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"highlightPoint",value:function highlightPoint(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"dehighlightPoint",value:function dehighlightPoint(){return this}},{key:"linkLayerStore",value:function linkLayerStore(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"mount",value:function mount(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"render",value:function render(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}}]),SimpleLayer}(),props_props={axes:{},mount:{},measurement:{},metaInf:{},data:{},config:{}};function axis_orientation_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _scaleMap,axis_orientation_BOTTOM="bottom",axis_orientation_TOP="top",axis_orientation_LEFT="left",axis_orientation_RIGHT="right",axisOrientationMap=(axis_orientation_defineProperty(_axisOrientationMap={},axis_orientation_LEFT,Symbols.axisLeft),axis_orientation_defineProperty(_axisOrientationMap,axis_orientation_BOTTOM,Symbols.axisBottom),axis_orientation_defineProperty(_axisOrientationMap,axis_orientation_RIGHT,Symbols.axisRight),axis_orientation_defineProperty(_axisOrientationMap,axis_orientation_TOP,Symbols.axisTop),_axisOrientationMap),LINEAR="linear",BAND="band",TIME="temporal",scale_type_COLOR="color",ORDINAL="ordinal",QUANTIZE="quantize",QUANTILE="quantile",LOG="log",POW="pow",scale_type_IDENTITY="identity",SEQUENTIAL="sequential",THRESHOLD="threshold",CONTINOUS=(__webpack_require__(14),"continous"),DISCRETE="discrete",constants_SEQUENTIAL="sequential",constants_ORDINAL="ordinal",constants_LINEAR="linear",constants_QUANTIZE="quantize",HIDDEN="hidden";function scale_creator_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var scaleLinear=scales_namespaceObject.scaleLinear,scaleThreshold=scales_namespaceObject.scaleThreshold,scaleLog=scales_namespaceObject.scaleLog,scalePow=scales_namespaceObject.scalePow,scaleIdentity=scales_namespaceObject.scaleIdentity,scaleOrdinal=scales_namespaceObject.scaleOrdinal,scaleSequential=scales_namespaceObject.scaleSequential,scaleQuantize=scales_namespaceObject.scaleQuantize,scaleQuantile=scales_namespaceObject.scaleQuantile,scaleBand=scales_namespaceObject.scaleBand,scaleTime=scales_namespaceObject.scaleTime,scaleMap=(scale_creator_defineProperty(_scaleMap={},LINEAR,scaleLinear),scale_creator_defineProperty(_scaleMap,BAND,scaleBand),scale_creator_defineProperty(_scaleMap,QUANTIZE,scaleQuantize),scale_creator_defineProperty(_scaleMap,QUANTILE,scaleQuantile),scale_creator_defineProperty(_scaleMap,THRESHOLD,scaleThreshold),scale_creator_defineProperty(_scaleMap,SEQUENTIAL,scaleSequential),scale_creator_defineProperty(_scaleMap,LOG,scaleLog),scale_creator_defineProperty(_scaleMap,POW,scalePow),scale_creator_defineProperty(_scaleMap,scale_type_IDENTITY,scaleIdentity),scale_creator_defineProperty(_scaleMap,TIME,scaleTime),scale_creator_defineProperty(_scaleMap,scale_type_COLOR,scaleLinear),scale_creator_defineProperty(_scaleMap,ORDINAL,scaleOrdinal),_scaleMap);function scale_creator_createScale(params){if(!params.type||!scaleMap[params.type])throw new Error("".concat(params.type," is not a valid scale type"));if(!Array.isArray(params.range))throw new Error("range parameter must be an array");var scaleFactory=null,range=params.range;if(params.type===constants_LINEAR&&params.interpolator){if(scaleFactory=scaleMap[params.interpolator],params.interpolator===POW)return scaleFactory().range(range).exponent(params.exponent);if(params.interpolator===LOG)return scaleFactory().range(range).base([params.base])}else scaleFactory=scaleMap[params.type];return params.type===constants_QUANTIZE&&scaleFactory().nice(),scaleFactory().range(range)}var cartesian_axis_default_config_defaultConfig={id:getUniqueId(),axisName:{defClassName:"axis-name"},axisNamePadding:12,base:10,classPrefix:"muze",className:"".concat("muze","-axis"),exponent:1,interpolator:"linear",fixedBaseline:!0,labels:{rotation:null,smartTicks:null},orientation:"left",numberFormat:function numberFormat(val){return val},padding:.3,nice:!0,numberOfTicks:10,rotate:!1,show:!0,showAxisName:!0,showInnerTicks:!0,showOuterTicks:!0,style:{},type:"linear",tickFormat:null,tickValues:null,xOffset:0,yOffset:0},axis_renderer_rotateAxis=function rotateAxis(instance,tickText,labelManager){var rotation,axis=instance.axis(),config=instance.config(),renderConfig=instance.renderConfig(),smartTicks=instance.smartTicks(),scale=axis.scale(),ticks=(scale.ticks||scale.quantile||scale.domain)(),orientation=config.orientation,fixedBaseline=config.fixedBaseline,type=config.type,labels=renderConfig.labels;rotation=labels.rotation;var tickSize=instance.getTickSize();return tickText.each(function(d,index){var yShift,xShift,datum=smartTicks[index]?smartTicks[index].text:d,tickFormatter=axis.tickFormat()?axis.tickFormat:null;datum=(tickSize?tickFormatter?tickFormatter()(d):datum:"").toString();var tickLabelDim=labelManager.getOriSize(datum),width=.5*tickLabelDim.width,height=.5*tickLabelDim.height;rotation<0&&(rotation=360+rotation);var quadrant=4-Math.floor(rotation/90),rotationNormalizer=(quadrant%2==0?rotation:180*Math.ceil(rotation/180)-rotation)%180;yShift=Math.sqrt(Math.pow(height,2)+Math.pow(width,2))*Math.sin(function angleToRadian(angle){return angle*Math.PI/180}(rotationNormalizer)),3!==quadrant&&2!==quadrant||rotationNormalizer>67.5&&rotationNormalizer<=90||(yShift+=2*height),xShift=width,xShift=90===rotation?height:270===rotation?-height:0,orientation===axis_orientation_TOP?(xShift=fixedBaseline&&ticks[0]===d&&type===constants_LINEAR?xShift+xShift/2:xShift,renderer_utils_selectElement(this).attr("transform","translate(".concat(-xShift+tickSize,"\n                                ").concat(-yShift-tickSize,") rotate(").concat(rotation,")"))):(xShift=fixedBaseline&&ticks[0]===d&&type===constants_LINEAR?xShift-xShift/2:xShift,renderer_utils_selectElement(this).attr("transform","translate(".concat(xShift-tickSize,"\n                                ").concat(yShift+tickSize,") rotate(").concat(rotation,")"))),renderer_utils_selectElement(this).transition().duration(1e3).text(datum)}),tickText},axis_renderer_changeTickOrientation=function changeTickOrientation(selectContainer,axisInstance,tickSize){var _smartTicks=axisInstance._smartTicks,config=axisInstance.config(),renderConfig=axisInstance.renderConfig(),labelManager=axisInstance.dependencies().labelManager,orientation=config.orientation,classPrefix=config.classPrefix,labels=renderConfig.labels,rotation=labels.rotation,isSmartTicks=labels.smartTicks,tickText=selectContainer.selectAll(".tick text");if(tickText.selectAll("tspan").remove(),!rotation||"top"!==orientation&&"bottom"!==orientation)if(rotation||isSmartTicks){if(tickText.text(""),"top"===orientation||"bottom"===orientation)tickText.attr("y",0).attr("x",0).attr("transform","").text(""),makeElement(tickText,"tspan",function(d,i){return _smartTicks[i]?_smartTicks[i].lines:[]},"".concat(classPrefix,"-smart-text")).attr("dy","0").style("opacity","0").transition().duration(1e3).on("end",axisInstance.registerAnimationDoneHook()).attr("dy",function(d,i){return"bottom"===orientation||0!==i?_smartTicks[0].oriTextHeight:-_smartTicks[0].oriTextHeight*(_smartTicks[0].lines.length-1)-tickSize}).style("opacity",1).text(function(e){return e}).attr("x",0);else makeElement(tickText,"tspan",function(d,i){return _smartTicks[i].lines},"".concat(classPrefix,"-smart-text")).text(function(e){return e})}else tickText.attr("transform","");else axis_renderer_rotateAxis(axisInstance,tickText,labelManager);return tickText},axis_renderer_setFixedBaseline=function setFixedBaseline(axisInstance){axisInstance.config().fixedBaseline&&axisInstance.setFixedBaseline()},axis_renderer_setAxisNamePos=function setAxisNamePos(textNode,orientation,measures){var axisNameHeight=measures.axisNameHeight,yOffset=measures.yOffset,labelOffset=measures.labelOffset,availableSpace=measures.availableSpace;switch(orientation){case axis_orientation_LEFT:textNode.attr("transform","translate(".concat(-(availableSpace.width-axisNameHeight),",").concat(yOffset+labelOffset,")rotate(-90)"));break;case axis_orientation_RIGHT:textNode.attr("transform","translate(".concat(availableSpace.width-axisNameHeight,",").concat(yOffset+labelOffset,")rotate(90)"));break;case axis_orientation_TOP:textNode.attr("transform","translate(".concat(availableSpace.width/2,",").concat(-availableSpace.height+axisNameHeight,")"));break;case axis_orientation_BOTTOM:textNode.attr("transform","translate(".concat(availableSpace.width/2,",").concat(availableSpace.height-axisNameHeight/2,")"))}return textNode};var setAxisRange=function setAxisRange(context,type,rangeBounds,offset){context.range(rangeBounds),offset&&context.config(function space_setter_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},"".concat(type,"Offset"),offset))},space_setter_adjustRange=function adjustRange(minDiff,range,domain,orientation){var diff=function getAxisOffset(timeDiff,range,domain){var width=Math.abs(range[1]-range[0])/(domain[1]-domain[0])*timeDiff,avWidth=range[1]-range[0],bars=avWidth/width;return(avWidth-avWidth/(bars+1)*bars)/2}(minDiff,range,domain);return orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM?(range[0]+=diff,range[1]-=diff):(range[0]-=diff,range[1]+=diff),range},spaceSetter=function spaceSetter(context,spaceConfig){var tickInterval,heightForTicks,_context$availableSpa=context.availableSpace(),availWidth=_context$availableSpa.width,availHeight=_context$availableSpa.height,padding=_context$availableSpa.padding,top=padding.top,left=padding.left,bottom=padding.bottom,right=padding.right,isOffset=spaceConfig.isOffset,_context$renderConfig=context.renderConfig(),showAxisName=_context$renderConfig.showAxisName,labels=_context$renderConfig.labels,rotation=labels.rotation,_context$config2=context.config(),orientation=_context$config2.orientation,fixedBaseline=_context$config2.fixedBaseline,axisNamePadding=_context$config2.axisNamePadding,tickValues=_context$config2.tickValues,_context$getAxisDimen=context.getAxisDimensions(),tickDimensions=_context$getAxisDimen.tickDimensions,allTickDimensions=_context$getAxisDimen.allTickDimensions,axisNameDimensions=_context$getAxisDimen.axisNameDimensions,tickSize=_context$getAxisDimen.tickSize,tickDimHeight=tickDimensions.height,tickDimWidth=tickDimensions.width,namePadding=showAxisName?axisNamePadding:0,labelConfig={smartTicks:!0,rotation:labels.rotation},minTickDistance=context._minTickDistance,minTickSpace=context._minTickSpace,minDiff=context._minDiff,domain=context.domain(),axisNameHeight=axisNameDimensions.height;return{time:{x:function x(){var tickShifter=tickDimWidth/2;return setAxisRange(context,"y",space_setter_adjustRange(minDiff,[tickShifter,availWidth-left-right-tickShifter],domain,orientation),isOffset?availHeight:null),tickInterval=availWidth/context.getTickValues().length-minTickDistance.width,heightForTicks=availHeight-axisNameDimensions.availHeight-tickSize-namePadding,tickInterval<minTickSpace.width&&0!==rotation&&(labelConfig.rotation=null===labels.rotation?-90:rotation,tickInterval<minTickSpace.height&&(heightForTicks=availHeight,tickInterval=minTickSpace.height,context.renderConfig({showInnerTicks:!1,showOuterTicks:!1}))),availHeight<axisNameHeight&&context.renderConfig({show:!1}),context.maxTickSpaces({width:tickInterval,height:heightForTicks,noWrap:null!==rotation}),labelConfig},y:function y(){var widthForTicks=availWidth,tickShifter=tickDimHeight/2;return setAxisRange(context,"x",space_setter_adjustRange(minDiff,[availHeight-top-bottom-tickShifter,tickShifter],domain,orientation),isOffset?availWidth:null),availWidth-axisNameHeight-namePadding<=minTickDistance.width&&(widthForTicks=0,context.renderConfig({showInnerTicks:!1,showOuterTicks:!1})),context.maxTickSpaces({width:widthForTicks,height:availHeight,noWrap:!0}),availWidth<axisNameHeight&&context.renderConfig({show:!1}),labelConfig}},band:{x:function x(){setAxisRange(context,"y",[0,availWidth-left-right],isOffset?availHeight:null);var range=context.range();if(tickInterval=(range[1]-range[0])/(tickValues||domain).length-minTickDistance.width,heightForTicks=availHeight-axisNameHeight-tickSize-namePadding,tickInterval<minTickSpace.width&&0!==rotation)labelConfig.rotation=null===rotation?-90:rotation,labelConfig.smartTicks=!1,tickInterval<minTickSpace.height&&(heightForTicks=0,tickInterval=0,context.renderConfig({showInnerTicks:!1,showOuterTicks:!1}),context.range([minTickSpace.height/2,availWidth-minTickSpace.height/2]));else if(tickValues){availWidth/domain.length-minTickDistance.width<minTickSpace.width&&context.range([minTickSpace.height/2,availWidth-minTickSpace.height/2])}return availHeight<axisNameHeight&&context.renderConfig({show:!1,showInnerTicks:!1,showOuterTicks:!1}),context.maxTickSpaces({width:tickInterval,height:heightForTicks,noWrap:null!==rotation}),labelConfig},y:function y(){setAxisRange(context,"x",[availHeight-bottom,top],isOffset?availWidth:null);var widthForTicks=availWidth;return availWidth-axisNameHeight-namePadding<=minTickDistance.width&&(widthForTicks=0,context.renderConfig({showInnerTicks:!1,showOuterTicks:!1})),context.maxTickSpaces({width:widthForTicks,height:availHeight,noWrap:!0}),availWidth<axisNameHeight&&context.renderConfig({show:!1}),labelConfig}},continous:{x:function x(){labelConfig.smartTicks=!1;var tickShifter=tickDimensions.width/2;setAxisRange(context,"y",[(fixedBaseline?0:tickShifter)+left,availWidth-right-tickShifter],isOffset?availHeight:null);var range=context.range(),totalTickWidth=allTickDimensions.length*(tickDimensions.width+minTickDistance.width);return range[1]-range[0]<totalTickWidth&&null===labels.rotation&&(labelConfig.rotation=-90),availHeight-axisNameHeight-namePadding<tickDimensions.height&&(context.renderConfig({showInnerTicks:!1}),availHeight<axisNameHeight&&context.renderConfig({show:!1})),labelConfig},y:function y(){labelConfig.smartTicks=!1;var tickShifter=tickDimensions.height/2;return setAxisRange(context,"x",[availHeight-bottom-(fixedBaseline?1:tickShifter),tickShifter+top],isOffset?availWidth:null),availWidth<tickDimensions.width+axisNameHeight+namePadding&&(context.renderConfig({showInnerTicks:!1}),availWidth<axisNameHeight&&context.renderConfig({show:!1})),labelConfig}}}};function cartesian_axis_helper_toConsumableArray(arr){return function cartesian_axis_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function cartesian_axis_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function cartesian_axis_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var getRotatedSpaces=function getRotatedSpaces(){var rotation=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,width=arguments.length>1?arguments[1]:void 0,height=arguments.length>2?arguments[2]:void 0,rotatedHeight=height,rotatedWidth=width;if(rotation){var angle=(rotation||0)*Math.PI/180;rotatedWidth=Math.abs(height*Math.sin(angle))+Math.abs(width*Math.cos(angle)),rotatedHeight=Math.abs(width*Math.sin(angle))+Math.abs(height*Math.cos(angle))}return{width:rotatedWidth,height:rotatedHeight}},helper_setOffset=function setOffset(context){var x=0,y=0,logicalSpace=context.logicalSpace(),config=context.config(),orientation=config.orientation,xOffset=config.xOffset,yOffset=config.yOffset;orientation===axis_orientation_LEFT&&(x=void 0===xOffset?logicalSpace.width:xOffset),orientation===axis_orientation_TOP&&(y=void 0===yOffset?logicalSpace.height:yOffset),context.config({xOffset:x,yOffset:y})},getAxisComponentDimensions=function getAxisComponentDimensions(context){var axisTicks,largestTick="",largestTickDimensions={width:0,height:0},smartTick={},allTickDimensions=[],scale=context.scale(),showAxisName=context.renderConfig().showAxisName,_context$config=context.config(),tickValues=_context$config.tickValues,name=_context$config.name,labelManager=context.dependencies().labelManager,labelFunc=scale.ticks||scale.quantile||scale.domain;return labelManager.setStyle(context._tickLabelStyle),axisTicks=(axisTicks=tickValues||labelFunc()).map(function(originalLabel,i){var label=context.getFormattedText(originalLabel,i,axisTicks),tickDimensions=labelManager.getOriSize(label);return allTickDimensions.push(tickDimensions),tickDimensions.width>largestTickDimensions.width&&(largestTick=label,smartTick=context.smartTicks()?context.smartTicks()[i]:{},largestTickDimensions=tickDimensions),label}),labelManager.setStyle(context._axisNameStyle),{axisNameDimensions:showAxisName?labelManager.getOriSize(name):{width:0,height:0},largestTick:largestTick,largestTickDimensions:largestTickDimensions,allTickDimensions:allTickDimensions,axisTicks:axisTicks,smartTick:smartTick,tickSize:context.getTickSize()}},getHorizontalAxisSpace=function getHorizontalAxisSpace(context,axisDimensions,range){var width,height,domain=context.domain(),tickSize=axisDimensions.tickSize,tickDimensions=axisDimensions.tickDimensions,axisNameDimensions=axisDimensions.axisNameDimensions,_context$config2=context.config(),axisNamePadding=_context$config2.axisNamePadding,tickValues=_context$config2.tickValues,showAxisName=context.renderConfig().showAxisName,axisDimHeight=axisNameDimensions.height,tickDimHeight=tickDimensions.height,tickDimWidth=tickDimensions.width;if(width=range&&range.length?range[1]-range[0]:0,height=0,tickValues){var minTickDiff=context.getMinTickDifference(),_ref=[Math.min.apply(Math,cartesian_axis_helper_toConsumableArray(tickValues).concat(cartesian_axis_helper_toConsumableArray(domain))),Math.max.apply(Math,cartesian_axis_helper_toConsumableArray(tickValues).concat(cartesian_axis_helper_toConsumableArray(domain)))];width=(_ref[1]-_ref[0])/Math.abs(minTickDiff)*(tickDimWidth+context._minTickDistance.width)}return height=width&&0!==width?tickDimHeight:Math.max(tickDimWidth,tickDimHeight),{width:width,height:height+=(showAxisName?axisDimHeight+axisNamePadding:0)+tickSize}},getVerticalAxisSpace=function getVerticalAxisSpace(context,axisDimensions){var height,width,domain=context.domain(),tickSize=axisDimensions.tickSize,tickDimensions=axisDimensions.tickDimensions,axisNameDimensions=axisDimensions.axisNameDimensions,_context$config3=context.config(),axisNamePadding=_context$config3.axisNamePadding,tickValues=_context$config3.tickValues,showAxisName=context.renderConfig().showAxisName,axisDimHeight=axisNameDimensions.height,tickDimHeight=tickDimensions.height;if(height=0,width=tickDimensions.width,tickValues){var minTickDiff=context.getMinTickDifference(),_ref2=[Math.min.apply(Math,cartesian_axis_helper_toConsumableArray(tickValues).concat(cartesian_axis_helper_toConsumableArray(domain))),Math.max.apply(Math,cartesian_axis_helper_toConsumableArray(tickValues).concat(cartesian_axis_helper_toConsumableArray(domain)))];height=(_ref2[1]-_ref2[0])/Math.abs(minTickDiff)*tickDimHeight}return{height:height,width:width+=(showAxisName?axisDimHeight:0)+tickSize+axisNamePadding}},helper_calculateBandSpace=function calculateBandSpace(context){var range=context.range(),axisDimensions=context.getAxisDimensions(),orientation=context.config().orientation,show=context.renderConfig().show,largestTickDimensions=axisDimensions.largestTickDimensions,axisTicks=axisDimensions.axisTicks,allTickDimensions=axisDimensions.allTickDimensions,largestDimHeight=largestTickDimensions.height,minTickWidth=context._minTickDistance.width;if(orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM){var _getHorizontalAxisSpa=getHorizontalAxisSpace(context,axisDimensions,range),_width=_getHorizontalAxisSpa.width,_height=_getHorizontalAxisSpa.height;return _width&&0!==_width||(_width=allTickDimensions.reduce(function(t,n){return t+Math.min(n.width,n.height)+minTickWidth},0)),!1===show&&(_height=0),{width:_width,height:_height}}var _getVerticalAxisSpace=getVerticalAxisSpace(context,axisDimensions),width=_getVerticalAxisSpace.width,height=_getVerticalAxisSpace.height;return height&&0!==height||(height=axisTicks.length*(largestDimHeight+context._minTickDistance.height)+largestDimHeight),!1===show&&(width=0),{width:width,height:height}},getValidDomain=function getValidDomain(context,domain){var userDom=context.config().domain;return userDom&&(domain=userDom),domain},setContinousAxisDomain=function setContinousAxisDomain(context,domain){var nice=context.config().nice,scale=context.scale.bind(context);scale().domain(domain),nice&&scale().nice(),context._domain=scale().domain()},PROPS={availableSpace:{},axisDimensions:{},axisComponentDimensions:{},config:{sanitization:function sanitization(context,value){var oldConfig=Object.assign({},context._config||{}),mockedOldConfig=mergeRecursive({},oldConfig);(value=mergeRecursive(mockedOldConfig,value)).axisNamePadding=Math.max(value.axisNamePadding,0);var shouldAxesScaleUpdate=function hasAxesConfigChanged(){var obj=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},obj1=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},properties=arguments.length>2?arguments[2]:void 0;return!(!Object.keys(obj).length||!Object.keys(obj1).length)&&properties.some(function(key){return obj[key]!==obj1[key]})}(value,oldConfig,["interpolator","exponent","base","orientation"]),tickFormatter=context.getTickFormatter(value);shouldAxesScaleUpdate&&(context._scale=context.createScale(value),context._axis=context.createAxis(value)),context._tickFormatter=function(ticks){return tickFormatter(ticks)};var _value=value,labels=_value.labels,show=_value.show,showInnerTicks=_value.showInnerTicks,showOuterTicks=_value.showOuterTicks,showAxisName=_value.showAxisName;return context.renderConfig({labels:labels,show:show,showInnerTicks:showInnerTicks,showOuterTicks:showOuterTicks,showAxisName:showAxisName}),value}},renderConfig:{sanitization:function sanitization(context,value){var oldConfig=Object.assign({},context._renderConfig||{});return value=mergeRecursive(oldConfig,value)}},logicalSpace:{},mount:{},range:{sanitization:function sanitization(context,value){return context.scale().range(value),context.logicalSpace(null),value}},smartTicks:{},tickSize:{},maxTickSpaces:{}};function simple_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var simple_axis_SimpleAxis=function(){function SimpleAxis(config,dependencies){!function simple_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleAxis),this._id=getUniqueId(),this._dependencies=dependencies,this._mount=null,this._range=[],this._domain=[],this._domainLock=!1,this._axisDimensions={},this._smartTicks=[];var defCon=mergeRecursive({},this.constructor.defaultConfig()),simpleConfig=mergeRecursive(defCon,config),bodyElem=renderer_utils_selectElement("body"),classPrefix=simpleConfig.classPrefix;this._tickLabelStyle=renderer_utils_getSmartComputedStyle(bodyElem,"".concat(classPrefix,"-ticks")),this._axisNameStyle=renderer_utils_getSmartComputedStyle(bodyElem,"".concat(classPrefix,"-axis-name")),dependencies.labelManager.setStyle(this._tickLabelStyle);var dist=dependencies.labelManager.getOriSize("w");this._minTickDistance={width:3*dist.width/4,height:dist.height/2},this._minTickSpace=dependencies.labelManager.getOriSize("www"),generateGetterSetters(this,PROPS),this.config(simpleConfig),this._scale=this.createScale(this._config),this._axis=this.createAxis(this._config),this._animationDonePromises=[]}return function simple_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_axis_defineProperties(Constructor,staticProps),Constructor}(SimpleAxis,[{key:"setFixedBaseline",value:function setFixedBaseline(){return this}},{key:"scale",value:function scale(){return arguments.length?(this._scale=arguments.length<=0?void 0:arguments[0],this):this._scale}},{key:"resetDomain",value:function resetDomain(){return this._domain=[],this}},{key:"axis",value:function axis(){return arguments.length?(this._axis=arguments.length<=0?void 0:arguments[0],this):this._axis}},{key:"domain",value:function domain(){if(arguments.length){var domainValue=arguments.length<=0?void 0:arguments[0];return domainValue=getValidDomain(this,domainValue),this.scale().domain(domainValue),this._domain=this.scale().domain(),this.setAxisComponentDimensions(),this.logicalSpace(null),this}return this._domain}},{key:"setAxisComponentDimensions",value:function setAxisComponentDimensions(){this.axisComponentDimensions(getAxisComponentDimensions(this))}},{key:"dependencies",value:function dependencies(){return this._dependencies}},{key:"createScale",value:function createScale(config){var base=config.base;return scale_creator_createScale({padding:config.padding,interpolator:config.interpolator,exponent:config.exponent,base:base,range:this.range(),type:this.constructor.type()})}},{key:"getTickFormatter",value:function getTickFormatter(value){var tickFormat=value.tickFormat,numberFormat=value.numberFormat;return tickFormat?function(ticks){return function(val,i){return tickFormat(numberFormat(val),val,i,ticks)}}:function(){return function(val){return numberFormat(val)}}}},{key:"resetLogicalSpace",value:function resetLogicalSpace(){this.logicalSpace(null),this.range([]);var _this$config=this.config(),labels=_this$config.labels,show=_this$config.show,showInnerTicks=_this$config.showInnerTicks,showOuterTicks=_this$config.showOuterTicks,showAxisName=_this$config.showAxisName;this.renderConfig({labels:labels,show:show,showInnerTicks:showInnerTicks,showOuterTicks:showOuterTicks,showAxisName:showAxisName})}},{key:"getFormattedText",value:function getFormattedText(text,index,axisTicks){return(0,this._tickFormatter)(axisTicks)(text,index)}},{key:"createAxis",value:function createAxis(config){var orientation=config.orientation,axisClass=axisOrientationMap[orientation];return axisClass?axisClass(this.scale()):null}},{key:"setAvailableSpace",value:function setAvailableSpace(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,height=arguments.length>1?arguments[1]:void 0,padding=arguments.length>2?arguments[2]:void 0,isOffset=arguments.length>3?arguments[3]:void 0,labelConfig={},orientation=this.config().orientation;return this.availableSpace({width:width,height:height,padding:padding}),labelConfig=orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM?spaceSetter(this,{isOffset:isOffset}).continous.x():spaceSetter(this,{isOffset:isOffset}).continous.y(),this.renderConfig({labels:labelConfig}),this.setTickConfig(),this.getTickSize(),this}},{key:"setTickConfig",value:function setTickConfig(){return this}},{key:"getScaleValue",value:function getScaleValue(domainVal){if(null!==domainVal&&void 0!==domainVal)return this.scale()(domainVal)}},{key:"getTickSize",value:function getTickSize(){return this.axis().tickSize()}},{key:"getAxisDimensions",value:function getAxisDimensions(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return this.axisDimensions(function computeAxisDimensions(context){var tickDimensions={},labels=context.renderConfig().labels,smartTicks=labels.smartTicks,rotation=labels.rotation,_getAxisComponentDime=getAxisComponentDimensions(context),largestTickDimensions=_getAxisComponentDime.largestTickDimensions,axisTicks=_getAxisComponentDime.axisTicks,smartTick=_getAxisComponentDime.smartTick,axisNameDimensions=_getAxisComponentDime.axisNameDimensions,allTickDimensions=_getAxisComponentDime.allTickDimensions,tickSize=_getAxisComponentDime.tickSize,labelHeight=largestTickDimensions.height,labelWidth=largestTickDimensions.width;return 0===context.domain().length?null:(tickDimensions=getRotatedSpaces(rotation,(tickDimensions=smartTicks?smartTick:{width:labelWidth,height:labelHeight}).width,tickDimensions.height),0===tickSize&&(tickDimensions={width:0,height:0}),{allTickDimensions:allTickDimensions,tickSize:tickSize,tickDimensions:tickDimensions,axisNameDimensions:axisNameDimensions,largestTickDimensions:largestTickDimensions,axisTicks:axisTicks})}.apply(void 0,[this].concat(params))),this.axisDimensions()}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||(this.logicalSpace(function calculateContinousSpace(context){var range=context.range(),axisDimensions=context.getAxisDimensions(),orientation=context.config().orientation,_context$renderConfig6=context.renderConfig(),show=_context$renderConfig6.show,showAxisName=_context$renderConfig6.showAxisName,axisNameDimensions=axisDimensions.axisNameDimensions;if(!1===show)return{width:0,height:0};var axisNameWidth=axisNameDimensions.width;if(orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM){var _getHorizontalAxisSpa2=getHorizontalAxisSpace(context,axisDimensions,range),_width2=_getHorizontalAxisSpa2.width,_height2=_getHorizontalAxisSpa2.height;return{width:Math.max(_width2,axisNameWidth),height:_height2}}var _getVerticalAxisSpace2=getVerticalAxisSpace(context,axisDimensions),width=_getVerticalAxisSpace2.width,height=_getVerticalAxisSpace2.height;return{width:width,height:Math.max(height,showAxisName?axisNameWidth:0)}}(this)),this.logicalSpace(),helper_setOffset(this)),this.logicalSpace()}},{key:"invert",value:function invert(){for(var _this=this,_len2=arguments.length,value=new Array(_len2),_key2=0;_key2<_len2;_key2++)value[_key2]=arguments[_key2];var values=value.map(function(d){return _this.scale().invert(d)})||[];return 1===value.length?values[0]:values}},{key:"getNearestRange",value:function getNearestRange(v1,v2){var extent,type=this.config().type,scale=this.scale(),range=scale.range(),reverse=range[0]>range[1];return"band"===type?(extent=scale.invertExtent(v1,v2),[scale(reverse?extent[extent.length-1]:extent[0]),scale(reverse?extent[0]:extent[extent.length-1])+scale.bandwidth()]):[v1,v2]}},{key:"getMinTickDifference",value:function getMinTickDifference(){return this.domain()}},{key:"getFormattedTickValues",value:function getFormattedTickValues(tickValues){return tickValues}},{key:"getUnitWidth",value:function getUnitWidth(){return 0}},{key:"serialize",value:function serialize(){return{name:this.name,type:this.type,range:this.range(),config:this.config()}}},{key:"render",value:function render(){return this.mount()&&(this.setTickConfig(),function renderAxis(axisInstance){var config=axisInstance.config(),renderConfig=axisInstance.renderConfig(),labelManager=axisInstance.dependencies().labelManager,mount=axisInstance.mount(),range=axisInstance.range(),axis=axisInstance.axis(),scale=axisInstance.scale(),domain=axisInstance.domain()||[],axisNameStyle=axisInstance._axisNameStyle,tickLabelStyle=axisInstance._tickLabelStyle,axisTickFormatter=axisInstance._tickFormatter,tickValues=axisInstance.tickValues,orientation=config.orientation,name=config.name,xOffset=config.xOffset,yOffset=config.yOffset,axisNamePadding=config.axisNamePadding,className=config.className,id=config.id,classPrefix=config.classPrefix,show=renderConfig.show,showAxisName=renderConfig.showAxisName,labels=renderConfig.labels;if(show&&domain.length){var tickSize=axisInstance.getTickSize(),selectContainer=makeElement(renderer_utils_selectElement(mount),"g",[axisInstance],"".concat(className),{},function(key){return key.config().id});labelManager.setStyle(tickLabelStyle);var labelFunc=scale.ticks||scale.quantile||scale.domain;axis.tickFormat(axisTickFormatter(tickValues||axis.tickValues()||labelFunc()));var availableSpace=Math.abs(range[0]-range[1]),labelProps=axisInstance.axisComponentDimensions().largestTickDimensions;selectContainer.attr("transform","translate(".concat(xOffset,",").concat(yOffset,")")),axis_renderer_setFixedBaseline(axisInstance),!1===labels.smartTicks||0===tickSize?selectContainer.transition().duration(1e3).on("end",axisInstance.registerAnimationDoneHook()).call(axis):selectContainer.call(axis),selectContainer.selectAll(".tick").classed("".concat(classPrefix,"-ticks"),!0),selectContainer.selectAll(".tick line").classed("".concat(classPrefix,"-tick-lines"),!0),selectContainer.selectAll(".tick text").classed("".concat(classPrefix,"-ticks"),!0).classed("".concat(classPrefix,"-ticks-").concat(id),!0),axis_renderer_changeTickOrientation(selectContainer,axisInstance,tickSize);var textNode=makeElement(selectContainer,"text",[name],"".concat(classPrefix,"-axis-name")).attr("text-anchor","middle").classed("".concat(classPrefix,"-axis-name-").concat(id),!0).text(function(d){return d});textNode.classed(HIDDEN,!showAxisName);var labelOffset=availableSpace/2;labelManager.setStyle(axisNameStyle);var axisNameSpace=labelManager.getOriSize(name),measures={labelProps:labelProps,tickSize:tickSize,axisNamePadding:axisNamePadding,axisNameHeight:axisNameSpace.height,axisNameWidth:axisNameSpace.width,yOffset:yOffset,xOffset:xOffset,labelOffset:labelOffset,availableSpace:axisInstance.availableSpace()};axis_renderer_setAxisNamePos(textNode,orientation,measures)}}(this)),this}},{key:"remove",value:function remove(){return renderer_utils_selectElement(this.mount()).remove(),this}},{key:"unsubscribe",value:function unsubscribe(){return this}},{key:"isReverse",value:function isReverse(){var range=this.range();return range[0]>range[1]}},{key:"getPixelToValueRatio",value:function getPixelToValueRatio(){var scale=this.scale(),range=scale.range(),domain=scale.domain();return Math.abs(range[1]-range[0])/(domain[1]-domain[0])}},{key:"animationDone",value:function animationDone(){return Promise.all(this._animationDonePromises)}},{key:"registerAnimationDoneHook",value:function registerAnimationDoneHook(){var resolveFn,promise=new Promise(function(resolve){resolveFn=resolve});return this._animationDonePromises.push(promise),function(){resolveFn()}}},{key:"id",get:function get(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return cartesian_axis_default_config_defaultConfig}}]),SimpleAxis}();function linear_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var linear_LinearInterpolator=function(){function LinearInterpolator(){!function linear_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LinearInterpolator)}return function linear_createClass(Constructor,protoProps,staticProps){return protoProps&&linear_defineProperties(Constructor.prototype,protoProps),staticProps&&linear_defineProperties(Constructor,staticProps),Constructor}(LinearInterpolator,[{key:"createScale",value:function createScale(config){var range=config.range,scaleFactory=scaleMap.linear;return this._scale=scaleFactory().range(range),this._scale}},{key:"getScaleValue",value:function getScaleValue(domainVal){return this._scale(domainVal)+.5}},{key:"sanitizeDomain",value:function sanitizeDomain(domain){return domain.length&&domain[0]===domain[1]&&(domain=[0,2*+domain[0]]),domain}}]),LinearInterpolator}();function log_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var log_LogInterpolator=function(){function LogInterpolator(){!function log_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LogInterpolator)}return function log_createClass(Constructor,protoProps,staticProps){return protoProps&&log_defineProperties(Constructor.prototype,protoProps),staticProps&&log_defineProperties(Constructor,staticProps),Constructor}(LogInterpolator,[{key:"createScale",value:function createScale(config){var range=config.range,base=config.base,scaleFactory=scaleMap.log;return this._scale=scaleFactory().range(range).base(base),this._scale}},{key:"getScaleValue",value:function getScaleValue(domainVal){return domainVal<=0?1:this._scale(domainVal)+.5}},{key:"sanitizeDomain",value:function sanitizeDomain(domain){return domain[0]<=0?[Math.max(1,domain[0]),Math.max(1,domain[1])]:domain}}]),LogInterpolator}();function pow_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _interpolatorMap,pow_PowInterpolator=function(){function PowInterpolator(){!function pow_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PowInterpolator)}return function pow_createClass(Constructor,protoProps,staticProps){return protoProps&&pow_defineProperties(Constructor.prototype,protoProps),staticProps&&pow_defineProperties(Constructor,staticProps),Constructor}(PowInterpolator,[{key:"createScale",value:function createScale(config){var range=config.range,exponent=config.exponent,scaleFactory=scaleMap.pow;return this._scale=scaleFactory().range(range).exponent(exponent),this._scale}},{key:"getScaleValue",value:function getScaleValue(domainVal){return this._scale(domainVal)+.5}},{key:"sanitizeDomain",value:function sanitizeDomain(domain){return domain}}]),PowInterpolator}();function continous_axis_typeof(obj){return(continous_axis_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function continous_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function continous_axis_possibleConstructorReturn(self,call){return!call||"object"!==continous_axis_typeof(call)&&"function"!=typeof call?function continous_axis_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function continous_axis_getPrototypeOf(o){return(continous_axis_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function continous_axis_setPrototypeOf(o,p){return(continous_axis_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function continous_axis_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var interpolatorMap=(continous_axis_defineProperty(_interpolatorMap={},LOG,log_LogInterpolator),continous_axis_defineProperty(_interpolatorMap,POW,pow_PowInterpolator),continous_axis_defineProperty(_interpolatorMap,LINEAR,linear_LinearInterpolator),_interpolatorMap),continous_axis_ContinousAxis=function(_SimpleAxis){function ContinousAxis(config,dependencies){return function continous_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ContinousAxis),config.tickFormat=config.tickFormat||function(val){return val},continous_axis_possibleConstructorReturn(this,continous_axis_getPrototypeOf(ContinousAxis).call(this,config,dependencies))}return function continous_axis_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&continous_axis_setPrototypeOf(subClass,superClass)}(ContinousAxis,simple_axis_SimpleAxis),function continous_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&continous_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&continous_axis_defineProperties(Constructor,staticProps),Constructor}(ContinousAxis,[{key:"createScale",value:function createScale(config){var base=config.base,padding=config.padding,interpolator=config.interpolator,exponent=config.exponent,range=this.range(),InterpolatorCls=interpolatorMap[interpolator];this._interpolator=new InterpolatorCls;var scale=this._interpolator.createScale({padding:padding,exponent:exponent,base:base,range:range});return scale=scale.nice()}},{key:"getScaleValue",value:function getScaleValue(domainVal){if(null!==domainVal&&void 0!==domainVal)return this._interpolator.getScaleValue(domainVal)}},{key:"getTickSize",value:function getTickSize(){var _this$renderConfig=this.renderConfig(),showInnerTicks=_this$renderConfig.showInnerTicks,showOuterTicks=_this$renderConfig.showOuterTicks,axis=this.axis();return axis.tickSizeInner(!1===showInnerTicks?0:6),axis.tickSizeOuter(!1===showOuterTicks?0:6),axis.tickSize()}},{key:"domain",value:function domain(_domain){return _domain?(Array.isArray(_domain)&&_domain.length?(_domain=getValidDomain(this,_domain),_domain=this._interpolator.sanitizeDomain(_domain),setContinousAxisDomain(this,_domain),this.setAxisComponentDimensions(),this.logicalSpace(null)):this._domain=[],this):this._domain}},{key:"setAvailableSpace",value:function setAvailableSpace(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,height=arguments.length>1?arguments[1]:void 0,padding=arguments.length>2?arguments[2]:void 0,isOffset=arguments.length>3?arguments[3]:void 0,labelConfig={},orientation=this.config().orientation;return this.availableSpace({width:width,height:height,padding:padding}),labelConfig=orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM?spaceSetter(this,{isOffset:isOffset}).continous.x():spaceSetter(this,{isOffset:isOffset}).continous.y(),this.renderConfig({labels:labelConfig}),this.setTickConfig(),this.getTickSize(),this}},{key:"setTickConfig",value:function setTickConfig(){var tickValues=this.config().tickValues,showInnerTicks=this.renderConfig().showInnerTicks,axis=this.axis();return showInnerTicks?tickValues?(tickValues instanceof Array&&this.axis().tickValues(tickValues),this):(axis.tickValues(this.getTickValues()),this):(axis.tickValues([]),this)}},{key:"getTickValues",value:function getTickValues(){var _this$config3=this.config(),orientation=_this$config3.orientation,tickValues=_this$config3.tickValues,range=this.range(),axis=this.axis(),availableSpace=Math.abs(range[0]-range[1]),labelProps=this.axisComponentDimensions().largestTickDimensions;return tickValues?axis.scale().ticks(tickValues):function getNumberOfTicks(availableSpace,labelDim,axis,axisInstance){var ticks=axis.scale().ticks(),numberOfTicks=axisInstance.config().numberOfTicks,tickLength=ticks.length,numberOfValues=tickLength;return tickLength*(1.5*labelDim)>availableSpace&&(numberOfValues=Math.floor(availableSpace/(1.5*labelDim))),numberOfValues=Math.min(numberOfTicks,Math.max(2,numberOfValues)),axis.scale().ticks(numberOfValues)}(availableSpace,labelProps[orientation===axis_orientation_BOTTOM||orientation===axis_orientation_TOP?"width":"height"],axis,this)}},{key:"getMinTickDifference",value:function getMinTickDifference(){return getSmallestDiff(this.config().tickValues)}},{key:"setFixedBaseline",value:function setFixedBaseline(tickText){var orientation=this.config().orientation,rotation=this.renderConfig().labels.rotation,axis=this.axis(),ticks=axis.scale().ticks(),_this$axisComponentDi=this.axisComponentDimensions().allTickDimensions[0],width=_this$axisComponentDi.width,height=_this$axisComponentDi.height;return axis.tickTransform(function(d){if(d===ticks[0]){if(orientation===axis_orientation_LEFT||orientation===axis_orientation_RIGHT)return"translate(0, -".concat(height/3,"px)");if((orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM)&&!rotation)return"translate(".concat(width/2,"px,  ",0,"px)")}return""}),tickText}}],[{key:"type",value:function type(){return LINEAR}}]),ContinousAxis}();function band_axis_typeof(obj){return(band_axis_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function band_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function band_axis_possibleConstructorReturn(self,call){return!call||"object"!==band_axis_typeof(call)&&"function"!=typeof call?function band_axis_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=band_axis_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function band_axis_getPrototypeOf(o){return(band_axis_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function band_axis_setPrototypeOf(o,p){return(band_axis_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var band_axis_BandAxis=function(_SimpleAxis){function BandAxis(){return function band_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BandAxis),band_axis_possibleConstructorReturn(this,band_axis_getPrototypeOf(BandAxis).apply(this,arguments))}return function band_axis_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&band_axis_setPrototypeOf(subClass,superClass)}(BandAxis,simple_axis_SimpleAxis),function band_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&band_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&band_axis_defineProperties(Constructor,staticProps),Constructor}(BandAxis,[{key:"createScale",value:function createScale(config){return _get(band_axis_getPrototypeOf(BandAxis.prototype),"createScale",this).call(this,config)}},{key:"setAvailableSpace",value:function setAvailableSpace(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,height=arguments.length>1?arguments[1]:void 0,padding=arguments.length>2?arguments[2]:void 0,isOffset=arguments.length>3?arguments[3]:void 0,labelConfig={},orientation=this.config().orientation;return this.availableSpace({width:width,height:height,padding:padding}),labelConfig=orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM?spaceSetter(this,{isOffset:isOffset}).band.x():spaceSetter(this,{isOffset:isOffset}).band.y(),this.renderConfig({labels:labelConfig}),this.setTickConfig(),this}},{key:"setTickConfig",value:function setTickConfig(){var smartlabel,smartTicks="",domain=this.domain(),labelManager=this._dependencies.labelManager,_this$config2=this.config(),tickValues=_this$config2.tickValues,padding=_this$config2.padding,labels=this.renderConfig().labels,_this$maxTickSpaces=this.maxTickSpaces(),availHeight=_this$maxTickSpaces.height,availWidth=_this$maxTickSpaces.width,noWrap=_this$maxTickSpaces.noWrap,_getRotatedSpaces=getRotatedSpaces(labels.rotation,availWidth,availHeight),width=_getRotatedSpaces.width,height=_getRotatedSpaces.height;if(tickValues&&this.axis().tickValues(tickValues),smartTicks=tickValues||domain,labelManager.setStyle(this._tickLabelStyle),"number"==typeof padding&&padding>=0&&padding<=1&&this.scale().padding(padding),domain&&domain.length){var values=tickValues||domain,tickFormatter=this._tickFormatter(values);smartTicks=values.map(function(d,i){return labelManager.useEllipsesOnOverflow(!0),smartlabel=labelManager.getSmartText(tickFormatter(d,i),width,height,noWrap),labelManager.constructor.textToLines(smartlabel)})}return this.smartTicks(smartTicks),this}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||(this.logicalSpace(helper_calculateBandSpace(this)),helper_setOffset(this),this.logicalSpace()),this.logicalSpace()}},{key:"getTickValues",value:function getTickValues(){return this.axis().scale().domain()}},{key:"getUnitWidth",value:function getUnitWidth(){return this.scale().bandwidth()}},{key:"getTickSize",value:function getTickSize(){var _this$renderConfig2=this.renderConfig(),showInnerTicks=_this$renderConfig2.showInnerTicks,showOuterTicks=_this$renderConfig2.showOuterTicks,axis=this.axis();return axis.tickSizeInner(showInnerTicks?6:0),axis.tickSizeOuter(showOuterTicks?6:0),axis.tickSize()}},{key:"invert",value:function invert(){for(var _this=this,_len=arguments.length,value=new Array(_len),_key=0;_key<_len;_key++)value[_key]=arguments[_key];var values=value.map(function(d){return _this.scale().invert(d)})||[];return 1===value.length?values[0]&&values[0].toString():values.map(function(d){return d.toString()})}}],[{key:"type",value:function type(){return BAND}}]),BandAxis}();function time_axis_typeof(obj){return(time_axis_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function time_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function time_axis_possibleConstructorReturn(self,call){return!call||"object"!==time_axis_typeof(call)&&"function"!=typeof call?function time_axis_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function time_axis_get(target,property,receiver){return(time_axis_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function time_axis_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=time_axis_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function time_axis_getPrototypeOf(o){return(time_axis_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function time_axis_setPrototypeOf(o,p){return(time_axis_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var time_axis_TimeAxis=function(_SimpleAxis){function TimeAxis(){var _getPrototypeOf2,_this;!function time_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TimeAxis);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=time_axis_possibleConstructorReturn(this,(_getPrototypeOf2=time_axis_getPrototypeOf(TimeAxis)).call.apply(_getPrototypeOf2,[this].concat(params))))._minDiff=1/0,_this}return function time_axis_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&time_axis_setPrototypeOf(subClass,superClass)}(TimeAxis,simple_axis_SimpleAxis),function time_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&time_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&time_axis_defineProperties(Constructor,staticProps),Constructor}(TimeAxis,[{key:"createScale",value:function createScale(range){var scale=time_axis_get(time_axis_getPrototypeOf(TimeAxis.prototype),"createScale",this).call(this,range);return scale=scale.nice()}},{key:"createAxis",value:function createAxis(config){var orientation=config.orientation,axisClass=axisOrientationMap[orientation];return axisClass?axisClass(this.scale()):null}},{key:"getTickFormatter",value:function getTickFormatter(value){var _this2=this,tickFormat=value.tickFormat;return tickFormat?function(ticks){var rawTicks=ticks.map(function(t){return t.getTime()});return function(val,i){return tickFormat(val,val.getTime(),i,rawTicks)}}:function(){return function(text){return _this2.scale().tickFormat()(text)}}}},{key:"getTickSize",value:function getTickSize(){var _this$renderConfig=this.renderConfig(),showInnerTicks=_this$renderConfig.showInnerTicks,showOuterTicks=_this$renderConfig.showOuterTicks,axis=this.axis();return axis.tickSizeInner(!1===showInnerTicks?0:6),axis.tickSizeOuter(!1===showOuterTicks?0:6),time_axis_get(time_axis_getPrototypeOf(TimeAxis.prototype),"getTickSize",this).call(this)}},{key:"getTickValues",value:function getTickValues(){return this.config().tickValues||this.scale().ticks()}},{key:"minDiff",value:function minDiff(diff){return this._minDiff=Math.min(this._minDiff,diff),this}},{key:"domain",value:function domain(_domain){return _domain?(_domain=getValidDomain(this,_domain),setContinousAxisDomain(this,_domain),this.setAxisComponentDimensions(),this.logicalSpace(null),this):this._domain}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||(this.logicalSpace(helper_calculateBandSpace(this)),this.logicalSpace(),helper_setOffset(this)),this.logicalSpace()}},{key:"getMinTickDifference",value:function getMinTickDifference(){return getSmallestDiff(this.config().tickValues)}},{key:"setAvailableSpace",value:function setAvailableSpace(){var width=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,height=arguments.length>1?arguments[1]:void 0,padding=arguments.length>2?arguments[2]:void 0,isOffset=arguments.length>3?arguments[3]:void 0,labelConfig={},orientation=this.config().orientation;return this.availableSpace({width:width,height:height,padding:padding}),labelConfig=orientation===axis_orientation_TOP||orientation===axis_orientation_BOTTOM?spaceSetter(this,{isOffset:isOffset}).time.x():spaceSetter(this,{isOffset:isOffset}).time.y(),this.renderConfig({labels:labelConfig}),this.setTickConfig(),this.getTickSize(),this}},{key:"setTickConfig",value:function setTickConfig(){var smartTicks,smartlabel,tickValues=this.config().tickValues,labels=this.renderConfig().labels,_this$maxTickSpaces=this.maxTickSpaces(),availHeight=_this$maxTickSpaces.height,availWidth=_this$maxTickSpaces.width,noWrap=_this$maxTickSpaces.noWrap,labelManager=this._dependencies.labelManager,domain=this.getTickValues();tickValues&&this.axis().tickValues(tickValues);var _getRotatedSpaces=getRotatedSpaces(labels.rotation,availWidth,availHeight),width=_getRotatedSpaces.width,height=_getRotatedSpaces.height;if(smartTicks=tickValues||domain,labelManager.setStyle(this._tickLabelStyle),domain&&domain.length){var values=tickValues||domain,tickFormatter=this._tickFormatter(values);smartTicks=values.map(function(d,i){return labelManager.useEllipsesOnOverflow(!0),smartlabel=labelManager.getSmartText(tickFormatter(d,i),width,height,noWrap),labelManager.constructor.textToLines(smartlabel)})}return this.smartTicks(smartTicks),this}}],[{key:"type",value:function type(){return TIME}}]),TimeAxis}(),x11Colors={Pink:{hex:"ffc0cb",rgb:"255,192,203"},LightPink:{hex:"ffb6c1",rgb:"255,182,193"},HotPink:{hex:"ff69b4",rgb:"255,105,180"},DeepPink:{hex:"ff1493",rgb:"255,20,147"},PaleVioletRed:{hex:"db7093",rgb:"219,112,147"},MediumVioletRed:{hex:"c71585",rgb:"199,21,133"},LightSalmon:{hex:"ffa07a",rgb:"255,160,122"},Salmon:{hex:"fa8072",rgb:"250,128,114"},DarkSalmon:{hex:"e9967a",rgb:"233,150,122"},LightCoral:{hex:"f08080",rgb:"240,128,128"},IndianRed:{hex:"cd5c5c",rgb:"205,92,92"},Crimson:{hex:"dc143c",rgb:"220,20,60"},FireBrick:{hex:"b22222",rgb:"178,34,34"},DarkRed:{hex:"8b0000",rgb:"139,0,0"},Red:{hex:"ff0000",rgb:"255,0,0"},OrangeRed:{hex:"ff4500",rgb:"255,69,0"},Tomato:{hex:"ff6347",rgb:"255,99,71"},Coral:{hex:"ff7f50",rgb:"255,127,80"},DarkOrange:{hex:"ff8c00",rgb:"255,140,0"},Orange:{hex:"ffa500",rgb:"255,165,0"},Gold:{hex:"ffd700",rgb:"255,215,0"},Yellow:{hex:"ffff00",rgb:"255,255,0"},LightYellow:{hex:"ffffe0",rgb:"255,255,224"},LemonChiffon:{hex:"fffacd",rgb:"255,250,205"},LightGoldenrodYellow:{hex:"fafad2",rgb:"250,250,210"},PapayaWhip:{hex:"ffefd5",rgb:"255,239,213"},Moccasin:{hex:"ffe4b5",rgb:"255,228,181"},PeachPuff:{hex:"ffdab9",rgb:"255,218,185"},PaleGoldenrod:{hex:"eee8aa",rgb:"238,232,170"},Khaki:{hex:"f0e68c",rgb:"240,230,140"},DarkKhaki:{hex:"bdb76b",rgb:"189,183,107"},Cornsilk:{hex:"fff8dc",rgb:"255,248,220"},BlanchedAlmond:{hex:"ffebcd",rgb:"255,235,205"},Bisque:{hex:"ffe4c4",rgb:"255,228,196"},NavajoWhite:{hex:"ffdead",rgb:"255,222,173"},Wheat:{hex:"f5deb3",rgb:"245,222,179"},BurlyWood:{hex:"deb887",rgb:"222,184,135"},Tan:{hex:"d2b48c",rgb:"210,180,140"},RosyBrown:{hex:"bc8f8f",rgb:"188,143,143"},SandyBrown:{hex:"f4a460",rgb:"244,164,96"},Goldenrod:{hex:"daa520",rgb:"218,165,32"},DarkGoldenrod:{hex:"b8860b",rgb:"184,134,11"},Peru:{hex:"cd853f",rgb:"205,133,63"},Chocolate:{hex:"d2691e",rgb:"210,105,30"},SaddleBrown:{hex:"8b4513",rgb:"139,69,19"},Sienna:{hex:"a0522d",rgb:"160,82,45"},Brown:{hex:"a52a2a",rgb:"165,42,42"},Maroon:{hex:"800000",rgb:"128,0,0"},DarkOliveGreen:{hex:"556b2f",rgb:"85,107,47"},Olive:{hex:"808000",rgb:"128,128,0"},OliveDrab:{hex:"6b8e23",rgb:"107,142,35"},YellowGreen:{hex:"9acd32",rgb:"154,205,50"},LimeGreen:{hex:"32cd32",rgb:"50,205,50"},Lime:{hex:"00ff00",rgb:"0,255,0"},LawnGreen:{hex:"7cfc00",rgb:"124,252,0"},Chartreuse:{hex:"7fff00",rgb:"127,255,0"},GreenYellow:{hex:"adff2f",rgb:"173,255,47"},SpringGreen:{hex:"00ff7f",rgb:"0,255,127"},MediumSpringGreen:{hex:"00fa9a",rgb:"0,250,154"},LightGreen:{hex:"90ee90",rgb:"144,238,144"},PaleGreen:{hex:"98fb98",rgb:"152,251,152"},DarkSeaGreen:{hex:"8fbc8f",rgb:"143,188,143"},MediumSeaGreen:{hex:"3cb371",rgb:"60,179,113"},SeaGreen:{hex:"2e8b57",rgb:"46,139,87"},ForestGreen:{hex:"228b22",rgb:"34,139,34"},Green:{hex:"008000",rgb:"0,128,0"},DarkGreen:{hex:"006400",rgb:"0,100,0"},MediumAquamarine:{hex:"66cdaa",rgb:"102,205,170"},Aqua:{hex:"00ffff",rgb:"0,255,255"},Cyan:{hex:"00ffff",rgb:"0,255,255"},LightCyan:{hex:"e0ffff",rgb:"224,255,255"},PaleTurquoise:{hex:"afeeee",rgb:"175,238,238"},Aquamarine:{hex:"7fffd4",rgb:"127,255,212"},Turquoise:{hex:"40e0d0",rgb:"64,224,208"},MediumTurquoise:{hex:"48d1cc",rgb:"72,209,204"},DarkTurquoise:{hex:"00ced1",rgb:"0,206,209"},LightSeaGreen:{hex:"20b2aa",rgb:"32,178,170"},CadetBlue:{hex:"5f9ea0",rgb:"95,158,160"},DarkCyan:{hex:"008b8b",rgb:"0,139,139"},Teal:{hex:"008080",rgb:"0,128,128"},LightSteelBlue:{hex:"b0c4de",rgb:"176,196,222"},PowderBlue:{hex:"b0e0e6",rgb:"176,224,230"},LightBlue:{hex:"add8e6",rgb:"173,216,230"},SkyBlue:{hex:"87ceeb",rgb:"135,206,235"},LightSkyBlue:{hex:"87cefa",rgb:"135,206,250"},DeepSkyBlue:{hex:"00bfff",rgb:"0,191,255"},DodgerBlue:{hex:"1e90ff",rgb:"30,144,255"},CornflowerBlue:{hex:"6495ed",rgb:"100,149,237"},SteelBlue:{hex:"4682b4",rgb:"70,130,180"},RoyalBlue:{hex:"4169e1",rgb:"65,105,225"},Blue:{hex:"0000ff",rgb:"0,0,255"},MediumBlue:{hex:"0000cd",rgb:"0,0,205"},DarkBlue:{hex:"00008b",rgb:"0,0,139"},Navy:{hex:"000080",rgb:"0,0,128"},MidnightBlue:{hex:"191970",rgb:"25,25,112"},Lavender:{hex:"e6e6fa",rgb:"230,230,250"},Thistle:{hex:"d8bfd8",rgb:"216,191,216"},Plum:{hex:"dda0dd",rgb:"221,160,221"},Violet:{hex:"ee82ee",rgb:"238,130,238"},Orchid:{hex:"da70d6",rgb:"218,112,214"},Fuchsia:{hex:"ff00ff",rgb:"255,0,255"},Magenta:{hex:"ff00ff",rgb:"255,0,255"},MediumOrchid:{hex:"ba55d3",rgb:"186,85,211"},MediumPurple:{hex:"9370db",rgb:"147,112,219"},BlueViolet:{hex:"8a2be2",rgb:"138,43,226"},DarkViolet:{hex:"9400d3",rgb:"148,0,211"},DarkOrchid:{hex:"9932cc",rgb:"153,50,204"},DarkMagenta:{hex:"8b008b",rgb:"139,0,139"},Purple:{hex:"800080",rgb:"128,0,128"},Indigo:{hex:"4b0082",rgb:"75,0,130"},DarkSlateBlue:{hex:"483d8b",rgb:"72,61,139"},SlateBlue:{hex:"6a5acd",rgb:"106,90,205"},MediumSlateBlue:{hex:"7b68ee",rgb:"123,104,238"},White:{hex:"ffffff",rgb:"255,255,255"},Snow:{hex:"fffafa",rgb:"255,250,250"},Honeydew:{hex:"f0fff0",rgb:"240,255,240"},MintCream:{hex:"f5fffa",rgb:"245,255,250"},Azure:{hex:"f0ffff",rgb:"240,255,255"},AliceBlue:{hex:"f0f8ff",rgb:"240,248,255"},GhostWhite:{hex:"f8f8ff",rgb:"248,248,255"},WhiteSmoke:{hex:"f5f5f5",rgb:"245,245,245"},Seashell:{hex:"fff5ee",rgb:"255,245,238"},Beige:{hex:"f5f5dc",rgb:"245,245,220"},OldLace:{hex:"fdf5e6",rgb:"253,245,230"},FloralWhite:{hex:"fffaf0",rgb:"255,250,240"},Ivory:{hex:"fffff0",rgb:"255,255,240"},AntiqueWhite:{hex:"faebd7",rgb:"250,235,215"},Linen:{hex:"faf0e6",rgb:"250,240,230"},LavenderBlush:{hex:"fff0f5",rgb:"255,240,245"},MistyRose:{hex:"ffe4e1",rgb:"255,228,225"},Gainsboro:{hex:"dcdcdc",rgb:"220,220,220"},LightGray:{hex:"d3d3d3",rgb:"211,211,211"},Silver:{hex:"c0c0c0",rgb:"192,192,192"},DarkGrey:{hex:"a9a9a9",rgb:"169,169,169"},Grey:{hex:"808080",rgb:"128,128,128"},DimGrey:{hex:"696969",rgb:"105,105,105"},LightSlateGrey:{hex:"778899",rgb:"119,136,153"},SlateGrey:{hex:"708090",rgb:"112,128,144"},DarkSlateGrey:{hex:"2f4f4f",rgb:"47,79,79"},Black:{hex:"000000",rgb:"0,0,0"}},palette=["#086bb6","#f37d45","#f5ce02","#67bda0","#c54e4e","#ae70af"],DEFAULT_GRADIENT_COLOR="#eaeaea",DEFAULT_CONFIG={range:palette,value:palette[0],step:!1,stops:5,type:constants_LINEAR};function props_toConsumableArray(arr){return function props_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function props_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function props_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var props_getHslString=function getHslString(hslArr){return"hsla(".concat(360*hslArr[0],",").concat(100*hslArr[1],"%,").concat(100*hslArr[2],"%,").concat(hslArr[3]||1,")")},convertToXllString=function convertToXllString(baseString){return(baseString.split(" ")||[]).reduce(function(x,e){return"".concat(x).concat(e.charAt(0).toUpperCase()).concat(e.slice(1))},"")},props_getActualHslColor=function getActualHslColor(e,paletteColor){var color="";if("string"==typeof e)if(e=(e=e.replace(/ /g,"")).toLowerCase(),"hsl"===detectColor(e)||"hsla"===detectColor(e))color=[(color=e.match(/(\d+(\.\d+)?)/g))[0]/360,color[1]/100,color[2]/100,color[3]||1];else if("hex"===detectColor(e))color=function hexToHsv(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex),r=parseInt(result[1],16),g=parseInt(result[2],16),b=parseInt(result[3],16),a=result[4]?parseInt(result[4],16):1;return rgbToHsv(r,g,b,a)}(e);else if("rgb"===detectColor(e)){var col=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/);color=rgbToHsv.apply(void 0,props_toConsumableArray(col))}else x11Colors[convertToXllString(e)]&&(color=rgbToHsv.apply(void 0,props_toConsumableArray(x11Colors[convertToXllString(e)].rgb.split(","))));else color=e instanceof Array?e:rgbToHsv(paletteColor);return color},props_PROPS={config:{sanitization:function sanitization(context,config){var defCon=mergeRecursive({},context.constructor.defaultConfig());config.type===constants_LINEAR&&(config.range=config.range||[defCon.range[0]],config.range=config.range.length>1?config.range:[DEFAULT_GRADIENT_COLOR].concat(props_toConsumableArray(config.range)));var oldConfig=mergeRecursive(defCon,context.config()),newConfig=mergeRecursive(oldConfig,config);return newConfig.range instanceof Array&&(newConfig.range=newConfig.range.map(function(e,i){return props_getActualHslColor(e,palette[i])}),newConfig.stops=config.stops||newConfig.range.length),newConfig.value=props_getActualHslColor(newConfig.value,newConfig.value),newConfig}},domain:{},scale:{},uniqueValues:{}};function color_strategy_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function color_strategy_toConsumableArray(arr){return function color_strategy_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function color_strategy_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function color_strategy_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var color_strategy_getStops=function getStops(domain,stops){var newStops=[];if(stops instanceof Array)newStops=stops.slice().sort(),newStops=color_strategy_toConsumableArray(new Set([domain[0]].concat(color_strategy_toConsumableArray(stops),[domain[1]]))).sort();else for(var interpolator=common_utils_numberInterpolator().apply(void 0,color_strategy_toConsumableArray(domain)),i=0;i<=stops;i++)newStops[i]=interpolator(i/stops);return newStops[0]<domain[0]&&newStops.shift(),{domain:domain,newStops:newStops}},color_strategy_rangeStops=function rangeStops(newStopsLength,range){var newRange=[];if(newStopsLength>Math.min(range.length,18))for(var interpolator=common_utils_piecewiseInterpolator()(function hslInterpolator(){return hslLong}(),range.map(function(e){return props_getHslString(e)})),i=0;i<newStopsLength;i++)newRange[i]=interpolator(i/(newStopsLength-1));else newRange=range.slice(0,newStopsLength);return{newRange:newRange}},indexedDomain=function indexedDomain(domain){var uniqueVals=domain;return{domain:domain.map(function(d,i){return i/(domain.length-1)}),uniqueVals:uniqueVals,scaleDomain:[0,1]}},indexedDomainMeasure=function indexedDomainMeasure(domain,stops,range){return{domain:domain,uniqueVals:domain,scaleDomain:[0,1],range:range}},normalDomain=function normalDomain(domain,stops,range){return{uniqueVals:domain,domain:domain,nice:!0,range:range}},color_strategy_steppedDomain=function steppedDomain(domain,stops,range){var _getStops=color_strategy_getStops(domain,stops),uniqueVals=_getStops.domain,newStops=_getStops.newStops;return{uniqueVals:uniqueVals,domain:newStops,nice:!0,range:color_strategy_rangeStops(newStops.length-1,range).newRange}},color_strategy_continousSteppedDomain=function continousSteppedDomain(domain,stops,range){var _getStops2=color_strategy_getStops(domain,range.length-1);return{uniqueVals:_getStops2.domain,domain:_getStops2.newStops,nice:!0,range:range.map(function(e){return props_getHslString(e)})}},uniqueRange=function uniqueRange(domainValue,scale,domain,uniqueVals){return scale(domain[uniqueVals.indexOf(domainValue)])},indexedRange=function indexedRange(domainValue,scale,domain){return scale((domainValue-domain[0])/(domain[domain.length-1]-domain[0]))},normalRange=function normalRange(domainValue,scale){return scale(domainValue)},strategyGetter=function strategyGetter(domainType,rangeType,schemeType,stops){return function strategies(){var _ref;return color_strategy_defineProperty(_ref={},"".concat(CONTINOUS,"-").concat(CONTINOUS,"-").concat(SEQUENTIAL),{scale:SEQUENTIAL,domainRange:function domainRange(){return indexedDomainMeasure},value:function value(){return indexedRange}}),color_strategy_defineProperty(_ref,"".concat(CONTINOUS,"-").concat(DISCRETE,"-").concat(SEQUENTIAL),{scale:SEQUENTIAL,domainRange:function domainRange(){return indexedDomainMeasure},value:function value(){return indexedRange}}),color_strategy_defineProperty(_ref,"".concat(DISCRETE,"-").concat(DISCRETE,"-").concat(SEQUENTIAL),{scale:SEQUENTIAL,domainRange:function domainRange(){return indexedDomain},value:function value(){return uniqueRange}}),color_strategy_defineProperty(_ref,"".concat(DISCRETE,"-").concat(DISCRETE,"-").concat(ORDINAL),{scale:ORDINAL,domainRange:function domainRange(){return normalDomain},value:function value(){return normalRange}}),color_strategy_defineProperty(_ref,"".concat(CONTINOUS,"-").concat(CONTINOUS,"-").concat(ORDINAL),{scale:LINEAR,domainRange:function domainRange(){return color_strategy_continousSteppedDomain},value:function value(){return normalRange}}),color_strategy_defineProperty(_ref,"".concat(CONTINOUS,"-").concat(DISCRETE,"-").concat(ORDINAL),{scale:QUANTILE,domainRange:function domainRange(){return color_strategy_steppedDomain},value:function value(){return normalRange}}),_ref}()["".concat(domainType,"-").concat(rangeType,"-").concat(schemeType||"")]};function color_axis_toConsumableArray(arr){return function color_axis_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function color_axis_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function color_axis_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function color_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _strategies,color_axis_ColorAxis=function(){function ColorAxis(config){!function color_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ColorAxis),generateGetterSetters(this,props_PROPS),this.config(config),this._domainType="linear"===this._config.type?CONTINOUS:DISCRETE,this._rangeType="linear"!==this._config.type||this._config.step?DISCRETE:CONTINOUS,this._schemeType=function getSchemeType(scheme){return scheme&&"string"==typeof scheme&&"i"===scheme[0]?constants_SEQUENTIAL:constants_ORDINAL}(this._config.range),this._colorStrategy=this.setColorStrategy(this._domainType,this._rangeType,this._schemeType),this._scale=this.createScale(this._colorStrategy),this._id=getUniqueId(),this.updateDomain(config.domain)}return function color_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&color_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&color_axis_defineProperties(Constructor,staticProps),Constructor}(ColorAxis,[{key:"createScale",value:function createScale(colorStrategy){var range=this.config().range;return range&&"string"==typeof range?function getScheme(scheme){return"i"===scheme[0]?scaleSequential(color_schemes_namespaceObject[scheme]):scaleOrdinal(color_schemes_namespaceObject[scheme])}(range):scale_creator_createScale({type:colorStrategy.scale,range:range})}},{key:"setColorStrategy",value:function setColorStrategy(domainType,rangeType,schemeType){this.config().stops;return strategyGetter(domainType,rangeType,schemeType)}},{key:"getHslString",value:function getHslString(hslColorArray){return props_getHslString(hslColorArray)}},{key:"getColor",value:function getColor(domainVal){return this.getHslString(this.getRawColor(domainVal))}},{key:"getRawColor",value:function getRawColor(domainVal){if(this.domain()&&void 0!==domainVal){var scale=this.scale(),range=scale.range?scale.range():null,color=this._colorStrategy.value(range)(domainVal,scale,this.domain(),this.uniqueValues());if("string"==typeof color){var col=color.substring(color.indexOf("(")+1,color.lastIndexOf(")")).split(/,\s*/);return rgbToHsv.apply(void 0,color_axis_toConsumableArray(col))}return color_axis_toConsumableArray(color)}return color_axis_toConsumableArray(this.config().value)}},{key:"updateDomain",value:function updateDomain(){var domain=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(domain.length){var scale=this.scale(),range=scale.range?scale.range():null,scaleInfo=this._colorStrategy.domainRange()(domain,this.config().stops,range);this.domain(scaleInfo.domain),scaleInfo.range&&this.scale().range(scaleInfo.range),this.uniqueValues(scaleInfo.uniqueVals),this.scale().domain(scaleInfo.scaleDomain||this.domain())}return this}},{key:"serialize",value:function serialize(){return{type:this.constructor.type(),scale:this.scale(),domain:this.domain(),config:this.config()}}},{key:"transformColor",value:function transformColor(color,transformationArr){var h=360*color[0],s=100*color[1],l=100*color[2],a=color[3]||1,newH=h+transformationArr[0],newS=s+transformationArr[1],newL=l+transformationArr[2],newA=a+transformationArr[3]||0;return{color:"hsla(".concat(newH,",").concat(newS,"%,").concat(newL,"%,").concat(newA,")"),hsla:[newH/360,newS/100,newL/100,newA]}}},{key:"id",value:function id(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return DEFAULT_CONFIG}},{key:"type",value:function type(){return"color"}}]),ColorAxis}(),defaults_DEFAULT_CONFIG={value:36,range:[36,1e3]};function size_strategy_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function size_strategy_toConsumableArray(arr){return function size_strategy_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function size_strategy_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function size_strategy_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var size_strategy_strategies=(size_strategy_defineProperty(_strategies={},"".concat(DISCRETE,"-").concat(CONTINOUS),{scale:LINEAR,domain:function indexedDomain(domain){var uniqueVals=domain;return{domain:domain.map(function(d,i){return i/(domain.length-1)}),uniqueVals:uniqueVals,scaleDomain:[0,1]}},range:function pieceWiseRange(domainValue,scale,domain,uniqueVals){var numVal=domain[uniqueVals.indexOf(domainValue)];return common_utils_piecewiseInterpolator()(common_utils_numberInterpolator(),size_strategy_toConsumableArray(scale.range()))(numVal)}}),size_strategy_defineProperty(_strategies,"".concat(CONTINOUS,"-").concat(CONTINOUS),{scale:LINEAR,domain:function normalDomain(domain){return{uniqueVals:domain,domain:domain}},range:function normalRange(domainValue,scale){return scale(domainValue)}}),size_strategy_defineProperty(_strategies,"".concat(CONTINOUS,"-").concat(DISCRETE),{scale:THRESHOLD,domain:function steppedDomain(domain,intervals){var newIntervals=[];if(intervals instanceof Array)newIntervals=intervals.slice().sort();else for(var interpolator=common_utils_numberInterpolator().apply(void 0,size_strategy_toConsumableArray(domain)),i=0;i<intervals;i++)newIntervals[i]=interpolator(i/(intervals-1));return newIntervals[0]<domain[0]&&newIntervals.shift(),{uniqueVals:newIntervals,domain:newIntervals,nice:!0}},range:function discreteRange(domainValue,scale,domain){var numVal=(domainValue-domain[0])/(domain[domain.length-1]-domain[0]);return common_utils_numberInterpolator().apply(void 0,size_strategy_toConsumableArray(scale.range()))(numVal)}}),_strategies),size_axis_props_PROPS={config:{},domain:{sanitization:function sanitization(context,value){return context.scale().domain(value),value}},range:{},scale:{},uniqueValues:{}};function size_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var size_axis_SizeAxis=function(){function SizeAxis(config){!function size_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SizeAxis),generateGetterSetters(this,size_axis_props_PROPS),this._id=getUniqueId(),this._config=Object.assign({},this.constructor.defaultConfig(),config),this._domainType="linear"===this._config.type?CONTINOUS:DISCRETE,this._rangeType=CONTINOUS,this._sizeStrategy=this.setStrategy(this._domainType,this._rangeType),this._scale=this.createScale(this._sizeStrategy),this._range=this._config.range,this.updateDomain(config.domain)}return function size_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&size_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&size_axis_defineProperties(Constructor,staticProps),Constructor}(SizeAxis,[{key:"setStrategy",value:function setStrategy(domainType,rangeType){return function strategyGetter(domainType,rangeType){return size_strategy_strategies["".concat(domainType,"-").concat(rangeType)]}(domainType,rangeType)}},{key:"createScale",value:function createScale(strategy){var range=this.config().range;return scale_creator_createScale({type:strategy.scale,range:range})}},{key:"getSize",value:function getSize(){var domainVal=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,value=this.config().value,scale=this.scale(),domain=this.domain()||[1,1];return scale&&domain[0]!==domain[1]?this._sizeStrategy.range(domainVal,scale,this.domain(),this.uniqueValues()):value}},{key:"updateDomain",value:function updateDomain(domain){if(domain){var domainInfo=(0,this._sizeStrategy.domain)(domain,this.config().intervals);this.domain(domainInfo.domain),this.uniqueValues(domainInfo.uniqueVals),this.scale().domain(domainInfo.scaleDomain||this.domain())}return this}},{key:"serialize",value:function serialize(){return{type:this.constructor.type(),scale:this.scale(),domain:this.domain(),range:this.range(),config:this.config()}}},{key:"id",value:function id(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return defaults_DEFAULT_CONFIG}},{key:"type",value:function type(){return"size"}}]),SizeAxis}(),shape_axis_defaults_DEFAULT_CONFIG={generator:null,value:"circle",range:["circle","diamond","star","cross","square","wye","triangle"]},shape_axis_props_PROPS={config:{},domain:{},scale:{},uniqueValues:{},generator:{}};function shape_axis_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _dataTypeScaleMap,shape_axis_ShapeAxis=function(){function ShapeAxis(config){!function shape_axis_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ShapeAxis),generateGetterSetters(this,shape_axis_props_PROPS),this._id=getUniqueId(),this._config=Object.assign({},this.constructor.defaultConfig()),this._config=mergeRecursive(this._config,config),this._scale=scale_creator_createScale({type:"ordinal",range:this._config.range}),this.updateDomain(config.domain)}return function shape_axis_createClass(Constructor,protoProps,staticProps){return protoProps&&shape_axis_defineProperties(Constructor.prototype,protoProps),staticProps&&shape_axis_defineProperties(Constructor,staticProps),Constructor}(ShapeAxis,[{key:"getShape",value:function getShape(value){if(!this.scale()||!this.domain()||!value)return this.config().value;if(this._generatedShapes)return this._generatedShapes[value];var shapeType=this.scale()(value);return"string"===shapeType?common_utils_getSymbol(shapeType):shapeType}},{key:"updateDomain",value:function updateDomain(){var domain=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return domain.length&&(this.uniqueValues(domain),this.domain(domain),this.scale().domain(domain),this.config().generator&&(this._generatedShapes=function shapeGenerator(domain,generatorFn){var generatedShapes={};return domain.forEach(function(value){generatedShapes[value]=generatorFn(value)}),generatedShapes}(domain,this.config().generator))),this}},{key:"serialize",value:function serialize(){return{type:this.constructor.type(),scale:this.scale(),domain:this.domain(),range:this.config().range,config:this.config()}}},{key:"id",value:function id(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return shape_axis_defaults_DEFAULT_CONFIG}},{key:"type",value:function type(){return"shape"}}]),ShapeAxis}();function data_type_scale_map_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var DATA_TYPES_MEASURE="measure",DATA_TYPES_TEMPORAL="temporal",group_transform=(data_type_scale_map_defineProperty(_dataTypeScaleMap={},"dimension",BAND),data_type_scale_map_defineProperty(_dataTypeScaleMap,DATA_TYPES_MEASURE,LINEAR),data_type_scale_map_defineProperty(_dataTypeScaleMap,DATA_TYPES_TEMPORAL,TIME),function(schema,data,config){var groupBy=config.groupBy instanceof Array?config.groupBy:[config.groupBy],groupByIndices=groupBy.map(function(fieldName){return schema.findIndex(function(d){return d.name===fieldName})});if(void 0!==groupByIndices.find(function(d){return-1===d}))throw new Error("Groupby field ".concat(groupBy," not found in schema"));return function nestCollection(params){var nestFn=src_nest();return params.keys.forEach(function(key){return nestFn.key(function(d){return d[key]})}),nestFn.entries(params.data)}({keys:groupByIndices,data:data})});var _transformMap;function transform_factory_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var transformMap=(transform_factory_defineProperty(_transformMap={},"identity",function identityTransform(schema,data,config){return data}),transform_factory_defineProperty(_transformMap,"group",group_transform),transform_factory_defineProperty(_transformMap,"stack",function(schema,data,config){var uniqueField=config.uniqueField,valueField=config.value,groupBy=config.groupBy,sort=config.sort||"descending",normalizedData=function normalizeData(data,schema,valueField,uniqueField,groupBy){var groupedData=group_transform(schema,data,{groupBy:uniqueField}),uniqueFieldIndex=schema.findIndex(function(d){return d.name===uniqueField}),valueFieldIndex=schema.findIndex(function(d){return d.name===valueField}),seriesKeyIndex=schema.findIndex(function(d){return d.name===groupBy}),seriesKeys=data.map(function(d){return d[seriesKeyIndex]}).filter(function(item,pos,arr){return arr.indexOf(item)===pos}).sort(),fieldNames=schema.reduce(function(acc,obj,i){return acc[i]=obj.name,acc},{});return{data:groupedData.map(function(arr){var tuples={},rowObj=arr.values.reduce(function(acc,row){return acc=row.reduce(function(obj,value,i){return i===seriesKeyIndex?(obj[value]=row[valueFieldIndex],tuples[value]=row):i!==valueFieldIndex&&(obj[fieldNames[i]]=value),obj},acc)},{});return rowObj._tuple=tuples,seriesKeys.forEach(function(seriesKey){if(void 0===rowObj[seriesKey]){rowObj[seriesKey]=0;var newArr=new Array(arr.values[0].length);newArr[uniqueFieldIndex]=arr.key,newArr[seriesKeyIndex]=seriesKey,rowObj._tuple[seriesKey]=newArr}}),rowObj}),keys:seriesKeys}}(data,schema,valueField,uniqueField,groupBy),keys=normalizedData.keys,map={},orderBy=config.orderBy,orderIndex=schema.findIndex(function(d){return d.name===orderBy}),groupByIndex=schema.findIndex(function(d){return d.name===groupBy});-1!==orderIndex&&(keys.forEach(function(key){var name=data.find(function(d){return d[groupByIndex]===key});map[key]=name[orderIndex]}),normalizedData.keys.sort(function(a,b){return map[a].localeCompare(map[b])}));var stackData=common_utils_stack({keys:normalizedData.keys,offset:config.offset||"diverging",order:sort,data:normalizedData.data});return stackData.forEach(function(seriesData){seriesData.forEach(function(dataObj){dataObj.data=dataObj.data._tuple[seriesData.key]})}),stackData}),_transformMap);var transform_factory=function transformFactory(type){var transform=transformMap[type];if("function"!=typeof transform)throw new Error("Invalid transform type supplied.");return transform};function helpers_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function helpers_toConsumableArray(arr){return function helpers_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function helpers_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function helpers_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function helpers_slicedToArray(arr,i){return function helpers_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function helpers_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function helpers_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var helpers_BAND=scale_type_namespaceObject.BAND,getLayerColor=function getLayerColor(_ref,_ref2){var datum=_ref.datum,index=_ref.index,colorEncoding=_ref2.colorEncoding,colorAxis=_ref2.colorAxis,colorFieldIndex=_ref2.colorFieldIndex,rawColor="",color="";return colorEncoding&&colorEncoding.value instanceof Function?(color=colorEncoding.value(datum,index),rawColor=colorEncoding.value(datum,index)):(rawColor=colorAxis.getRawColor(datum._data[colorFieldIndex]),color=colorAxis.getHslString(rawColor)),{color:color,rawColor:rawColor}},transfromColor=function transfromColor(colorAxis,datum,styleType,intensity){datum.meta.stateColor[styleType]=datum.meta.stateColor[styleType]||datum.meta.originalColor;var fillColorInfo=colorAxis.transformColor(datum.meta.stateColor[styleType],intensity);return datum.meta.stateColor[styleType]=fillColorInfo.hsla,fillColorInfo},helpers_applyInteractionStyle=function applyInteractionStyle(context,selectionSet,interactionStyles,config){var elements=context.getPlotElementsFromSet(selectionSet),colorAxis=context.axes().color,apply=config.apply,interactionType=config.interactionType;interactionStyles.forEach(function(style){var styleType=style.type;elements.style(styleType,function(d){var _d$meta=d.meta,colorTransform=_d$meta.colorTransform,stateColor=_d$meta.stateColor,originalColor=_d$meta.originalColor;if(colorTransform[interactionType]=colorTransform[interactionType]||{},apply&&!colorTransform[interactionType][styleType])return colorTransform[interactionType][styleType]=style.intensity,transfromColor(colorAxis,d,styleType,style.intensity).color;if(!apply&&colorTransform[interactionType][styleType])return colorTransform[interactionType][styleType]=null,transfromColor(colorAxis,d,styleType,style.intensity.map(function(e){return-e})).color;var _ref4=helpers_slicedToArray(stateColor[styleType]?stateColor[styleType]:originalColor,4),h=_ref4[0],s=_ref4[1],l=_ref4[2],a=_ref4[3];return"hsla(".concat(360*h,",").concat(100*s,"%,").concat(100*l,"%, ").concat(a||1,")")})})},helpers_getAxesScales=function getAxesScales(axes){var _map2=helpers_slicedToArray([ENCODING.X,ENCODING.Y].map(function(e){return axes[e]}),2),xAxis=_map2[0],yAxis=_map2[1],_map4=helpers_slicedToArray([xAxis,yAxis].map(function(e){return e&&e.scale()}),2);return{xAxis:xAxis,yAxis:yAxis,xScale:_map4[0],yScale:_map4[1]}},getIndividualClassName=function getIndividualClassName(d,i,data,context){var className=context.config().individualClassName,classNameStr="";return className instanceof Function&&(classNameStr=className(d,i,data,context)),classNameStr},attachDataToVoronoi=function attachDataToVoronoi(voronoi,points){var _ref5;voronoi.data((_ref5=[]).concat.apply(_ref5,helpers_toConsumableArray(points)).filter(function(d){return void 0!==d._id}).map(function(d){var point=d.update;return{x:point.x,y:point.y,data:d}}))},helpers_updateStyle=function updateStyle(target,styles,remove){for(var key in styles)({}).hasOwnProperty.call(styles,key)&&target.style(key,remove?null:styles[key])},positionPoints=function positionPoints(context,points){var positioner=context.encodingTransform();return positioner?positioner(points,context,{smartLabel:context._dependencies.smartLabel}):points},helpers_getPlotMeasurement=function getPlotMeasurement(context,dimensionalValues){var fieldInfo=context.encodingFieldsInf(),axes=context.axes(),transformType=context.transformType(),config=context.config(),bandScale=context._bandScale;return["x","y"].map(function(type){var span=0,groupSpan=0,padding=0,offsetValues=[];if(fieldInfo["".concat(type,"FieldType")]===dist_datamodel.FieldType.DIMENSION){var actualGroupWidth,timeDiff=fieldInfo["".concat(type,"FieldSubType")]===dist_datamodel.DimensionSubtype.TEMPORAL?context.dataProps().timeDiffs[type]:0,axis=axes[type],pad=config["pad".concat(type.toUpperCase())],innerPadding=config.innerPadding,keys=dimensionalValues,scale=axis.scale();groupSpan=function getGroupSpan(axis,minDiff){var width=axis.getUnitWidth(),scale=axis.scale(),range=scale.range(),domain=scale.domain();return width||Math.abs(range[1]-range[0])/Math.abs(domain[1]-domain[0])*minDiff}(axis,timeDiff);var isAxisBandScale=axis.constructor.type()===helpers_BAND,axisPadding=axis.config().padding;if("group"===transformType){var groupPadding=isAxisBandScale?0:axisPadding*groupSpan/2;bandScale.range([groupPadding,groupSpan-groupPadding]).domain(keys).paddingInner(innerPadding),span=bandScale.bandwidth(),actualGroupWidth=groupSpan-(isAxisBandScale?0:axisPadding*groupSpan),offsetValues=keys.map(function(key){return bandScale(key)-(isAxisBandScale?0:groupSpan/2)})}else if(void 0!==pad){var offset;if(isAxisBandScale){var step=scale.step();offset=scale.padding()*step,span=scale.bandwidth()+offset}else span=groupSpan;offsetValues=keys.map(function(){return isAxisBandScale?-offset/2:-span/2})}else actualGroupWidth=span=groupSpan-(padding=isAxisBandScale?0:axisPadding*groupSpan),offsetValues=keys.map(function(){return isAxisBandScale?0:-span/2});groupSpan=actualGroupWidth,padding=isAxisBandScale?axisPadding*axis.scale().step():axisPadding*groupSpan}return{span:span,offsetValues:offsetValues,groupSpan:groupSpan,padding:padding}})},helpers_resolveInvalidTransformType=function resolveInvalidTransformType(context){var _context$encodingFiel=context.encodingFieldsInf(),xField=_context$encodingFiel.xField,yField=_context$encodingFiel.yField,xFieldType=_context$encodingFiel.xFieldType,yFieldType=_context$encodingFiel.yFieldType,groupByField=context.config().transform.groupBy,fieldsConfig=context.data().getFieldsConfig(),groupByFieldMeasure=fieldsConfig[groupByField]&&fieldsConfig[groupByField].def.type===dist_datamodel.FieldType.MEASURE;return!xField||!yField||groupByFieldMeasure||!groupByField||xFieldType===dist_datamodel.FieldType.DIMENSION&&yFieldType===dist_datamodel.FieldType.DIMENSION?"identity":null},helpers_getValidTransformForAggFn=function getValidTransformForAggFn(context){var resolvedInvalidTransformType=helpers_resolveInvalidTransformType(context);if(resolvedInvalidTransformType)return resolvedInvalidTransformType;var _context$encodingFiel2=context.encodingFieldsInf(),xField=_context$encodingFiel2.xField,yField=_context$encodingFiel2.yField,xFieldType=_context$encodingFiel2.xFieldType,yFieldType=_context$encodingFiel2.yFieldType,groupByField=context.config().transform.groupBy,isCustomTransformTypeProvided=!!getObjProp(context._customConfig,"transform","type"),transformType=context.config().transform.type;if(!isCustomTransformTypeProvided&&groupByField&&xFieldType!==yFieldType){var measureField=xFieldType===dist_datamodel.FieldType.MEASURE?xField:yField;transformType="sum"===common_utils_retrieveNearestGroupByReducers(context.data(),measureField)[measureField]?STACK:"group"}return transformType};function listener_map_slicedToArray(arr,i){return function listener_map_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function listener_map_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function listener_map_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _defaultOptions,listener_map_listenerMap=function listenerMap(context,ns){return[{props:["".concat(ns.local,".").concat("data")],listener:function listener(_ref){var data=listener_map_slicedToArray(_ref,2)[1],config=context.config(),encodingValue=config.encoding;if(data&&encodingValue){var fieldsConfig=data.getFieldsConfig(),encodingFieldsInf=function getEncodingFieldInf(encoding,fieldsConfig){var _map6=helpers_slicedToArray([ENCODING.X,ENCODING.Y,ENCODING.X0,ENCODING.Y0,COLOR,SHAPE,SIZE].map(function(e){return encoding[e]&&encoding[e].field}),7),xField=_map6[0],yField=_map6[1],x0Field=_map6[2],y0Field=_map6[3],colorField=_map6[4],shapeField=_map6[5],sizeField=_map6[6],_map8=helpers_slicedToArray([xField,yField,x0Field,y0Field].map(function(e){return fieldsConfig[e]&&fieldsConfig[e].def.type}),2),xFieldType=_map8[0],yFieldType=_map8[1],_map10=helpers_slicedToArray([xField,yField].map(function(e){return fieldsConfig[e]&&(fieldsConfig[e].def.subtype||fieldsConfig[e].def.type)}),2),xFieldSubType=_map10[0],yFieldSubType=_map10[1],_map12=helpers_slicedToArray([xField,yField,x0Field,y0Field].map(function(e){return fieldsConfig[e]&&fieldsConfig[e].index}),4);return{xField:xField,yField:yField,colorField:colorField,shapeField:shapeField,sizeField:sizeField,x0Field:x0Field,y0Field:y0Field,xFieldType:xFieldType,yFieldType:yFieldType,xFieldSubType:xFieldSubType,yFieldSubType:yFieldSubType,xFieldIndex:_map12[0],yFieldIndex:_map12[1],x0FieldIndex:_map12[2],y0FieldIndex:_map12[3]}}(encodingValue,fieldsConfig);context.encodingFieldsInf(encodingFieldsInf),context.resolveTransformType(),context._transformedData=context.getTransformedData(data,config,context.transformType(),encodingFieldsInf),context._normalizedData=context.getNormalizedData(context._transformedData,fieldsConfig);var domain=context.calculateDomainFromData(context._normalizedData,context.encodingFieldsInf(),context.data().getFieldsConfig());context._domain=domain,!context._updateLock&&context.domain(domain)}},type:"registerImmediateListener"},{props:["".concat(ns.local,".").concat("config")],listener:function listener(_ref3){var calculateDomain=listener_map_slicedToArray(_ref3,2)[1].calculateDomain,props=context.getRenderProps(),store=context.store(),namespaceInf={namespace:"".concat(namespace_namespaceObject.LAYER_LOCAL_NAMESPACE,".").concat(context.metaInf().namespace),key:"renderListener"};store.unsubscribe(namespaceInf),!1===calculateDomain&&props.push("".concat(ns.local,".").concat("data")),store.registerChangeListener(props,function(){!function renderLayer(context){var mount=context.mount();mount&&(context.render(mount),context.dependencies().throwback.commit(common_props.ON_LAYER_DRAW,!0))}(context)},!1,namespaceInf)},type:"registerImmediateListener"}]};function default_options_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var defaultOptions=(default_options_defineProperty(_defaultOptions={},"config",{value:null,meta:{sanitization:function sanitization(config,oldConfig,context){context._customConfig=config;var constructor=context.constructor,newConf=mergeRecursive({},constructor.defaultConfig());return constructor.defaultPolicy(newConf,config)}}}),default_options_defineProperty(_defaultOptions,"data",{value:null,meta:{preset:function preset(data,context){context._cacheEnabled?context._cachedData.push(data):context._cachedData=[data]}}}),_defaultOptions);function base_layer_typeof(obj){return(base_layer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function base_layer_construct(Parent,args,Class){return(base_layer_construct=function base_layer_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&base_layer_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function base_layer_toConsumableArray(arr){return function base_layer_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function base_layer_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function base_layer_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function base_layer_slicedToArray(arr,i){return function base_layer_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function base_layer_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function base_layer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function base_layer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function base_layer_getPrototypeOf(o){return(base_layer_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function base_layer_setPrototypeOf(o,p){return(base_layer_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function base_layer_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var base_layer_BaseLayer=function(_SimpleLayer){function BaseLayer(data,axes,config){var _this,dependencies=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function base_layer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseLayer),_this=function base_layer_possibleConstructorReturn(self,call){return!call||"object"!==base_layer_typeof(call)&&"function"!=typeof call?base_layer_assertThisInitialized(self):call}(this,base_layer_getPrototypeOf(BaseLayer).call(this)),generateGetterSetters(base_layer_assertThisInitialized(base_layer_assertThisInitialized(_this)),props_props),_this.data(data),_this.axes(axes),_this.config(config),_this.alias(_this.constructor.formalName()+getUniqueId()),_this.dependencies(dependencies),_this._points=[],_this._cachedData=[],_this._id=getUniqueId(),_this._measurement={},_this._animationDonePromises=[],_this._customConfig=null,_this}return function base_layer_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&base_layer_setPrototypeOf(subClass,superClass)}(BaseLayer,simple_layer_SimpleLayer),function base_layer_createClass(Constructor,protoProps,staticProps){return protoProps&&base_layer_defineProperties(Constructor.prototype,protoProps),staticProps&&base_layer_defineProperties(Constructor,staticProps),Constructor}(BaseLayer,[{key:"store",value:function store(){if(arguments.length){this._store=arguments.length<=0?void 0:arguments[0];var metaInf=this.metaInf(),localNs="".concat(namespace_namespaceObject.LAYER_LOCAL_NAMESPACE,".").concat(metaInf.namespace);!function initializeGlobalState(context){var store=context.store(),globalState=context.constructor.getState()[0],namespace=context.metaInf().namespace;for(var prop in globalState)store.append("".concat(namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE,".").concat(prop),helpers_defineProperty({},namespace,null))}(this);var store=this.store();return store.append("".concat(namespace_namespaceObject.LAYER_LOCAL_NAMESPACE),function base_layer_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},metaInf.namespace,null)),common_utils_transactor(this,defaultOptions,store.model,{namespace:localNs}),common_utils_registerListeners(this,listener_map_listenerMap,{local:localNs,global:namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE},{unitRowIndex:metaInf.unitRowIndex,unitColIndex:metaInf.unitColIndex}),this}return this._store}},{key:"domain",value:function domain(){var prop="".concat(namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE,".").concat("domain",".").concat(this.metaInf().namespace);return arguments.length?(this.store().commit(prop,arguments.length<=0?void 0:arguments[0]),this):this.store().get(prop)}},{key:"encodingFieldsInf",value:function encodingFieldsInf(){return arguments.length?(this._encodingFieldsInf=arguments.length<=0?void 0:arguments[0],this):this._encodingFieldsInf}},{key:"encodingTransform",value:function encodingTransform(){return arguments.length?(this._encodingTransform=arguments.length<=0?void 0:arguments[0],this):this._encodingTransform}},{key:"alias",value:function alias(){return arguments.length?(this._alias=arguments.length<=0?void 0:arguments[0],this):this._alias||this.constructor.formalName()}},{key:"dependencies",value:function dependencies(){return arguments.length?(this._dependencies=arguments.length<=0?void 0:arguments[0],this):this._dependencies}},{key:"enableCaching",value:function enableCaching(){return this._cacheEnabled=!0,this}},{key:"clearCaching",value:function clearCaching(){return this._cacheEnabled=!1,this.data(this._cachedData[0])}},{key:"serialize",value:function serialize(){return this.config()}},{key:"id",value:function id(){return this._id}},{key:"getTransformedData",value:function getTransformedData(dataModel,config,transformType,encodingFieldsInf){return function transformData(dataModel,config,transformType,encodingFieldInf){var data=dataModel.getData({withUid:!0}),schema=data.schema,transform=config.transform,xField=encodingFieldInf.xField,yField=encodingFieldInf.yField,xFieldType=encodingFieldInf.xFieldType,yFieldType=encodingFieldInf.yFieldType,uniqueField=xFieldType===dist_datamodel.FieldType.MEASURE?yField:xField;return transform_factory(transformType)(schema,data.data,{groupBy:transform.groupBy,uniqueField:uniqueField,sort:transform.sort||"none",offset:transform.offset,orderBy:transform.orderBy,value:yFieldType===dist_datamodel.FieldType.MEASURE?yField:xField},data.uids)}(dataModel,config,transformType,encodingFieldsInf)}},{key:"calculateDomainFromData",value:function calculateDomainFromData(data){var domains={};return this.data().isEmpty()||(domains=function calculateDomainFromData(data,encodingFieldInf,transformType){var xFieldSubType=encodingFieldInf.xFieldSubType,yFieldSubType=encodingFieldInf.yFieldSubType,xField=encodingFieldInf.xField,yField=encodingFieldInf.yField,x0Field=encodingFieldInf.x0Field,y0Field=encodingFieldInf.y0Field,domains={},yEnc=ENCODING.Y,xEnc=ENCODING.X;return xField&&(domains.x=common_utils_getDomainFromData(data,x0Field||transformType===STACK?[xEnc,ENCODING.X0]:[xEnc,xEnc],xFieldSubType)),yField&&(domains.y=common_utils_getDomainFromData(data,y0Field||transformType===STACK?[ENCODING.Y0,ENCODING.Y]:[yEnc,yEnc],yFieldSubType)),domains}(data,this.encodingFieldsInf(),this.transformType())),domains}},{key:"getDataDomain",value:function getDataDomain(encodingType){var domains=this.store().get("".concat(namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE,".").concat("domain",".").concat(this.metaInf().namespace));return void 0!==encodingType?domains[encodingType]||[]:domains}},{key:"getNormalizedData",value:function getNormalizedData(transformedData,fieldsConfig){return function getNormalizedData(transformedData,fieldsConfig,encodingFieldInf,transformType){var transformedDataArr="identity"===transformType?[transformedData]:transformedData,xFieldType=encodingFieldInf.xFieldType,xFieldIndex=encodingFieldInf.xFieldIndex,yFieldIndex=encodingFieldInf.yFieldIndex,x0FieldIndex=encodingFieldInf.x0FieldIndex,y0FieldIndex=encodingFieldInf.y0FieldIndex,fieldsLen=Object.keys(fieldsConfig).length;return transformedDataArr.map(function(data){return("group"===transformType?data.values:data).map(function(d){var tuple,y,y0,x,x0,pointObj={};return transformType===STACK?(tuple=d.data||[],d[1]>=d[0]?(y=x0=d[1],x=y0=d[0]):(y=x0=d[0],x=y0=d[1]),(pointObj=xFieldType===dist_datamodel.FieldType.MEASURE?{x:x,x0:x0,y:tuple[yFieldIndex],y0:tuple[yFieldIndex]}:{x:tuple[xFieldIndex],x0:tuple[xFieldIndex],y:y,y0:y0})._data=tuple,pointObj._id=tuple[fieldsLen]):((pointObj={x:d[xFieldIndex],y:d[yFieldIndex],x0:d[x0FieldIndex],y0:d[y0FieldIndex]})._data=d,pointObj._id=d[fieldsLen]),pointObj})}).filter(function(d){return d.length})}(transformedData,fieldsConfig,this.encodingFieldsInf(),this.transformType())}},{key:"getNearestPoint",value:function getNearestPoint(){return null}},{key:"applyInteractionStyle",value:function applyInteractionStyle(interactionType,selectionSet,apply,styles){var interactionStyles=(this.config().interaction||{})[interactionType];(interactionStyles=styles||interactionStyles)&&helpers_applyInteractionStyle(this,selectionSet,interactionStyles,{apply:apply,interactionType:interactionType})}},{key:"disableUpdate",value:function disableUpdate(){return this._updateLock=!0,this}},{key:"enableUpdate",value:function enableUpdate(){return this._updateLock=!1,this}},{key:"resolveTransformType",value:function resolveTransformType(){this._transformType=function getValidTransform(context){return helpers_resolveInvalidTransformType(context)||context.config().transform.type}(this)}},{key:"transformType",value:function transformType(){return this._transformType}},{key:"render",value:function render(){return this}},{key:"elemType",value:function elemType(){return"g"}},{key:"remove",value:function remove(){return this.store().unsubscribe({namespace:"".concat(namespace_namespaceObject.LAYER_LOCAL_NAMESPACE,".").concat(this.metaInf().namespace)}),renderer_utils_selectElement(this.mount()).remove(),this}},{key:"cachePoint",value:function cachePoint(key,data){if(null===key)return this;var pointMap=this._pointMap;return!pointMap[key]&&(pointMap[key]=[]),pointMap[key].push(data),this}},{key:"dataProps",value:function dataProps(){return arguments.length?(this._dataProps=arguments.length<=0?void 0:arguments[0],this):this._dataProps}},{key:"getIdentifiersFromData",value:function getIdentifiersFromData(data){var schema=this.data().getData().schema,fieldsConfig=this.data().getFieldsConfig(),identifiers=[[],[]],_this$encodingFieldsI=this.encodingFieldsInf(),xFieldType=_this$encodingFieldsI.xFieldType,yFieldType=_this$encodingFieldsI.yFieldType,xField=_this$encodingFieldsI.xField,yField=_this$encodingFieldsI.yField,_map2=base_layer_slicedToArray([xFieldType,yFieldType].map(function(type){return type===dist_datamodel.FieldType.MEASURE}),2),xMeasure=_map2[0],yMeasure=_map2[1];if(schema.forEach(function(d,i){var name=d.name;fieldsConfig[name].def.type===dist_datamodel.FieldType.DIMENSION&&(identifiers[0].push(name),identifiers[1].push(data[i]))}),xMeasure&&yMeasure){var _identifiers$,_identifiers$2,xMeasureIndex=fieldsConfig[xField].index,yMeasureIndex=fieldsConfig[yField].index;(_identifiers$=identifiers[0]).push.apply(_identifiers$,[xField,yField]),(_identifiers$2=identifiers[1]).push.apply(_identifiers$2,[data[xMeasureIndex],data[yMeasureIndex]])}return identifiers}},{key:"getPlotSpan",value:function getPlotSpan(){return{x:0,y:0}}},{key:"getPlotPadding",value:function getPlotPadding(){return{x:0,y:0}}},{key:"getPointsFromIdentifiers",value:function getPointsFromIdentifiers(identifiers){var _ref,fieldNames,values,config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},getAllAttrs=config.getAllAttrs,getBBox=config.getBBox;if(!this.data())return[];if(identifiers instanceof datamodel_default.a){var dataObj=identifiers.getData();fieldNames=dataObj.schema.map(function(d){return d.name}),values=dataObj.data}else fieldNames=identifiers[0],values=identifiers.slice(1,identifiers.length);var points=this._points,fieldsConfig=this.data().getFieldsConfig(),filteredPoints=(_ref=[]).concat.apply(_ref,base_layer_toConsumableArray(points)).filter(function(point){var _data=point._data,_id=point._id;return fieldNames.every(function(field,idx){return field in fieldsConfig&&fieldsConfig[field].def.type===dist_datamodel.FieldType.DIMENSION?-1!==values.findIndex(function(d){return d[idx]===_data[fieldsConfig[field].index]}):field!==reserved_fields.ROW_ID||-1!==values.findIndex(function(d){return d[idx]===_id})})});return getAllAttrs?filteredPoints:filteredPoints.map(function(d){var obj=clone(d);if(getBBox){var update=obj.update||obj;if(void 0!==obj.size){var sizeVal=2*Math.sqrt(obj.size/Math.PI);update.width=sizeVal,update.height=sizeVal,update.x-=sizeVal/2,update.y-=sizeVal/2}else void 0===update.width&&(update.width=2),void 0===update.height&&(update.height=2)}return obj.update||obj}).sort(function(a,b){return a.y-b.y})}},{key:"getTransformedDataFromIdentifiers",value:function getTransformedDataFromIdentifiers(identifiers){var measureIndex,enc,_identifiers$getData=identifiers.getData(),identifierData=_identifiers$getData.data,identifierSchema=_identifiers$getData.schema,normalizedData=this._normalizedData,fieldsConfig=this.data().getFieldsConfig(),_this$encodingFieldsI2=this.encodingFieldsInf(),yField=_this$encodingFieldsI2.yField,xField=_this$encodingFieldsI2.xField,yFieldType=_this$encodingFieldsI2.yFieldType;_this$encodingFieldsI2.xFieldType===dist_datamodel.FieldType.MEASURE?(measureIndex=fieldsConfig[xField].index,enc="x"):yFieldType===dist_datamodel.FieldType.MEASURE&&(measureIndex=fieldsConfig[yField].index,enc="y");var transformedData=[];return normalizedData.forEach(function(dataArr){dataArr.forEach(function(dataObj){var tupleArr=dataObj._data;if(identifierSchema.every(function(obj,i){return-1!==identifierData.findIndex(function(d){return tupleArr[fieldsConfig[obj.name].index]===d[i]})})){var transformedVal=dataObj[enc],row=dataObj._data,tuple={};for(var key in fieldsConfig){var index=fieldsConfig[key].index;tuple[key]=row[index],index===measureIndex&&(tuple[key]=transformedVal)}transformedData.push(tuple)}})}),[transformedData,this.data().getData().schema]}},{key:"getPlotElementsFromSet",value:function getPlotElementsFromSet(set){return renderer_utils_selectElement(this.mount()).selectAll(this.elemType()).filter(function(data){return!!data&&-1!==set.indexOf(data._id)})}},{key:"animationDone",value:function animationDone(){return Promise.all(this._animationDonePromises)}},{key:"registerAnimationDoneHook",value:function registerAnimationDoneHook(){var resolveFn,promise=new Promise(function(resolve){resolveFn=resolve});return this._animationDonePromises.push(promise),function(){resolveFn()}}},{key:"getRenderProps",value:function getRenderProps(){var metaInf=this.metaInf();return["".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.y.").concat(metaInf.unitRowIndex,"0"),"".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.x.").concat(metaInf.unitColIndex,"0")]}}],[{key:"getState",value:function getState(){return[{domain:{}},{config:{},data:{}}]}},{key:"create",value:function create(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return base_layer_construct(this,params)}},{key:"defaultConfig",value:function defaultConfig(){return{transform:{type:"identity"}}}},{key:"defaultPolicy",value:function defaultPolicy(conf,userConf){return mergeRecursive(conf,userConf)}},{key:"formalName",value:function formalName(){return"base"}},{key:"shouldDrawAnchors",value:function shouldDrawAnchors(){return!1}}]),BaseLayer}(),renderer_line=Symbols.line,renderer_drawLine=function drawLine(context){var filteredPoints,layer=context.layer,container=context.container,points=context.points,interpolate=context.interpolate,connectNullData=context.connectNullData,className=context.className,style=context.style,transition=context.transition,mount=renderer_utils_selectElement(container).attr("class",className),curveInterpolatorFn=pathInterpolators[interpolate],linepath=renderer_line().curve(curveInterpolatorFn).x(function(d){return d.update.x}).y(function(d){return d.update.y}).defined(function(d){return null!==d.update.y});filteredPoints=points,connectNullData&&(filteredPoints=points.filter(function(d){return null!==d.update.y})),helpers_updateStyle(mount,style);var element=makeElement(mount,"path",[1]);return element.classed(points[0].className,!0),transition.disabled||(element=element.transition().duration(transition.duration).on("end",layer.registerAnimationDoneHook())),element.attr("d",linepath(filteredPoints)).style("fill-opacity",0),element},line_default_config_defaultConfig={classPrefix:"muze",defClassName:"layer-line",className:"",interpolate:"linear",transform:{type:"group"},interaction:{highlight:[{type:"stroke",intensity:[0,0,-15,0]}],fade:[{type:"stroke",intensity:[0,0,15,0]}],focus:[{type:"stroke",intensity:[0,0,15,0]}]},nearestPointThreshold:20,encoding:{color:{},x:{},y:{},strokeOpacity:{value:1}},transition:{effect:"cubic",duration:1e3},connectNullData:!1};__webpack_require__(15);function line_typeof(obj){return(line_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function line_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function line_possibleConstructorReturn(self,call){return!call||"object"!==line_typeof(call)&&"function"!=typeof call?function line_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function line_getPrototypeOf(o){return(line_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function line_setPrototypeOf(o,p){return(line_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var line_LineLayer=function(_BaseLayer){function LineLayer(){var _getPrototypeOf2,_this;!function line_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LineLayer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=line_possibleConstructorReturn(this,(_getPrototypeOf2=line_getPrototypeOf(LineLayer)).call.apply(_getPrototypeOf2,[this].concat(args))))._voronoi=new common_utils_Voronoi,_this}return function line_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&line_setPrototypeOf(subClass,superClass)}(LineLayer,base_layer_BaseLayer),function line_createClass(Constructor,protoProps,staticProps){return protoProps&&line_defineProperties(Constructor.prototype,protoProps),staticProps&&line_defineProperties(Constructor,staticProps),Constructor}(LineLayer,[{key:"elemType",value:function elemType(){return"path"}},{key:"getDrawFn",value:function getDrawFn(){return renderer_drawLine}},{key:"translatePoints",value:function translatePoints(data,encodingFieldsInf,axes){var _this2=this,points=[],xAxis=axes.x,yAxis=axes.y,colorAxis=axes.color,encoding=this.config().encoding,xFieldType=encodingFieldsInf.xFieldType,yFieldType=encodingFieldsInf.yFieldType,isXDim=xFieldType===dist_datamodel.FieldType.DIMENSION,isYDim=yFieldType===dist_datamodel.FieldType.DIMENSION,key=isXDim?ENCODING.X:isYDim?ENCODING.Y:null,colorEncoding=encoding.color,colorField=colorEncoding.field,fieldsConfig=this.data().getFieldsConfig(),colorFieldIndex=colorField&&fieldsConfig[colorField].index,style={},meta={};return points=data.map(function(d,i){var xPx=xAxis.getScaleValue(d.x)+xAxis.getUnitWidth()/2,yPx=yAxis.getScaleValue(d.y),_getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor;style.stroke=color,style["fill-opacity"]=0,meta.stateColor={},meta.originalColor=rawColor,meta.colorTransform={};var point={enter:{},update:{x:xPx,y:null===d.y?null:yPx},style:style,_data:d._data,_id:d._id,rowId:d._id,source:d._data,meta:meta};return point.className=getIndividualClassName(d,i,data,_this2),_this2.cachePoint(d[key],point),point}),points=positionPoints(this,points)}},{key:"render",value:function render(container){var points,seriesClassName,style,_this3=this,config=this.config(),encoding=config.encoding,interpolate=config.interpolate,className=config.className,defClassName=config.defClassName,transition=config.transition,normalizedData=this._normalizedData,transformedData=this._transformedData,fieldsConfig=this.data().getFieldsConfig(),axes=this.axes(),keys=transformedData.map(function(d){return d.key}),qualifiedClassName=getQualifiedClassName(defClassName,this.id(),config.classPrefix),containerSelection=renderer_utils_selectElement(container),colorField=encoding.color.field,colorFieldIndex=fieldsConfig[colorField]&&fieldsConfig[colorField].index;return this._points=[],this._pointMap={},containerSelection.classed(qualifiedClassName.join(" "),!0),containerSelection.classed(className,!0),makeElement(container,"g",normalizedData,null,{enter:function enter(group){!function animateGroup(mount,context){var groupTransition,update,transition=context.transition,groupAnimateStyle=context.groupAnimateStyle,duration=transition.duration,effect=transition.effect,disabled=transition.disabled;groupAnimateStyle&&(renderer_utils_setStyles(mount.node(),groupAnimateStyle.enter),update=groupAnimateStyle.update,groupTransition=disabled?mount:mount.transition().ease(easeFns[effect]).duration(duration).on("end",function(){helpers_updateStyle(renderer_utils_selectElement(this),update,!0)}),helpers_updateStyle(groupTransition,update))}(group,{transition:transition,groupAnimateStyle:{enter:{"stroke-opacity":0,"fill-opacity":_this3.getPathStyle()["fill-opacity"]},update:{"stroke-opacity":encoding.strokeOpacity.value}}})},update:function update(group,dataArr,i){var color;points=_this3.translatePoints(dataArr,_this3.encodingFieldsInf(),axes,i),_this3._points.push(points),seriesClassName="".concat(qualifiedClassName[0],"-").concat(keys[i]||i).toLowerCase();var colorValFn=encoding.color.value,colorVal=points.find(function(d){return null!==d._data[colorFieldIndex]&&void 0!==d._data[colorFieldIndex]});color=colorValFn?colorValFn(dataArr,i,normalizedData):axes.color.getColor(colorVal&&colorVal._data[colorFieldIndex]),style=_this3.getPathStyle(color),_this3.getDrawFn()({layer:_this3,container:group.node(),interpolate:interpolate,points:points,className:seriesClassName,transition:transition,style:style||{},connectNullData:config.connectNullData})}},function(d){return d[0]._data[colorFieldIndex]||d[0]._id}),attachDataToVoronoi(this._voronoi,this._points),this}},{key:"getPathStyle",value:function getPathStyle(color){return{stroke:color,"fill-opacity":"0"}}},{key:"getNearestPoint",value:function getNearestPoint(x,y,config){var searchRadius=config.searchRadius,data=this.data();if(!data||data&&data.isEmpty())return null;searchRadius=void 0!==searchRadius?searchRadius:this.config().nearestPointThreshold;var point=this._voronoi.find(x,y,searchRadius),dimensions=getObjProp(point,"data","data","update");if(point){var _point$data$data=point.data.data,_data=_point$data$data._data,_id=_point$data$data._id;return{id:this.getIdentifiersFromData(_data,_id),dimensions:[{x:dimensions.x,y:dimensions.y,width:2,height:2}],layerId:this.id()}}return null}}],[{key:"formalName",value:function formalName(){return"line"}},{key:"defaultConfig",value:function defaultConfig(){return line_default_config_defaultConfig}},{key:"defaultPolicy",value:function defaultPolicy(conf,userConf){var config=base_layer_BaseLayer.defaultPolicy(conf,userConf),encoding=config.encoding,transform=config.transform,colorField=encoding.color&&encoding.color.field;return colorField&&!transform.groupBy&&(transform.groupBy=colorField),config}},{key:"shouldDrawAnchors",value:function shouldDrawAnchors(){return!0}}]),LineLayer}();function renderer_slicedToArray(arr,i){return function renderer_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function renderer_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function renderer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var renderer_area=Symbols.area,area_renderer=function drawArea(params){var filteredPoints,layer=params.layer,container=params.container,points=params.points,style=params.style,transition=params.transition,className=params.className,connectNullData=params.connectNullData,interpolate=params.interpolate,easeEffect=transition.effect,duration=transition.duration,mount=renderer_utils_selectElement(container),curveInterpolatorFn=pathInterpolators[interpolate],selection=mount.selectAll("path").data([params.points]),_map2=renderer_slicedToArray(["enter","update"].map(function(e){return renderer_area().curve(curveInterpolatorFn).x(function(d){return d[e].x}).y1(function(d){return d[e].y}).y0(function(d){return d[e].y0}).defined(function(d){return null!==d[e].y})}),2),enterAreaPath=_map2[0],updateAreaPath=_map2[1];filteredPoints=points,mount.attr("class",className),connectNullData&&(filteredPoints=points.filter(function(d){return null!==d.update.y}));var selectionEnter=selection.enter().append("path").attr("d",enterAreaPath(filteredPoints));selection.merge(selectionEnter).transition().ease(easeFns[easeEffect]).duration(duration).on("end",layer.registerAnimationDoneHook()).attr("d",updateAreaPath(filteredPoints)).each(function(d){var element=renderer_utils_selectElement(this);element.classed(d[0].className,!0),Object.keys(style).forEach(function(key){return element.style(key,style[key])})})};__webpack_require__(16);function area_typeof(obj){return(area_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function area_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function area_possibleConstructorReturn(self,call){return!call||"object"!==area_typeof(call)&&"function"!=typeof call?function area_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function area_get(target,property,receiver){return(area_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function area_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=area_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function area_getPrototypeOf(o){return(area_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function area_setPrototypeOf(o,p){return(area_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var area_AreaLayer=function(_LineLayer){function AreaLayer(){return function area_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AreaLayer),area_possibleConstructorReturn(this,area_getPrototypeOf(AreaLayer).apply(this,arguments))}return function area_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&area_setPrototypeOf(subClass,superClass)}(AreaLayer,line_LineLayer),function area_createClass(Constructor,protoProps,staticProps){return protoProps&&area_defineProperties(Constructor.prototype,protoProps),staticProps&&area_defineProperties(Constructor,staticProps),Constructor}(AreaLayer,[{key:"calculateDomainFromData",value:function calculateDomainFromData(data,encodingFieldsInf,fieldsConfig){var domains=area_get(area_getPrototypeOf(AreaLayer.prototype),"calculateDomainFromData",this).call(this,data,fieldsConfig);return[ENCODING.X,ENCODING.Y].forEach(function(type){encodingFieldsInf["".concat(type,"FieldType")]===dist_datamodel.FieldType.MEASURE&&void 0!==domains[type]&&(domains[type][0]=Math.min(domains[type][0],0))}),domains}},{key:"getDrawFn",value:function getDrawFn(){return area_renderer}},{key:"translatePoints",value:function translatePoints(data,encodingFieldsInf,axes){var _this=this,points=[],transformType=this.transformType(),colorAxis=axes.color,config=this.config(),colorEncoding=config.encoding.color,colorField=colorEncoding.field,fieldsConfig=this.data().getFieldsConfig(),colorFieldIndex=colorField&&fieldsConfig[colorField].index,xField=encodingFieldsInf.xField,yField=encodingFieldsInf.yField,y0Field=encodingFieldsInf.y0Field,_getAxesScales=helpers_getAxesScales(axes),xAxis=_getAxesScales.xAxis,yAxis=_getAxesScales.yAxis,classNameFn=config.individualClassName,isXDim=fieldsConfig[xField]&&fieldsConfig[xField].def.type===dist_datamodel.FieldType.DIMENSION,isYDim=fieldsConfig[yField]&&fieldsConfig[yField].def.type===dist_datamodel.FieldType.DIMENSION,key=isXDim?"x":isYDim?"y":null;return points=data.map(function(d,i){var xPx=xAxis.getScaleValue(d.x)+xAxis.getUnitWidth()/2,yPx=yAxis.getScaleValue(d.y),y0Px=y0Field||transformType===STACK?yAxis.getScaleValue(d.y0):yAxis.getScaleValue(0),_getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor,style={},meta={};style.fill=color,meta.stateColor={},meta.originalColor=rawColor,meta.colorTransform={};var point={enter:{x:xPx,y:null===d.y?d.y:yAxis.getScaleValue(0),y0:null===d.y0?d.y0:yAxis.getScaleValue(0)},update:{x:xPx,y:null===d.y?d.y:yPx,y0:null===d.y0?d.y0:y0Px},_id:d._id,_data:d._data,source:d._data,rowId:d._id,className:classNameFn?classNameFn(d,i,data,_this):"",style:style,meta:meta};return point.className=getIndividualClassName(d,i,data,_this),_this.cachePoint(d[key],point),point}),points=positionPoints(this,points)}},{key:"resolveTransformType",value:function resolveTransformType(){this._transformType=helpers_getValidTransformForAggFn(this)}},{key:"getPathStyle",value:function getPathStyle(color){return{fill:color}}}],[{key:"defaultConfig",value:function defaultConfig(){return area_default_config_defaultConfig}},{key:"formalName",value:function formalName(){return"area"}}]),AreaLayer}(),arc_default_config_defaultConfig={classPrefix:"muze",defClassName:"layer-arc",padding:{top:1,bottom:1,left:1,right:1},className:"",minOuterRadius:10,interaction:{highlight:[{type:"fill",intensity:[0,0,-15,0]}],fade:[{type:"fill",intensity:[0,0,15,0]}],focus:[{type:"fill",intensity:[0,0,15,0]}]},height:100,width:100,sort:"",cornerRadius:0,padAngle:0,padRadius:0,startAngle:0,endAngle:360,colors:["#F44336","blue","green","yellow","orange","purple"],transform:{type:"identity"},encoding:{"stroke-width":{value:"2px"},"stroke-linejoin":{value:"round"},angle:{value:"1"},radius:{value:"1"},opacity:{value:"1"},color:{value:"1"},shape:{value:"1"},size:{value:"1"}},innerRadiusFixer:10,transition:{effect:"cubic",duration:500},states:{highlight:{className:"".concat("muze","-layer-arc-highlight")},fadeout:{className:"".concat("muze","-layer-arc-fadeout")},selected:{className:"".concat("muze","-layer-arc-selected")}}};function arc_helper_slicedToArray(arr,i){return function arc_helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function arc_helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function arc_helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}__webpack_require__(17);function arc_typeof(obj){return(arc_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function arc_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function arc_possibleConstructorReturn(self,call){return!call||"object"!==arc_typeof(call)&&"function"!=typeof call?function arc_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function arc_getPrototypeOf(o){return(arc_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function arc_setPrototypeOf(o,p){return(arc_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var arc_pie=Symbols.pie,arc_arc=Symbols.arc,arc_ArcLayer=function(_BaseLayer){function ArcLayer(data,axes,config,dependencies){var _this;return function arc_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ArcLayer),(_this=arc_possibleConstructorReturn(this,arc_getPrototypeOf(ArcLayer).call(this,data,axes,config,dependencies)))._prevPieData={},_this}return function arc_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&arc_setPrototypeOf(subClass,superClass)}(ArcLayer,base_layer_BaseLayer),function arc_createClass(Constructor,protoProps,staticProps){return protoProps&&arc_defineProperties(Constructor.prototype,protoProps),staticProps&&arc_defineProperties(Constructor,staticProps),Constructor}(ArcLayer,[{key:"elemType",value:function elemType(){return"path"}},{key:"getTransformedData",value:function getTransformedData(dataModel,config){var _this2=this,pieData=[],pieIndex={},startAngle=config.startAngle,endAngle=config.endAngle,encoding=config.encoding,sort=config.sort,minOuterRadius=config.minOuterRadius,prevData=this._transformedData||[],_getFieldIndices=function getFieldIndices(encoding,fieldsConfig){var _map2=arc_helper_slicedToArray([ANGLE,RADIUS,COLOR,SIZE].map(function(e){return encoding[e].field}),4),angleField=_map2[0],radiusField=_map2[1],colorField=_map2[2],_map4=arc_helper_slicedToArray([angleField,_map2[3],radiusField].map(function(e){var conf=fieldsConfig[e];return conf&&conf.def.type===dist_datamodel.FieldType.MEASURE?conf.index:null}),3);return{angleIndex:_map4[0],sizeIndex:_map4[1],radiusIndex:_map4[2],colorIndex:getObjProp(fieldsConfig,colorField,"index")}}(encoding,this.data().getFieldsConfig()),angleIndex=_getFieldIndices.angleIndex,sizeIndex=_getFieldIndices.sizeIndex,radiusIndex=_getFieldIndices.radiusIndex,colorIndex=_getFieldIndices.colorIndex,dataVal=dataModel.getData(),data=dataVal.data,uids=dataVal.uids;this._prevPieData={},prevData.forEach(function(e,index){_this2._prevPieData[e.uid]=[e,index],pieIndex[e.index]=e}),pieData=arc_pie().startAngle(startAngle/180*Math.PI).endAngle(Math.PI*endAngle/180).value(function(d){return d[angleIndex]||1}).sortValues(null),sort.length&&radiusIndex&&pieData.sort(function(a,b){return"asc"===sort?a[radiusIndex]-b[radiusIndex]:b[radiusIndex]-a[radiusIndex]});var sizeVal=data.reduce(function(acc,d){return acc+(d[sizeIndex]||0)},1);return pieData=pieData(data).map(function(d,i){return d.outerRadiusValue=data[i][radiusIndex]||minOuterRadius,d.innerRadius=config.innerRadius,d.colorVal=data[i][colorIndex],d.angleVal=data[i][angleIndex],d.sizeVal=sizeVal,d.uid=uids[i],d.rowId=d.uid,d.source=data[i],d._previousInfo=_this2._prevPieData[d.uid]?_this2._prevPieData[d.uid][0]:function getPreviousPoint(prevData,currIndex,config){var prevArc=prevData[currIndex-1],nextArc=prevData[currIndex];return prevArc&&nextArc?{startAngle:prevArc.endAngle,endAngle:nextArc.startAngle}:nextArc?{startAngle:config.startAngle*Math.PI*2/360,endAngle:config.startAngle*Math.PI*2/360}:{startAngle:config.endAngle*Math.PI*2/360,endAngle:config.endAngle*Math.PI*2/360}}(pieIndex,d.index,config),d})}},{key:"getNormalizedData",value:function getNormalizedData(data){return data}},{key:"calculateDomainFromData",value:function calculateDomainFromData(data){return{radius:common_utils_getDomainFromData([data],["outerRadiusValue","outerRadiusValue"])}}},{key:"getNearestPoint",value:function getNearestPoint(x,y){var config=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},dataPoint=renderer_utils_selectElement(config.event.target).data()[0];if(isSimpleObject(dataPoint)){var _dataPoint$datum=dataPoint.datum,data=_dataPoint$datum.data,uid=_dataPoint$datum.uid;return{id:this.getIdentifiersFromData(data,uid),layerId:this.id()}}return null}},{key:"getPlotElementsFromSet",value:function getPlotElementsFromSet(set){return renderer_utils_selectElement(this.mount()).selectAll(this.elemType()).filter(function(d){return-1!==set.indexOf(d.datum.uid)})}},{key:"render",value:function render(container){var _this3=this,_this$measurement=this.measurement(),height=_this$measurement.height,width=_this$measurement.width,_this$config=this.config(),classPrefix=_this$config.classPrefix,defClassName=_this$config.defClassName,minOuterRadius=_this$config.minOuterRadius,innerRadius=_this$config.innerRadius,outerRadius=_this$config.outerRadius,cornerRadius=_this$config.cornerRadius,padAngle=_this$config.padAngle,padRadius=_this$config.padRadius,padding=_this$config.padding,transition=_this$config.transition,innerRadiusFixer=_this$config.innerRadiusFixer,sizeAxis=this.axes().size,transformedData=this._transformedData,chartHeight=height-padding.top-padding.bottom,chartWidth=width-padding.left-padding.right,qualClassName=getQualifiedClassName(defClassName,this.id(),classPrefix),range=function getRadiusRange(width,height,config){var minOuterRadius=config.minOuterRadius,innerRadius=config.innerRadius,outerRadius=config.outerRadius,innerRadiusFixer=config.innerRadiusFixer;return[Math.max(innerRadius+innerRadiusFixer||0,minOuterRadius),outerRadius||Math.min(height,width)/2]}(chartWidth,chartHeight,{minOuterRadius:minOuterRadius,innerRadius:innerRadius,outerRadius:outerRadius,innerRadiusFixer:innerRadiusFixer}),colorAxis=this.axes().color,defaultRadius=outerRadius||Math.min(chartHeight,chartWidth)/2,radiusDomain=this.domain().radius,rangeValueGetter=function rangeValueGetter(d){return function getRangeValue(datum,range,domain,defaultRadius,sizeAxis){var domainMultiplier=1,outerRadiusValue=datum.outerRadiusValue,sizeVal=datum.sizeVal,sizeAxisDomain=sizeAxis.domain(),sizeMultiplier=sizeAxis.getSize(sizeVal)/(sizeAxisDomain?sizeAxis.range()[1]:sizeAxis.config().value);return domainMultiplier*=(range[1]-range[0])/(domain[1]-domain[0]),(range[0]+(outerRadiusValue-domain[0])*domainMultiplier||defaultRadius)*sizeMultiplier}(d,range,radiusDomain,defaultRadius,sizeAxis)},path=arc_arc().innerRadius(innerRadius?Math.min(chartHeight/2,chartWidth/2,innerRadius):0).cornerRadius(cornerRadius).padAngle(padAngle).padRadius(padRadius);this._chartWidth=chartWidth,this._chartHeight=chartHeight;var g=makeElement(renderer_utils_selectElement(container),"g",[1],"".concat(qualClassName[0],"-group")).classed("".concat(qualClassName[1],"-group"),!0).attr("transform","translate(".concat(chartWidth/2,",").concat(chartHeight/2,")")),consecutiveExits=[],exitCounter=0;return makeElement(g,"g",transformedData,"".concat(qualClassName[0]),{update:function tween(elem){makeElement(elem,"path",function(d,i){return[{datum:d,index:i,arcFn:path,meta:{originalColor:colorAxis.getRawColor(d.colorVal),stateColor:{},colorTransform:{}}}]},"".concat(qualClassName[0],"-path")).style("fill",function(d){return colorAxis.getColor(d.datum.colorVal)}).transition().duration(transition.duration).on("end",_this3.registerAnimationDoneHook()).attrTween("d",function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return function tweenPie(path,rangeValueGetter,b){var datum=b[0].datum,outerRadius=rangeValueGetter(datum);return datum.outerRadius=outerRadius,datum._previousInfo.outerRadius=datum._previousInfo.outerRadius||outerRadius,function(t){return path(common_utils_interpolator()(datum._previousInfo,datum)(t))}}(path,rangeValueGetter,params)}).attr("class",function(d,i){var individualClass=getIndividualClassName(d,i,transformedData,_this3);return"".concat(qualClassName[0],"-path ").concat(qualClassName[1],"-path-").concat(d.index,"\n                                    ").concat(individualClass)})},exit:function tweenExit(elem,d){var exitArr=consecutiveExits[exitCounter],oldExitCounter=exitCounter;exitArr?exitArr[exitArr.length-1].datum.index===d.index-1?exitArr.push({elem:elem,datum:d}):exitCounter++:exitArr=[{elem:elem,datum:d}],consecutiveExits[oldExitCounter]=exitArr}}).attr("class",function(d,i){return"".concat(qualClassName[0]," ").concat(qualClassName[1],"-").concat(i)}),function tweenExitPie(consecutiveExits,transition,rangeValueGetter,path){consecutiveExits.length>0&&consecutiveExits.forEach(function(consecutiveExitArr){var startAngle=consecutiveExitArr[0].datum.startAngle,endAngle=consecutiveExitArr[consecutiveExitArr.length-1].datum.endAngle,mid=2*Math.PI*startAngle/(2*Math.PI+startAngle-endAngle);consecutiveExitArr.forEach(function(e){var elem=e.elem,datum=e.datum;elem.each(function(){var gElem=renderer_utils_selectElement(this);gElem.selectAll("path").transition().duration(transition.duration).attrTween("d",function(){return function(t){var outerRadius=rangeValueGetter(datum);return datum.outerRadius=outerRadius,path(common_utils_interpolator()(datum,{startAngle:mid,endAngle:mid,outerRadius:outerRadius})(t))}}).remove(),gElem.remove()})})})}(consecutiveExits,transition,rangeValueGetter,path),this}},{key:"getPointsFromIdentifiers",value:function getPointsFromIdentifiers(identifiers){if(!this.data())return[];var fieldNames=identifiers[0],values=identifiers.slice(1,identifiers.length),pieSlices=renderer_utils_selectElement(this.mount()).selectAll("path").data(),fieldsConfig=this.data().getFieldsConfig(),pieSliceInf=pieSlices.filter(function(tData){var data=tData.datum.data,uid=tData.datum.uid;return fieldNames.every(function(field,idx){return field in fieldsConfig&&fieldsConfig[field].def.type===dist_datamodel.FieldType.DIMENSION?-1!==values.findIndex(function(d){return d[idx]===data[fieldsConfig[field].index]}):field!==reserved_fields.ROW_ID||-1!==values.findIndex(function(d){return d[idx]===uid})})})[0];if(pieSliceInf){var centroid=pieSliceInf.arcFn.centroid(pieSliceInf.datum);return[{x:centroid[0]+this._chartWidth/2,y:centroid[1]+this._chartHeight/2,width:2,height:2}]}return[]}},{key:"getRenderProps",value:function getRenderProps(){return["".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.radius")]}}],[{key:"defaultConfig",value:function defaultConfig(){return arc_default_config_defaultConfig}},{key:"formalName",value:function formalName(){return"arc"}}]),ArcLayer}(),text_renderer=function drawText(container,data,config,smartLabel){var selection=renderer_utils_selectElement(container).selectAll("g").data(data),selectionMerge=selection.enter().append("g").each(function(dataObj){renderer_utils_setAttrs(this,dataObj.enter)}).merge(selection),style=renderer_utils_getSmartComputedStyle(renderer_utils_selectElement(container),config.className),fontSize=parseInt(style.fontSize,10);return smartLabel.setStyle(style),selectionMerge.each(function(dataObj){var backgroundVal,element=renderer_utils_selectElement(this),update=dataObj.update,text=dataObj.text,color=dataObj.color,textanchor=dataObj.textanchor,textStyle=dataObj.style,background=dataObj.background;if(backgroundVal=background.value){var diff,backgroundPadding=background.padding,_smartLabel$getOriSiz=smartLabel.getOriSize(dataObj.text),width=_smartLabel$getOriSiz.width,height=_smartLabel$getOriSiz.height,backgroundEl=makeElement(element,"rect",[1]);diff="end"===textanchor?width:"start"===textanchor?0:width/2,renderer_utils_setAttrs(backgroundEl.node(),{x:update.x-diff-backgroundPadding/2,y:update.y-fontSize-backgroundPadding/2,width:width+backgroundPadding,height:height+backgroundPadding}),background&&renderer_utils_setStyles(backgroundEl,{background:backgroundVal})}var textEl=makeElement(element,"text",function(d){return[d]}).text(text),textNode=textEl.node();textStyle&&renderer_utils_setStyles(textNode,textStyle),color&&renderer_utils_setStyles(textNode,{fill:color}),dataObj.className&&textEl.classed(dataObj.className,!0),renderer_utils_setAttrs(textNode,update),textEl.attr("text-anchor",textanchor)}),selection.exit().remove(),selection},text_default_config_defaultConfig={defClassName:"layer-text",classPrefix:"muze",className:"",transform:{type:"identity"},interaction:{highlight:[{type:"fill",intensity:[0,0,-15,0]}],fade:[{type:"fill",intensity:[0,0,15,0]}],focus:[{type:"fill",intensity:[0,0,15,0]}]},transition:{effect:"cubic",duration:1e3},encoding:{color:{},text:{value:"",background:{padding:10}}},states:{highlight:{className:"".concat("muze","-layer-text-highlight")},fadeout:{className:"".concat("muze","-layer-text-fadeout")},selected:{className:"".concat("muze","-layer-text-selected")}}};__webpack_require__(18);function text_typeof(obj){return(text_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function text_slicedToArray(arr,i){return function text_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function text_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function text_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function text_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function text_possibleConstructorReturn(self,call){return!call||"object"!==text_typeof(call)&&"function"!=typeof call?function text_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function text_getPrototypeOf(o){return(text_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function text_setPrototypeOf(o,p){return(text_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var text_TextLayer=function(_BaseLayer){function TextLayer(){return function text_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextLayer),text_possibleConstructorReturn(this,text_getPrototypeOf(TextLayer).apply(this,arguments))}return function text_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&text_setPrototypeOf(subClass,superClass)}(TextLayer,base_layer_BaseLayer),function text_createClass(Constructor,protoProps,staticProps){return protoProps&&text_defineProperties(Constructor.prototype,protoProps),staticProps&&text_defineProperties(Constructor,staticProps),Constructor}(TextLayer,[{key:"elemType",value:function elemType(){return"text"}},{key:"translatePoints",value:function translatePoints(data,encoding,axes){for(var _this=this,points=[],colorAxis=axes.color,textEncoding=encoding.text,textField=textEncoding.field,value=textEncoding.value,textFormatter=textEncoding.formatter,colorEncoding=encoding.color,colorField=colorEncoding&&colorEncoding.field,fieldsConfig=this.data().getFieldsConfig(),backgroundEncoding=encoding.text.background,backgroundPadding=backgroundEncoding.padding,backgroundValue=backgroundEncoding.value,colorFieldIndex=fieldsConfig[colorField]?fieldsConfig[colorField].index:-1,textFieldIndex=textField?fieldsConfig[textField]&&fieldsConfig[textField].index:-1,xEnc=ENCODING.X,yEnc=ENCODING.Y,_loop=function _loop(i,len){var d=data[i],row=d._data,textValue=textField?row[textFieldIndex]:value,_map2=text_slicedToArray([xEnc,yEnc].map(function(type){return axes[type]?axes[type].getScaleValue(d[type])+axes[type].getUnitWidth()/2:0}),2),xPx=_map2[0],yPx=_map2[1],_getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor,point={enter:{},update:{x:xPx,y:yPx},text:textFormatter?textFormatter(textValue):textValue,color:color,background:{value:backgroundValue instanceof Function?backgroundValue(d,i,data,_this):null,padding:backgroundPadding},meta:{stateColor:{},originalColor:rawColor,colorTransform:{}},style:{},_data:row,_id:d._id,source:d._data,rowId:d._id};null!==d.x&&null!==d.y&&points.push(point),point.className=getIndividualClassName(d,i,data,_this)},i=0,len=data.length;i<len;i++)_loop(i);return points=positionPoints(this,points)}},{key:"render",value:function render(container){var points,_this2=this,config=this.config(),encoding=config.encoding,normalizedData=this._normalizedData,className=config.className,qualifiedClassName=getQualifiedClassName(config.defClassName,this.id(),config.classPrefix),axes=this.axes();return renderer_utils_selectElement(container).classed("".concat(qualifiedClassName.join(" ")," ").concat(className),!0),renderer_utils_createElements({data:normalizedData,append:"g",selector:"g",container:container,each:function each(dataArr,group,i){var node=group.node();points=_this2.translatePoints(dataArr,encoding,axes,i),renderer_utils_setStyles(node,{"text-anchor":"middle"}),text_renderer(node,points,{className:qualifiedClassName[0]},_this2._dependencies.smartLabel)}}),this}}],[{key:"defaultConfig",value:function defaultConfig(){return text_default_config_defaultConfig}},{key:"formalName",value:function formalName(){return"text"}}]),TextLayer}(),point_renderer=function drawSymbols(params){var mergedGroups,layer=params.layer,container=params.container,points=params.points,transition=params.transition,className=params.className,duration=transition.duration,effect=transition.effect,disabled=transition.disabled,mount=renderer_utils_selectElement(container);mount.attr("class",className);var symbolGroups=mount.selectAll("g").data(points,params.keyFn),symbolEnter=symbolGroups.enter().append("g").attr("transform",function(d){return"translate(".concat(d.enter.x,",").concat(d.enter.y,")")});mergedGroups=symbolGroups.merge(symbolEnter).each(function(d){!function createShape(d,elem){var groupElement=renderer_utils_selectElement(elem),shape=d.shape,size=d.size,update=d.update;if(shape instanceof Promise)shape.then(function(res){d.shape=res,createShape(d,elem)});else if(shape instanceof Element){var newShape=shape.cloneNode(!0);if("img"===newShape.nodeName.toLowerCase()){var src=newShape.src||newShape.href;(newShape=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("href",src)}var shapeElement=renderer_utils_selectElement(newShape);"path"===newShape.nodeName||"image"===newShape.nodeName?shapeElement.attr("transform","scale(".concat(size/100,")")):(shapeElement.attr("height",size),shapeElement.attr("width",size)),shapeElement.attr("x",-size/2),shapeElement.attr("y",-size/2),renderer_utils_selectElement(groupElement.node().appendChild(newShape))}else if("string"==typeof shape){var pathStr;pathStr=function checkPath(str){return!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(str)&&/[\dz]$/i.test(str)&&str.length>4)}(shape)?shape:common_utils_getSymbol(shape).size(size)(update),makeElement(groupElement,"path",function(data){return[data]}).attr("d",pathStr)}else d.shape="circle",createShape(d,elem)}(d,this)}),(mergedGroups=disabled?mergedGroups:mergedGroups.transition().duration(transition.duration).on("end",layer.registerAnimationDoneHook())).attr("transform",function(d){return"translate(".concat(d.update.x,",").concat(d.update.y,")")}).each(function(d){var style=d.style,element=renderer_utils_selectElement(this);objectIterator(style,function(key){return element.style(key,style[key])}),element.attr("class","".concat(className)),element.classed(d.className,!0)});var exitGroups=symbolGroups.exit();disabled?exitGroups.remove():exitGroups.transition().ease(easeFns[effect]).duration(duration).on("end",function(){renderer_utils_selectElement(this).remove()}).style("fill-opacity",0).style("stroke-opacity",0)},point_default_config_defaultConfig={defClassName:"layer-point",className:"",classPrefix:"muze",defColorStyle:"stroke",interaction:{highlight:[{type:"fill",intensity:[0,0,-20,0]}],fade:[{type:"fill",intensity:[0,0,20,0]}],focus:[{type:"fill",intensity:[0,0,20,0]}]},innerPadding:.1,nearestPointThreshold:10,transform:{type:"identity"},transition:{effect:"cubic",duration:1e3},encoding:{size:{value:30},color:{},shape:{value:"circle"},x:{},y:{},strokeOpacity:{value:.5},fillOpacity:{value:.5}},shapes:["circle","cross","diamond","square","star","wye","triangle"],sizes:[20,30,40,50,60,70]};__webpack_require__(19);function point_typeof(obj){return(point_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function point_toConsumableArray(arr){return function point_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function point_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function point_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function point_slicedToArray(arr,i){return function point_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function point_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function point_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function point_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function point_possibleConstructorReturn(self,call){return!call||"object"!==point_typeof(call)&&"function"!=typeof call?function point_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function point_getPrototypeOf(o){return(point_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function point_setPrototypeOf(o,p){return(point_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var point_PointLayer=function(_BaseLayer){function PointLayer(){var _getPrototypeOf2,_this;!function point_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PointLayer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=point_possibleConstructorReturn(this,(_getPrototypeOf2=point_getPrototypeOf(PointLayer)).call.apply(_getPrototypeOf2,[this].concat(args))))._voronoi=new common_utils_Voronoi,_this._bandScale=Scales.band(),_this}return function point_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&point_setPrototypeOf(subClass,superClass)}(PointLayer,base_layer_BaseLayer),function point_createClass(Constructor,protoProps,staticProps){return protoProps&&point_defineProperties(Constructor.prototype,protoProps),staticProps&&point_defineProperties(Constructor,staticProps),Constructor}(PointLayer,[{key:"elemType",value:function elemType(){return"g"}},{key:"translatePoints",value:function translatePoints(data,encoding,axes){for(var _this2=this,config=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},points=[],sizeEncoding=encoding.size,shapeEncoding=encoding.shape,colorEncoding=encoding.color,x=encoding.x,y=encoding.y,sizeField=sizeEncoding.field,sizeValue=sizeEncoding.value,shapeField=shapeEncoding.field,xField=x.field,yField=y.field,sizeAxis=axes.size,shapeAxis=axes.shape,fieldsConfig=this.data().getFieldsConfig(),isXDim=fieldsConfig[xField]&&fieldsConfig[xField].def.type===dist_datamodel.FieldType.DIMENSION,isYDim=fieldsConfig[yField]&&fieldsConfig[yField].def.type===dist_datamodel.FieldType.DIMENSION,key=isXDim?ENCODING.X:isYDim?ENCODING.Y:null,colorField=colorEncoding&&colorEncoding.field,colorFieldIndex=fieldsConfig[colorField]&&fieldsConfig[colorField].index,measurement=this.measurement(),shapeFieldIndex=fieldsConfig[shapeField]&&fieldsConfig[shapeField].index,sizeFieldIndex=fieldsConfig[sizeField]&&fieldsConfig[sizeField].index,colorAxis=axes.color,_config$offset=config.offset,offsetX=_config$offset.x,offsetY=_config$offset.y,_loop=function _loop(i,len){var d=data[i],row=d._data,size=sizeValue instanceof Function?sizeValue(d,i):sizeAxis.getSize(row[sizeFieldIndex]),shape=shapeAxis.getShape(row[shapeFieldIndex]),_map2=point_slicedToArray([ENCODING.X,ENCODING.Y].map(function(type){var value=null===d[type]?void 0:d[type],measure=type===ENCODING.X?measurement.width:measurement.height;return encoding[type].field?axes[type].getScaleValue(value):measure/2}),2),xPx=_map2[0],yPx=_map2[1];xPx+=offsetX,yPx+=offsetY;var _getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor,style={fill:color,stroke:color};if(!isNaN(xPx)&&!isNaN(yPx)){var point={enter:{x:xPx,y:yPx},update:{x:xPx,y:yPx},shape:shape,size:Math.abs(size),meta:{stateColor:{},originalColor:rawColor,colorTransform:{}},style:style,_data:row,_id:d._id,source:d._data,rowId:d._id};point.className=getIndividualClassName(d,i,data,_this2),points.push(point),_this2.cachePoint(d[key],point)}},i=0,len=data.length;i<len;i++)_loop(i);return points=positionPoints(this,points)}},{key:"render",value:function render(container){var seriesClassName,_this3=this,maxSize=0,config=this.config(),keys=this._transformedData.map(function(d){return d.key}),transition=config.transition,className=config.className,defClassName=config.defClassName,classPrefix=config.classPrefix,normalizedData=this._normalizedData,containerSelection=renderer_utils_selectElement(container),qualifiedClassName=getQualifiedClassName(defClassName,this.id(),classPrefix);return this._points=[],this._pointMap={},containerSelection.classed(qualifiedClassName.join(" "),!0).classed(className,!0),this._points=this.generateDataPoints(normalizedData,keys),makeElement(container,"g",this._points,null,{update:function update(group,points){maxSize=Math.max.apply(Math,[maxSize].concat(point_toConsumableArray(points.map(function(d){return d.size})))),seriesClassName="".concat(qualifiedClassName[0]),_this3.constructor.drawFn()({layer:_this3,container:group.node(),points:points,className:seriesClassName,transition:transition,keyFn:function keyFn(d){return d._id}})}},function(data){return data[0]._id}),this._maxSize=2*Math.sqrt(maxSize/Math.PI),attachDataToVoronoi(this._voronoi,this._points),this}},{key:"generateDataPoints",value:function generateDataPoints(normalizedData,keys){var _this4=this,encoding=this.config().encoding,axes=this.axes(),_getPlotMeasurement2=point_slicedToArray(helpers_getPlotMeasurement(this,keys),2),widthMetrics=_getPlotMeasurement2[0],heightMetrics=_getPlotMeasurement2[1],offsetXValues=widthMetrics.offsetValues||[],offsetYValues=heightMetrics.offsetValues||[];return normalizedData.map(function(dataArr,i){var measurementConf=_this4.getMeasurementConfig(offsetXValues[i],offsetYValues[i],widthMetrics.span,heightMetrics.span);return _this4.translatePoints(dataArr,encoding,axes,measurementConf)}).filter(function(d){return d.length})}},{key:"getMeasurementConfig",value:function getMeasurementConfig(offsetX,offsetY,widthSpan,heightSpan){return{offset:{x:(offsetX||0)+widthSpan/2,y:(offsetY||0)+heightSpan/2},span:{x:widthSpan,y:heightSpan}}}},{key:"getNearestPoint",value:function getNearestPoint(x,y){var distanceLimit=Math.max(this._maxSize,this.config().nearestPointThreshold);if(!this.data())return null;var point=this._voronoi.find(x,y,distanceLimit),dimensions=point&&point.data.data.update,radius=point?Math.sqrt(point.data.data.size/Math.PI):0;if(point){var _point$data$data=point.data.data,_data=_point$data$data._data,_id=_point$data$data._id;return{id:this.getIdentifiersFromData(_data,_id),dimensions:[{x:dimensions.x,y:dimensions.y,width:radius,height:radius}],layerId:this.id()}}return null}}],[{key:"defaultConfig",value:function defaultConfig(){return point_default_config_defaultConfig}},{key:"defaultPolicy",value:function defaultPolicy(conf,userConf){var config=base_layer_BaseLayer.defaultPolicy(conf,userConf),encoding=config.encoding,transform=config.transform,colorField=encoding.color&&encoding.color.field;return colorField&&(transform.groupBy=colorField),config}},{key:"formalName",value:function formalName(){return"point"}},{key:"drawFn",value:function drawFn(){return point_renderer}}]),PointLayer}(),renderer_drawRects=function drawRects(params){var layer=params.layer,points=params.points,container=params.container,keyFn=params.keyFn;return makeElement(container,"rect",points,null,{enter:function enter(elem,d){!function barEnterFn(elem,d){var selection=elem,enter=d.enter||{};Object.entries(enter).forEach(function(attr){return!isNaN(attr[1])&&selection.attr(attr[0],attr[1])})}(elem,d)},update:function update(elem,d,i){!function transitionBars(layer,elem,datum,index,context){var transition=context.transition,duration=transition.duration,disabled=transition.disabled,effect=transition.effect,selection=elem,selTransition=disabled?selection:selection.transition().duration(duration).ease(easeFns[effect]).on("end",layer.registerAnimationDoneHook()),update=datum.update||datum,updateStyle=datum.style||{};datum.className&&selection.classed(datum.className,!0),Object.entries(update).forEach(function(attr){return!isNaN(attr[1])&&selTransition.attr(attr[0],attr[1])}),Object.entries(updateStyle).forEach(function(styleObj){return selection.style(styleObj[0],styleObj[1])})}(layer,elem,d,0,params)}},keyFn)},bar_default_config_defaultConfig={classPrefix:"muze",defClassName:"layer-bar",className:"",interaction:{highlight:[{type:"fill",intensity:[0,0,-15,0]}],fade:[{type:"fill",intensity:[0,0,15,0]}],focus:[{type:"fill",intensity:[0,0,15,0]}]},transform:{type:"stack"},transition:{effect:"cubic",duration:1e3},innerPadding:.1,encoding:{color:{},x:{},y:{},x0:{},y0:{}},states:{highlight:{className:"".concat("muze","-layer-bar-highlight")},fadeout:{className:"".concat("muze","-layer-bar-fadeout")},selected:{className:"".concat("muze","-layer-bar-selected")}}},bar_helper_resolveDimByField=(__webpack_require__(20),function resolveDimByField(type,axesInfo,config,data){var pos,spaceType="x"===type?"width":"height",_ref=[config["".concat(type,"FieldType")],axesInfo["".concat(type,"Axis")]],fieldType=_ref[0],axis=_ref[1],transformType=config.transformType,sizeEncoding=config.sizeEncoding,sizeConfig=config.sizeConfig,measurement=config.measurement,sizeValue=sizeEncoding.value,enter=0,space=0,enterSpace=0;if(void 0!==fieldType)if(config["".concat(type,"0Field")]){var min,max,minVal=data[type],maxVal=data["".concat(type,"0")];if(null===minVal||null===maxVal)return{enterSpace:void 0,enter:void 0,pos:void 0,space:void 0};fieldType===dist_datamodel.MeasureSubtype.CONTINUOUS||fieldType===dist_datamodel.DimensionSubtype.TEMPORAL?(min=Math.min(minVal,maxVal),max=Math.max(minVal,maxVal)):(min=minVal,max=maxVal);var scales="x"===type?[min,max]:[max,min];pos=axis.getScaleValue(scales[0])+axis.getUnitWidth()/2,space=Math.abs(axis.getScaleValue(scales[1])-pos)+axis.getUnitWidth()/2,enter=pos,enterSpace=0}else if(fieldType===dist_datamodel.DimensionSubtype.CATEGORICAL||fieldType===dist_datamodel.DimensionSubtype.TEMPORAL){if(pos=axis.getScaleValue(data[type])+(sizeConfig["x"===type?"barWidthOffset":"barHeightOffset"]||0),space=sizeConfig["x"===type?"barWidth":"barHeight"],void 0!==sizeValue){var diffPx=sizeValue*space;space-=diffPx,pos+=diffPx/2}enter=pos,enterSpace=space}else{var zeroPos=axis.getScaleValue(0),axisType=axis.getScaleValue(data[type]),axisType0=axis.getScaleValue(data["".concat(type,"0")]);enterSpace=0,"x"===type?(pos=data[type]<0||transformType===STACK?axisType:zeroPos,space=Math.abs(pos-(transformType===STACK?axisType0:data[type]>=0?axisType:zeroPos))):(pos=transformType===STACK||data[type]>=0?axisType:zeroPos,space=Math.abs(pos-(transformType===STACK?axisType0:data[type]>=0?zeroPos:axisType))),enter=zeroPos}else pos=0,space=measurement[spaceType];return{enterSpace:enterSpace,enter:enter,pos:pos,space:space}}),resolveDimensions=function resolveDimensions(data,config,axes){var axesInfo={xAxis:axes.x,yAxis:axes.y},_resolveDimByField=bar_helper_resolveDimByField("x",axesInfo,config,data),enterWidth=_resolveDimByField.enterSpace,enterX=_resolveDimByField.enter,xPos=_resolveDimByField.pos,width=_resolveDimByField.space,_resolveDimByField2=bar_helper_resolveDimByField("y",axesInfo,config,data),enterHeight=_resolveDimByField2.enterSpace;return{enter:{x:enterX,y:_resolveDimByField2.enter,width:enterWidth,height:enterHeight},update:{x:xPos,y:_resolveDimByField2.pos,width:width,height:_resolveDimByField2.space}}};function bar_typeof(obj){return(bar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function bar_toConsumableArray(arr){return function bar_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function bar_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function bar_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function bar_slicedToArray(arr,i){return function bar_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function bar_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function bar_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function bar_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function bar_possibleConstructorReturn(self,call){return!call||"object"!==bar_typeof(call)&&"function"!=typeof call?function bar_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function bar_get(target,property,receiver){return(bar_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function bar_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=bar_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function bar_getPrototypeOf(o){return(bar_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function bar_setPrototypeOf(o,p){return(bar_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var MEASURE=dist_datamodel.FieldType.MEASURE,bar_scaleBand=Scales.band,bar_BarLayer=function(_BaseLayer){function BarLayer(){var _getPrototypeOf2,_this;!function bar_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BarLayer);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=bar_possibleConstructorReturn(this,(_getPrototypeOf2=bar_getPrototypeOf(BarLayer)).call.apply(_getPrototypeOf2,[this].concat(params))))._bandScale=bar_scaleBand(),_this._plotPadding={x:0,y:0},_this._plotSpan={x:0,y:0},_this._pointMap={},_this}return function bar_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&bar_setPrototypeOf(subClass,superClass)}(BarLayer,base_layer_BaseLayer),function bar_createClass(Constructor,protoProps,staticProps){return protoProps&&bar_defineProperties(Constructor.prototype,protoProps),staticProps&&bar_defineProperties(Constructor,staticProps),Constructor}(BarLayer,[{key:"elemType",value:function elemType(){return"rect"}},{key:"calculateDomainFromData",value:function calculateDomainFromData(data,encodingFieldInf,fieldsConfig){var domain=bar_get(bar_getPrototypeOf(BarLayer.prototype),"calculateDomainFromData",this).call(this,data,encodingFieldInf,fieldsConfig);return["x","y"].forEach(function(d){encodingFieldInf["".concat(d,"FieldType")]===MEASURE&&domain[d]&&(encodingFieldInf["".concat(d,"0Field}")]?domain[d]=domain[d].sort(function(a,b){return a-b}):domain[d][0]=Math.min(domain[d][0],0))}),domain}},{key:"translatePoints",value:function translatePoints(data,sizeConfig){return function getTranslatedPoints(context,data,sizeConfig){for(var points=[],encoding=context.config().encoding,axes=context.axes(),colorAxis=axes.color,fieldsConfig=context.data().getFieldsConfig(),colorEncoding=encoding.color,colorField=colorEncoding.field,sizeEncoding=encoding.size||{},_context$encodingFiel=context.encodingFieldsInf(),x0Field=_context$encodingFiel.x0Field,y0Field=_context$encodingFiel.y0Field,xFieldSubType=_context$encodingFiel.xFieldSubType,yFieldSubType=_context$encodingFiel.yFieldSubType,measurement=context.measurement(),isXDim=xFieldSubType===dist_datamodel.DimensionSubtype.CATEGORICAL||xFieldSubType===dist_datamodel.DimensionSubtype.TEMPORAL,isYDim=yFieldSubType===dist_datamodel.DimensionSubtype.CATEGORICAL||yFieldSubType===dist_datamodel.DimensionSubtype.TEMPORAL,key=isXDim?"x":isYDim?"y":null,transformType=context.transformType(),colorFieldIndex=colorField&&fieldsConfig[colorField]&&fieldsConfig[colorField].index,i=0,len=data.length;i<len;i++){var d=data[i],style={},meta={},dimensions=resolveDimensions(d,{xFieldType:xFieldSubType,yFieldType:yFieldSubType,x0Field:x0Field,y0Field:y0Field,transformType:transformType,measurement:measurement,sizeConfig:sizeConfig,sizeEncoding:sizeEncoding},axes),_getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor;style.fill=color,meta.stateColor={},meta.originalColor=rawColor,meta.colorTransform={};var update=dimensions.update;if(!isNaN(update.x)&&!isNaN(update.y)&&void 0!==d._id){var point=null;(point={enter:dimensions.enter,update:update,style:style,_data:d._data,_id:d._id,source:d._data,rowId:d._id,meta:meta}).className=getIndividualClassName(d,i,data,context),points.push(point),context.cachePoint(d[key],point)}}return points=positionPoints(context,points)}(this,data,sizeConfig)}},{key:"render",value:function render(container){var _this2=this,config=this.config(),transition=config.transition,normalizedDataArr=this._normalizedData,keys=this._transformedData.map(function(d){return d.key}),fieldsConfig=this.data().getFieldsConfig(),axes=this.axes(),height=axes.y&&axes.y.scale().range()[0],width=axes.x&&axes.x.scale().range()[1],defClassName=config.defClassName,qualifiedClassName=getQualifiedClassName(defClassName,this.id(),config.classPrefix),className=config.className,containerSelection=renderer_utils_selectElement(container),dimensions=Object.values(fieldsConfig).filter(function(e){return e.def.type===dist_datamodel.FieldType.DIMENSION}).map(function(e){return e.index});return containerSelection.classed(qualifiedClassName.join(" "),!0),containerSelection.classed(className,!0),function clipElement(container,measurement,id){var clipPathElement=makeElement(src_select(container),"clipPath",[1],"#".concat(id));makeElement(clipPathElement,"rect",[1]).attr("x",measurement.x).attr("y",measurement.x).attr("width",measurement.width).attr("height",measurement.height),clipPathElement.attr("clip-path","url(#".concat(id,")"))}(container,{x:0,y:0,width:width,height:height},"id-".concat(this.id())),this._points=this.generateDataPoints(normalizedDataArr,keys),renderer_utils_createElements({data:this._points,container:container,selector:"g",append:"g",each:function each(points,group,i){var seriesClassName="".concat(qualifiedClassName[0],"-").concat(keys[i]||i).toLowerCase();group.style("display","block"),renderer_drawRects({layer:_this2,container:group.node(),points:points,className:seriesClassName,transition:transition,style:{},keyFn:function keyFn(d){return dimensions.map(function(key){return d._data[key]}).join("-")}})}}),this}},{key:"generateDataPoints",value:function generateDataPoints(normalizedData,keys){var _this3=this,_getPlotMeasurement2=bar_slicedToArray(helpers_getPlotMeasurement(this,keys),2),barWidthMetrics=_getPlotMeasurement2[0],barHeightMetrics=_getPlotMeasurement2[1],barWidthOffsets=barWidthMetrics.offsetValues||[],barHeightOffsets=barHeightMetrics.offsetValues||[];return this._plotSpan={x:barWidthMetrics.groupSpan||0,y:barHeightMetrics.groupSpan||0},this._plotPadding={x:barWidthMetrics.padding||0,y:barHeightMetrics.padding||0},this._pointMap={},normalizedData.map(function(data,i){return _this3.translatePoints(data,{barWidth:barWidthMetrics.span,barWidthOffset:barWidthOffsets[i]||0,barHeight:barHeightMetrics.span,barHeightOffset:barHeightOffsets[i]||0})})}},{key:"getPlotPadding",value:function getPlotPadding(){return this._plotPadding}},{key:"resolveTransformType",value:function resolveTransformType(){this._transformType=helpers_getValidTransformForAggFn(this)}},{key:"getNearestPoint",value:function getNearestPoint(x,y){if(!this.data())return null;var value,points,uniqueFieldType,uniqueFieldIndex,filterData,identifiers,pointFound=null,dataModel=this.data(),dataObj=dataModel.getData(),fieldsConfig=dataModel.getFieldsConfig(),axes=this.axes(),data=dataObj.data,pointMap=this._pointMap,_this$encodingFieldsI=this.encodingFieldsInf(),xField=_this$encodingFieldsI.xField,yField=_this$encodingFieldsI.yField,xFieldSubType=_this$encodingFieldsI.xFieldSubType,yFieldSubType=_this$encodingFieldsI.yFieldSubType;xFieldSubType===dist_datamodel.MeasureSubtype.CONTINUOUS?(value=axes.y.invert(y),uniqueFieldIndex=fieldsConfig[yField].index,uniqueFieldType=yFieldSubType):(value=axes.x.invert(x),uniqueFieldIndex=fieldsConfig[xField].index,uniqueFieldType=xFieldSubType),uniqueFieldType===dist_datamodel.DimensionSubtype.CATEGORICAL&&(points=pointMap[value]),uniqueFieldType===dist_datamodel.DimensionSubtype.TEMPORAL&&(points=pointMap[value=(filterData=bar_toConsumableArray(new Set(data.map(function(d){return d[uniqueFieldIndex]}))))[common_utils_getClosestIndexOf(filterData,value)]]);var len=points&&points.length;points&&points.sort(function(p1,p2){return p1.update.y-p2.update.y});for(var i=0;i<len;i++){var point=points[i],update=point.update;if(x>=update.x&&x<=update.width+update.x&&y>=update.y&&y<=update.height+update.y){pointFound=point;break}pointFound=null}var values=pointFound&&pointFound._data;return values&&(identifiers=this.getIdentifiersFromData(values,pointFound._id)),pointFound?{dimensions:[pointFound.update],id:identifiers,layerId:this.id()}:pointFound}},{key:"getPlotSpan",value:function getPlotSpan(){return this._plotSpan}}],[{key:"formalName",value:function formalName(){return"bar"}},{key:"defaultConfig",value:function defaultConfig(){return bar_default_config_defaultConfig}},{key:"defaultPolicy",value:function defaultPolicy(conf,userConf){var config=base_layer_BaseLayer.defaultPolicy(conf,userConf),colorField=config.encoding.color.field,transform=config.transform;return colorField&&(transform.groupBy=colorField),config}}]),BarLayer}(),tick_default_config_defaultConfig={defClassName:"layer-tick",className:"",classPrefix:"muze",interaction:{highlight:[{type:"stroke",intensity:[0,0,-15,0]}],fade:[{type:"stroke",intensity:[0,0,15,0]}],focus:[{type:"stroke",intensity:[0,0,15,0]}]},innerPadding:.1,transform:{type:"identity"},transition:{effect:"cubic",duration:1e3},encoding:{color:{},x:{},y:{},x0:{},y0:{},strokeOpacity:{value:.5},fillOpacity:{value:.5}},states:{highlight:{className:"".concat("muze","-layer-tick-highlight")},fadeout:{className:"".concat("muze","-layer-tick-fadeout")},selected:{className:"".concat("muze","-layer-tick-selected")}}},tick_renderer=function(params){var points=params.points,container=params.container,keyFn=params.keyFn,className=params.className,mount=renderer_utils_selectElement(container),ticks=mount.selectAll("path").data(points,keyFn),ticksEnter=ticks.enter().append("path");return mount.attr("class",className||""),ticksEnter.each(function(d){var selection=renderer_utils_selectElement(this),enter=d.enter||{};Object.entries(enter).forEach(function(attr){return!isNaN(attr[1])&&selection.attr(attr[0],attr[1])})}),ticks.exit().remove(),ticks.merge(ticksEnter).each(function(d){var selection=renderer_utils_selectElement(this),update=d.update,updateStyle=d.style||{},x0=void 0!==update.x0?update.x0:update.x,y0=void 0!==update.y0?update.y0:update.y,path="M ".concat(update.x," ").concat(update.y," L ").concat(x0," ").concat(y0);d.className&&selection.classed(d.className,!0),selection.attr("d",path),Object.entries(updateStyle).forEach(function(styleObj){return selection.style(styleObj[0],styleObj[1])})})};__webpack_require__(21);function tick_typeof(obj){return(tick_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function tick_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function tick_possibleConstructorReturn(self,call){return!call||"object"!==tick_typeof(call)&&"function"!=typeof call?function tick_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function tick_getPrototypeOf(o){return(tick_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function tick_setPrototypeOf(o,p){return(tick_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var tick_TickLayer=function(_PointLayer){function TickLayer(){return function tick_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TickLayer),tick_possibleConstructorReturn(this,tick_getPrototypeOf(TickLayer).apply(this,arguments))}return function tick_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&tick_setPrototypeOf(subClass,superClass)}(TickLayer,point_PointLayer),function tick_createClass(Constructor,protoProps,staticProps){return protoProps&&tick_defineProperties(Constructor.prototype,protoProps),staticProps&&tick_defineProperties(Constructor,staticProps),Constructor}(TickLayer,[{key:"elemType",value:function elemType(){return"path"}},{key:"translatePoints",value:function translatePoints(data,encoding,axes){for(var config=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},points=[],_getAxesScales=helpers_getAxesScales(axes),xAxis=_getAxesScales.xAxis,yAxis=_getAxesScales.yAxis,fieldsConfig=this.data().getFieldsConfig(),_this$encodingFieldsI=this.encodingFieldsInf(),xField=_this$encodingFieldsI.xField,yField=_this$encodingFieldsI.yField,x0Field=_this$encodingFieldsI.x0Field,y0Field=_this$encodingFieldsI.y0Field,xFieldType=_this$encodingFieldsI.xFieldType,yFieldType=_this$encodingFieldsI.yFieldType,isXDim=xFieldType===dist_datamodel.FieldType.DIMENSION,isYDim=yFieldType===dist_datamodel.FieldType.DIMENSION,key=isXDim?ENCODING.X:isYDim?ENCODING.Y:null,colorEncoding=encoding.color,colorField=colorEncoding&&colorEncoding.field,colorFieldIndex=fieldsConfig[colorField]&&fieldsConfig[colorField].index,measurement=this.measurement(),colorAxis=axes.color,_config$offset=config.offset,offsetX=_config$offset.x,offsetY=_config$offset.y,_config$span=config.span,xSpan=_config$span.x,ySpan=_config$span.y,i=0,len=data.length;i<len;i++){var xPx=void 0,x0Px=void 0,y0Px=void 0,yPx=void 0,d=data[i],row=d._data;xField&&(x0Px=(xPx=xAxis.getScaleValue(d.x)+offsetX)+xSpan),yField&&(y0Px=null!==(yPx=yAxis.getScaleValue(d.y)+offsetY)?yPx+ySpan:null),xField||(xPx=0,x0Px=measurement.width,isNaN(yPx)||(y0Px=yPx+=ySpan/2)),yField||(yPx=0,y0Px=measurement.height,x0Px=xPx+=xSpan/2),x0Field&&(x0Px=xAxis.getScaleValue(d.x0)+xSpan,yPx+=ySpan/2,y0Px-=ySpan/2),y0Field&&(y0Px=yAxis.getScaleValue(d.y0)+ySpan,xPx+=xSpan/2,x0Px-=xSpan/2);var style={},meta={},_getLayerColor=getLayerColor({datum:d,index:i},{colorEncoding:colorEncoding,colorAxis:colorAxis,colorFieldIndex:colorFieldIndex}),color=_getLayerColor.color,rawColor=_getLayerColor.rawColor;if(style.stroke=color,meta.stateColor={},meta.originalColor=rawColor,meta.colorTransform={},!isNaN(xPx)&&!isNaN(yPx)){var point={enter:{},update:{x:xPx,y:yPx,x0:x0Px,y0:y0Px},style:style,_data:row,_id:d._id,source:row,rowId:d._id,meta:meta};point.className=getIndividualClassName(d,i,data,this),points.push(point),this.cachePoint(d[key],point)}}return points=positionPoints(this,points)}},{key:"getMeasurementConfig",value:function getMeasurementConfig(offsetX,offsetY,widthSpan,heightSpan){return{offset:{x:offsetX||0,y:offsetY||0},span:{x:widthSpan,y:heightSpan}}}}],[{key:"defaultConfig",value:function defaultConfig(){return tick_default_config_defaultConfig}},{key:"formalName",value:function formalName(){return"tick"}},{key:"drawFn",value:function drawFn(){return tick_renderer}}]),TickLayer}(),layer_types_AREA_LAYER="area",layer_types_ARC_LAYER="arc",layer_types_LINE_LAYER="line",layer_types_TEXT_LAYER="text",layer_types_POINT_LAYER="point",layer_types_BAR_LAYER="bar",layer_types_TICK_LAYER="tick",layer_types_SIMPLE_LAYER="simple",layer_types_BASE_LAYER="base";function layer_factory_toConsumableArray(arr){return function layer_factory_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function layer_factory_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function layer_factory_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _DEFAULT_LAYERS,sanitizeEncoding=function sanitizeEncoding(encoding){for(var key in encoding)"string"==typeof encoding[key]&&(encoding[key]={field:encoding[key]})},src_layer_factory=function(){var compositeLayers={},factoryObj={setLayerRegistry:function setLayerRegistry(reg){factoryObj._layerRegistry=reg},getSerializedConf:function getSerializedConf(mark,layerDef){var serializedDefs,defs=compositeLayers[mark],newConf=mergeRecursive({},layerDef);if(defs)serializedDefs=defs.map(function(unitLayerDef){var sDef={};return function parseLayerDefinition(sink,definition,layerDef,layerType){for(var key in definition)if(Object.hasOwnProperty.call(definition,key)){var strs=void 0,propValue=void 0,def=definition[key];isSimpleObject(def)?(sink[key]={},parseLayerDefinition(sink[key],def,layerDef,layerType)):"string"==typeof def&&(strs=def.split("."))&&strs[0]===layerType?void 0!==(propValue=getObjProp.apply(void 0,[layerDef].concat(layer_factory_toConsumableArray(strs.slice(1,strs.length)))))&&(sink[key]=propValue):sink[key]=def}}(sDef,unitLayerDef,newConf,mark),sanitizeEncoding(sDef.encoding),sDef});else{var encoding=newConf.encoding;sanitizeEncoding(encoding),serializedDefs=newConf}return serializedDefs},getLayerInstance:function getLayerInstance(layerDef){for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)params[_key-1]=arguments[_key];var layerRegistry=factoryObj._layerRegistry,instances=(layerDef=layerDef instanceof Array?layerDef:[layerDef]).map(function(layerObj){var layerConstructor=layerRegistry[layerObj.mark];return layerConstructor.create.apply(layerConstructor,params)});return 1===instances.length?instances[0]:instances},getLayerClass:function getLayerClass(mark){return factoryObj._layerRegistry[mark]},composeLayers:function composeLayers(layerType,layerDefs){compositeLayers[layerType]=layerDefs},sanitizeLayerConfig:function sanitizeLayerConfig(layerDef){var newConf=mergeRecursive({},layerDef);return sanitizeEncoding(newConf.encoding),newConf}};return factoryObj}();function defaults_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _CONFIG$ROWS$COLUMNS$,DEFAULT_LAYERS=(defaults_defineProperty(_DEFAULT_LAYERS={},layer_types_AREA_LAYER,area_AreaLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_ARC_LAYER,arc_ArcLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_LINE_LAYER,line_LineLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_TEXT_LAYER,text_TextLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_POINT_LAYER,point_PointLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_TICK_LAYER,tick_TickLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_BAR_LAYER,bar_BarLayer),defaults_defineProperty(_DEFAULT_LAYERS,layer_types_BASE_LAYER,base_layer_BaseLayer),_DEFAULT_LAYERS),muze_package=__webpack_require__(6),X="x",Y="y",ROWS="rows",COLUMNS="columns",COL="col",ROW="row",enums_constants_COLOR="color",enums_constants_SHAPE="shape",enums_constants_SIZE="size",constants_LEFT="left",constants_RIGHT="right",CELL="cell",X_AXES="xAxes",Y_AXES="yAxes",ENTRY_CELLS="entryCell",EXIT_CELLS="exitCell",constants_RADIUS="radius",constants_ANGLE="angle",PRIMARY="Primary",SECONDARY="Secondary";function local_options_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var local_options=(local_options_defineProperty(_CONFIG$ROWS$COLUMNS$={},"config",{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,ROWS,{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,COLUMNS,{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,enums_constants_COLOR,{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,enums_constants_SHAPE,{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,enums_constants_SIZE,{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,"detail",{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,"layers",{}),local_options_defineProperty(_CONFIG$ROWS$COLUMNS$,"transform",{}),_CONFIG$ROWS$COLUMNS$);function simple_group_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var simple_group=function(){function SimpleGroup(){!function simple_group_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleGroup)}return function simple_group_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_group_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_group_defineProperties(Constructor,staticProps),Constructor}(SimpleGroup,[{key:"data",value:function data(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"config",value:function config(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"serialize",value:function serialize(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"measurement",value:function measurement(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}}]),SimpleGroup}();function variable_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var variable_Variable=function(){function Variable(){!function variable_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Variable)}return function variable_createClass(Constructor,protoProps,staticProps){return protoProps&&variable_defineProperties(Constructor.prototype,protoProps),staticProps&&variable_defineProperties(Constructor,staticProps),Constructor}(Variable,[{key:"type",value:function type(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"toString",value:function toString(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}}]),Variable}();function composed_vars_typeof(obj){return(composed_vars_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function composed_vars_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function composed_vars_possibleConstructorReturn(self,call){return!call||"object"!==composed_vars_typeof(call)&&"function"!=typeof call?function composed_vars_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function composed_vars_getPrototypeOf(o){return(composed_vars_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function composed_vars_setPrototypeOf(o,p){return(composed_vars_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var composed_vars=function(_Variable){function ComposedVars(){var _getPrototypeOf2,_this;!function composed_vars_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ComposedVars);for(var _len=arguments.length,texts=new Array(_len),_key=0;_key<_len;_key++)texts[_key]=arguments[_key];return(_this=composed_vars_possibleConstructorReturn(this,(_getPrototypeOf2=composed_vars_getPrototypeOf(ComposedVars)).call.apply(_getPrototypeOf2,[this].concat(texts)))).vars(texts),_this}return function composed_vars_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&composed_vars_setPrototypeOf(subClass,superClass)}(ComposedVars,variable_Variable),function composed_vars_createClass(Constructor,protoProps,staticProps){return protoProps&&composed_vars_defineProperties(Constructor.prototype,protoProps),staticProps&&composed_vars_defineProperties(Constructor,staticProps),Constructor}(ComposedVars,[{key:"vars",value:function vars(){return arguments.length?(this._vars=arguments.length<=0?void 0:arguments[0],this):this._vars}},{key:"data",value:function data(){for(var _len2=arguments.length,dm=new Array(_len2),_key2=0;_key2<_len2;_key2++)dm[_key2]=arguments[_key2];return dm.length?(this.vars().forEach(function(d){return d.data(dm[0])}),this):this._data}},{key:"getMembers",value:function getMembers(){return this.vars().map(function(member){return member.getMembers()[0]})}},{key:"type",value:function type(){return this.vars()[0].type()}},{key:"toString",value:function toString(){return this.vars().map(function(d){return d.toString()}).join(",")}},{key:"numberFormat",value:function numberFormat(){return this.vars()[0].numberFormat()}},{key:"format",value:function format(values){return this.vars()[0].format(values)}},{key:"subtype",value:function subtype(){return this.vars()[0].subtype()}},{key:"getMinDiff",value:function getMinDiff(){return this.vars()[0].getMinDiff()}}]),ComposedVars}();function simple_var_typeof(obj){return(simple_var_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function simple_var_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function simple_var_possibleConstructorReturn(self,call){return!call||"object"!==simple_var_typeof(call)&&"function"!=typeof call?function simple_var_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function simple_var_getPrototypeOf(o){return(simple_var_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function simple_var_setPrototypeOf(o,p){return(simple_var_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var simple_var_SimpleVariable=function(_Variable){function SimpleVariable(text){var _this;return function simple_var_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleVariable),(_this=simple_var_possibleConstructorReturn(this,simple_var_getPrototypeOf(SimpleVariable).call(this))).oneVar(text),_this}return function simple_var_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&simple_var_setPrototypeOf(subClass,superClass)}(SimpleVariable,variable_Variable),function simple_var_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_var_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_var_defineProperties(Constructor,staticProps),Constructor}(SimpleVariable,[{key:"oneVar",value:function oneVar(){return arguments.length?(this._oneVar=arguments.length<=0?void 0:arguments[0],this):this._oneVar}},{key:"data",value:function data(){return arguments.length?(this._data=arguments.length<=0?void 0:arguments[0],this):this._data}},{key:"toString",value:function toString(){return this.oneVar()}},{key:"numberFormat",value:function numberFormat(){return"measure"===this.type()?this.data().getFieldspace().getMeasure()[this.oneVar()].numberFormat():function(val){return val}}},{key:"format",value:function format(values){if(values&&"temporal"===this.subtype()){var formatter=this.data().getFieldspace().getDimension()[this.oneVar()].schema().format,dtFormat=new dist_datamodel.DateTimeFormatter(formatter);values=values.map(function(e){return dtFormat.getNativeDate(e)})}return values}},{key:"getMembers",value:function getMembers(){return[this.oneVar()]}},{key:"type",value:function type(){return this.data().getFieldsConfig()[this.oneVar()].def.type}},{key:"subtype",value:function subtype(){var fieldDef=this.data().getFieldsConfig()[this.oneVar()].def;return fieldDef.subtype||fieldDef.type}},{key:"getMinDiff",value:function getMinDiff(){return this.data().getFieldspace().fieldsObj()[this.oneVar()].minimumConsecutiveDifference()}},{key:"equals",value:function equals(varInst){return this.oneVar()===varInst.oneVar()}}]),SimpleVariable}();function field_sanitizer_slicedToArray(arr,i){return function field_sanitizer_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function field_sanitizer_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function field_sanitizer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function field_sanitizer_toConsumableArray(arr){return function field_sanitizer_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function field_sanitizer_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function field_sanitizer_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var field_sanitizer_convertToVar=function convertToVar(datamodel,fields){var vars=[];return fields&&fields.forEach(function(field){field instanceof composed_vars?(vars.push(field),field.data(datamodel)):vars.push(new simple_var_SimpleVariable(field).data(datamodel))}),vars},field_sanitizer_transformFields=function transformFields(datamodel,config){var _map2=field_sanitizer_slicedToArray([ROWS,COLUMNS].map(function(fields){var normalizedFields=function normalizeFields(config,type){var fieldsArr=[],fields=config[type];return fields[0]instanceof Array?(fieldsArr[0]=fields[0]||[],fieldsArr[1]=fields[1]||[]):fieldsArr[0]=fields,fieldsArr}(config,fields),norFields=[field_sanitizer_convertToVar(datamodel,normalizedFields[0])];return normalizedFields[1]&&(norFields[1]=field_sanitizer_convertToVar(datamodel,normalizedFields[1])),function orderFields(fieldArray,type){var dimensionArr=[[],[]],measureArr=[[],[]],temporalArr=[[],[]],categoricalArr=[[],[]];fieldArray.forEach(function(fieldList,index){fieldList.forEach(function(field){"dimension"===field.type()?(dimensionArr[index].push(field),"temporal"===field.subtype()?temporalArr[index].push(field):categoricalArr[index].push(field)):measureArr[index].push(field)})});var numOfMeasures=measureArr[0].length+(measureArr[1]?measureArr[1].length:0);if(!fieldArray[1]&&(measureArr[1]=type===COLUMNS?measureArr[0]:[],measureArr[0]=type!==COLUMNS?measureArr[0]:[],dimensionArr[1]=[],dimensionArr[0]=dimensionArr[0],0===numOfMeasures)){var allDimensions=[].concat(field_sanitizer_toConsumableArray(dimensionArr[0]),field_sanitizer_toConsumableArray(dimensionArr[1]));type===COLUMNS?(dimensionArr[1]=allDimensions[allDimensions.length-1]?[allDimensions[allDimensions.length-1]]:[],allDimensions.splice(-1,1)):dimensionArr[1]=[],dimensionArr[0]=field_sanitizer_toConsumableArray(allDimensions)}return dimensionArr[0].length&&dimensionArr[1].length&&numOfMeasures>0&&(dimensionArr[0]=[].concat(field_sanitizer_toConsumableArray(dimensionArr[0]),field_sanitizer_toConsumableArray(dimensionArr[1])),dimensionArr[1]=[]),{fields:dimensionArr.map(function(list,i){return 1===i?measureArr[i].concat(dimensionArr[i]):dimensionArr[i].concat(measureArr[i])}),dimensions:[].concat(field_sanitizer_toConsumableArray(dimensionArr[0]),field_sanitizer_toConsumableArray(dimensionArr[1])),measures:[].concat(field_sanitizer_toConsumableArray(measureArr[0]),field_sanitizer_toConsumableArray(measureArr[1])),temporal:[].concat(field_sanitizer_toConsumableArray(temporalArr[0]),field_sanitizer_toConsumableArray(temporalArr[1])),categorical:[].concat(field_sanitizer_toConsumableArray(categoricalArr[0]),field_sanitizer_toConsumableArray(categoricalArr[1]))}}(norFields,fields)}),2),rowsInfo=_map2[0],columnsInfo=_map2[1],rows=rowsInfo.fields,rowDimensions=rowsInfo.dimensions,rowMeasures=rowsInfo.measures,rowTemporalFields=rowsInfo.temporal,rowCategoricalFields=rowsInfo.categorical,columns=columnsInfo.fields,columnDimensions=columnsInfo.dimensions,columnMeasures=columnsInfo.measures;return{rows:rows,rowDimensions:rowDimensions,rowMeasures:rowMeasures,rowTemporalFields:rowTemporalFields,rowCategoricalFields:rowCategoricalFields,columns:columns,columnTemporalFields:columnsInfo.temporal,columnCategoricalFields:columnsInfo.categorical,columnDimensions:columnDimensions,columnMeasures:columnMeasures}};function visual_encoder_slicedToArray(arr,i){return function visual_encoder_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function visual_encoder_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function visual_encoder_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function visual_encoder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var visual_encoder_VisualEncoder=function(){function VisualEncoder(){!function visual_encoder_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VisualEncoder)}return function visual_encoder_createClass(Constructor,protoProps,staticProps){return protoProps&&visual_encoder_defineProperties(Constructor.prototype,protoProps),staticProps&&visual_encoder_defineProperties(Constructor,staticProps),Constructor}(VisualEncoder,[{key:"createAxis",value:function createAxis(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"setCommonDomain",value:function setCommonDomain(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getLayerConfig",value:function getLayerConfig(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"fieldInfo",value:function fieldInfo(){return arguments.length?(this._fieldInfo=mergeRecursive(this._fieldInfo||{},arguments.length<=0?void 0:arguments[0]),this):this._fieldInfo}},{key:"fieldSanitizer",value:function fieldSanitizer(datamodel,config){return this.fieldInfo(field_sanitizer_transformFields(datamodel,config)),this.fieldInfo()}},{key:"axisFrom",value:function axisFrom(){return arguments.length?(this._axisFrom=arguments.length<=0?void 0:arguments[0],this):this._axisFrom}},{key:"headerFrom",value:function headerFrom(){return arguments.length?(this._headerFrom=arguments.length<=0?void 0:arguments[0],this):this.__headerFrom}},{key:"setAxisAndHeaders",value:function setAxisAndHeaders(){var axisFrom=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},fields=arguments.length>1?arguments[1]:void 0,_getHeaderAxisFrom2=visual_encoder_slicedToArray(group_utils_getHeaderAxisFrom(ROW,fields.rows,axisFrom),2),rowHeader=_getHeaderAxisFrom2[0],rowAxis=_getHeaderAxisFrom2[1],_getHeaderAxisFrom4=visual_encoder_slicedToArray(group_utils_getHeaderAxisFrom("column",fields.columns,axisFrom),2),colHeader=_getHeaderAxisFrom4[0],colAxis=_getHeaderAxisFrom4[1];return this.axisFrom({row:rowAxis,column:colAxis}),this.headerFrom({row:rowHeader,column:colHeader}),this}}]),VisualEncoder}(),scaleMaps={linear:continous_axis_ContinousAxis,band:band_axis_BandAxis,temporal:time_axis_TimeAxis,size:size_axis_SizeAxis,color:color_axis_ColorAxis,shape:shape_axis_ShapeAxis},data_type_scale_map_dataTypeScaleMap={dimension:scale_type_namespaceObject.BAND,categorical:scale_type_namespaceObject.BAND,temporal:scale_type_namespaceObject.TIME,measure:scale_type_namespaceObject.LINEAR,continuous:scale_type_namespaceObject.LINEAR};function encoder_helper_toConsumableArray(arr){return function encoder_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function encoder_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function encoder_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var encoder_helper_generateAxisFromMap=function generateAxisFromMap(axisType,fieldInfo,axesCreators,groupAxes){var axisKey,currentAxes=[],fields=fieldInfo.fields,index=fieldInfo.index,map=axesCreators.cacheMaps["".concat(axisType,"AxesMap")],commonAxisKey=getAxisKey(axisType,index);return fields.forEach(function(field,axisIndex){axisKey=getAxisKey(axisType,index,axisIndex,data_type_scale_map_dataTypeScaleMap[field.subtype()]);var axis,axisConfig=function getAxisConfig(axisInfo,field,axesCreators){var axisOrientation,index=axisInfo.index,axisIndex=axisInfo.axisIndex,axisType=axisInfo.axisType,config=axesCreators.config,position=axesCreators.position,userAxisConfig=config.axes&&config.axes[axisType]||{};axisOrientation="both"===position?(axisType===Y?[axis_orientation_namespaceObject.LEFT,axis_orientation_namespaceObject.RIGHT]:[axis_orientation_namespaceObject.TOP,axis_orientation_namespaceObject.BOTTOM])[axisIndex]:position;var axisConfig={id:"".concat(axisType,"-").concat(index,"-").concat(axisIndex),name:field.toString(),field:field.toString(),numberFormat:field.numberFormat(),orientation:axisOrientation,showAxisName:!0,show:!0,type:data_type_scale_map_dataTypeScaleMap[field.subtype()]};return userAxisConfig.tickValues=field.format(userAxisConfig.tickValues),userAxisConfig.domain=field.format(userAxisConfig.domain),mergeRecursive(axisConfig,userAxisConfig)}({index:index,axisIndex:axisIndex,axisType:axisType},field,axesCreators);map.has(axisKey)?((axis=map.get(axisKey))._rotationLock=!1,axis.config(axisConfig),axisConfig.domain?axis.domain(axisConfig.domain):axis.resetDomain()):axis=function createSimpleAxis(axisConfig,field,axesCreators){var labelManager=axesCreators.labelManager;return new(0,scaleMaps[data_type_scale_map_dataTypeScaleMap[field.subtype()]])(axisConfig,{labelManager:labelManager})}(axisConfig,field,axesCreators),currentAxes.push(axis),map.set(axisKey,axis)}),currentAxes.length&&(map.set(commonAxisKey,currentAxes),groupAxes.add(commonAxisKey)),currentAxes},getIndex=function getIndex(arr,val){for(var i=0,arrIndex=-1;-1===arrIndex&&i<arr.length;)arr[i].toString()===val.toString()&&(arrIndex=i),i++;return arrIndex};function cartesian_encoder_typeof(obj){return(cartesian_encoder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function cartesian_encoder_toConsumableArray(arr){return function cartesian_encoder_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function cartesian_encoder_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function cartesian_encoder_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function cartesian_encoder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function cartesian_encoder_possibleConstructorReturn(self,call){return!call||"object"!==cartesian_encoder_typeof(call)&&"function"!=typeof call?function cartesian_encoder_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function cartesian_encoder_get(target,property,receiver){return(cartesian_encoder_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function cartesian_encoder_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=cartesian_encoder_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function cartesian_encoder_getPrototypeOf(o){return(cartesian_encoder_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function cartesian_encoder_setPrototypeOf(o,p){return(cartesian_encoder_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var cartesian_encoder_CartesianEncoder=function(_VisualEncoder){function CartesianEncoder(){return function cartesian_encoder_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,CartesianEncoder),cartesian_encoder_possibleConstructorReturn(this,cartesian_encoder_getPrototypeOf(CartesianEncoder).apply(this,arguments))}return function cartesian_encoder_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&cartesian_encoder_setPrototypeOf(subClass,superClass)}(CartesianEncoder,visual_encoder_VisualEncoder),function cartesian_encoder_createClass(Constructor,protoProps,staticProps){return protoProps&&cartesian_encoder_defineProperties(Constructor.prototype,protoProps),staticProps&&cartesian_encoder_defineProperties(Constructor,staticProps),Constructor}(CartesianEncoder,[{key:"createAxis",value:function createAxis(axesCreators,fieldInfo){var _this=this,geomCellAxes={},axes=axesCreators.axes,projections=fieldInfo.projections,indices=fieldInfo.indices,rowFields=projections.rowFields,columnFields=projections.columnFields,axisFields=[{fields:rowFields,index:indices.rowIndex},{fields:columnFields,index:indices.columnIndex}],xAxes=axes.x||[],yAxes=axes.y||[];return[rowFields,columnFields].forEach(function(fields,i){var type=0===i?ROW:"column",axis=0===i?Y:X;fields.length>1?axesCreators.position="both":axesCreators.position=_this.axisFrom()[type],geomCellAxes[axis]=encoder_helper_generateAxisFromMap(axis,axisFields[i],axesCreators,axis===X?xAxes:yAxes)}),geomCellAxes}},{key:"updateDomains",value:function updateDomains(store,axes){var xAxes=axes.x,yAxes=axes.y;store.model.lock();for(var i=0;i<xAxes.length;i++)for(var j=0;j<xAxes[i].length;j++)store.commit("".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.x.",0).concat(i,"0"),xAxes[i][j].domain());for(var _i=0;_i<yAxes.length;_i++)for(var _j=0;_j<yAxes[_i].length;_j++)store.commit("".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.y.").concat(_i,0,"0"),yAxes[_i][_j].domain()),yAxes[_i][_j]._domainLock=!1;store.model.unlock()}},{key:"unionUnitDomains",value:function unionUnitDomains(context){for(var store=context.store(),unitDomains=store.get("".concat(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,".domain")),resolver=context.resolver(),units=resolver.units(),domains={0:{},1:{}},_loop=function _loop(rIdx,len){for(var unitsArr=units[rIdx],_loop2=function _loop2(cIdx,len2){var axisFields=unitsArr[cIdx].fields();[axisFields.x,axisFields.y].forEach(function(fieldArr,axisType){fieldArr.forEach(function(field,axisIndex){var key=axisType?"".concat(rIdx,"0").concat(axisIndex):"0".concat(cIdx).concat(axisIndex),dom=unitDomains["".concat(rIdx).concat(cIdx)];dom&&0!==Object.keys(dom).length&&(domains[axisType][key]=common_utils_unionDomain([domains[axisType]&&domains[axisType][key]||[],dom["".concat(field)]],field.subtype()))})})},cIdx=0,len2=unitsArr.length;cIdx<len2;cIdx++)_loop2(cIdx)},rIdx=0,len=units.length;rIdx<len;rIdx++)_loop(rIdx);var _resolver$axes=resolver.axes(),xAxes=_resolver$axes.x,yAxes=_resolver$axes.y;store.model.lock(),[xAxes,yAxes].forEach(function(axesArr,axisType){axesArr.forEach(function(axes,idx){var min=[],max=[],domain=[],adjustedDomain=[];axes.length>1&&"linear"===axes[0].constructor.type()&&axes[0].config().alignZeroLine&&(axes.forEach(function(axis,i){var key=axisType?"".concat(idx,"0").concat(i):"0".concat(idx).concat(i);domain=domains[axisType][key],min[i]=domain[0],max[i]=domain[1]}),adjustedDomain=function getAdjustedDomain(max,min){var y1ratio=max[0]/(max[0]-min[0]),y2ratio=max[1]/(max[1]-min[1]),allSameSign=!1;return min[0]>0&&min[1]>0&&min[1]>0&&max[1]>0&&(allSameSign=!0,min[0]=0,min[1]=0),min[0]<0&&min[1]<0&&min[1]<0&&max[1]<0&&(allSameSign=!0,max[0]=0,max[1]=0),allSameSign||y1ratio===y2ratio||(y1ratio<y2ratio?min[1]=min[0]/max[0]*max[1]:min[0]=min[1]/max[1]*max[0]),[[min[0],max[0]],[min[1],max[1]]]}(max,min)),axes.forEach(function(axis,index){var key=axisType?"".concat(idx,"0").concat(index):"0".concat(idx).concat(index);domain=adjustedDomain[index]||domains[axisType][key],axis.domain(domain);var type=axisType?"y":"x";store.commit("".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.").concat(type,".").concat(idx).concat(index),domain)})})}),store.model.unlock()}},{key:"getFacetsAndProjections",value:function getFacetsAndProjections(fields,type){for(var facets=[],projections=[],counter=0,primaryFacets=[],secondaryFacets=[],primaryFields=fields[0],secondaryFields=fields[1],primaryLen=primaryFields.length,secondaryLen=secondaryFields.length,axisFrom=this.axisFrom(),i=0;i<primaryLen;i++){var projArr=[primaryFields[i]],primaryField=primaryFields[i];if("measure"===primaryField.type()){var secondaryField=secondaryFields[counter];secondaryField&&"measure"===secondaryField.type()&&(counter++,projArr=[primaryField,secondaryField]),projections.push(projArr)}else facets.push(primaryField),primaryFacets.push(primaryField)}if(secondaryLen>counter)for(var _i2=counter;_i2<secondaryLen;_i2++){var _secondaryField=secondaryFields[_i2],_projArr=[_secondaryField];"measure"===_secondaryField.type()?projections.push(_projArr):(facets.push(_secondaryField),secondaryFacets.push(_secondaryField))}if((primaryFacets.length||secondaryFacets.length)&&!projections.length)if(axisFrom[type=type===COL?"column":type]!==constants_LEFT&&"top"!==axisFrom[type]||!primaryFacets.length){var _facet=secondaryFacets[0];projections=[[_facet]];var _existIndex=getIndex(primaryFacets,_facet);_existIndex>-1&&(projections=[[_facet,_facet]],primaryFacets.splice(_existIndex,1)),secondaryFacets.splice(0,1)}else{var axisFromIndex=primaryFacets.length-1,facet=primaryFacets[axisFromIndex];projections=[[facet]];var existIndex=getIndex(secondaryFacets,facet);existIndex>-1&&(projections=[[facet,facet]],secondaryFacets.splice(existIndex,1)),primaryFacets.splice(axisFromIndex,1)}return{facets:facets=(facets=[].concat(primaryFacets,secondaryFacets)).filter(function(el,index,self){return index===self.findIndex(function(t){return t.toString()===el.toString()})}),projections:projections}}},{key:"fieldSanitizer",value:function fieldSanitizer(datamodel,config){return cartesian_encoder_get(cartesian_encoder_getPrototypeOf(CartesianEncoder.prototype),"fieldSanitizer",this).call(this,datamodel,config)}},{key:"getRetinalFieldsDomain",value:function getRetinalFieldsDomain(dataModels,encoding){var groupedModel=dataModels.groupedModel,domains={};for(var key in encoding)if({}.hasOwnProperty.call(encoding,key)){var encodingObj=encoding[key],field=encodingObj.field;if(!encodingObj.domain&&field){var domain=retriveDomainFromData(groupedModel,field);domains[field]=domain}}return domains}},{key:"serializeLayerConfig",value:function serializeLayerConfig(layerArray){var serializedLayers=[];return layerArray.length&&layerArray.forEach(function(layer,i){var def=src_layer_factory.sanitizeLayerConfig(layer);def.order=i,serializedLayers.push(def)}),serializedLayers}},{key:"getLayerConfig",value:function getLayerConfig(fields,userLayerConfig){var layerConfig=[],columnFields=fields.columnFields,rowFields=fields.rowFields;return columnFields.forEach(function(colField){var colFieldName=colField.toString();rowFields.forEach(function(rowField){var configs=[],rowFieldName=rowField.toString(),encoding={x:{field:colFieldName},y:{field:rowFieldName}},rowFieldType=rowField.subtype(),mark=function getDefaultMark(colFieldType,rowFieldType){return"categorical"===colFieldType||"categorical"===rowFieldType?"bar":"temporal"===colFieldType||"temporal"===rowFieldType?"line":"point"}(colField.subtype(),rowFieldType),defConfigs=[{mark:mark,def:{mark:mark,encoding:encoding}}],layerConfigs=function getLayerConfFromFields(colFields,rowFields,userLayerConfig){return userLayerConfig.filter(function(conf){var _ref,_ref2,_ref3,userConf=conf instanceof Array?conf:[conf],encodingArr=(_ref=[]).concat.apply(_ref,encoder_helper_toConsumableArray(userConf.map(function(d){return d.encoding}).filter(function(d){return void 0!==d})));if(!encodingArr.length)return!0;var xFields=(_ref2=[]).concat.apply(_ref2,encoder_helper_toConsumableArray(encodingArr.map(function(d){return[d.x&&d.x.field,d.x0&&d.x0.field]}))).filter(function(d){return void 0!==d&&null!==d}),yFields=(_ref3=[]).concat.apply(_ref3,encoder_helper_toConsumableArray(encodingArr.map(function(d){return[d.y&&d.y.field,d.y0&&d.y0.field]}))).filter(function(d){return void 0!==d&&null!==d});if(!xFields.length&&!yFields.length)return!0;var colFieldExist=!!xFields.length&&xFields.every(function(d){return-1!==colFields.indexOf(d)}),rowFieldExist=!!yFields.length&&yFields.every(function(d){return-1!==rowFields.indexOf(d)});return xFields.length&&yFields.length?colFieldExist&&rowFieldExist:colFieldExist||rowFieldExist})}(colField.getMembers(),rowField.getMembers(),userLayerConfig||[]);configs=layerConfigs.length?layerConfigs.map(function(layerConf){var mergedLayerConf=mergeRecursive(mergeRecursive({},defConfigs[0].def),layerConf),serializedLayerConfig=src_layer_factory.getSerializedConf(mergedLayerConf.mark,mergedLayerConf);return{mark:mergedLayerConf.mark,order:mergedLayerConf.order,def:serializedLayerConfig}}):defConfigs,layerConfig.push.apply(layerConfig,cartesian_encoder_toConsumableArray(configs))})}),layerConfig}}],[{key:"type",value:function type(){return"cartesian"}}]),CartesianEncoder}();function polar_encoder_typeof(obj){return(polar_encoder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function polar_encoder_toConsumableArray(arr){return function polar_encoder_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function polar_encoder_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function polar_encoder_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function polar_encoder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function polar_encoder_possibleConstructorReturn(self,call){return!call||"object"!==polar_encoder_typeof(call)&&"function"!=typeof call?function polar_encoder_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function polar_encoder_get(target,property,receiver){return(polar_encoder_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function polar_encoder_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=polar_encoder_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function polar_encoder_getPrototypeOf(o){return(polar_encoder_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function polar_encoder_setPrototypeOf(o,p){return(polar_encoder_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var polar_encoder_PolarEncoder=function(_VisualEncoder){function PolarEncoder(){return function polar_encoder_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PolarEncoder),polar_encoder_possibleConstructorReturn(this,polar_encoder_getPrototypeOf(PolarEncoder).apply(this,arguments))}return function polar_encoder_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&polar_encoder_setPrototypeOf(subClass,superClass)}(PolarEncoder,visual_encoder_VisualEncoder),function polar_encoder_createClass(Constructor,protoProps,staticProps){return protoProps&&polar_encoder_defineProperties(Constructor.prototype,protoProps),staticProps&&polar_encoder_defineProperties(Constructor,staticProps),Constructor}(PolarEncoder,[{key:"createAxis",value:function createAxis(axesCreators,fieldInfo){var geomCellAxes=axesCreators.axes,indices=fieldInfo.indices,rowIndex=indices.rowIndex,columnIndex=indices.columnIndex,pieAxes=geomCellAxes.pie||[];return pieAxes[rowIndex]=pieAxes[rowIndex]||[],pieAxes[rowIndex][columnIndex]=[],geomCellAxes.pie=pieAxes,geomCellAxes.x=null,geomCellAxes.y=null,geomCellAxes}},{key:"getFacetsAndProjections",value:function getFacetsAndProjections(fields){for(var counter=0,facets=[],projections=[],primaryFields=fields[0],secondaryFields=fields[1],primaryLen=primaryFields.length,secondaryLen=secondaryFields.length,i=0;i<primaryLen;i++){var primaryField=primaryFields[i];if("measure"===primaryField.type()){var secondaryField=secondaryFields[counter++],projArr=secondaryField?[primaryField,secondaryField]:[primaryField];projections.push(projArr)}else facets.push(primaryField)}if(secondaryLen>counter)for(var _i=counter;_i<secondaryLen;_i++){var _secondaryField=secondaryFields[_i],_projArr=[_secondaryField];"measure"===_secondaryField.type()?projections.push(_projArr):facets.push(_secondaryField)}return{facets:facets,projections:projections}}},{key:"unionUnitDomains",value:function unionUnitDomains(context){var store=context.store(),domains=store.get("".concat(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,".domain")),domainProps={radius:[1/0,-1/0]};Object.values(domains).forEach(function(domainVal){for(var key in domainVal)domainProps[key]=[Math.min(domainVal[key][0],domainProps[key][0]),Math.min(domainVal[key][1],domainProps[key][1])]}),store.commit("".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.radius"),domainProps.radius)}},{key:"setCommonDomain",value:function setCommonDomain(){return this}},{key:"layers",value:function layers(){return arguments.length?(this._layers=arguments.length<=0?void 0:arguments[0],this):this._layers}},{key:"fieldSanitizer",value:function fieldSanitizer(datamodel,config){var sanitizedRows=[[],[]],sanitizedColumns=[[],[]],fields=polar_encoder_get(polar_encoder_getPrototypeOf(PolarEncoder.prototype),"fieldSanitizer",this).call(this,datamodel,config),layers=config.layers,rows=fields.rows,columns=fields.columns,encoding=layers[0].encoding,radius=encoding&&encoding.radius?encoding.radius.field:null,angle=encoding&&encoding.angle?encoding.angle.field:null,sanitizedFields=[sanitizedRows,sanitizedColumns];return[rows,columns].forEach(function(fieldType,typeIndex){fieldType.forEach(function(fieldSet,i){return fieldSet.forEach(function(field){field.toString()!==radius&&field.toString()!==angle&&"measure"!==field.type()&&sanitizedFields[typeIndex][i].push(field)})})}),sanitizedColumns=polar_encoder_toConsumableArray(new Set(sanitizedColumns)),sanitizedRows=polar_encoder_toConsumableArray(new Set(sanitizedRows)),this.fieldInfo({rows:sanitizedRows,columns:sanitizedColumns}),this.fieldInfo()}},{key:"getRetinalFieldsDomain",value:function getRetinalFieldsDomain(dataModels,encoding,facetFields,groupBy){var sizeField,colorField,fields=[],layers=this.layers(),dataModel=dataModels.groupedModel,fieldsConfig=dataModel.getFieldsConfig(),domains={};if(layers&&layers[0]){var layerEncoding=layers[0].def.encoding||{};[constants_RADIUS,constants_ANGLE,enums_constants_SIZE,enums_constants_COLOR].forEach(function(encType){var field=layerEncoding[encType]?layerEncoding[encType].field:"",measureField=fieldsConfig[field]&&"measure"===fieldsConfig[field].def.type;encType===enums_constants_SIZE&&measureField&&(sizeField=field),encType===enums_constants_COLOR&&(colorField=field),fieldsConfig[field]&&!measureField&&fields.push(field)})}if(sizeField&&(domains[sizeField]=dataModel.groupBy(facetFields,function polar_encoder_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},sizeField,"sum")).getFieldspace().fieldsObj()[sizeField].domain()),colorField){var dm=dataModel.groupBy([].concat(polar_encoder_toConsumableArray(facetFields),fields),groupBy.measures);domains[colorField]=dm.getFieldspace().fieldsObj()[colorField].domain()}return domains}},{key:"getLayerConfig",value:function getLayerConfig(fields,userLayerConfig){var layerConfig=[],columnFields=fields.columnFields,rowFields=fields.rowFields;return[].concat(polar_encoder_toConsumableArray(columnFields),polar_encoder_toConsumableArray(rowFields)).forEach(function(){var config={mark:"arc",def:{encoding:{}}};userLayerConfig&&userLayerConfig.length>0&&(config=mergeRecursive(config,userLayerConfig[0])),layerConfig.push(config)}),0===layerConfig.length&&(layerConfig=userLayerConfig),this.layers(layerConfig),layerConfig}},{key:"serializeLayerConfig",value:function serializeLayerConfig(layerArray){var serializedLayers=[];return layerArray.length&&layerArray.forEach(function(layer){var def=src_layer_factory.getSerializedConf(layer.mark,layer);serializedLayers.push({mark:layer.mark,def:def})}),serializedLayers}}],[{key:"type",value:function type(){return"polar"}}]),PolarEncoder}();function retinal_encoder_typeof(obj){return(retinal_encoder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function retinal_encoder_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function retinal_encoder_possibleConstructorReturn(self,call){return!call||"object"!==retinal_encoder_typeof(call)&&"function"!=typeof call?function retinal_encoder_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function retinal_encoder_getPrototypeOf(o){return(retinal_encoder_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function retinal_encoder_setPrototypeOf(o,p){return(retinal_encoder_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var retinal_encoder_RetinalEncoder=function(_VisualEncoder){function RetinalEncoder(){return function retinal_encoder_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RetinalEncoder),retinal_encoder_possibleConstructorReturn(this,retinal_encoder_getPrototypeOf(RetinalEncoder).apply(this,arguments))}return function retinal_encoder_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&retinal_encoder_setPrototypeOf(subClass,superClass)}(RetinalEncoder,visual_encoder_VisualEncoder),function retinal_encoder_createClass(Constructor,protoProps,staticProps){return protoProps&&retinal_encoder_defineProperties(Constructor.prototype,protoProps),staticProps&&retinal_encoder_defineProperties(Constructor,staticProps),Constructor}(RetinalEncoder,[{key:"createAxis",value:function createAxis(axesCreators){var fieldsConfig=axesCreators.fieldsConfig,config=axesCreators.config,newAxes={};return[enums_constants_COLOR,enums_constants_SHAPE,enums_constants_SIZE].forEach(function(axisType){newAxes["".concat(axisType)]=function createRetinalAxis(axesCreators){var fieldProps=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},axisType=axesCreators.axisType,fieldsConfig=axesCreators.fieldsConfig,field=fieldProps.field,axis=[],Cls=scaleMaps[axisType];return fieldProps.type=fieldProps.type?fieldProps.type:group_utils_getAxisType(fieldsConfig,field||null),axis.push(new Cls(fieldProps)),axis}({axisType:axisType,fieldsConfig:fieldsConfig},config[axisType])}),newAxes}},{key:"getLayerConfig",value:function getLayerConfig(encodingConfigs,userLayerConfig){var layerConfig=[];return userLayerConfig.forEach(function(e){var config=e;[enums_constants_COLOR,enums_constants_SHAPE,enums_constants_SIZE].forEach(function(axis){if(encodingConfigs[axis]&&encodingConfigs[axis].field){var def=config.def;config.def instanceof Array?def.forEach(function(conf){conf.encoding=conf.encoding||{},!conf.encoding[axis]&&(conf.encoding[axis]={}),conf.encoding[axis].field=encodingConfigs[axis].field}):(def.encoding=def.encoding||{},!def.encoding[axis]&&(def.encoding[axis]={}),def.encoding[axis].field=encodingConfigs[axis].field)}}),layerConfig.push(config)}),layerConfig}},{key:"setCommonDomain",value:function setCommonDomain(context){var domains=context.domains,axes=context.axes,encoding=context.encoding;return Object.entries(encoding).forEach(function(enc){if(enc[1]&&enc[1].field){var encType=enc[0],field=enc[1].field;field&&axes[encType].forEach(function(axis){var domain=domains[field];!enc[1].domain&&axis.updateDomain(domain)})}}),axes}}],[{key:"type",value:function type(){return"retinal"}}]),RetinalEncoder}(),group_utils_this=void 0;function group_utils_slicedToArray(arr,i){return function group_utils_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function group_utils_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function group_utils_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function group_utils_toConsumableArray(arr){return function group_utils_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function group_utils_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function group_utils_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function group_utils_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _actionBehaviourMap,group_utils_isDistributionEqual=function isDistributionEqual(arr){return[].concat(group_utils_toConsumableArray(arr[0]),group_utils_toConsumableArray(arr[1])).reduce(function(isEqual,row){var rowType=row.type();return"measure"!==rowType&&"temporal"!==rowType||(isEqual=!0),isEqual},!1)},initializeCacheMaps=function initializeCacheMaps(){return{cellMap:new Map,xAxesMap:new Map,yAxesMap:new Map,entryCellMap:new Map,exitCellMap:new Map}},getAxisKey=function getAxisKey(axisName){for(var _len=arguments.length,params=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)params[_key-1]=arguments[_key];return"".concat(axisName,"-axis-").concat(params.join("-"))},group_utils_headerCreator=function headerCreator(fields,fieldHeaders,TextCell,_ref2){var classPrefix=_ref2.classPrefix,labelManager=_ref2.labelManager;return fields.length>0?fields[0].map(function(cell,i){return new TextCell({type:"header",className:"".concat(classPrefix,"-grid-headers")},{labelManager:labelManager}).source(function getHeaderText(headers,index,rowLength){var header="";if(index===rowLength-1&&headers.length>rowLength){for(var i=index;i<headers.length-1;i++)header+="".concat(headers[i].toString()," / ");return header+=headers[headers.length-1].toString()}return headers[index]?headers[index].toString():""}(fieldHeaders,i,fields[0].length)).config({show:cell.config().show})}):[]},group_utils_getAxisType=function getAxisType(fieldsConfig,field){var fieldType="ordinal";return field&&"dimension"!==fieldsConfig[field].def.type&&(fieldType="linear"),fieldType},retriveDomainFromData=function retriveDomainFromData(datamodel,fieldName){return datamodel.getFieldspace().fields.find(function(d){return d.name()===fieldName.toString()}).domain()},group_utils_getHeaderAxisFrom=function getHeaderAxisFrom(type,fields,userAxisFromConfig){var axisFrom=userAxisFromConfig[type],headerFrom="",options=type===ROW?[constants_LEFT,constants_RIGHT]:["bottom","top"],_fields=group_utils_slicedToArray(fields,2),firstField=_fields[0],secondField=_fields[1],firstFieldType=function firstFieldType(i){return firstField.length?firstField[i].type():null},secondFieldType=function secondFieldType(i){return secondField.length?secondField[i].type():null};return"dimension"===firstFieldType(firstField.length-1)&&"dimension"===secondFieldType(0)?(headerFrom=axisFrom?options[1-options.indexOf(axisFrom)]:options[1],axisFrom="column"===type&&firstField[firstField.length-1].toString()===secondField[0].toString()?"top":axisFrom||options[0]):"dimension"===secondFieldType(secondField.length-1)?(headerFrom=type===ROW?constants_RIGHT:"bottom",axisFrom=type===ROW?constants_RIGHT:"bottom"):(headerFrom=type===ROW?constants_LEFT:"top",axisFrom=type===ROW?constants_LEFT:"top"),"measure"===firstFieldType(firstField.length-1)&&"measure"===secondFieldType(0)?axisFrom=type===ROW?constants_LEFT:"top":"measure"===secondFieldType(0)?axisFrom=type===ROW?constants_RIGHT:"bottom":"measure"===firstFieldType(firstField.length-1)&&(axisFrom=type===ROW?constants_LEFT:"top"),[headerFrom,axisFrom]},setFacetsAndProjections=function setFacetsAndProjections(context,fieldInfo,encoder){var fields=fieldInfo.fields,type=fieldInfo.type,_encoder$simpleEncode=encoder.simpleEncoder.getFacetsAndProjections(fields,type),facets=_encoder$simpleEncode.facets,projections=_encoder$simpleEncode.projections;return context.facets(group_utils_defineProperty({},"".concat(type,"Facets"),facets)),context.projections(group_utils_defineProperty({},"".concat(type,"Projections"),projections)),{facets:facets,projections:projections,fields:fields}},group_utils_getBorders=function getBorders(matrices,encoder){var showRowBorders={top:!1,bottom:!1},showColBorders={left:!1,right:!1},showValueBorders={top:!1,bottom:!1,left:!1,right:!1},rows=matrices.rows,columns=matrices.columns,valueMatrix=matrices.values,_rows=group_utils_slicedToArray(rows,2),leftRows=_rows[0],rightRows=_rows[1],_columns=group_utils_slicedToArray(columns,2),topColumns=_columns[0],bottomColumns=_columns[1],_encoder$fieldInfo=encoder.fieldInfo(),rowDimensions=_encoder$fieldInfo.rowDimensions,columnDimensions=_encoder$fieldInfo.columnDimensions,rowTemporalFields=_encoder$fieldInfo.rowTemporalFields,columnTemporalFields=_encoder$fieldInfo.columnTemporalFields,columnMeasures=_encoder$fieldInfo.columnMeasures,rowMeasures=_encoder$fieldInfo.rowMeasures,allDimensionLength=rowDimensions.length+columnDimensions.length,allMeasuresLength=rowMeasures.length+columnMeasures.length,allTemporalFieldsLength=rowTemporalFields.length+columnTemporalFields.length;if("polar"===encoder.constructor.type()){if(!allDimensionLength)return{showRowBorders:showRowBorders,showColBorders:showColBorders,showValueBorders:showValueBorders}}else if(!allMeasuresLength&&!allTemporalFieldsLength&&allDimensionLength<=2)return{showRowBorders:showRowBorders,showColBorders:showColBorders,showValueBorders:showValueBorders};return showRowBorders=function getRowBorders(left,right){var borders={top:!1,bottom:!1};return(left.length>1||right.length>1)&&(borders.top=!0,borders.bottom=!0),borders}(leftRows,rightRows),showColBorders=function getColumnsBorders(top,bottom){var borders={left:!1,right:!1};return(top.length||bottom.length)&&(top[0]&&top[0].length>1||bottom[0]&&bottom[0].length>1)&&(borders.left=!0,borders.right=!0),borders}(topColumns,bottomColumns),showValueBorders=function getValueBorders(rows,columns){var borders={top:!0,left:!0,bottom:!0,right:!0},borderTypeRow=[constants_LEFT,constants_RIGHT],borderTypeCol=["top","bottom"];return rows.forEach(function(e,i){e[0]&&e[0].length?borders[borderTypeRow[i]]=!0:borders[borderTypeRow[i]]=!1}),columns.forEach(function(e,i){e.length?borders[borderTypeCol[i]]=!0:borders[borderTypeCol[i]]=!1}),borders}([leftRows,rightRows],[topColumns,bottomColumns]),valueMatrix.length>1&&(showValueBorders.top=!0,showValueBorders.bottom=!0),valueMatrix.length&&valueMatrix[0].length>1&&(showValueBorders.left=!0,showValueBorders.right=!0),{showRowBorders:showRowBorders,showColBorders:showColBorders,showValueBorders:showValueBorders}};function action_behaviour_map_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var actionBehaviourMap=(action_behaviour_map_defineProperty(_actionBehaviourMap={},actions_namespaceObject.DRAG,{behaviours:[behaviours_namespaceObject.BRUSH],touch:!1}),action_behaviour_map_defineProperty(_actionBehaviourMap,actions_namespaceObject.HOVER,{behaviours:[behaviours_namespaceObject.HIGHLIGHT]}),action_behaviour_map_defineProperty(_actionBehaviourMap,actions_namespaceObject.LONGTOUCH,{behaviours:[behaviours_namespaceObject.SELECT],touch:!0}),action_behaviour_map_defineProperty(_actionBehaviourMap,actions_namespaceObject.TOUCHDRAG,{behaviours:[behaviours_namespaceObject.BRUSH],touch:!0}),action_behaviour_map_defineProperty(_actionBehaviourMap,actions_namespaceObject.CLICK,{behaviours:[behaviours_namespaceObject.SELECT],touch:!1}),_actionBehaviourMap);function src_helper_toConsumableArray(arr){return function src_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function src_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function src_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var helper_getLayerFromDef=function getLayerFromDef(context,definition,existingLayer,namespaces){var instances=existingLayer,dependencies=context._layerDeps,metaInf=context.metaInf();existingLayer||(instances=src_layer_factory.getLayerInstance(definition),toArray(instances).forEach(function(inst,i){inst.metaInf({unitRowIndex:metaInf.rowIndex,unitColIndex:metaInf.colIndex,namespace:namespaces[i]}),inst.store(context.store())}));var layers={},instanceArr=toArray(instances);return(definition=toArray(definition)).reduce(function(acc,def,idx){var instance=instanceArr[idx];return instance.config(def),instance.dependencies(dependencies),instance.dataProps({timeDiffs:context._timeDiffs}),def.name&&instance.alias(def.name),layers[instance.alias()]=instance,acc},{}),layers},resolveEncodingTransform=function resolveEncodingTransform(layerInst,store){var encodingTransform=layerInst.config().encodingTransform||{},resolvable=encodingTransform.resolvable,depArr=[];if(resolvable){var resolved=resolvable(store);depArr=resolved.depArr,layerInst.encodingTransform(resolved.fn)}else encodingTransform instanceof Function&&layerInst.encodingTransform(encodingTransform);return depArr},helper_sanitizeLayerDef=function sanitizeLayerDef(layerDefs){var sanitizedDefs=[];return layerDefs.forEach(function(layerDef,i){var def=layerDef.def,mark=layerDef.mark;if(def)def.name||(def.name="".concat(mark,"-").concat(i)),sanitizedDefs.push(layerDef);else{var sConf=src_layer_factory.getSerializedConf(layerDef.mark,layerDef);sConf.name||(sConf.name="".concat(mark,"-").concat(i)),sanitizedDefs.push({mark:layerDef.mark,def:sConf})}}),sanitizedDefs},getLayersBy=function getLayersBy(layers,searchBy,value){return layers.filter(function(layer){return("type"===searchBy?layer.constructor.formalName():layer.alias())===value})},removeLayersBy=function removeLayersBy(layers,searchBy,value){layers.filter(function(inst){return("type"===searchBy?inst.config().mark:inst.alias())!==value||(inst.remove(),!1)})},createRenderPromise=function createRenderPromise(unit){unit._renderedPromise.then(function(){unit._renderedPromise=new Promise(function(resolve){unit._renderedResolve=resolve}),createRenderPromise(unit)})},GRID_BAND="gridBands",GRID_LINE="gridLines";function grid_lines_slicedToArray(arr,i){return function grid_lines_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function grid_lines_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function grid_lines_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function grid_lines_toConsumableArray(arr){return function grid_lines_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function grid_lines_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function grid_lines_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function grid_lines_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _CONFIG$LAYERDEFS$TRA,grid_lines_BAR_LAYER=layer_types_namespaceObject.BAR_LAYER,grid_lines_TICK_LAYER=layer_types_namespaceObject.TICK_LAYER,grid_lines_LINEAR=scale_type_namespaceObject.LINEAR,grid_lines_getGridLayerDefinitions=function getGridLayerDefinitions(context,config,type){return["x","y"].map(function(axisType){var axes=context.axes();return axes[axisType]&&defaultValue(config[axisType]&&config[axisType].show,function getDefaultVisibilty(show,axis){return axis.constructor.type()===grid_lines_LINEAR&&show}(config.show,axes[axisType][0]))?function getLayerDefinition(context,axes,type,orientation){var _definition,encoding,_encoding,config=context.config(),classPrefix=config.classPrefix,gridLines=config.gridLines,gridBands=config.gridBands,gridLineColor=gridLines.color,zeroLineColor=gridLines.zeroLineColor,defClassName=type===GRID_BAND?gridBands.defClassName:gridLines.defClassName,gridBandColor=gridBands[orientation].color,axis=axes[orientation][0],isLinearScale=axis.constructor.type()===grid_lines_LINEAR;type===GRID_BAND&&isLinearScale?(grid_lines_defineProperty(_encoding={},orientation,"".concat(orientation,"value")),grid_lines_defineProperty(_encoding,"".concat(orientation,"0"),"".concat(orientation,"value0")),encoding=_encoding):encoding=grid_lines_defineProperty({},orientation,"".concat(orientation,isLinearScale?"value":"dim"));return encoding.color={value:function value(data,i){var isNegativeDomain=isLinearScale&&axis.domain()[0]<0;return type===GRID_BAND?gridBandColor[i%2]:isNegativeDomain&&0===data[orientation]?zeroLineColor:gridLineColor}},{definition:(_definition={defClassName:"".concat(defClassName,"-").concat(orientation),className:config.className,name:orientation,individualClassName:function individualClassName(data,i){return isLinearScale&&axis.domain()[0]<0&&0===data.y&&type!==GRID_BAND?"".concat(classPrefix,"-axis-zero-line"):"".concat(classPrefix,"-grid-").concat(type,"-").concat(orientation,"-").concat(i%2)}},grid_lines_defineProperty(_definition,"pad".concat(orientation.toUpperCase()),type===GRID_BAND?0:void 0),grid_lines_defineProperty(_definition,"encoding",encoding),_definition),axes:grid_lines_defineProperty({},orientation,axis),interactive:!1}}(context,axes,type,axisType):null}).filter(function(d){return null!==d})},attachDataToGridLineLayers=function attachDataToGridLineLayers(context){var _ref,axes=context.axes(),measurement={width:context.width(),height:context.height()},gridLines=context._gridLines,gridBands=context._gridBands,gridLayerData=function getGridLayerData(axes,fields,fieldsConfig){var gridData={};return["x","y"].forEach(function(type){var ticks=axes[type][0].getTickValues(),subtype=getObjProp(fieldsConfig,getObjProp(fields,type,0).getMembers()[0],"def","subtype"),jsonData=[],schema=[{name:"yvalue",type:"measure"},{name:"xvalue",type:"measure"},{name:"yvalue0",type:"measure"},{name:"xvalue0",type:"measure"},{name:"xdim",type:"dimension",subtype:subtype},{name:"ydim",type:"dimension",subtype:subtype}],len=Math.max(ticks.length);ticks=subtype===dist_datamodel.DimensionSubtype.TEMPORAL?ticks.map(function(d){return d.getTime()}):ticks;for(var i=0;i<len;i+=1){var _jsonData$push;jsonData.push((grid_lines_defineProperty(_jsonData$push={},"".concat(type,"value"),ticks[i]),grid_lines_defineProperty(_jsonData$push,"".concat(type,"value0"),ticks[i+1]),grid_lines_defineProperty(_jsonData$push,"".concat(type,"dim"),ticks[i]),grid_lines_defineProperty(_jsonData$push,"".concat(type,"dim"),ticks[i]),_jsonData$push))}gridData[type]=new datamodel_default.a(jsonData,schema)}),gridData}(axes,context.fields(),context.data().getFieldsConfig());(_ref=[]).concat.apply(_ref,grid_lines_toConsumableArray(gridBands).concat(grid_lines_toConsumableArray(gridLines))).forEach(function(inst){inst.data(inst.axes().x?gridLayerData.x:gridLayerData.y).measurement(measurement)})},src_default_config_defaultConfig={classPrefix:"muze",defClassName:"visual-unit",className:"",trackerClassName:"visual-unit-tracker",gridLines:{defClassName:"axis-grid-lines",className:"",show:!0,color:"#efefef",zeroLineColor:"#b6b6b6"},gridBands:{defClassName:"axis-grid-bands",className:"",show:!1,y:{color:["#fff","#fbfbfb"]},x:{color:["#fff","#f9f9f9"]}},arcLayerClassName:"layer-arc",interaction:{tooltip:{mode:"consolidated"}},sideEffectClassName:"side-effect-container"};function src_local_options_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function local_options_toConsumableArray(arr){return function local_options_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function local_options_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function local_options_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var src_local_options=(src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA={},"config",{value:null,meta:{sanitization:function sanitization(config,oldConfig){return mergeRecursive(oldConfig||mergeRecursive({},src_default_config_defaultConfig),config)}}}),src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA,"layerDef",{value:null,meta:{preset:function preset(layerDef){return helper_sanitizeLayerDef(layerDef)}}}),src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA,"transform",{value:null}),src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA,"layers",{value:null}),src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA,"data",{value:null,meta:{typeCheck:function typeCheck(d){return d instanceof datamodel_default.a},preset:function preset(data,context){if(context._cache){var cachedData=context.cachedData();context.cachedData([].concat(local_options_toConsumableArray(cachedData),[data]))}else{var oldData=context.data();oldData&&oldData.unsubscribe("propagation"),context.cachedData([data])}}}}),src_local_options_defineProperty(_CONFIG$LAYERDEFS$TRA,"transformedData",{value:null,meta:{addAsMethod:!1}}),_CONFIG$LAYERDEFS$TRA);function src_listener_map_slicedToArray(arr,i){return function src_listener_map_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function src_listener_map_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function src_listener_map_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _PROPS,listener_map_calculateDomainListener=function calculateDomainListener(context,namespace){return function(){var domain=function unionDomainFromLayers(layers,axisFields,layerAxisIndex,fieldsConfig){var domains={};return(layers=layers.filter(function(layer){return null!==layer.getDataDomain()})).forEach(function(layer){var domainValues={},config=layer.config(),encoding=config.encoding,layerDomain=layer.getDataDomain(),layerId=layer.id();null!==layerDomain&&!1!==config.calculateDomain&&(domainValues=Object.entries(layerDomain),domains=domainValues.reduce(function(fieldDomain,domain){var encodingType=domain[0],field=encoding[encodingType].field,axisIndex=layerAxisIndex[layerId][encodingType];if(encodingType in axisFields){var fieldStr="".concat(axisFields[encodingType][axisIndex]);fieldDomain[fieldStr]=fieldDomain[fieldStr]||[],fieldDomain[fieldStr]=common_utils_unionDomain([fieldDomain[fieldStr],domain[1]],fieldsConfig[field].def.subtype?fieldsConfig[field].def.subtype:fieldsConfig[field].def.type)}else fieldDomain[encodingType]=domain[1];return fieldDomain},domains))}),domains}(context.layers(),context.fields(),context._layerAxisIndex,context.data().getFieldsConfig());context.store().commit("".concat(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,".").concat("domain",".").concat(namespace),domain)}},src_listener_map_listenerMap=function listenerMap(context,namespace,metaInf){return[{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("config")],listener:function listener(_ref){var config=src_listener_map_slicedToArray(_ref,2)[1];config&&context.firebolt().config(config.interaction)}},{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("layerDef")],listener:function listener(_ref3){var layerDefs=src_listener_map_slicedToArray(_ref3,2)[1],fieldsVal=context.fields();if(layerDefs&&fieldsVal){!function removeExitLayers(layerDefs,context){var layersMap=context._layersMap,markSet={};for(var key in layerDefs.forEach(function(layerDef,i){var id="".concat(layerDef.mark,"-").concat(i);markSet[id]=!0}),layersMap)key in markSet||(layersMap[key].forEach(function(layer){return layer.remove()}),delete layersMap[key])}(layerDefs,context);var axes=context.axes();if(axes.x||axes.y){var props=["".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.y.").concat(metaInf.rowIndex,"0"),"".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.x.").concat(metaInf.colIndex,"0")],store=context.store(),listenerInf={namespace:namespace.local,key:"gridLineListener"};store.unsubscribe(listenerInf),store.registerChangeListener(props,function(){attachDataToGridLineLayers(context)},!1,listenerInf)}context.addLayer(layerDefs),context._lifeCycleManager.notify({client:context.layers(),action:"initialized",formalName:"layer"})}}},{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("data")],listener:function listener(_ref5){var dataModel=src_listener_map_slicedToArray(_ref5,2)[1],axesObj=context.axes(),timeDiffs={},timeDiffsByField={};Object.entries(function temporalFields(dataModel){var filteredFields={};return Object.entries(dataModel.getFieldspace().getDimension()).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),fieldName=_ref6[0],fieldObj=_ref6[1];fieldObj.subtype()===dist_datamodel.DimensionSubtype.TEMPORAL&&(filteredFields[fieldName]=fieldObj)}),filteredFields}(dataModel)).forEach(function(_ref7){var _ref8=src_listener_map_slicedToArray(_ref7,2),fieldName=_ref8[0],fieldObj=_ref8[1];timeDiffsByField[fieldName]=fieldObj.minimumConsecutiveDifference()}),Object.entries(context.fields()).forEach(function(_ref9){var _ref10=src_listener_map_slicedToArray(_ref9,2),type=_ref10[0],field=src_listener_map_slicedToArray(_ref10[1],1)[0];if(field){var timeDiff=timeDiffsByField[field.oneVar()];timeDiff&&(timeDiffs[type]=timeDiff,axesObj[type].forEach(function(axis){return axis.minDiff(timeDiff)}))}}),context._timeDiffsByField=timeDiffsByField,context._timeDiffs=timeDiffs}},{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("config")],listener:function listener(){!function createGridLineLayer(context){var vuConf=context.config(),metaInf=context.metaInf(),store=context.store(),timeDiffs=context._timeDiffs;[GRID_BAND,GRID_LINE].forEach(function(type){var mark,config;type===GRID_BAND?(mark=grid_lines_BAR_LAYER,config=vuConf.gridBands):(mark=grid_lines_TICK_LAYER,config=vuConf.gridLines);var definitions=grid_lines_getGridLayerDefinitions(context,config,type),sel="_".concat(type,"Selection");context[sel]=function createGridLines(){var instances=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},createFn=arguments.length>1?arguments[1]:void 0,definitions=arguments.length>2?arguments[2]:void 0,iteratorFn=arguments.length>3?arguments[3]:void 0,map={};for(var key in definitions.forEach(function(def){var name=def.definition.name,instance=instances[name];instance||(instances[name]=instance=createFn(def)),iteratorFn(instance,def,name),map[name]=1}),instances)key in map||(instances[key].remove(),delete instances[key]);return instances}(context[sel],function(){var inst=src_layer_factory.getLayerInstance({mark:mark});return inst.dependencies(context._layerDeps),inst},definitions,function(layer,atomicDef,key){var definition=atomicDef.definition,sConf=src_layer_factory.getSerializedConf(mark,definition),axesObj=atomicDef.axes;layer.metaInf({unitRowIndex:metaInf.rowIndex,unitColIndex:metaInf.colIndex,namespace:"".concat(metaInf.namespace).concat(type).concat(key)}).store(store).config(sConf).dataProps({timeDiffs:timeDiffs}).axes(axesObj)}),context["_".concat(type)]=Object.values(context[sel])})}(context)}},{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("data"),"".concat(namespace.local,".").concat("transform")],listener:function listener(_ref11,_ref12){var dataModel=src_listener_map_slicedToArray(_ref11,2)[1],transform=src_listener_map_slicedToArray(_ref12,2)[1];if(dataModel){var dataModels=function transformDataModels(transform,dataModel){var dataModels={};for(var key in transform)if({}.hasOwnProperty.call(transform,key)){var transformVal=transform[key];dataModels[key]=transformVal(dataModel)}return dataModels}(transform,dataModel);context.store().commit("".concat(namespace.local,".").concat("transformedData"),dataModels)}}},{type:"registerImmediateListener",props:["".concat(namespace.local,".").concat("transformedData"),"".concat(namespace.local,".").concat("layers")],listener:function listener(_ref15,_ref16){var transformedData=src_listener_map_slicedToArray(_ref15,2)[1],layers=src_listener_map_slicedToArray(_ref16,2)[1],layerAxisIndexVal=context._layerAxisIndex,axesVal=context.axes(),dataModel=context.data();if(transformedData&&layers&&axesVal&&layerAxisIndexVal){context._lifeCycleManager.notify({client:layers,action:"beforeupdate",formalName:"layer"});var model=context.store().model;layers.forEach(function(lyr){return lyr.disableUpdate()}),function attachDataToLayers(layers,dm,transformedDataModels){layers.forEach(function(layer){var dataSource=layer.config().source,dataModel=dataSource instanceof Function?dataSource(dm):transformedDataModels[dataSource]||dm;layer.data()!==dataModel&&layer.data(dataModel)})}(layers,dataModel,transformedData),model.lock(),layers.forEach(function(lyr){lyr.enableUpdate().domain(lyr._domain)}),model.unlock(),context._dimensionMeasureMap=function getDimensionMeasureMap(layers,fieldsConfig){var retinalEncodingsAndMeasures={};for(var key in layers.forEach(function(layer){var _layer$encodingFields=layer.encodingFieldsInf(),colorField=_layer$encodingFields.colorField,sizeField=_layer$encodingFields.sizeField,shapeField=_layer$encodingFields.shapeField,measures=[_layer$encodingFields.xField,_layer$encodingFields.yField].filter(function(field){return fieldsConfig[field]&&fieldsConfig[field].def.type===dist_datamodel.FieldType.MEASURE});[colorField,sizeField,shapeField].forEach(function(field){var _retinalEncodingsAndM;fieldsConfig[field]&&fieldsConfig[field].def.type===dist_datamodel.FieldType.DIMENSION&&(!retinalEncodingsAndMeasures[field]&&(retinalEncodingsAndMeasures[field]=[]),(_retinalEncodingsAndM=retinalEncodingsAndMeasures[field]).push.apply(_retinalEncodingsAndM,src_helper_toConsumableArray(measures)))})}),retinalEncodingsAndMeasures)({}).hasOwnProperty.call(retinalEncodingsAndMeasures,key)&&(retinalEncodingsAndMeasures[key]=src_helper_toConsumableArray(new Set(retinalEncodingsAndMeasures[key])));return retinalEncodingsAndMeasures}(layers,dataModel.getFieldsConfig(),context.retinalFields()),function attachAxisToLayers(axes,layers,layerAxisIndex){layers.forEach(function(layer){var layerId=layer.id(),axesObj={};objectIterator(axes,function(key){var axisInf=layerAxisIndex[layerId];axisInf&&axes[key]&&(axesObj[key]=axes[key][axisInf[key]||0])}),Object.keys(axesObj).length&&layer.axes(axesObj)})}(axesVal,layers,layerAxisIndexVal),context._lifeCycleManager.notify({client:layers,action:"updated",formalName:"layer"})}}}]};function props_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var src_props_PROPS=(props_defineProperty(_PROPS={},"facetByFields",{}),props_defineProperty(_PROPS,"retinalFields",{}),props_defineProperty(_PROPS,"parentAlias",{}),props_defineProperty(_PROPS,"layers",{}),props_defineProperty(_PROPS,"cachedData",{}),props_defineProperty(_PROPS,"detailFields",{}),props_defineProperty(_PROPS,"axes",{defaultValue:{x:[],y:[]}}),props_defineProperty(_PROPS,"fields",{}),props_defineProperty(_PROPS,"metaInf",{}),props_defineProperty(_PROPS,"registry",{}),props_defineProperty(_PROPS,"width",{}),props_defineProperty(_PROPS,"height",{}),props_defineProperty(_PROPS,"parentContainerInf",{}),_PROPS);function firebolt_helper_slicedToArray(arr,i){return function firebolt_helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function firebolt_helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function firebolt_helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function firebolt_helper_toConsumableArray(arr){return function firebolt_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function firebolt_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function firebolt_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var helper_registerListeners=function registerListeners(firebolt){var context=firebolt.context,store=context.store();store.registerImmediateListener(["local.units.".concat(context.metaInf().namespace,".").concat("data")],function(dataModel){if(dataModel[1]){firebolt.createSelectionSet(firebolt.context.data().getData().uids),firebolt.initializeSideEffects();var originalData=firebolt.context.cachedData()[0];firebolt.attachPropagationListener(originalData)}}),store.registerChangeListener(["local.units.".concat(context.metaInf().namespace,".").concat("data")],function(){firebolt.context.mount()||firebolt.context.cachedData()[0].unsubscribe("propagation")}),context._layerDeps.throwback.registerChangeListener([common_props.ON_LAYER_DRAW],function(_ref){firebolt_helper_slicedToArray(_ref,2)[1]&&(function dispatchQueuedSideEffects(context){var queuedSideEffects=context._queuedSideEffects;Object.entries(queuedSideEffects).forEach(function(entry){var sideEffect=entry[1];context.dispatchSideEffect.apply(context,[sideEffect.name].concat(firebolt_helper_toConsumableArray(sideEffect.params)))}),context._queuedSideEffects={}}(firebolt),function clearActionHistory(context){var actionHistory=context._actionHistory;for(var key in actionHistory)actionHistory[key].isMutableAction&&delete context._actionHistory[key]}(firebolt))})};function payload_generator_toConsumableArray(arr){return function payload_generator_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function payload_generator_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function payload_generator_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var payloadGenerator={brush:function brush(instance,selectionDataModel,propConfig){var propPayload=propConfig.payload,criteria=function getRangeFromData(instance,selectionDataModel,propConfig){var dataObj=selectionDataModel[0].getData(),propCriteria=propConfig.payload.criteria,sourceIdentifiers=propConfig.sourceIdentifiers,schema=dataObj.schema,fieldMap=instance.data().getFieldsConfig(),data=dataObj.data;return instance.id()===propConfig.sourceId?propCriteria:null!==sourceIdentifiers?schema.reduce(function(acc,obj,index){var range,field=obj.name,fieldObj=fieldMap[field],isDimension=(fieldObj&&(fieldObj.def.subtype?fieldObj.def.subtype:fieldObj.def.type))===dist_datamodel.DimensionSubtype.CATEGORICAL;return fieldObj?(range=isDimension?data.map(function(d){return d[index]}):[Math.min.apply(Math,payload_generator_toConsumableArray(data.map(function(d){return d[index]}))),Math.max.apply(Math,payload_generator_toConsumableArray(data.map(function(d){return d[index]})))],acc[field]=range,acc):acc},{}):null}(instance,selectionDataModel,propConfig),payload=Object.assign({},propPayload);return payload.criteria=criteria,payload},__default:function __default(instance,selectionDataModel,propConfig){var propPayload=propConfig.payload,sourceIdentifiers=propConfig.sourceIdentifiers,dataObj=selectionDataModel[0].getData(),schema=dataObj.schema,payload=Object.assign({},propPayload);schema=dataObj.schema;var data=dataObj.data,sourceFields=schema.map(function(d){return d.name});return payload.criteria=!sourceIdentifiers&&selectionDataModel[0].isEmpty()?null:[sourceFields].concat(payload_generator_toConsumableArray(data)),payload.sourceFields=sourceIdentifiers?sourceIdentifiers.getSchema().map(function(d){return d.name}):[],payload}};function data_propagator_toConsumableArray(arr){return function data_propagator_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function data_propagator_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function data_propagator_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var data_propagator_propagateValues=function propagateValues(instance,action){var propagationData,config=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},payload=config.payload,selectionSet=config.selectionSet,propagationFieldInf=config.propagationFields[action]||{},propagationFields=propagationFieldInf.fields||[],append=propagationFieldInf.append,criteria=payload.criteria,context=instance.context,dataModel=context.cachedData()[0],sourceId=context.id(),sideEfffects=instance.sideEffects(),behaviourEffectMap=instance._behaviourEffectMap,mergedModel=selectionSet.mergedEnter.model,fieldsConfig=dataModel.getFieldsConfig();payload.sourceUnit=sourceId,payload.action=action,payload.sourceCanvas=context.parentAlias();var propagationBehaviour=instance._propagationBehaviourMap[action]||action,propFields=[];null===criteria?propagationData=null:isSimpleObject(criteria)?(propFields=Object.keys(criteria||{}),propagationData=mergedModel?mergedModel.project(propFields):null):(propFields=criteria[0],propagationData=mergedModel?mergedModel.project(propFields):null);var facetByFields=context.facetByFields();if(null!==propagationData&&propagationFields.length){var fields=propagationData.getData().schema.map(function(d){return d.name});propagationData=function getModelWithFacetData(dm,data){var dataObj=dm.getData(),schema1=dataObj.schema,data1=dataObj.data,jsonData=[],schema2=data[0].map(function(d){return{name:"".concat(d),type:dist_datamodel.FieldType.DIMENSION}}),data2=data[1];return data1.forEach(function(d){var tuple={};schema1.forEach(function(obj,i){tuple[obj.name]=d[i]}),schema2.forEach(function(obj,i){tuple[obj.name]=data2[i]}),jsonData.push(tuple)}),new datamodel_default.a(jsonData,[].concat(data_propagator_toConsumableArray(schema1),data_propagator_toConsumableArray(schema2)))}(propagationData,facetByFields),propFields=append?[].concat(data_propagator_toConsumableArray(fields),data_propagator_toConsumableArray(propagationFields)):propagationFields,propagationData=propagationData.project(propFields)}var propagateInterpolatedValues=!1;propFields.length&&propFields.every(function(field){return fieldsConfig[field]&&fieldsConfig[field].def.type===dist_datamodel.FieldType.MEASURE})&&(propagateInterpolatedValues=!0);var groupId=context.parentAlias();payload.action=action;var behaviourInstance=instance._actions.behavioural[propagationBehaviour],isMutableAction=!!behaviourInstance&&behaviourInstance.constructor.mutates(),filterFn=function filterFn(entry,propagationConf){var effects=behaviourEffectMap[entry.config.action],mutates=!entry.config.groupId||effects.some(function(d){return sideEfffects[d.name||d].constructor.mutates()});return entry.config.groupId!==propagationConf.groupId&&mutates},sourceBehaviour=instance._actions.behavioural[action],mutates=!!sourceBehaviour&&sourceBehaviour.constructor.mutates(),propConfig={payload:payload,action:action,criteria:propagationData,isMutableAction:mutates,propagateInterpolatedValues:propagateInterpolatedValues,groupId:groupId,sourceId:mutates?groupId:sourceId,filterFn:filterFn,enabled:function enabled(propConf,firebolt){return action===propagationBehaviour||propConf.payload.sourceCanvas===firebolt.context.parentAlias()}};dataModel.propagate(propagationData,propConfig,!0),action!==propagationBehaviour&&(propConfig={payload:payload,sourceId:isMutableAction?groupId:sourceId,criteria:propagationData,isMutableAction:isMutableAction,propagateInterpolatedValues:propagateInterpolatedValues,action:propagationBehaviour,groupId:groupId,applyOnSource:action===propagationBehaviour,enabled:function enabled(propConf,firebolt){return propConf.payload.sourceCanvas!==firebolt.context.parentAlias()},filterFn:filterFn},dataModel.propagate(propagationData,propConfig,!0,{filterImmutableAction:function filterImmutableAction(actionInf,propInf){return actionInf.groupId!==propInf.groupId}}))};function src_firebolt_typeof(obj){return(src_firebolt_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function src_firebolt_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function firebolt_get(target,property,receiver){return(firebolt_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function firebolt_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=firebolt_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function firebolt_getPrototypeOf(o){return(firebolt_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function firebolt_setPrototypeOf(o,p){return(firebolt_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function firebolt_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var firebolt_UnitFireBolt=function(_Firebolt){function UnitFireBolt(){var _getPrototypeOf2,_this;!function src_firebolt_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UnitFireBolt);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return _this=function firebolt_possibleConstructorReturn(self,call){return!call||"object"!==src_firebolt_typeof(call)&&"function"!=typeof call?firebolt_assertThisInitialized(self):call}(this,(_getPrototypeOf2=firebolt_getPrototypeOf(UnitFireBolt)).call.apply(_getPrototypeOf2,[this].concat(params))),helper_registerListeners(firebolt_assertThisInitialized(firebolt_assertThisInitialized(_this))),_this}return function firebolt_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&firebolt_setPrototypeOf(subClass,superClass)}(UnitFireBolt,firebolt_Firebolt),function src_firebolt_createClass(Constructor,protoProps,staticProps){return protoProps&&src_firebolt_defineProperties(Constructor.prototype,protoProps),staticProps&&src_firebolt_defineProperties(Constructor,staticProps),Constructor}(UnitFireBolt,[{key:"propagate",value:function propagate(behaviour,payload,selectionSet,sideEffects){data_propagator_propagateValues(this,behaviour,{payload:payload,selectionSet:selectionSet,sideEffects:sideEffects,propagationFields:this._propagationFields})}},{key:"getApplicableSideEffects",value:function getApplicableSideEffects(sideEffects,payload,propagationInf){var context=this.context,unitId=context.id(),aliasName=context.parentAlias(),propagationSourceCanvas=propagationInf.propPayload&&propagationInf.propPayload.sourceCanvas,sourceUnitId=propagationInf.propPayload&&propagationInf.propPayload.sourceUnit,sourceSideEffects=this._sourceSideEffects,sideEffectInstances=this.sideEffects(),actionOnSource=!sourceUnitId||sourceUnitId===unitId,applicableSideEffects=payload.sideEffects?[{effects:payload.sideEffects,behaviours:[payload.action]}]:sideEffects;return applicableSideEffects.forEach(function(d){var mappedEffects=d.effects;mappedEffects=mappedEffects.filter(function(se){if(sideEffectInstances[se.name||se].constructor.mutates()&&!1===propagationInf.isMutableAction)return!1;if(!actionOnSource&&null!==payload.criteria){var sideEffectChecker=sourceSideEffects[se.name||se];return!sideEffectChecker||sideEffectChecker(propagationInf.propPayload,context)}return propagationSourceCanvas!==aliasName&&!actionOnSource||!1!==se.applyOnSource}),d.effects=mappedEffects}),applicableSideEffects}},{key:"shouldApplySideEffects",value:function shouldApplySideEffects(propagate){return!1===propagate}},{key:"onDataModelPropagation",value:function onDataModelPropagation(){var _this2=this;return function(data,config){var isSourceFieldPresent=!0,isMutableAction=!1,propPayload=config.payload,sourceIdentifiers=config.sourceIdentifiers,enabledFn=config.enabled,action=config.action,payloadFn=payloadGenerator[action]||payloadGenerator.__default;if(sourceIdentifiers){var fieldsConfig=sourceIdentifiers.getFieldsConfig(),sourceIdentifierFields=Object.keys(fieldsConfig),propFields=Object.keys(data[0].getFieldsConfig());Object.values(fieldsConfig).some(function(d){return d.def.type===dist_datamodel.FieldType.MEASURE})||(isSourceFieldPresent=sourceIdentifierFields.some(function(d){return-1!==propFields.indexOf(d)}))}var payload=payloadFn(_this2.context,data,config),sourceBehaviours=_this2._sourceBehaviours,filterFn=sourceBehaviours[action]||sourceBehaviours["*"],enabled=!0;if(filterFn&&(enabled=filterFn(propPayload||{},_this2.context)),enabledFn&&(enabled=enabledFn(config,_this2)&&!1!==enabled),enabled){var effects=_this2._behaviourEffectMap[action],sideEffectInstances=_this2.sideEffects();isMutableAction=config.groupId?effects.some(function(d){return sideEffectInstances[d.name||d].constructor.mutates()}):config.isMutableAction;var propagationInf={propagate:!1,data:data,propPayload:propPayload,sourceIdentifiers:sourceIdentifiers,persistent:!1,isSourceFieldPresent:isSourceFieldPresent,sourceId:config.propagationSourceId,isMutableAction:config.isMutableAction};_this2._actionHistory[action]={payload:payload,propagationInf:propagationInf,isMutableAction:isMutableAction},_this2.dispatchBehaviour(action,payload,propagationInf)}}}},{key:"prepareSelectionSets",value:function prepareSelectionSets(behaviours){var data=this.context.data();return data&&this.createSelectionSet(data.getData().uids,behaviours),this}},{key:"initializeSideEffects",value:function initializeSideEffects(){return this.context.data()&&firebolt_get(firebolt_getPrototypeOf(UnitFireBolt.prototype),"initializeSideEffects",this).call(this),this}},{key:"remove",value:function remove(){return this.context.cachedData()[0].unsubscribe("propagation"),this}}]),UnitFireBolt}();__webpack_require__(22);function visual_unit_construct(Parent,args,Class){return(visual_unit_construct=function visual_unit_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&visual_unit_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function visual_unit_setPrototypeOf(o,p){return(visual_unit_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function visual_unit_toConsumableArray(arr){return function visual_unit_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function visual_unit_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function visual_unit_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function visual_unit_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function visual_unit_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var visual_unit_VisualUnit=function(){function VisualUnit(registry,dependencies){var _this=this;!function visual_unit_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VisualUnit),this._id=getUniqueId(),this._dependencies=dependencies,this._layerDeps={throwback:new common_utils_Store(visual_unit_defineProperty({},common_props.ON_LAYER_DRAW,!1)),smartLabel:dependencies.smartLabel,lifeCycleManager:dependencies.lifeCycleManager},this._renderedResolve=null,this._renderedPromise=new Promise(function(resolve){_this._renderedResolve=resolve}),createRenderPromise(this),this._layerDeps.throwback.registerChangeListener([common_props.ON_LAYER_DRAW],function(){_this._renderedResolve(),_this._lifeCycleManager.notify({client:_this.layers(),action:"drawn",formalName:"layer"})}),this._lifeCycleManager=dependencies.lifeCycleManager,this._layersMap={},this._gridLinesSelection={},this._gridBandsSelection={},this._gridLines=[],this._gridBands=[],this._layerNamespaces={},this._layerAxisIndex={},this._transformedDataModels={},src_layer_factory.setLayerRegistry(registry.layerRegistry),generateGetterSetters(this,src_props_PROPS),this.registry(registry),this.cachedData([])}return function visual_unit_createClass(Constructor,protoProps,staticProps){return protoProps&&visual_unit_defineProperties(Constructor.prototype,protoProps),staticProps&&visual_unit_defineProperties(Constructor,staticProps),Constructor}(VisualUnit,[{key:"store",value:function store(){if(arguments.length){this._store=arguments.length<=0?void 0:arguments[0];var metaInf=this.metaInf();this.store().append("".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE),visual_unit_defineProperty({},"".concat(metaInf.namespace),null));var localNs="".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE,".").concat(metaInf.namespace);return common_utils_transactor(this,src_local_options,this.store().model,{namespace:localNs}),common_utils_registerListeners(this,src_listener_map_listenerMap,{local:localNs,global:namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE},{rowIndex:metaInf.rowIndex,colIndex:metaInf.colIndex}),this.firebolt(new firebolt_UnitFireBolt(this,{physical:physicalActions,behavioural:behavioural_namespaceObject,physicalBehaviouralMap:actionBehaviourMap},side_effects_namespaceObject,behaviour_effect_map_behaviourEffectMap)),this}return this._store}},{key:"firebolt",value:function firebolt(){return arguments.length?(this._firebolt=arguments.length<=0?void 0:arguments[0],this):this._firebolt}},{key:"id",value:function id(){return this._id}},{key:"lockModel",value:function lockModel(){return this._store.model.lock(),this}},{key:"unlockModel",value:function unlockModel(){return this._store.model.unlock(),this}},{key:"timeDiffsByField",value:function timeDiffsByField(){return arguments.length?this:this._timeDiffsByField}},{key:"render",value:function render(container){var config=this.config(),className=config.className,defClassName=config.defClassName,sideEffectClassName=config.sideEffectClassName,classPrefix=config.classPrefix,qualifiedClassName=getQualifiedClassName(defClassName,this.id(),config.classPrefix),width=this.width(),height=this.height(),containerSelection=renderer_utils_selectElement(container).style("position","relative");this._rootSvg=makeElement(containerSelection,"svg",[null],className).style("width","".concat(width,"px")).style("height","".concat(height,"px"));var node=this._rootSvg.node();renderer_utils_setAttrs(node,{width:width,height:height,class:qualifiedClassName.join(" ")}),function renderGridLineLayers(context,container){var classPrefix=context.config().classPrefix,gridLines=context._gridLines,gridBands=context._gridBands,gridLineParentGroup=makeElement(container,"g",[1],"".concat(classPrefix,"-").concat("grid-parent-group"));[[gridLines,"".concat(classPrefix,"-").concat("grid-lines")],[gridBands,"".concat(classPrefix,"-").concat("grid-bands")]].forEach(function(entry){var _entry=grid_lines_slicedToArray(entry,2),instances=_entry[0],parentGroupClass=_entry[1],mountPoint=makeElement(gridLineParentGroup,"g",[1],".".concat(parentGroupClass)),className="".concat(parentGroupClass,"-group");makeElement(mountPoint,"g",instances,".".concat(className),{update:function update(group,instance){instance.dataProps({timeDiffs:context._timeDiffs}).mount(group.node())}})})}(this,node),function renderLayers(context,container,layers,measurement){context._lifeCycleManager.notify({client:layers,action:"beforedraw",formalName:"layer"});var classPrefix=context.config().classPrefix,orderedLayers=context.layers().sort(function(a,b){return a.config().order-b.config().order}),layerParentGroup=makeElement(container,"g",[1],"".concat(classPrefix,"-layer-group")),layerDepOrder=getDependencyOrder(context._layerDepOrder),groups={};makeElement(layerParentGroup,"g",orderedLayers,null,{update:function update(group,layer){groups[layer.alias()]={group:group,layer:layer}}}),layerDepOrder.map(function(name){return groups[name]}).forEach(function(o){var layer=o.layer,group=o.group;layer.measurement(measurement),layer.dataProps({timeDiffs:context._timeDiffs}),!1!==layer.config().render&&layer.mount(group.node())})}(this,node,this.layers(),{width:width,height:height}),this._sideEffectGroup=function createSideEffectGroup(container,className){return makeElement(container,"g",[1],className).node()}(node,"".concat(classPrefix,"-").concat(sideEffectClassName));var firebolt=this.firebolt();return function initSideEffects(sideEffects,firebolt){for(var key in sideEffects)({}).hasOwnProperty.call(sideEffects,key)&&sideEffects[key]instanceof spawnable_SpawnableSideEffect&&sideEffects[key].drawingContext(function(){return firebolt.context.getDrawingContext()})}(firebolt.sideEffects(),firebolt),this}},{key:"done",value:function done(){return this._renderedPromise}},{key:"enableCaching",value:function enableCaching(){return this._cache=!0,this}},{key:"clearCaching",value:function clearCaching(){return this._cache=!1,this.cachedData([this.cachedData()[0]]),this}},{key:"getDrawingContext",value:function getDrawingContext(){var rootSvg=this._rootSvg&&this._rootSvg.node(),width=this.width(),height=this.height(),_this$parentContainer=this.parentContainerInf(),el=_this$parentContainer.el,dimensions=_this$parentContainer.dimensions;return{htmlContainer:this.mount(),svgContainer:rootSvg,width:width,height:height,sideEffectGroup:this._sideEffectGroup,parentContainer:el,parentContainerDimensions:dimensions,xOffset:0,yOffset:0}}},{key:"serialize",value:function serialize(){return{layers:this.layers().map(function(layer){return layer.serialize()}),config:this.config(),axes:this.axes().map(function(axis){return axis.serialize()})}}},{key:"mount",value:function mount(){return arguments.length?(this._mount=arguments.length<=0?void 0:arguments[0],this.render(arguments.length<=0?void 0:arguments[0]),this.firebolt().mapActionsAndBehaviour(),this):this._mount}},{key:"addLayer",value:function addLayer(layerDefinition){var _ref2,_ref3,_this2=this,layerDefinitions=helper_sanitizeLayerDef(toArray(layerDefinition)),layersMap=this._layersMap,markSet={},store={layers:{},components:{unit:this}},layerIndex=0,startIndex=(_ref2=[]).concat.apply(_ref2,visual_unit_toConsumableArray(Object.values(this._layersMap))).length,metaInf=this.metaInf(),props=this._layerNamespaces,layers=layerDefinitions.sort(function(a,b){return a.order-b.order}).reduce(function(layersArr,layerDef){var _layersArr,definition=layerDef.def,markId=definition.name,defArr=toArray(definition),namespaces=[];defArr.forEach(function(def){def.order=layerDef.order+layerIndex;var namespace="".concat(metaInf.namespace).concat(startIndex);layersMap[markId]||(startIndex++,!1!==definition.calculateDomain&&(props["".concat(namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE,".").concat("domain",".").concat(namespace)]=!0)),namespaces.push(namespace)}),layerIndex+=defArr.length;var instances=helper_getLayerFromDef(_this2,definition,layersMap[markId],namespaces);store.layers=Object.assign(store.layers,instances);var instanceValues=Object.values(instances);return layersArr=(_layersArr=layersArr).concat.apply(_layersArr,visual_unit_toConsumableArray(instanceValues)),layersMap[markId]=instanceValues,markSet[markId]=markId,layersArr},[]);store.unit=this;var layerdeps={},layersArr=(_ref3=[]).concat.apply(_ref3,visual_unit_toConsumableArray(Object.values(this._layersMap)));layersArr.forEach(function(layer){var alias=layer.alias();store.layers[alias]=layer,layerdeps[alias]=[]}),layers.forEach(function(layer){var depArr=resolveEncodingTransform(layer,store);layerdeps[layer.alias()]=depArr}),this._layerDepOrder=layerdeps,this._layerAxisIndex=Object.assign(this._layerAxisIndex,function getLayerAxisIndex(layers,fields){var layerAxisIndex={};return layers.forEach(function(layer){var _layer$config=layer.config(),axis=_layer$config.axis,encoding=_layer$config.encoding,id=layer.id();["x","y"].forEach(function(type){var index,field=defaultValue(getObjProp(axis,type),encoding[type]&&encoding[type].field);index=fields[type]?fields[type].findIndex(function(fieldInst){return-1!==fieldInst.getMembers().indexOf(field)}):0,!layerAxisIndex[id]&&(layerAxisIndex[id]={}),layerAxisIndex[id][type]=index})}),layerAxisIndex}(layers,this.fields()));var stateStore=this.store();return stateStore.unsubscribe({key:"calculateDomainListener",namespace:"".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE,".").concat(metaInf.namespace)}),stateStore.registerImmediateListener(Object.keys(props),listener_map_calculateDomainListener(this,metaInf.namespace),!1,{key:"calculateDomainListener",namespace:"".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE,".").concat(metaInf.namespace)}),this.layers(layersArr),layers}},{key:"remove",value:function remove(){var lifeCycleManager=this._dependencies.lifeCycleManager;return lifeCycleManager.notify({client:this,action:"beforeremove",formalName:"unit"}),this.store().unsubscribe({namespace:"".concat(namespace_namespaceObject.UNIT_LOCAL_NAMESPACE,".").concat(this.metaInf().namespace)}),renderer_utils_selectElement(this.mount()).remove(),this.firebolt().remove(),lifeCycleManager.notify({client:this.layers(),action:"beforeremove",formalName:"layer"}),this.layers().forEach(function(layer){return layer.remove()}),lifeCycleManager.notify({client:this.layers(),action:"removed",formalName:"layer"}),lifeCycleManager.notify({client:this,action:"removed",formalName:"unit"}),this}},{key:"getDataModelFromIdentifiers",value:function getDataModelFromIdentifiers(identifiers,mode,parentModel){if(null===identifiers)return null;var dataModel=parentModel||this.data();return common_utils_getDataModelFromIdentifiers(dataModel,identifiers,mode)}},{key:"resetData",value:function resetData(){return this.data(this.cachedData()[0]),this}},{key:"getSourceInfo",value:function getSourceInfo(){return{dimensionMeasureMap:this._dimensionMeasureMap,fields:this.fields(),data:this.data(),axes:this.axes()}}},{key:"getDefaultTargetContainer",value:function getDefaultTargetContainer(){var _this$config=this.config(),classPrefix=_this$config.classPrefix,defClassName=_this$config.defClassName;return[".".concat(classPrefix,"-").concat(defClassName)]}},{key:"getLayersByType",value:function getLayersByType(type){return getLayersBy(this.layers(),"type",type)}},{key:"getLayerByName",value:function getLayerByName(name){return getLayersBy(this.layers(),"name",name)[0]}},{key:"getNearestPoint",value:function getNearestPoint(x,y,config){var pointObj={id:null},dimValue=function getNearestDimensionalValue(context,position){var fields=context.fields();if(!fields.x.length||!fields.y.length)return null;var data=context.data(),axes=context.axes(),fieldsConfig=data.getFieldsConfig(),xField=getObjProp(fields,"x",0).getMembers()[0],yField=getObjProp(fields,"y",0).getMembers()[0],xFieldType=fieldsConfig[xField].def.subtype,yFieldType=fieldsConfig[yField].def.subtype,entryVal=[["x",xFieldType,xField],["y",yFieldType,yField]].find(function(entry){return entry[1]===dist_datamodel.DimensionSubtype.CATEGORICAL||entry[1]===dist_datamodel.DimensionSubtype.TEMPORAL});if(!entryVal||xFieldType!==dist_datamodel.MeasureSubtype.CONTINUOUS&&yFieldType!==dist_datamodel.MeasureSubtype.CONTINUOUS)return null;var field=entryVal[2],index=fieldsConfig[field].index,key=axes[entryVal[0]][0].invert(position[entryVal[0]]);if(entryVal[1]===dist_datamodel.DimensionSubtype.TEMPORAL){var filterData=src_helper_toConsumableArray(new Set(data.getData().data.map(function(d){return d[index]})));key=filterData[common_utils_getClosestIndexOf(filterData,key)]}return void 0!==key?[[field],[key]]:null}(this,{x:x,y:y});if(null!==dimValue&&config.getAllPoints){pointObj.id=dimValue;var pointInf=this.getMarkInfFromLayers(x,y,config);return pointObj.target=pointInf&&pointInf.id?pointInf.id:pointObj.id,pointObj}var markInf=this.getMarkInfFromLayers(x,y,config)||{id:null};return(pointObj=Object.assign({},markInf)).target=markInf.id,pointObj}},{key:"getMarkInfFromLayers",value:function getMarkInfFromLayers(x,y,args){for(var layers=this.layers(),len=layers.length,point=null,i=0;i<len;i++){var layer=layers[i];if(!1!==layer.config().interactive&&(point=layer.getNearestPoint(x,y,args)),point)return point}return point}},{key:"getPlotPointsFromIdentifiers",value:function getPlotPointsFromIdentifiers(identifiers){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},points=[],parsedIdentifiers=identifiers;if(null===identifiers)return[];var layers=this.layers(),len=layers.length;isSimpleObject(identifiers)&&(parsedIdentifiers=[Object.keys(identifiers)],parsedIdentifiers=[].concat(visual_unit_toConsumableArray(parsedIdentifiers),visual_unit_toConsumableArray(function transposeArray(arr){return arr[0].map(function(col,i){return arr.map(function(row){return row[i]})})}(Object.values(identifiers)))));for(var i=0;i<len;i++){var layer=layers[i];!1!==layer.config().interactive&&(points=[].concat(visual_unit_toConsumableArray(points),visual_unit_toConsumableArray(layer.getPointsFromIdentifiers(parsedIdentifiers,config))))}return points}},{key:"removeLayerByName",value:function removeLayerByName(name){return removeLayersBy("name",name),this}},{key:"removeLayersByType",value:function removeLayersByType(type){return removeLayersBy("type",type),this}}],[{key:"formalName",value:function formalName(){return"unit"}},{key:"getState",value:function getState(){return[{domain:{}},src_local_options]}},{key:"create",value:function create(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return visual_unit_construct(this,params)}}]),VisualUnit}();function matrix_model_slicedToArray(arr,i){return function matrix_model_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function matrix_model_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function matrix_model_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function matrix_model_toConsumableArray(arr){return function matrix_model_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function matrix_model_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function matrix_model_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var getFieldNames=function getFieldNames(fields1){return[fields1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]].map(function(fields){return fields.reduce(function(acc,d){return acc=[].concat(matrix_model_toConsumableArray(acc),matrix_model_toConsumableArray(d.getMembers()))},[])})},createSelectedDataModel=function createSelectedDataModel(datamodel,fieldNames,fieldValues){return datamodel.select(function(fields){return fieldNames.every(function(field,k){return fields[field].value===fieldValues[k]})})},matrix_model_uniqueKeyGenerator=function uniqueKeyGenerator(keyArray,context){var depth=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,val=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],facets=context.facets,dataModel=context.dataModel,uniqueValues=context.uniqueValues;if(facets[depth+1]){var field=facets[depth];uniqueValues.forEach(function(value){var newDm=dataModel.select(function(fields){return fields[field].value===value}),nextDepthUniqueValues=retriveDomainFromData(newDm,facets[depth+1]);uniqueKeyGenerator(keyArray,{facets:facets,dataModel:newDm,uniqueValues:nextDepthUniqueValues},depth+1,[].concat(matrix_model_toConsumableArray(val),[value]))})}else uniqueValues.forEach(function(value){keyArray.push([].concat(matrix_model_toConsumableArray(val),[value]))})},projectRows=function projectRows(datamodel,projections){var allColumnProjections=projections.allColumnProjections,rowProjections=projections.rowProjections,optionalProjections=projections.optionalProjections;return rowProjections.length>0?rowProjections.map(function(projectFields){var _getFieldNames2=matrix_model_slicedToArray(getFieldNames(projectFields,allColumnProjections),2),projFieldNames=_getFieldNames2[0],colProjFieldNames=_getFieldNames2[1];return datamodel.project([].concat(matrix_model_toConsumableArray(projFieldNames),matrix_model_toConsumableArray(colProjFieldNames),matrix_model_toConsumableArray(optionalProjections)))}):[datamodel]},pushToMatrix=function pushToMatrix(context,valueCellCreator){var _matrix$rowIndex,cells=[],matrix=context.matrix,datamodel=context.datamodel,facetInfo=context.facetInfo,fieldInfo=context.fieldInfo,rowProjections=fieldInfo.rowProjections,colProjections=fieldInfo.colProjections,optionalProjections=fieldInfo.optionalProjections,rowIndex=facetInfo.rowIndex,columnIndex=facetInfo.columnIndex,rowProj=rowProjections[rowIndex%rowProjections.length]||[];colProjections.length>0?cells=colProjections.map(function(projectFields,projIdx){var _getFieldNames4=matrix_model_slicedToArray(getFieldNames(projectFields,rowProj),2),colProjFieldNames=_getFieldNames4[0],rowProjFieldNames=_getFieldNames4[1],projectedDm=datamodel.project([].concat(matrix_model_toConsumableArray(colProjFieldNames),matrix_model_toConsumableArray(rowProjFieldNames),matrix_model_toConsumableArray(optionalProjections))),projections={rowFields:rowProj,columnFields:projectFields},indices={rowIndex:rowIndex,columnIndex:columnIndex*colProjections.length+projIdx};return valueCellCreator(projectedDm,{projections:projections,indices:indices},facetInfo)}):cells=[valueCellCreator(datamodel,{projections:{rowFields:rowProj,columnFields:[]},indices:{rowIndex:rowIndex,columnIndex:columnIndex}},facetInfo)];matrix[rowIndex]=matrix[rowIndex]||[],(_matrix$rowIndex=matrix[rowIndex]).push.apply(_matrix$rowIndex,matrix_model_toConsumableArray(cells))};function cell_creator_slicedToArray(arr,i){return function cell_creator_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function cell_creator_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function cell_creator_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function cell_creator_toConsumableArray(arr){return function cell_creator_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function cell_creator_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function cell_creator_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var cell_creator_createValueCells=function createValueCells(context,datamodel,fieldInfo,facets){var projections=fieldInfo.projections,indices=fieldInfo.indices,rowFields=projections.rowFields,columnFields=projections.columnFields,rowIndex=indices.rowIndex,columnIndex=indices.columnIndex,suppliedLayers=context.suppliedLayers,GeomCell=context.cell,resolver=context.resolver,config=context.config,encoder=context.encoder,detailFields=context.detailFields,axes=resolver.axes(),cacheMaps=resolver.cacheMaps(),matrixLayers=resolver.matrixLayers(),labelManager=resolver.dependencies().smartlabel,horizontalAxis=resolver.horizontalAxis(),verticalAxis=resolver.verticalAxis(),datamodelTransform=resolver.datamodelTransform(),entryCellMap=cacheMaps.entryCellMap,exitCellMap=cacheMaps.exitCellMap,layerConfigArr=encoder.getLayerConfig({columnFields:columnFields,rowFields:rowFields},suppliedLayers||[]),axesCreators={config:config,labelManager:labelManager,axes:axes,cacheMaps:cacheMaps};fieldInfo.normalizedColumns=verticalAxis.fields,fieldInfo.normalizedRows=horizontalAxis.fields;var groupAxes=encoder.createAxis(axesCreators,fieldInfo);matrixLayers[rowIndex]=matrixLayers[rowIndex]?matrixLayers[rowIndex]:[],matrixLayers[rowIndex][columnIndex]=layerConfigArr;var geomCellKey=function getCellKey(rowId,columnId){return"cell-".concat(rowId,"-").concat(columnId)}(rowIndex,columnIndex),fields={y:rowFields,x:columnFields},allFacets=[[].concat(cell_creator_toConsumableArray(facets.rowFacets[0]),cell_creator_toConsumableArray(facets.colFacets[0])),[].concat(cell_creator_toConsumableArray(facets.rowFacets[1]),cell_creator_toConsumableArray(facets.colFacets[1]))],geomCell=exitCellMap.has(geomCellKey)?exitCellMap.get(geomCellKey):new GeomCell;return geomCell.data(datamodel).axes(groupAxes).fields(fields).transform(datamodelTransform).detailFields(detailFields).facetByFields(allFacets),entryCellMap.set(geomCellKey,geomCell),exitCellMap.delete(geomCellKey),function updateCells(resolver,facets,geomCell){[ROW,COL].forEach(function(field){var cells=resolver["".concat(field,"Cells")](),facetKey=facets["".concat(field,"Facets")][1].join();!cells[facetKey]&&(cells[facetKey]=[]),cells[facetKey].push(geomCell),resolver["".concat(field,"Cells")](cells)})}(resolver,facets,geomCell),entryCellMap.get(geomCellKey)},cell_creator_createAxisCells=function createAxisCells(selection,axes,axisIndex,cells){return common_utils_createSelection(selection,function(axis){return axis},axes,function(item,i){return i+item.reduce(function(e,n){return e+(n.id+axisIndex)},"")}).map(function(axis){if(axis&&axis[axisIndex]){var axisInst=axis[axisIndex],_axisInst$config=axisInst.config(),orientation=_axisInst$config.orientation,show=_axisInst$config.show;return(new cells.AxisCell).source(axisInst).config({isOffset:orientation===axis_orientation_namespaceObject.LEFT||orientation===axis_orientation_namespaceObject.TOP,show:show})}return(new cells.BlankCell).config({show:!1})})},cell_creator_headerPlaceholderGn=function headerPlaceholderGn(context,selectionObj,cells,labelManager){var axis=context.axis,keys=context.keys,type=context.type,facet=context.facet,counter=axis.length/keys.length,selectionKeys=keys.length?axis.map(function(d,i){return keys[Math.floor(i/counter)]}):[];return common_utils_createSelection(selectionObj["".concat(type,"Headers")],function(keySet){return keySet},selectionKeys,function(keySet,i){return"".concat(keySet.join(","),"-").concat(i)}).map(function(keySet){return function createTextCells(selection,headers,cells,labelManager){return common_utils_createSelection(selection,function(label){return new cells.TextCell({},{labelManager:labelManager}).source(label)},headers,function(key,i){return key+i})}(null,keySet,cells,labelManager).map(function(cell,k,i){return cell.source(keySet[i]).config(facet)})})},cell_creator_generatePlaceholders=function generatePlaceholders(context,cells,labelManager){var selectionObj,matrices=context.matrices,fields=context.fields,facetsAndProjections=context.facetsAndProjections,selection=context.selection,facet=context.facet,encoders=context.encoders,rows=fields.rows,columns=fields.columns,valuesMatrix=matrices.valuesMatrix,rowProjections=facetsAndProjections.rowProjections,colProjections=facetsAndProjections.colProjections,rowKeys=valuesMatrix.rowKeys,columnKeys=valuesMatrix.columnKeys,takeAxisFrom=encoders.simpleEncoder._axisFrom,takeHeaderFrom=encoders.simpleEncoder._headerFrom;selectionObj=selection||{},["pie",X,Y].forEach(function(axis){var axisFrom=axis===X?takeAxisFrom.column:takeAxisFrom.row;selectionObj=function axisPlaceholderGn(context,selObj,cells){var axesMatrix=context.matrices.axesMatrix;return function(type,axisFrom){var axes=axesMatrix["".concat(type)];if(axes&&axes.length)if(type===X||type===Y){var fieldNames=type===Y?ROWS:COLUMNS;[PRIMARY,SECONDARY].forEach(function(fieldType,index){var selObjProp="".concat(fieldNames).concat(fieldType),axisIndex=index,axesForDraw=axes;axisFrom!==constants_RIGHT&&"bottom"!==axisFrom||(axisIndex=1-axisIndex),getObjProp(axes,0,axisIndex)||(axesForDraw=[]),selObj[selObjProp]=cell_creator_createAxisCells(selObj[selObjProp],axesForDraw,axisIndex,cells)})}else selObj.rowsPrimary=cell_creator_createAxisCells(selObj.rowPrime,axes.map(function(){return[]}),0,cells),selObj.columnsPrimary=cell_creator_createAxisCells(selObj.colPrime,axes[0],0,cells);return selObj}}(context,selectionObj,cells)(axis,axisFrom)});var _selectionObj=selectionObj,rowsPrimary=_selectionObj.rowsPrimary,rowsSecondary=_selectionObj.rowsSecondary,columnsPrimary=_selectionObj.columnsPrimary,columnsSecondary=_selectionObj.columnsSecondary,rowAxis=rowsPrimary&&rowsPrimary.getObjects().length?rowsPrimary.getObjects():rowsSecondary&&rowsSecondary.getObjects().length?rowsSecondary.getObjects():[],colAxis=columnsPrimary&&columnsPrimary.getObjects().length?columnsPrimary.getObjects():columnsSecondary&&columnsSecondary.getObjects().length?columnsSecondary.getObjects():[];return[{type:constants_LEFT,section:rows[0],axis:rowAxis,headerFrom:takeHeaderFrom.row},{type:constants_RIGHT,section:rows[1],axis:rowAxis,headerFrom:takeHeaderFrom.row},{type:"top",section:columns[0],axis:colAxis,headerFrom:takeHeaderFrom.column},{type:"bottom",section:columns[1],axis:colAxis,headerFrom:takeHeaderFrom.column}].forEach(function(config,index){var keys,length,type=config.type,section=config.section,axis=config.axis,headerFrom=config.headerFrom;if(index<2?(keys=rowKeys,length=rowProjections.length>0?rowProjections.length:1):(keys=columnKeys,length=colProjections.length>0?colProjections.length:1),section.length&&headerFrom===type&&axis&&keys.length){var hContext={axis:axis,length:length,type:type},headers=[];index<2?(hContext.keys=keys,hContext.facet=facet.rows,headers=cell_creator_headerPlaceholderGn(hContext,selectionObj,cells,labelManager)):(hContext.facet=facet.columns,hContext.keys=keys[0].map(function(key,i){return keys.map(function(e){return e[i]})}),headers=cell_creator_headerPlaceholderGn(hContext,selectionObj,cells,labelManager)),selectionObj["".concat(type,"Headers")]=headers}else selectionObj["".concat(type,"Headers")]=null}),selectionObj},cell_creator_computeMatrices=function computeMatrices(context,config){var resolver=context.resolver,datamodel=context.datamodel,componentRegistry=context.componentRegistry,encoders=context.encoders,globalConfig=config.globalConfig,selection=config.selection,transform=config.transform,groupBy=globalConfig.autoGroupBy,labelManager=resolver.dependencies().smartlabel,fieldMap=datamodel.getFieldsConfig(),layerConfig=resolver.layerConfig(),registry=resolver.registry(),normalizedRows=resolver.horizontalAxis().fields,normalizedColumns=resolver.verticalAxis().fields,otherEncodings=resolver.optionalProjections(config,layerConfig),facetsAndProjections=resolver.getAllFields(),matrixGnContext={normalizedColumns:normalizedColumns,normalizedRows:normalizedRows,facetsAndProjections:facetsAndProjections,layers:layerConfig,fieldMap:fieldMap,otherEncodings:otherEncodings,encoders:encoders,facet:globalConfig.facet||{},axisFrom:globalConfig.axisFrom||{},selection:selection},cells={GeomCell:resolver.getCellDef(registry.GeomCell),AxisCell:resolver.getCellDef(registry.AxisCell),BlankCell:resolver.getCellDef(registry.BlankCell),TextCell:resolver.getCellDef(registry.TextCell)},isRowSizeEqual=group_utils_isDistributionEqual(normalizedRows),isColumnSizeEqual=group_utils_isDistributionEqual(normalizedColumns);resolver.colCells({}),resolver.rowCells({}),resolver.datamodelTransform(transform||{}),resolver.resetSimpleAxes();var newCacheMap={exitCellMap:resolver.cacheMaps().entryCellMap,entryCellMap:new Map};resolver.cacheMaps(newCacheMap);var valueCellContext={config:globalConfig,suppliedLayers:encoders.simpleEncoder.serializeLayerConfig(resolver.layerConfig()),resolver:resolver,cell:cells.GeomCell,encoder:encoders.simpleEncoder,newCacheMap:newCacheMap,detailFields:config.detail},fieldsConfig=datamodel.getFieldsConfig(),groupedModel=datamodel;if(!groupBy.disabled){var allFields=function extractFields(facetsAndProjections,layerFields){var _ref6,fields=Object.values(facetsAndProjections).map(function(arr){var _ref4,_ref5,flattenArray=(_ref4=[]).concat.apply(_ref4,group_utils_toConsumableArray(arr));return(_ref5=[]).concat.apply(_ref5,group_utils_toConsumableArray(flattenArray.map(function(field){return field instanceof variable_Variable?field.getMembers():field})))});return(_ref6=[]).concat.apply(_ref6,group_utils_toConsumableArray(fields).concat(group_utils_toConsumableArray(layerFields)))}(facetsAndProjections,function getFieldsFromSuppliedLayers(suppliedLayerConfig,fieldsConfig){var _ref3,fields=[],encodingArr=suppliedLayerConfig.map(function(conf){return conf.encoding||{}});return fields=(fields=[].concat(group_utils_toConsumableArray(fields),[(_ref3=[]).concat.apply(_ref3,group_utils_toConsumableArray(encodingArr.map(function(enc){return Object.values(enc).map(function(d){return d.field})})))])).filter(function(field){return fieldsConfig[field]&&fieldsConfig[field].def.type===dist_datamodel.FieldType.DIMENSION})}(valueCellContext.suppliedLayers,datamodel.getFieldsConfig())),dimensions=allFields.filter(function(field){return fieldsConfig[field]&&fieldsConfig[field].def.type===dist_datamodel.FieldType.DIMENSION}),aggregationFns=groupBy.measures,measureNames=Object.keys(datamodel.getFieldspace().getMeasure()),nearestAggFns=common_utils_retrieveNearestGroupByReducers.apply(void 0,[datamodel].concat(cell_creator_toConsumableArray(measureNames))),resolvedAggFns=mergeRecursive(nearestAggFns,aggregationFns);groupedModel=datamodel.groupBy(dimensions.length?dimensions:[""],resolvedAggFns).project(allFields)}var valueMatrixInfo=function getMatrixModel(dataModel,facetsAndProjections,valueCellCreator){var rowDataModels=[],rowKeys=[],columnKeys=[],allColumnProjections=[],matrix=[],facetInfo=[],fieldInfo=Object.assign({},facetsAndProjections),rowFacets=fieldInfo.rowFacets,colFacets=fieldInfo.colFacets;if(fieldInfo.colProjections.forEach(function(colProj){allColumnProjections.push.apply(allColumnProjections,matrix_model_toConsumableArray(colProj))}),fieldInfo.allColumnProjections=allColumnProjections,rowFacets.length>0){var field=rowFacets[0].toString(),firstLevelRowKeys=retriveDomainFromData(dataModel,field);matrix_model_uniqueKeyGenerator(rowKeys,{facets:rowFacets,dataModel:dataModel,uniqueValues:firstLevelRowKeys}),rowKeys.forEach(function(val){var _rowDataModels,rowFacetFieldNames=matrix_model_slicedToArray(getFieldNames(rowFacets),1)[0],selectedDataModel=createSelectedDataModel(dataModel,rowFacetFieldNames,val);(_rowDataModels=rowDataModels).push.apply(_rowDataModels,matrix_model_toConsumableArray(projectRows(selectedDataModel,fieldInfo))),rowDataModels.forEach(function(){facetInfo.push([rowFacets,val])})})}else{var _rowDataModels2;(_rowDataModels2=rowDataModels).push.apply(_rowDataModels2,matrix_model_toConsumableArray(projectRows(dataModel,fieldInfo)))}if(rowDataModels=rowDataModels.length>0?rowDataModels:[[]],colFacets.length>0){var colFacetNames=colFacets.map(function(d){return"".concat(d)}),_field=colFacetNames[0],firstLevelColumnKeys=retriveDomainFromData(dataModel,_field);matrix_model_uniqueKeyGenerator(columnKeys,{facets:colFacetNames,dataModel:dataModel,uniqueValues:firstLevelColumnKeys}),rowDataModels.forEach(function(dme,rIndex){facetInfo[rIndex]=facetInfo[rIndex]||[[],[]],columnKeys.forEach(function(val,cIndex){matrix[rIndex]=matrix[rIndex]||[];var datamodel=dme instanceof datamodel_default.a?dme:dataModel,selectedDataModel=createSelectedDataModel(datamodel,colFacetNames,val),context={matrix:matrix,datamodel:selectedDataModel,facetInfo:{rowFacets:facetInfo[rIndex],colFacets:[colFacets,val],rowIndex:rIndex,columnIndex:cIndex},fieldInfo:fieldInfo};pushToMatrix(context,valueCellCreator)})})}else rowDataModels.forEach(function(dme,rIndex){facetInfo[rIndex]=facetInfo[rIndex]||[[],[]];var context={matrix:matrix,datamodel:dme||dataModel,facetInfo:{rowFacets:facetInfo[rIndex],colFacets:[[],[]],rowIndex:rIndex,columnIndex:0},fieldInfo:fieldInfo};pushToMatrix(context,valueCellCreator)});var transposedColKeys=columnKeys.length>0?columnKeys[0].map(function(col,i){return columnKeys.map(function(row){return row[i]})}):columnKeys;return{matrix:matrix,rowKeys:rowKeys,columnKeys:transposedColKeys}}(groupedModel,facetsAndProjections,resolver.valueCellsCreator(valueCellContext));resolver.cacheMaps().exitCellMap.forEach(function(placeholder){placeholder.remove()}),resolver.cacheMaps().exitCellMap.clear(),resolver.valueMatrix(valueMatrixInfo.matrix);var _mutateAxesFromMap=function mutateAxesFromMap(cacheMaps,axes){var xAxes=null,yAxes=null,xAxesMap=cacheMaps.xAxesMap,yAxesMap=cacheMaps.yAxesMap,xAxisSet=axes.x,yAxisSet=axes.y;return xAxisSet&&xAxisSet.forEach(function(axisId){var xAxis=xAxesMap.get(axisId);(xAxes=xAxes||[]).push(xAxis)}),yAxisSet&&yAxisSet.forEach(function(axisId){var yAxis=yAxesMap.get(axisId);(yAxes=yAxes||[]).push(yAxis)}),{xAxes:xAxes,yAxes:yAxes}}(resolver.cacheMaps(),resolver.axes()),xAxes=_mutateAxesFromMap.xAxes,yAxes=_mutateAxesFromMap.yAxes;resolver.axes({x:xAxes,y:yAxes});var store=resolver.store();[xAxes,yAxes].forEach(function(axesArr,type){var stateProps={};(axesArr=axesArr||[]).forEach(function(axes,idx){axes.forEach(function(axis,axisIndex){stateProps["".concat(idx).concat(axisIndex)]=null})}),store.append("".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.").concat(type?"y":"x"),stateProps)}),resolver.createUnits(componentRegistry,config);var _generateMatrices=function generateMatrices(context,matrices,cells,labelManager){var unitHeight=context.unitHeight,unitWidth=context.unitWidth,facetsAndProjections=context.facetsAndProjections,normalizedRows=context.normalizedRows,normalizedColumns=context.normalizedColumns,selection=context.selection,axisFrom=context.axisFrom,facet=context.facet,encoders=context.encoders,selectionObj=cell_creator_generatePlaceholders({fields:{rows:normalizedRows,columns:normalizedColumns},matrices:matrices,facetsAndProjections:facetsAndProjections,selection:selection,axisFrom:axisFrom,facet:facet,encoders:encoders},cells,labelManager),columnsPrimary=selectionObj.columnsPrimary,columnsSecondary=selectionObj.columnsSecondary,rowsPrimary=selectionObj.rowsPrimary,rowsSecondary=selectionObj.rowsSecondary,leftHeaders=selectionObj.leftHeaders,topHeaders=selectionObj.topHeaders,bottomHeaders=selectionObj.bottomHeaders,rightHeaders=selectionObj.rightHeaders,_map2=cell_creator_slicedToArray([rowsPrimary,rowsSecondary,columnsPrimary,columnsSecondary].map(function(d){return d?d.getObjects():[]}),4),rowPrime=_map2[0],rowSec=_map2[1],colPrime=_map2[2],colSec=_map2[3],_map4=cell_creator_slicedToArray([leftHeaders,rightHeaders].map(function(e){return e?e.getObjects().map(function(f){return f.getObjects()}):[]}),2),leftFacets=_map4[0],rightFacets=_map4[1],rowPriority=rowSec.length?1:-1;rowPrime.length&&rowPriority++;var colPriority=colSec.length?1:-1;colPrime.length&&colPriority++;var leftMatrix=leftFacets.length?leftFacets.map(function(d,i){return rowPrime[i]=rowPrime[i]?[rowPrime[i]]:[],[].concat(cell_creator_toConsumableArray(d),cell_creator_toConsumableArray(rowPrime[i]))}):rowPrime?rowPrime.map(function(d){return[d]}):[],rightMatrix=rowSec.length?rowSec.map(function(d,i){return[d].concat(cell_creator_toConsumableArray(rightFacets[i]||[]))}):rightFacets.length?rightFacets.map(function(d){return cell_creator_toConsumableArray(d)}):[],topMatrix=[];topHeaders&&topHeaders.getObjects().forEach(function(e){e.getObjects().forEach(function(x,i){topMatrix[i]=topMatrix[i]||[],topMatrix[i].push(x)})});colPrime.length&&topMatrix.push(colPrime);var bottomMatrix=[];colSec.length&&bottomMatrix.push(colSec);var currentBottomLength=bottomMatrix.length;bottomHeaders&&bottomHeaders.getObjects().forEach(function(e){e.getObjects().forEach(function(x,i){bottomMatrix[i+currentBottomLength]=bottomMatrix[i+currentBottomLength]||[],bottomMatrix[i+currentBottomLength].push(x)})});if(!leftMatrix.length&&!rightMatrix.length){var cell=new cells.BlankCell;cell.setAvailableSpace(unitWidth,unitHeight),leftMatrix=[[cell]]}if(!(topMatrix.length||bottomMatrix.length&&bottomMatrix[0].length)){var _cell=new cells.BlankCell;_cell.setAvailableSpace(unitWidth,unitHeight),bottomMatrix=[[_cell]]}return{rows:[leftMatrix,rightMatrix],columns:[topMatrix,bottomMatrix],selectionObj:selectionObj,colPriority:colPriority,rowPriority:rowPriority}}(matrixGnContext,{valuesMatrix:valueMatrixInfo,axesMatrix:resolver.axes()},cells,labelManager),rows=_generateMatrices.rows,columns=_generateMatrices.columns,selectionObj=_generateMatrices.selectionObj,rowPriority=_generateMatrices.rowPriority,colPriority=_generateMatrices.colPriority;return resolver.rowMatrix(rows),resolver.columnMatrix(columns),{rows:resolver.rowMatrix(),columns:resolver.columnMatrix(),values:resolver.valueMatrix(),isColumnSizeEqual:isColumnSizeEqual,isRowSizeEqual:isRowSizeEqual,priority:{row:rowPriority,col:colPriority},selection:selectionObj,dataModels:{groupedModel:groupedModel,parentModel:datamodel}}},RESOLVER_PROPS={dependencies:{},units:{},datamodelTransform:{},layerConfig:{},matrixLayers:{},colCells:{},rowCells:{},rowMatrix:{},columnMatrix:{},valueMatrix:{},encoder:{}};function matrix_resolver_slicedToArray(arr,i){return function matrix_resolver_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function matrix_resolver_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function matrix_resolver_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function matrix_resolver_toConsumableArray(arr){return function matrix_resolver_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function matrix_resolver_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function matrix_resolver_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function matrix_resolver_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var matrix_resolver_MatrixResolver=function(){function MatrixResolver(dependencies){!function matrix_resolver_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MatrixResolver),this._registry={},this._layerConfig=[],this._matrixLayers=[],this._dependencies=dependencies,this._rowMatrix=[],this._columnMatrix=[],this._valueMatrix=[],this._facets={rowFacets:[],colFacets:[]},this._projections={rowProjections:[],colProjections:[]},this._datamodelTransform={},this._units=[],this._cacheMaps={},this._axes={x:{},y:{},color:[],size:[],shape:[]},generateGetterSetters(this,RESOLVER_PROPS),this.cacheMaps(initializeCacheMaps())}return function matrix_resolver_createClass(Constructor,protoProps,staticProps){return protoProps&&matrix_resolver_defineProperties(Constructor.prototype,protoProps),staticProps&&matrix_resolver_defineProperties(Constructor,staticProps),Constructor}(MatrixResolver,[{key:"registry",value:function registry(){var _this=this;return arguments.length?(Object.entries(arguments.length<=0?void 0:arguments[0]).forEach(function(val){_this._registry[val[0]]=val[1]}),this):this._registry}},{key:"cacheMaps",value:function cacheMaps(){for(var _this2=this,_len=arguments.length,maps=new Array(_len),_key=0;_key<_len;_key++)maps[_key]=arguments[_key];return maps.length?([CELL,X_AXES,Y_AXES,ENTRY_CELLS,EXIT_CELLS].forEach(function(e){_this2._cacheMaps["".concat(e,"Map")]=maps[0]["".concat(e,"Map")]||_this2._cacheMaps["".concat(e,"Map")]}),this):this._cacheMaps}},{key:"axes",value:function axes(){return arguments.length?(this._axes=Object.assign({},this._axes,arguments.length<=0?void 0:arguments[0]),this):this._axes}},{key:"facets",value:function facets(){var _this3=this;return arguments.length?(Object.entries(arguments.length<=0?void 0:arguments[0]).forEach(function(e){_this3._facets[e[0]]=e[1]}),this):this._facets}},{key:"projections",value:function projections(){var _this4=this;return arguments.length?(Object.entries(arguments.length<=0?void 0:arguments[0]).forEach(function(e){_this4._projections[e[0]]=e[1]}),this):this._projections}},{key:"optionalProjections",value:function optionalProjections(config,layerConfig){var otherEncodings={},optionalProjections=[];return[enums_constants_SIZE,enums_constants_COLOR,enums_constants_SHAPE].forEach(function(type){if(config[type]&&config[type].field){var enc=config[type];otherEncodings[type]=enc.field,optionalProjections.push(enc.field)}}),config.detail&&optionalProjections.push.apply(optionalProjections,matrix_resolver_toConsumableArray(config.detail)),layerConfig.length&&layerConfig.forEach(function(layer){layer.encoding&&Object.values(layer.encoding).forEach(function(enc){enc&&-1===optionalProjections.indexOf(enc.field)&&optionalProjections.push(enc.field?enc.field:enc)})}),this.projections({optionalProjections:optionalProjections}),otherEncodings}},{key:"horizontalAxis",value:function horizontalAxis(rows,encoder){return rows?(this._horizontalAxis=setFacetsAndProjections(this,{type:ROW,fields:rows},encoder),this):this._horizontalAxis}},{key:"verticalAxis",value:function verticalAxis(columns,encoder){return columns?(this._verticalAxis=setFacetsAndProjections(this,{type:COL,fields:columns},encoder),this):this._verticalAxis}},{key:"getCellDef",value:function getCellDef(cell){var registry=this.registry();return Object.values(registry).forEach(function(e){e.prototype instanceof cell&&(cell=e)}),cell}},{key:"valueCellsCreator",value:function valueCellsCreator(context){return this.matrixLayers([]),function(datamodel,fieldInfo,facets){return cell_creator_createValueCells(context,datamodel,fieldInfo,facets)}}},{key:"forEach",value:function forEach(matrixType,callback){this[matrixType]().forEach(function(row,rIndex){row.forEach(function(col,cIndex){callback(rIndex,cIndex,col)})})}},{key:"getAllFields",value:function getAllFields(){var retObj=this.projections();return Object.entries(this.facets()).forEach(function(e){retObj[e[0]]=e[1]}),retObj}},{key:"resetSimpleAxes",value:function resetSimpleAxes(){return this.axes({x:new Set,y:new Set})}},{key:"createUnits",value:function createUnits(componentRegistry,config){var globalConfig=config.globalConfig,alias=config.alias,layerRegistry=componentRegistry.layerRegistry,sideEffectRegistry=componentRegistry.sideEffectRegistry,_this$dependencies=this.dependencies(),smartLabel=_this$dependencies.smartlabel,lifeCycleManager=_this$dependencies.lifeCycleManager,units=[[]],unitConfig=function extractUnitConfig(config){var unitConfig={};return["interaction","gridLines","gridBands"].forEach(function(attr){void 0!==config[attr]&&(unitConfig[attr]=config[attr])}),unitConfig}(globalConfig||{}),globalState=visual_unit_VisualUnit.getState()[0],globalStates={},store=this.store();for(var key in this.forEach("valueMatrix",function(i,j,el){var unit=el.source();if(!unit){var namespace="".concat(i).concat(j);unit=visual_unit_VisualUnit.create({layerRegistry:layerRegistry,sideEffectRegistry:sideEffectRegistry},{smartLabel:smartLabel,lifeCycleManager:lifeCycleManager}),globalStates[namespace]=null,unit.metaInf({rowIndex:i,colIndex:j,namespace:namespace}),unit.store(store),el.source(unit)}!units[i]&&(units[i]=[]),units[i][j]=unit,unit.parentAlias(alias),el.config(unitConfig)}),globalState)store.append("".concat(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,".").concat(key),globalStates);return lifeCycleManager.notify({client:units,action:"initialized",formalName:"unit"}),this.units(units)}},{key:"setDomains",value:function setDomains(config,datamodel,encoders){var color=config.color,shape=config.shape,size=config.size,groupBy=config.globalConfig.autoGroupBy,_this$getAllFields=this.getAllFields(),rowFacets=_this$getAllFields.rowFacets,colFacets=_this$getAllFields.colFacets,encoding={color:color,shape:shape,size:size},facetFields=[].concat(matrix_resolver_toConsumableArray(rowFacets.map(function(e){return e.toString()})),matrix_resolver_toConsumableArray(colFacets.map(function(e){return e.toString()}))),retContext={domains:encoders.simpleEncoder.getRetinalFieldsDomain(datamodel,encoding,facetFields,groupBy),axes:this.axes(),encoding:encoding};return encoders.retinalEncoder.setCommonDomain(retContext),this}},{key:"resetFacetsAndProjections",value:function resetFacetsAndProjections(){return this._facets={},this._projections={},this}},{key:"getRetinalAxes",value:function getRetinalAxes(){var _this$axes=this.axes(),color=_this$axes.color,shape=_this$axes.shape,size=_this$axes.size;return{color:matrix_resolver_toConsumableArray(color),shape:matrix_resolver_toConsumableArray(shape),size:matrix_resolver_toConsumableArray(size)}}},{key:"getSimpleAxes",value:function getSimpleAxes(type){return this.axes()["".concat(type)]}},{key:"createRetinalAxes",value:function createRetinalAxes(fieldsConfig,config,encoders){var _this5=this,layerConfig=this.layerConfig();this.optionalProjections(config,layerConfig);var retinalAxes=encoders.retinalEncoder.createAxis({fieldsConfig:fieldsConfig,config:config,axes:this.axes()}),lifeCycleManager=this.dependencies().lifeCycleManager;[enums_constants_COLOR,enums_constants_SHAPE,enums_constants_SIZE].forEach(function(e){_this5.axes()[e]=retinalAxes[e]}),lifeCycleManager.notify({client:this.axes(),action:"initialized",formalName:"axis"}),lifeCycleManager.notify({client:this.units(),action:"beforeupdate",formalName:"unit"});var units=[],matrixLayers=this.matrixLayers();return this.forEach("valueMatrix",function(i,j,el){el.axes(retinalAxes),el.source()&&el.source().retinalFields(config),el.layerDef(encoders.retinalEncoder.getLayerConfig(config,matrixLayers[i][j])),el.updateModel(),units.push(el.source())}),lifeCycleManager.notify({client:units,action:"updated",formalName:"unit"}),this}},{key:"createHeaders",value:function createHeaders(placeholders,fieldNames,config){var bottomLeft=[],bottomRight=[],rows=placeholders.rows,columns=placeholders.columns,_this$dependencies3=this.dependencies(),labelManager=_this$dependencies3.smartlabel,lifeCycleManager=_this$dependencies3.lifeCycleManager,showHeaders=config.showHeaders,classPrefix=config.classPrefix,TextCell=this.getCellDef(this.registry().TextCell),BlankCell=this.getCellDef(this.registry().BlankCell),_rows=matrix_resolver_slicedToArray(rows,2),leftRows=_rows[0],rightRows=_rows[1],_columns=matrix_resolver_slicedToArray(columns,2),topCols=_columns[0],bottomCols=_columns[1],rowHeaders=fieldNames.rows,blankCellCreator=function blankCellCreator(cell){return(new BlankCell).config({show:cell.config().show})},headers={left:group_utils_headerCreator(leftRows,rowHeaders[0],showHeaders?TextCell:BlankCell,{classPrefix:classPrefix,labelManager:labelManager}),right:group_utils_headerCreator(rightRows,rowHeaders[1],showHeaders?TextCell:BlankCell,{classPrefix:classPrefix,labelManager:labelManager})},footers={left:leftRows.length>0?leftRows[0].map(blankCellCreator):[],right:rightRows.length>0?rightRows[0].map(blankCellCreator):[]},_map2=matrix_resolver_slicedToArray([constants_LEFT,constants_RIGHT].map(function(type){return topCols.map(function(col,i){return i===topCols.length-1?headers[type]:footers[type]})}),2),topLeft=_map2[0],topRight=_map2[1];if(0===topCols.length){var _map4=matrix_resolver_slicedToArray([constants_LEFT,constants_RIGHT].map(function(type){return bottomCols.map(function(col,i){return 0===i?headers[type]:footers[type]})}),2);bottomLeft=_map4[0],bottomRight=_map4[1]}else bottomLeft=bottomCols.map(function(){return leftRows.length>0?leftRows[0].map(blankCellCreator):[]}),bottomRight=bottomCols.map(function(){return rightRows.length>0?rightRows[0].map(blankCellCreator):[]});return lifeCycleManager.notify({client:[topLeft,topRight,bottomLeft,bottomRight],action:"initialized",formalName:"facet-headers"}),{topLeft:topLeft,topRight:topRight,bottomLeft:bottomLeft,bottomRight:bottomRight}}},{key:"getMatrices",value:function getMatrices(datamodel,config,componentRegistry,encoders){return cell_creator_computeMatrices({datamodel:datamodel,componentRegistry:componentRegistry,encoders:encoders,resolver:this},config)}},{key:"store",value:function store(){return arguments.length?(this._store=arguments.length<=0?void 0:arguments[0],this):this._store}}]),MatrixResolver}();function value_matrix_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var value_matrix=function(){function ValueMatrix(matrixArr){!function value_matrix_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ValueMatrix);var instancesById={};this.matrix(matrixArr||[]),this.filter(function(){return!0}),this.each(function(el,rIdx,cIdx){var cellValue=el.valueOf();if(cellValue&&cellValue.id){var id=cellValue.id();instancesById[id]={instance:cellValue,rowIndex:rIdx,colIndex:cIdx}}}),this.instancesById(instancesById)}return function value_matrix_createClass(Constructor,protoProps,staticProps){return protoProps&&value_matrix_defineProperties(Constructor.prototype,protoProps),staticProps&&value_matrix_defineProperties(Constructor,staticProps),Constructor}(ValueMatrix,[{key:"instancesById",value:function instancesById(){return arguments.length?(this._instancesById=arguments.length<=0?void 0:arguments[0],this):this._instancesById}},{key:"matrix",value:function matrix(){return arguments.length?(this._matrix=arguments.length<=0?void 0:arguments[0],this):this._matrix}},{key:"filter",value:function filter(){return arguments.length?(this._filterFn=arguments.length<=0?void 0:arguments[0],this):this._filterFn}},{key:"width",value:function width(){var rowWidth=0;return this.matrix().forEach(function(row){var currentRowWidth=0;row.forEach(function(cell){currentRowWidth+=cell.getLogicalSpace().width}),rowWidth=Math.max(rowWidth,currentRowWidth)}),rowWidth}},{key:"height",value:function height(){var rowHeight=0;return this.matrix().forEach(function(row){var currentRowHeight=0;row.forEach(function(cell){currentRowHeight=Math.max(currentRowHeight,cell.getLogicalSpace().height)}),rowHeight+=currentRowHeight}),rowHeight}},{key:"each",value:function each(fn){var matrix=this.matrix(),filterFn=this.filter();return matrix.forEach(function(row,rIndex){row.forEach(function(col,cIndex){filterFn(col)&&fn(col,rIndex,cIndex,matrix)})}),this}},{key:"findPlaceHolderById",value:function findPlaceHolderById(id){return this.instancesById()[id]}}]),ValueMatrix}();function visual_group_helper_slicedToArray(arr,i){return function visual_group_helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function visual_group_helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function visual_group_helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var visual_group_props_PROPS,helper_setMatrixInstances=function setMatrixInstances(context,placeholder){var values=placeholder.values,rows=placeholder.rows,columns=placeholder.columns;return values=values||[],rows=rows||[],columns=columns||[],context._composition.matrices={value:new value_matrix(values),left:new value_matrix(rows[0]),right:new value_matrix(rows[1]),top:new value_matrix(columns[0]),bottom:new value_matrix(columns[1])},context._dependencies.throwback.commit(common_props.MATRIX_CREATED,!0),context},helper_createMatrices=function createMatrices(context){var rows=context.rows(),columns=context.columns(),color=context.color(),datamodel=context.data(),size=context.size(),detail=context.detail(),layers=context.layers(),transform=context.transform(),config=context.config(),shape=context.shape(),resolver=context.resolver();resolver.store(context.store());var matrixConfig={selection:context.selection(),alias:context.alias(),globalConfig:config||{},rows:rows,columns:columns,detail:detail,layers:layers,transform:transform};!function unsubscribeChangeListeners(context){context.store().unsubscribe({namespace:"group",key:"unionDomain"})}(context);var retinalConfig=function sanitizeRetinalConfig(retinalConf){var conf={};for(var key in retinalConf){var confValue=retinalConf[key];conf[key]="string"!=typeof confValue&&confValue?confValue:{field:retinalConf[key]}}return conf}({color:color,shape:shape,size:size});matrixConfig=Object.assign(matrixConfig,retinalConfig);var encoders={};encoders.retinalEncoder=new retinal_encoder_RetinalEncoder,encoders.simpleEncoder=function getEncoder(layers){var encoder=new cartesian_encoder_CartesianEncoder;return layers.length&&(encoder=layers.every(function(e){return"arc"===e.mark})?new polar_encoder_PolarEncoder:encoder),encoder}(layers),resolver.encoder(encoders.simpleEncoder),context.groupType(encoders.simpleEncoder.constructor.type());var fields=encoders.simpleEncoder.fieldSanitizer(datamodel,matrixConfig);encoders.simpleEncoder.setAxisAndHeaders(config?config.axisFrom:{},fields),layers&&resolver.layerConfig(layers),resolver.horizontalAxis(fields.rows,encoders).verticalAxis(fields.columns,encoders);var placeholderInfo=resolver.getMatrices(datamodel,matrixConfig,context.registry(),encoders);return context._groupedDataModel=placeholderInfo.dataModels.groupedModel,context.selection(placeholderInfo.selection),resolver.createRetinalAxes(placeholderInfo.dataModels.parentModel.getFieldsConfig(),retinalConfig,encoders),resolver.setDomains(matrixConfig,placeholderInfo.dataModels,encoders),helper_setMatrixInstances(context,placeholderInfo),context.cornerMatrices(resolver.createHeaders(placeholderInfo,fields,config)),context.placeholderInfo(placeholderInfo),context._composition.axes=resolver.axes(),context.metaData({border:group_utils_getBorders(placeholderInfo,encoders.simpleEncoder)}),resolver.encoder().unionUnitDomains(context),function registerDomainChangeListener(context){context.store().registerChangeListener(["".concat(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,".domain")],function(){context.resolver().encoder().unionUnitDomains(context)},!1,{namespace:"group",key:"unionDomain"})}(context),context};function visual_group_props_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var src_visual_group_props_PROPS=(visual_group_props_defineProperty(visual_group_props_PROPS={alias:{},data:{},cornerMatrices:{defaultValue:{topLeft:[],topRight:[],bottomLeft:[],bottomRight:[]}},groupType:{},metaData:{defaultValue:{border:{}}},placeholderInfo:{defaultValue:{}},resolver:{},registry:{sanitization:function sanitization(context,value){return context.resolver&&context.resolver().registry(value.cellRegistry),value}},selection:{}},"config",{}),visual_group_props_defineProperty(visual_group_props_PROPS,ROWS,{}),visual_group_props_defineProperty(visual_group_props_PROPS,COLUMNS,{}),visual_group_props_defineProperty(visual_group_props_PROPS,enums_constants_COLOR,{}),visual_group_props_defineProperty(visual_group_props_PROPS,enums_constants_SHAPE,{}),visual_group_props_defineProperty(visual_group_props_PROPS,enums_constants_SIZE,{}),visual_group_props_defineProperty(visual_group_props_PROPS,"detail",{}),visual_group_props_defineProperty(visual_group_props_PROPS,"layers",{}),visual_group_props_defineProperty(visual_group_props_PROPS,"transform",{}),visual_group_props_PROPS);function visual_group_typeof(obj){return(visual_group_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function visual_group_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function visual_group_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function visual_group_getPrototypeOf(o){return(visual_group_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function visual_group_setPrototypeOf(o,p){return(visual_group_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function visual_group_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var visual_group=function(_SimpleGroup){function VisualGroup(registry,dependencies){var _this;!function visual_group_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VisualGroup),_this=function visual_group_possibleConstructorReturn(self,call){return!call||"object"!==visual_group_typeof(call)&&"function"!=typeof call?visual_group_assertThisInitialized(self):call}(this,visual_group_getPrototypeOf(VisualGroup).call(this));var componentSubRegistry=registry.componentSubRegistry;return _this._dependencies=dependencies,generateGetterSetters(visual_group_assertThisInitialized(visual_group_assertThisInitialized(_this)),src_visual_group_props_PROPS),generateGetterSetters(visual_group_assertThisInitialized(visual_group_assertThisInitialized(_this)),local_options),_this._composition={},_this._data=[],_this._mount=null,_this._selection={},_this.resolver(new matrix_resolver_MatrixResolver(_this._dependencies)),helper_setMatrixInstances(visual_group_assertThisInitialized(visual_group_assertThisInitialized(_this)),{}),_this.registry({layerRegistry:componentSubRegistry.layerRegistry.get(),cellRegistry:componentSubRegistry.cellRegistry.get()}),_this}return function visual_group_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&visual_group_setPrototypeOf(subClass,superClass)}(VisualGroup,simple_group),function visual_group_createClass(Constructor,protoProps,staticProps){return protoProps&&visual_group_defineProperties(Constructor.prototype,protoProps),staticProps&&visual_group_defineProperties(Constructor,staticProps),Constructor}(VisualGroup,[{key:"store",value:function store(){return arguments.length?(this._store=arguments.length<=0?void 0:arguments[0],function initializeGlobalState(context){var globalState=context.constructor.getState()[0];context.store().append(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,globalState)}(this),function createUnitState(context){var globalState=visual_group_helper_slicedToArray(visual_unit_VisualUnit.getState(),1)[0];context.store().append(namespace_namespaceObject.UNIT_GLOBAL_NAMESPACE,globalState)}(this),function createLayerState(context){var globalState=visual_group_helper_slicedToArray(base_layer_BaseLayer.getState(),1)[0];context.store().append(namespace_namespaceObject.LAYER_GLOBAL_NAMESPACE,globalState)}(this),function setupChangeListeners(context){var store=context.store();store.registerChangeListener(["".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.x")],function(){context.resolver().axes().x.forEach(function(axes){return axes.forEach(function(axis){axis.render()})})}),store.registerChangeListener(["".concat(namespace_namespaceObject.GROUP_GLOBAL_NAMESPACE,".domain.y")],function(){context.resolver().axes().y.forEach(function(axes){return axes.forEach(function(axis){axis.render()})})})}(this),this):this._store}},{key:"matrixInstance",value:function matrixInstance(){return arguments.length?this:this.composition().matrices}},{key:"composition",value:function composition(){return arguments.length?this:this._composition}},{key:"lockModel",value:function lockModel(){return this.store().model.lock(),this}},{key:"unlockModel",value:function unlockModel(){return this.store().model.unlock(),this}},{key:"where",value:function where(variable){return function findInGroup(variable,allFields){var channel=null;return[enums_constants_COLOR,enums_constants_SIZE,enums_constants_SHAPE].forEach(function(e){group_utils_this.store.get(e)&&variable===group_utils_this.store.get(e)[0]&&(channel=e)}),channel?{channel:channel}:([ROW,COL].forEach(function(facetType){allFields["".concat(facetType,"Facets")].forEach(function(e){e.toString()===variable&&(channel={channel:"facet",type:facetType===COL?"column":ROW})})}),channel||([ROW,COL].forEach(function(projType){allFields["".concat(projType,"Projections")].forEach(function(e){e.forEach(function(m){m.toString()===variable&&(channel=projType===COL?X:Y)})})}),channel?{channel:channel}:null))}(variable,this.resolver().getAllFields())}},{key:"getAxes",value:function getAxes(type){return"retinal"===type?this.resolver().getRetinalAxes():this.resolver().getSimpleAxes(type)}},{key:"getCells",value:function getCells(type){return this.resolver()["".concat(type,"Cells")]()}},{key:"getFieldsFromChannel",value:function getFieldsFromChannel(channel){var _this$resolver$getAll=this.resolver().getAllFields(),rowProjections=_this$resolver$getAll.rowProjections,colProjections=_this$resolver$getAll.colProjections;return channel===Y?rowProjections:colProjections}},{key:"getCellsByFacetKey",value:function getCellsByFacetKey(facetKey){var resolver=this.resolver();return resolver.rowCells()[facetKey]||resolver.colCells()[facetKey]||[]}},{key:"getAxesByFacetKey",value:function getAxesByFacetKey(axisType,facetKey){var resolver=this.resolver();return(resolver.rowCells()[facetKey]||resolver.colCells()[facetKey])[0].valueOf().axes()[axisType]||[]}},{key:"serialize",value:function serialize(){var _ref,store=this.store();return visual_group_defineProperty(_ref={},"config",store.get("config")),visual_group_defineProperty(_ref,"mount",store.get("mount")),_ref}},{key:"getGroupByData",value:function getGroupByData(){return this._groupedDataModel}},{key:"createMatrices",value:function createMatrices(){helper_createMatrices(this)}}],[{key:"getState",value:function getState(){return[{domain:{x:{},y:{},radius:{}}},{}]}}]),VisualGroup}();__webpack_require__(1);function behavioural_select_typeof(obj){return(behavioural_select_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function select_toConsumableArray(arr){return function select_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function select_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function select_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function behavioural_select_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function behavioural_select_possibleConstructorReturn(self,call){return!call||"object"!==behavioural_select_typeof(call)&&"function"!=typeof call?function behavioural_select_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function behavioural_select_getPrototypeOf(o){return(behavioural_select_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function behavioural_select_setPrototypeOf(o,p){return(behavioural_select_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var action_behaviour_map_actionBehaviourMap,_propagationBehaviour,behavioural_select_SelectBehaviour=function(_PersistentBehaviour){function SelectBehaviour(){return function behavioural_select_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectBehaviour),behavioural_select_possibleConstructorReturn(this,behavioural_select_getPrototypeOf(SelectBehaviour).apply(this,arguments))}return function behavioural_select_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&behavioural_select_setPrototypeOf(subClass,superClass)}(SelectBehaviour,persistent_PersistentBehaviour),function behavioural_select_createClass(Constructor,protoProps,staticProps){return protoProps&&behavioural_select_defineProperties(Constructor.prototype,protoProps),staticProps&&behavioural_select_defineProperties(Constructor,staticProps),Constructor}(SelectBehaviour,[{key:"setSelectionSet",value:function setSelectionSet(addSet,selectionSet){if(null===addSet)selectionSet.reset();else if(addSet.length){var existingRemoveSet=addSet.filter(function(d){return selectionSet._set[d]===enums_selection_namespaceObject.SELECTION_OLD_EXIT||selectionSet._set[d]===enums_selection_namespaceObject.SELECTION_NEW_EXIT});existingRemoveSet.length?(selectionSet.updateEntry(),selectionSet.add(existingRemoveSet)):(selectionSet.updateExit(),selectionSet.remove(addSet));var exitSet=selectionSet.getSets().exitSet,mergedExitSet=[].concat(select_toConsumableArray(new Set(exitSet[1])),select_toConsumableArray(new Set(exitSet[0]))),completeSetCount=selectionSet.getCompleteSet().length;exitSet[1].length!==completeSetCount&&mergedExitSet.length===completeSetCount&&selectionSet.reset()}else selectionSet.remove(selectionSet.getCompleteSet());return this}}],[{key:"formalName",value:function formalName(){return"select"}}]),SelectBehaviour}();function firebolt_action_behaviour_map_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var firebolt_behaviour_effect_map_behaviourEffectMap,_propagationSideEffec,firebolt_action_behaviour_map_actionBehaviourMap=(firebolt_action_behaviour_map_defineProperty(action_behaviour_map_actionBehaviourMap={},actions_namespaceObject.DRAG,{target:".".concat("muze","-gradient-rect"),behaviours:[behaviours_namespaceObject.BRUSH]}),firebolt_action_behaviour_map_defineProperty(action_behaviour_map_actionBehaviourMap,actions_namespaceObject.HOVER,{target:[".".concat("muze","-legend-columns")],behaviours:[behaviours_namespaceObject.HIGHLIGHT]}),firebolt_action_behaviour_map_defineProperty(action_behaviour_map_actionBehaviourMap,actions_namespaceObject.CLICK,{target:[".".concat("muze","-legend-columns")],behaviours:[behaviours_namespaceObject.SELECT]}),action_behaviour_map_actionBehaviourMap),action_behaviour_map_propagationBehaviourMap=(firebolt_action_behaviour_map_defineProperty(_propagationBehaviour={},behaviours_namespaceObject.SELECT,behaviours_namespaceObject.FILTER),firebolt_action_behaviour_map_defineProperty(_propagationBehaviour,behaviours_namespaceObject.BRUSH,behaviours_namespaceObject.HIGHLIGHT),_propagationBehaviour);function firebolt_behaviour_effect_map_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var src_firebolt_behaviour_effect_map_behaviourEffectMap=(firebolt_behaviour_effect_map_defineProperty(firebolt_behaviour_effect_map_behaviourEffectMap={},"brush",["selectionBox",{name:"highlighter",options:{strategy:"fade"}}]),firebolt_behaviour_effect_map_defineProperty(firebolt_behaviour_effect_map_behaviourEffectMap,"highlight",["highlighter"]),firebolt_behaviour_effect_map_defineProperty(firebolt_behaviour_effect_map_behaviourEffectMap,"select",[{name:"highlighter",options:{strategy:"fade"}}]),firebolt_behaviour_effect_map_behaviourEffectMap),propagationSideEffects=(firebolt_behaviour_effect_map_defineProperty(_propagationSideEffec={},"brush",[{name:"highlighter",options:{strategy:"fade"}}]),firebolt_behaviour_effect_map_defineProperty(_propagationSideEffec,"highlight",[{name:"highlighter",options:{strategy:"fade"}}]),firebolt_behaviour_effect_map_defineProperty(_propagationSideEffec,"select",["filter"]),_propagationSideEffec),SCALE_FUNCTIONS={size:"getSize",shape:"getShape",color:"getColor"},VALUE="value";function src_firebolt_helper_toConsumableArray(arr){return function src_firebolt_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function src_firebolt_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function src_firebolt_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var helper_propagate=function propagate(firebolt,action,selectionSet){var propagationData,config=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},type=firebolt.context.constructor.type(),payload=config.payload,data=firebolt.context.data(),metaData=firebolt.context.metaData(),fieldType=metaData.getData().schema[0].type,propPayload={},sourceId=firebolt.context._id;propPayload.action=action_behaviour_map_propagationBehaviourMap[action]||action,propPayload.sideEffects=propagationSideEffects[action],propPayload.sourceCanvas=firebolt.context.canvasAlias();var isMutableAction=firebolt._actions.behavioural[propPayload.action].constructor.mutates();if(null===payload.criteria)propagationData=null;else{var entrySet=selectionSet.mergedEnter,values=data.filter(function(d){return-1!==entrySet.uids.indexOf(d.id)}).map(function(d){return d.value});if("step"===type||"discrete"===type&&"measure"===fieldType){var field=Object.keys(payload.criteria||{})[0];propagationData=(values=data.filter(function(d){return-1!==entrySet.uids.indexOf(d.id)}).map(function(d){return d.range})).length?metaData.select(function(fields){for(var check=!1,i=0;i<values.length&&!0!==(check=fields[field].value>=values[i][0]&&fields[field].value<=values[i][1]);i++);return check},{saveChild:!1}):null}else"gradient"===type?propagationData=getDataModelFromRange(metaData,payload.criteria):values.length?propagationData=function assembleModelFromIdentifiers(model,identifiers){var data,schema=[],fieldMap=model.getFieldsConfig();return identifiers.length?function(){for(var fields=identifiers[0],len=fields.length,i=0;i<len;i++){var field=fields[i],fieldObj=fieldMap[field]&&Object.assign({},fieldMap[field].def);fieldObj&&schema.push(Object.assign(fieldObj))}data=[];for(var header=identifiers[0],_loop=function _loop(_i2){var temp={};identifiers[_i2].forEach(function(fieldVal,cIdx){temp[header[cIdx]]=fieldVal}),data.push(temp)},_i2=1;_i2<identifiers.length;_i2+=1)_loop(_i2)}():(data=[],schema=[]),new model.constructor(data,schema)}(metaData,[payload.criteria[0]].concat(src_firebolt_helper_toConsumableArray(values.map(function(d){return[d]})))):(propPayload.criteria=null,propagationData=metaData.select(function(){return!0},{saveChild:!1}))}var propagateInterpolatedValues=!1;propagationData&&(propagateInterpolatedValues=propagationData.getSchema().every(function(d){return"measure"===d.type}));var propConfig={sourceId:"legend-".concat(sourceId),payload:propPayload,criteria:null===propPayload.criteria?null:propagationData,isMutableAction:isMutableAction,propagateInterpolatedValues:propagateInterpolatedValues,action:propPayload.action};metaData.propagate(propagationData,propConfig,!0)};function legend_firebolt_typeof(obj){return(legend_firebolt_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function legend_firebolt_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function legend_firebolt_possibleConstructorReturn(self,call){return!call||"object"!==legend_firebolt_typeof(call)&&"function"!=typeof call?function legend_firebolt_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function legend_firebolt_getPrototypeOf(o){return(legend_firebolt_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function legend_firebolt_setPrototypeOf(o,p){return(legend_firebolt_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var legend_firebolt_LegendFireBolt=function(_Firebolt){function LegendFireBolt(){var _getPrototypeOf2,_this;!function legend_firebolt_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LegendFireBolt);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=legend_firebolt_possibleConstructorReturn(this,(_getPrototypeOf2=legend_firebolt_getPrototypeOf(LegendFireBolt)).call.apply(_getPrototypeOf2,[this].concat(params)))).initializeSideEffects(),_this}return function legend_firebolt_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&legend_firebolt_setPrototypeOf(subClass,superClass)}(LegendFireBolt,firebolt_Firebolt),function legend_firebolt_createClass(Constructor,protoProps,staticProps){return protoProps&&legend_firebolt_defineProperties(Constructor.prototype,protoProps),staticProps&&legend_firebolt_defineProperties(Constructor,staticProps),Constructor}(LegendFireBolt,[{key:"getPropagationSelectionSet",value:function getPropagationSelectionSet(selectionSet){return selectionSet[0]}},{key:"propagate",value:function propagate(behaviourName,payload,selectionSet){helper_propagate(this,behaviourName,selectionSet,{payload:payload})}},{key:"getAddSetFromCriteria",value:function getAddSetFromCriteria(criteria){var values,uniqueIds,type=this.context.constructor.type();return null===criteria?uniqueIds=null:"step"===type?(values=Object.values(criteria),uniqueIds=this.context.data().filter(function(d){return-1!==values.indexOf(d.range)}).map(function(d){return d.id})):"gradient"===type?uniqueIds=[]:(values=criteria[1])?uniqueIds=this.context.data().filter(function(d){return-1!==values.indexOf(d.value)}).map(function(d){return d.id}):(values=Object.values(criteria),uniqueIds=this.context.data().filter(function(d){return-1!==values.indexOf(d.range)}).map(function(d){return d.id})),{uids:uniqueIds,model:null}}},{key:"getFullData",value:function getFullData(){return null}}]),LegendFireBolt}();function drag_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var physical_physicalActions,firebolt_physical_hover=function hover(firebolt){return function(targetEl,behaviours){var dispatchBehaviour=function dispatchBehaviour(args){var event=renderer_utils_getEvent(),payload={criteria:firebolt.context.getCriteriaFromData(args)};behaviours.forEach(function(behaviour){return firebolt.dispatchBehaviour(behaviour,payload)}),event.stopPropagation()};targetEl.on("mouseover",dispatchBehaviour).on("mousemove",dispatchBehaviour).on("mouseout",function(){var event=renderer_utils_getEvent();behaviours.forEach(function(behaviour){return firebolt.dispatchBehaviour(behaviour,{criteria:null})}),event.stopPropagation()})}},firebolt_physical_click=function click(firebolt){return function(targetEl,behaviours){targetEl.on("click",function dispatchBehaviour(args){var payload={criteria:firebolt.context.getCriteriaFromData(args)};behaviours.forEach(function(behaviour){return firebolt.dispatchBehaviour(behaviour,payload)})})}};function firebolt_physical_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var firebolt_physical_physicalActions=(firebolt_physical_defineProperty(physical_physicalActions={},"drag",function drag(firebolt){return function(targetEl,behaviours){var payload,startPos={},endPos={},d3Drag=renderer_utils_getD3Drag(),context=firebolt.context,boundingBox=context.measurement().gradientDimensions,axisType="horizontal"===context.config().align?"x":"y",axisScale=context.axis().source().scale(),rangeShifter=axisScale.range()["x"===axisType?0:1];targetEl.call(d3Drag().on("start",function(){var event=renderer_utils_getEvent();startPos={x:event.x,y:event.y}}).on("drag",function(){var event=renderer_utils_getEvent();(endPos={x:event.x,y:event.y}).x=Math.max(0,Math.min(endPos.x,boundingBox.width)),endPos.y=Math.max(0,Math.min(endPos.y,boundingBox.height)),payload={criteria:drag_defineProperty({},context.fieldName(),[axisScale.invert(startPos[axisType]+2*rangeShifter),axisScale.invert(endPos[axisType]+2*rangeShifter)].sort(function(a,b){return a-b}))},behaviours.forEach(function(behaviour){return firebolt.dispatchBehaviour(behaviour,payload)})}).on("end",function(){var event=renderer_utils_getEvent();(endPos={x:event.x,y:event.y}).x=Math.max(0,Math.min(endPos.x,boundingBox.width)),endPos.y=Math.max(0,Math.min(endPos.y,boundingBox.height)),payload=startPos[axisType]===endPos[axisType]?{criteria:{}}:{criteria:drag_defineProperty({},context.fieldName(),[axisScale.invert(startPos[axisType]+2*rangeShifter),axisScale.invert(endPos[axisType]+2*rangeShifter)].sort(function(a,b){return a-b}))},behaviours.forEach(function(behaviour){return firebolt.dispatchBehaviour(behaviour,payload)})}))}}),firebolt_physical_defineProperty(physical_physicalActions,"hover",firebolt_physical_hover),firebolt_physical_defineProperty(physical_physicalActions,"click",firebolt_physical_click),physical_physicalActions);function selection_box_drag_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var getSelectionCriteria=function getSelectionCriteria(subject,axis,measures){var criteria=[],axisScale=axis.axisScale,axisType=axis.axisType,startPos=measures.startPos,endPos=measures.endPos,selectionBoxMeasure=measures.selectionBoxMeasure,drawingInfMeasure=measures.drawingInfMeasure,offset=measures.offset,subjectStartPoint=subject[axisType];return criteria=startPos[axisType]===endPos[axisType]?[]:subjectStartPoint+selectionBoxMeasure>=drawingInfMeasure+offset?[axisScale.invert(drawingInfMeasure+offset-selectionBoxMeasure),axisScale.invert(drawingInfMeasure+offset)]:subjectStartPoint-offset<offset?[axisScale.invert(2*offset),axisScale.invert(selectionBoxMeasure+2*offset)]:[axisScale.invert(subjectStartPoint),axisScale.invert(subjectStartPoint+selectionBoxMeasure)],"x"===axisType||criteria.reverse(),criteria};__webpack_require__(23);function side_effects_selection_box_typeof(obj){return(side_effects_selection_box_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function side_effects_selection_box_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function side_effects_selection_box_possibleConstructorReturn(self,call){return!call||"object"!==side_effects_selection_box_typeof(call)&&"function"!=typeof call?function side_effects_selection_box_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function side_effects_selection_box_getPrototypeOf(o){return(side_effects_selection_box_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function side_effects_selection_box_setPrototypeOf(o,p){return(side_effects_selection_box_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var side_effects_selection_box=function(_SpawnableSideEffect){function SelectionBox(){return function side_effects_selection_box_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectionBox),side_effects_selection_box_possibleConstructorReturn(this,side_effects_selection_box_getPrototypeOf(SelectionBox).apply(this,arguments))}return function side_effects_selection_box_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&side_effects_selection_box_setPrototypeOf(subClass,superClass)}(SelectionBox,spawnable_SpawnableSideEffect),function side_effects_selection_box_createClass(Constructor,protoProps,staticProps){return protoProps&&side_effects_selection_box_defineProperties(Constructor.prototype,protoProps),staticProps&&side_effects_selection_box_defineProperties(Constructor,staticProps),Constructor}(SelectionBox,[{key:"apply",value:function apply(selectionSet,payload){var x,y,width,height,firebolt=this.firebolt,context=firebolt.context,config=this.config(),axis=context.axis().source(),className="".concat(config.classPrefix,"-").concat(config.className),domain=payload.criteria[firebolt.context.fieldName()],axisScale=axis.scale(),range=domain?[axis.getScaleValue(domain[0]),axis.getScaleValue(domain[1])]:[],axisType="horizontal"===context.config().align?"x":"y",gradientDimension=firebolt.context.measurement().gradientDimensions["x"===axisType?"height":"width"],rangeShifter=axisScale.range()["x"===axisType?0:1],legendGradContainer=context.getDrawingContext().svgContainer,legendSelGroup=makeElement(legendGradContainer,"g",[1],"".concat(config.classPrefix,"-selection-box-group"));"horizontal"===firebolt.context.config().align?(x=range[0]-rangeShifter||0,y=0,width=range[1]-range[0]||0,height=gradientDimension):(x=0,y=range[1]-rangeShifter||0,height=range[0]-range[1]||0,width=gradientDimension);makeElement(legendSelGroup,"rect",[{domain:domain,x:x,y:y,width:width,height:height}],className,{enter:function enterFn(el){!function selectionBoxDrag(firebolt){return function(targetEl,behaviours){var payload,startPos={},endPos={},d3Drag=renderer_utils_getD3Drag(),context=firebolt.context,axisScale=context.axis().source().scale(),axisType="horizontal"===context.config().align?"x":"y",measures={drawingInfMeasure:context.measurement().gradientDimensions["x"===axisType?"width":"height"],offset:axisScale.range()["x"===axisType?0:1]},subject={};targetEl.call(d3Drag().on("start",function(){var event=renderer_utils_getEvent();startPos=function getMousePos(element,event){var boundingClientRect=element.getBoundingClientRect();return{x:event.x-boundingClientRect.x,y:event.y-boundingClientRect.y}}(this,event.sourceEvent),subject=event.subject}).on("drag",function(){var event=renderer_utils_getEvent(),selectionBoxMeasure=subject["x"===axisType?"width":"height"];subject.x+=event.dx,subject.y+=event.dy,measures.selectionBoxMeasure=selectionBoxMeasure,measures.startPos=startPos,measures.endPos=endPos;var criteria=getSelectionCriteria(subject,{axisScale:axisScale,axisType:axisType},measures);payload={criteria:selection_box_drag_defineProperty({},context.fieldName(),criteria),fadeOut:!0},firebolt.dispatchBehaviour(behaviours[0],payload)}).on("end",function(){var event=renderer_utils_getEvent(),selectionBoxMeasure=subject["x"===axisType?"width":"height"];measures.selectionBoxMeasure=selectionBoxMeasure,measures.startPos=startPos,measures.endPos=endPos;var criteria=getSelectionCriteria(event,{axisScale:axisScale,axisType:axisType},measures);payload={criteria:selection_box_drag_defineProperty({},context.fieldName(),criteria),fadeOut:!0,config:{transition:{duration:200}}},firebolt.dispatchBehaviour(behaviours[0],payload)}))}}(firebolt)(el,["brush"])}}).attr("y",y).attr("x",x).attr("width",width).attr("height",height)}}],[{key:"formalName",value:function formalName(){return"selectionBox"}},{key:"defaultConfig",value:function defaultConfig(){return{className:"legend-selection-box",classPrefix:"muze"}}}]),SelectionBox}(),legend_highlighter_strategies_strategies=function strategies(firebolt){var context=firebolt.context,classed=function classed(set,className,change){var classPrefix=context.config().classPrefix;renderer_utils_selectElement(context.mount()).selectAll(".".concat(classPrefix,"-legend-columns")).filter(function(d){return-1!==set.uids.indexOf(d.id)}).selectAll("div").classed(className,change)};return{fade:function fade(set){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},classPrefix=context.config().classPrefix;set.mergedEnter.length||set.mergedExit.length?(classed(set.mergedExit,config.className||"".concat(classPrefix,"-legend-brighten"),!1),classed(set.mergedExit,config.className||"".concat(classPrefix,"-legend-fadeout"),!0),classed(set.mergedEnter,config.className||"".concat(classPrefix,"-legend-fadeout"),!1)):classed(set.completeSet,config.className||"".concat(classPrefix,"-legend-fadeout"),!1)},brighten:function brighten(set){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},classPrefix=context.config().classPrefix;set.mergedEnter.length||set.mergedExit.length?(classed(set.mergedEnter,config.className||"".concat(classPrefix,"-legend-brighten"),!0),classed(set.mergedExit,config.className||"".concat(classPrefix,"-legend-brighten"),!1)):classed(set.completeSet,config.className||"".concat(classPrefix,"-legend-brighten"),!1)}}};function legend_highlighter_typeof(obj){return(legend_highlighter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function legend_highlighter_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function legend_highlighter_possibleConstructorReturn(self,call){return!call||"object"!==legend_highlighter_typeof(call)&&"function"!=typeof call?function legend_highlighter_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function legend_highlighter_getPrototypeOf(o){return(legend_highlighter_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function legend_highlighter_setPrototypeOf(o,p){return(legend_highlighter_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var legend_highlighter_LegendHighlighter=function(_GenericSideEffect){function LegendHighlighter(){var _getPrototypeOf2,_this;!function legend_highlighter_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LegendHighlighter);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=legend_highlighter_possibleConstructorReturn(this,(_getPrototypeOf2=legend_highlighter_getPrototypeOf(LegendHighlighter)).call.apply(_getPrototypeOf2,[this].concat(params))))._strategies=legend_highlighter_strategies_strategies(_this.firebolt),_this._strategy="brighten",_this}return function legend_highlighter_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&legend_highlighter_setPrototypeOf(subClass,superClass)}(LegendHighlighter,generic),function legend_highlighter_createClass(Constructor,protoProps,staticProps){return protoProps&&legend_highlighter_defineProperties(Constructor.prototype,protoProps),staticProps&&legend_highlighter_defineProperties(Constructor,staticProps),Constructor}(LegendHighlighter,[{key:"apply",value:function apply(selectionSet,payload){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,this._strategies[options.strategy||this._strategy])(selectionSet,this)}}],[{key:"formalName",value:function formalName(){return"highlighter"}}]),LegendHighlighter}(),legend_props_PROPS={config:{sanitization:function sanitization(context,value){return mergeRecursive(context._config||{},value)}},data:{},fieldName:{},legendContainer:{},measurement:{sanitization:function sanitization(context,value){var measurement=mergeRecursive(context._measurement,value);return["padding","border","margin"].forEach(function(space){measurement[space]=Math.min(measurement[space]>0?measurement[space]:0,.1*measurement.maxWidth,.1*measurement.maxHeight)}),measurement}},logicalSpace:{},metaData:{},range:{sanitization:function sanitization(context,value){return context.scale().range(value),context.resetLogicalSpace(),context.store().commit("range",value),value}},scale:{},smartTicks:{},store:{},title:{sanitization:function sanitization(context,value){return mergeRecursive(context._title||{},value)}}},ALIGN_HORIZONTAL="horizontal",ALIGN_VERTICAL="vertical",DEFAULT_MEASUREMENT={height:30,width:30,maxWidth:1/0,maxHeight:1/0,padding:2,margin:2,border:1},LEGEND_TITLE={text:"",orientation:function orientation(pos){return"left"===pos||"right"===pos?"left":"center"}},legend_defaults_DEFAULT_CONFIG={classPrefix:"muze",borderStyle:"solid",borderColor:"rgba(0,0,0,0)",formatter:{bounds:{lower:"less than",upper:"more than"}},item:{text:{orientation:"right",width:10,formatter:function formatter(val){return val}},icon:{className:"legend-icon",height:20,width:20,color:"rgba(0,0,0,.5)",type:"square"}}},defaults_ICON_MAP=function ICON_MAP(icon){return icon&&"string"==typeof icon?common_utils_getSymbol(icon):icon};function legend_helper_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var legend_helper_getScaleInfo=function getScaleInfo(scale){var scaleType=scale.constructor.type();return{scaleType:scaleType,domain:scale.uniqueValues(),steps:scale.config().stops||1,scaleFn:SCALE_FUNCTIONS[scaleType]}},legend_helper_getInterpolatedData=function getInterpolatedData(domain,steps){for(var domainForLegend=[],interpolatedFn=common_utils_numberInterpolator()(domain[0],domain[1]),i=0;i<=steps;i++)domainForLegend[i]=interpolatedFn(i/steps);return domainForLegend},getDomainBounds=function getDomainBounds(type,scaleInfo,domainInfo){var _ref,scaleFn=scaleInfo.scaleFn,scaleType=scaleInfo.scaleType,scale=scaleInfo.scale,domain=domainInfo.domain,domainBounds=domainInfo.domainBounds,domainLeg=domainInfo.domainLeg,steps=domainInfo.steps,ele=domain["lower"===type?0:domain.length-1],step=steps["lower"===type?0:steps.length-1];return legend_helper_defineProperty(_ref={},scaleType,"size"===scaleType?scale[scaleFn](ele)*scale.getScaleFactor():scale[scaleFn](ele)),legend_helper_defineProperty(_ref,"value",domainBounds[type]),legend_helper_defineProperty(_ref,"id","lower"===type?0:domainLeg.length+2),legend_helper_defineProperty(_ref,"range",[ele,step]),_ref};function simple_legend_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _legendOrientation,_positionConfig,_alignmentMap,_itemStack,simple_legend_SimpleLegend=function(){function SimpleLegend(dependencies){!function simple_legend_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleLegend),this._data=[],this._metaData=[],this._mount=null,this._fieldName=null,this._title=Object.assign({},LEGEND_TITLE),this._metaData=null,this._labelManager=dependencies.labelManager,this._cells=dependencies.cells,this._id=getUniqueId(),this._measurement=Object.assign({},this.constructor.defaultMeasurement()),this._config=mergeRecursive({},this.constructor.defaultConfig()),generateGetterSetters(this,legend_props_PROPS),this._computedStyle=renderer_utils_getSmartComputedStyle(renderer_utils_selectElement("body"),"".concat(this.config().classPrefix,"-legend-item-info")),this._firebolt=new legend_firebolt_LegendFireBolt(this,{behavioural:Object.assign({},behavioural_namespaceObject,firebolt_behavioural_namespaceObject),physical:firebolt_physical_physicalActions,physicalBehaviouralMap:firebolt_action_behaviour_map_actionBehaviourMap},firebolt_side_effects_namespaceObject,src_firebolt_behaviour_effect_map_behaviourEffectMap)}return function simple_legend_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_legend_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_legend_defineProperties(Constructor,staticProps),Constructor}(SimpleLegend,[{key:"id",value:function id(){return this._id}},{key:"firebolt",value:function firebolt(){return arguments.length?this:this._firebolt}},{key:"elemType",value:function elemType(){return"path"}},{key:"canvasAlias",value:function canvasAlias(){return arguments.length?(this._canvasAlias=arguments.length<=0?void 0:arguments[0],this):this._canvasAlias}},{key:"mount",value:function mount(){return arguments.length?(this._mount=arguments.length<=0?void 0:arguments[0],this.render(),this):this._mount}},{key:"getLabelSpaces",value:function getLabelSpaces(){var _this$config=this.config(),item=_this$config.item,classPrefix=_this$config.classPrefix;return this._labelManager.setStyle(renderer_utils_getSmartComputedStyle(renderer_utils_selectElement("body"),"".concat(classPrefix,"-legend-item-info"))),function getItemMeasures(data,prop,labelManager,formatter){var space=[];return data.forEach(function(item,index){var value=prop?item[prop]:item,_labelManager$getOriS=labelManager.getOriSize(formatter(value)),height=_labelManager$getOriS.height,width=_labelManager$getOriS.width;space[index]={height:height+1,width:width+1}}),space}(this.data(),VALUE,this._labelManager,item.text.formatter)}},{key:"setLegendMeasures",value:function setLegendMeasures(){var _this$measurement=this.measurement(),width=_this$measurement.width,height=_this$measurement.height,maxWidth=_this$measurement.maxWidth,maxHeight=_this$measurement.maxHeight,padding=_this$measurement.padding,margin=_this$measurement.margin,border=_this$measurement.border,align=this.config().align,effPadding=2*padding,effBorder=2*border,effMargin=2*margin;this.data(this.dataFromScale(this.scale()));var titleSpace=this.getTitleSpace(),titleHeight=titleSpace.height>0?titleSpace.height+effPadding:0,titleWidth=titleSpace.width+effPadding,labelSpaces=this.getLabelSpaces(effPadding,align),_computeItemSpaces=function computeItemSpaces(config,measures,data){var totalHeight=0,totalWidth=0,maxItemSpaces={width:0,height:0},effPadding=measures.effPadding,titleWidth=measures.titleWidth,labelSpaces=measures.labelSpaces,titleHeight=measures.titleHeight,maxWidth=measures.maxWidth,item=config.item,align=config.align,icon=item.icon,textOrientation=item.text.orientation,itemSpaces=[],iconSpaces=[],maxIconWidth=0;return labelSpaces.forEach(function(labelSpace,i){var itemSpace={width:0,height:0},iconSpace={width:0,height:0},datum=data[i]||{};"left"===textOrientation||"right"===textOrientation?(labelSpace.width+=effPadding,iconSpace.width=(datum.size?2*Math.sqrt(datum.size/Math.PI):icon.width)+effPadding,maxIconWidth=Math.max(iconSpace.width,maxIconWidth),itemSpace.width=labelSpace.width+maxIconWidth,labelSpace.height=Math.max(labelSpace.height,icon.height)+effPadding,iconSpace.height=labelSpace.height,itemSpace.height=labelSpace.height):(labelSpace.width=Math.max(labelSpace.width,datum.size?2*Math.sqrt(datum.size/Math.PI):icon.width)+effPadding,iconSpace.width=labelSpace.width,itemSpace.width=labelSpace.width,maxIconWidth=Math.max(iconSpace.width,maxIconWidth),labelSpace.height+=effPadding,iconSpace.height=icon.height+effPadding,itemSpace.height=labelSpace.height+iconSpace.height),"horizontal"===align?totalHeight=Math.max(totalHeight,itemSpace.height):(totalHeight+=itemSpace.height,totalWidth=Math.max(totalWidth,itemSpace.width,titleWidth)+effPadding),maxItemSpaces={width:Math.max(itemSpace.width,maxItemSpaces.width),height:Math.max(itemSpace.height,maxItemSpaces.height)},itemSpaces.push(itemSpace),iconSpaces.push(iconSpace)}),itemSpaces.forEach(function(itemSpace,i){if("horizontal"===align)itemSpace.height=totalHeight,iconSpaces[i].width=maxIconWidth,"left"===textOrientation||"right"===textOrientation?(labelSpaces[i].height=totalHeight,iconSpaces[i].height=totalHeight,itemSpaces[i].width=labelSpaces[i].width+maxIconWidth):(labelSpaces[i].width=maxIconWidth,itemSpaces[i].width=maxIconWidth,labelSpaces[i].width=maxIconWidth),totalWidth=Math.max(totalWidth+itemSpaces[i].width);else if(itemSpace.width=Math.max(totalWidth,maxWidth),"top"===textOrientation||"bottom"===textOrientation)labelSpaces[i].width=totalWidth,iconSpaces[i].width=totalWidth,maxIconWidth=totalWidth;else{var labelWidth=labelSpaces[i].width,newLabelWidth=maxItemSpaces.width-maxIconWidth;iconSpaces[i].width=maxIconWidth,itemSpaces[i].width=labelSpaces[i].width+maxIconWidth,labelSpaces[i].width=Math.max(labelWidth,newLabelWidth),totalWidth=Math.max(totalWidth,itemSpace.width)+effPadding}}),totalWidth=Math.max(totalWidth,titleWidth),{totalHeight:totalHeight+=titleHeight+effPadding,totalWidth:totalWidth,itemSpaces:itemSpaces,iconSpaces:iconSpaces,maxItemSpaces:maxItemSpaces,maxIconWidth:maxIconWidth}}(this.config(),{effPadding:effPadding,titleWidth:titleWidth,labelSpaces:labelSpaces,titleHeight:titleHeight,maxWidth:maxWidth,maxHeight:maxHeight},this.data()),totalHeight=_computeItemSpaces.totalHeight,totalWidth=_computeItemSpaces.totalWidth,itemSpaces=_computeItemSpaces.itemSpaces,iconSpaces=_computeItemSpaces.iconSpaces,maxItemSpaces=_computeItemSpaces.maxItemSpaces,maxIconWidth=_computeItemSpaces.maxIconWidth;return this.measurement({width:Math.max(totalWidth,width)+effMargin+effBorder,height:Math.max(totalHeight,height)+effMargin+effBorder,labelSpaces:labelSpaces,iconSpaces:iconSpaces,itemSpaces:itemSpaces,maxItemSpaces:maxItemSpaces,maxIconWidth:maxIconWidth,titleSpaces:{width:Math.min(maxWidth,this.measurement().width)-effMargin-effBorder,height:titleHeight}}),this}},{key:"getTitleSpace",value:function getTitleSpace(){return this._labelManager.setStyle(renderer_utils_getSmartComputedStyle(renderer_utils_selectElement("body"),"".concat(this.config().classPrefix,"-legend-title"))),this._labelManager.getOriSize(this.title().text?this.title().text:"")}},{key:"renderTitle",value:function renderTitle(container){var _this$measurement2=this.measurement(),titleSpaces=_this$measurement2.titleSpaces,border=_this$measurement2.border,padding=_this$measurement2.padding,width=_this$measurement2.width,maxWidth=_this$measurement2.maxWidth,_this$config3=this.config(),borderStyle=_this$config3.borderStyle,borderColor=_this$config3.borderColor;return function titleCreator(container,title,measurement,config){var titleWidth=Math.min(measurement.maxWidth,measurement.width),titleContainer=makeElement(container,"table",[1],"".concat(config.classPrefix,"-legend-title")).style("width","".concat(titleWidth,"px")).style("height","".concat(measurement.height,"px")).style("border-bottom","".concat(measurement.border,"px ").concat(config.borderStyle," ").concat(config.borderColor)).style("text-align",title.orientation instanceof Function?title.orientation(config.position):title.orientation);return makeElement(titleContainer,"td",[1],"".concat(config.classPrefix,"-legend-title-text")).style("width","".concat(titleWidth,"px")).style("max-width","".concat(titleWidth,"px")).style("height","100%").style("line-height",1).style("padding","".concat(measurement.padding,"px")).text(title.text).style("overflow-x","scroll").node()}(container,this.title(),{height:titleSpaces.height,width:width,maxWidth:maxWidth,border:border,padding:padding,borderStyle:borderStyle,borderColor:borderColor},this.config())}},{key:"render",value:function render(){var firebolt=this.firebolt(),_this$config4=this.config(),classPrefix=_this$config4.classPrefix,borderStyle=_this$config4.borderStyle,borderColor=_this$config4.borderColor,_this$measurement3=this.measurement(),maxWidth=_this$measurement3.maxWidth,maxHeight=_this$measurement3.maxHeight,width=_this$measurement3.width,height=_this$measurement3.height,margin=_this$measurement3.margin,border=_this$measurement3.border,legendContainer=makeElement(renderer_utils_selectElement(this.mount()),"div",[1],"".concat(classPrefix,"-legend-box"));return legendContainer.classed("".concat(classPrefix,"-legend-box-").concat(this._id),!0),legendContainer.style("float","left"),legendContainer.style("width","".concat(Math.min(maxWidth,width)-2*margin,"px")).style("height","".concat(Math.min(maxHeight,height)-2*margin,"px")).style("margin","".concat(margin,"px")).style("border","".concat(border,"px ").concat(borderStyle," ").concat(borderColor)),this.legendContainer(legendContainer.node()),this.renderTitle(legendContainer),firebolt.createSelectionSet(this.data().map(function(d){return d.id})),legendContainer}},{key:"getCriteriaFromData",value:function getCriteriaFromData(data){var fieldName=this.fieldName();return"measure"===this.metaData().getData().schema[0].type?function simple_legend_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},fieldName,data.range):[[fieldName],[data.value]]}}],[{key:"create",value:function create(dependencies){return new SimpleLegend(dependencies)}},{key:"defaultConfig",value:function defaultConfig(){return legend_defaults_DEFAULT_CONFIG}},{key:"defaultMeasurement",value:function defaultMeasurement(){return DEFAULT_MEASUREMENT}}]),SimpleLegend}();function position_config_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var legendOrientation=(position_config_defineProperty(_legendOrientation={},"horizontal",{datasets:function datasets(data){return{row:[1],column:data}},itemContainerMeasures:function itemContainerMeasures(measurement){var itemSpaces=measurement.itemSpaces,width=measurement.width;return{row:{width:"".concat(width,"px"),padding:"".concat(0,"px")},column:{width:function width(d,i){return"".concat(itemSpaces[i].width,"px")},padding:"".concat(0,"px")}}},getStepSpacesInfo:function getStepSpacesInfo(measurement){var maxItemSpaces=measurement.maxItemSpaces;return{iconHeight:measurement.height,iconWidth:maxItemSpaces.width,stepPadding:{horizontal:!0,vertical:!1}}}}),position_config_defineProperty(_legendOrientation,"vertical",{datasets:function datasets(data){return{row:data,column:function column(d){return[d]}}},itemContainerMeasures:function itemContainerMeasures(measurement,config){var width=measurement.width,padding=config.padding;return{row:{width:"".concat(width,"px"),padding:"".concat(padding,"px")},column:{width:"".concat(width,"px"),padding:"".concat(0,"px")}}},getStepSpacesInfo:function getStepSpacesInfo(measurement){var maxItemSpaces=measurement.maxItemSpaces,width=measurement.width;return{iconHeight:maxItemSpaces.height,iconWidth:width,stepPadding:{horizontal:!1,vertical:!0}}}}),_legendOrientation),positionConfig=(position_config_defineProperty(_positionConfig={},"left",legendOrientation.vertical),position_config_defineProperty(_positionConfig,"right",legendOrientation.vertical),position_config_defineProperty(_positionConfig,"top",legendOrientation.horizontal),position_config_defineProperty(_positionConfig,"bottom",legendOrientation.horizontal),_positionConfig),alignmentMap=(position_config_defineProperty(_alignmentMap={},"left","end"),position_config_defineProperty(_alignmentMap,"right","start"),position_config_defineProperty(_alignmentMap,"top","center"),position_config_defineProperty(_alignmentMap,"bottom","center"),_alignmentMap),itemStack=(position_config_defineProperty(_itemStack={},"left",[VALUE,"shape"]),position_config_defineProperty(_itemStack,"right",["shape",VALUE]),position_config_defineProperty(_itemStack,"top",[VALUE,"shape"]),position_config_defineProperty(_itemStack,"bottom",["shape",VALUE]),_itemStack),renderer_createLegendSkeleton=function createLegendSkeleton(context,container,classPrefix,data){var gradWidth,gradHeight,maxGradHeight,maxGradWidth,measurement=context.measurement(),margin=measurement.margin,border=measurement.border,titleSpaces=measurement.titleSpaces,width=measurement.width,height=measurement.height,maxWidth=measurement.maxWidth,maxHeight=measurement.maxHeight;gradHeight=height-(titleSpaces.height+2*margin+2*border),gradWidth=width-(2*margin+2*border),maxGradHeight=maxHeight-(titleSpaces.height+2*margin+2*border),maxGradWidth=maxWidth-(2*margin+2*border);var legendBody=makeElement(container,"div",[1],"".concat(classPrefix,"-legend-body"));return legendBody.select(".".concat(classPrefix,"-legend-overflow")).remove(),maxGradWidth&&maxGradWidth<gradWidth&&(legendBody=legendBody.style("width","".concat(maxGradWidth,"px")).style("overflow-x","scroll")),maxGradHeight&&maxGradHeight<gradHeight&&legendBody.style("height","".concat(maxGradHeight,"px")).style("overflow-y","scroll"),(legendBody=makeElement(legendBody,"div",[1],"".concat(classPrefix,"-legend-overflow"))).style("width","".concat(gradWidth,"px")),legendBody.style("height","".concat(gradHeight,"px")),{legendItem:function getItemContainers(container,data,legendInstance){var measurement=legendInstance.measurement(),config=legendInstance.config(),itemSpaces=measurement.itemSpaces,classPrefix=config.classPrefix,position=config.position,positionObj=positionConfig[position],datasets=positionObj.datasets(data),measures=positionObj.itemContainerMeasures(measurement,config),rows=makeElement(container,"div",datasets.row,"".concat(classPrefix,"-legend-row"));rows.style("height",function(d,i){return"".concat(itemSpaces[i].height,"px")}),rows.style("width",measures.row.width),rows.style("padding",measures.row.padding);var columns=makeElement(rows,"div",datasets.column,"".concat(classPrefix,"-legend-columns"));return columns.style("width",measures.column.width),columns.style("padding",measures.column.padding),columns}(legendBody,data,context)}},renderer_createItemSkeleton=function createItemSkeleton(context,container){var _context$config=context.config(),classPrefix=_context$config.classPrefix,textOrientation=_context$config.item.text.orientation,stack=itemStack[textOrientation],itemSkeleton=makeElement(container,"div",function(d,i){return stack.map(function(e){return[e,d[e],d.color,d.size,d.value,context.fieldName(),i]})},"".concat(classPrefix,"-legend-item-info")),alignClass=alignmentMap[textOrientation];return itemSkeleton.classed(alignClass,!0),{itemSkeleton:itemSkeleton}},renderer_applyItemStyle=function applyItemStyle(item,measureType,stepColorCheck,context){var _context$measurement=context.measurement(),padding=_context$measurement.padding,labelSpaces=_context$measurement.labelSpaces,iconSpaces=_context$measurement.iconSpaces,maxIconWidth=_context$measurement.maxIconWidth,diff=stepColorCheck?2*-padding:0;return item[0]===VALUE?"".concat(labelSpaces[item[6]][measureType],"px"):"".concat("width"!==measureType||stepColorCheck?iconSpaces[item[6]][measureType]-diff:maxIconWidth,"px")},renderer_renderIcon=function renderIcon(icon,container,datum,context){var classPrefix=context.classPrefix,iconHeight=context.iconHeight,iconWidth=context.iconWidth,maxIconWidth=context.maxIconWidth,padding=context.padding,color=context.color,svg=makeElement(container,"svg",function(f){return[f]},"".concat(classPrefix,"-legend-icon-svg")).attr("width",maxIconWidth).attr("height",iconHeight).style("width","".concat(maxIconWidth,"px")).style("height","".concat(iconHeight,"px"));"rect"!==icon?function createShape(d,elem,defaultIcon,width,height){var groupElement=elem,size=d[3]||Math.min(width,height)*Math.PI,shape=d[1]||defaultIcon;if(shape instanceof Promise)shape.then(function(res){return d.shape=res,createShape(d,elem)});else{if(shape instanceof Element){var newShape=shape.cloneNode(!0);if("img"===newShape.nodeName.toLowerCase()){var src=newShape.src||newShape.href;(newShape=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("href",src)}return renderer_utils_selectElement(newShape).attr("transform","scale(".concat(size/100,")")),renderer_utils_selectElement(groupElement.node().appendChild(newShape))}var pathStr;if("string"==typeof shape)return pathStr=function checkPath(str){return!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(str)&&/[\dz]$/i.test(str)&&str.length>4)}(shape)?shape:defaults_ICON_MAP(shape).size(size)(),makeElement(groupElement,"path",function(data){return[data]}).attr("d",pathStr)}return d[1]="circle",createShape(d,elem,"circle")}(datum,makeElement(svg,"g",[datum[1]],"".concat(classPrefix,"-legend-icon")),datum[3]?"circle":"square",iconWidth,iconHeight).attr("transform","translate(".concat(maxIconWidth/2-padding," ").concat(iconHeight/2,")")).attr("fill",datum[2]||color):makeElement(svg,"rect",[datum[1]],"".concat(classPrefix,"-legend-icon")).attr("x",0).attr("y",0).attr("width",maxIconWidth).attr("height",iconHeight).attr("fill",datum[2]||color)};function discrete_legend_typeof(obj){return(discrete_legend_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function discrete_legend_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function discrete_legend_toConsumableArray(arr){return function discrete_legend_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function discrete_legend_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function discrete_legend_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function discrete_legend_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function discrete_legend_possibleConstructorReturn(self,call){return!call||"object"!==discrete_legend_typeof(call)&&"function"!=typeof call?function discrete_legend_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function discrete_legend_get(target,property,receiver){return(discrete_legend_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function discrete_legend_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=discrete_legend_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function discrete_legend_getPrototypeOf(o){return(discrete_legend_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function discrete_legend_setPrototypeOf(o,p){return(discrete_legend_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var discrete_legend_DiscreteLegend=function(_SimpleLegend){function DiscreteLegend(){return function discrete_legend_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DiscreteLegend),discrete_legend_possibleConstructorReturn(this,discrete_legend_getPrototypeOf(DiscreteLegend).apply(this,arguments))}return function discrete_legend_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&discrete_legend_setPrototypeOf(subClass,superClass)}(DiscreteLegend,simple_legend_SimpleLegend),function discrete_legend_createClass(Constructor,protoProps,staticProps){return protoProps&&discrete_legend_defineProperties(Constructor.prototype,protoProps),staticProps&&discrete_legend_defineProperties(Constructor,staticProps),Constructor}(DiscreteLegend,[{key:"dataFromScale",value:function dataFromScale(scale){var _getScaleInfo=legend_helper_getScaleInfo(scale),scaleType=_getScaleInfo.scaleType,domain=_getScaleInfo.domain,scaleFn=_getScaleInfo.scaleFn,domainForLegend=discrete_legend_toConsumableArray(new Set(domain)),field=this.metaData().getFieldspace().fields[0],_field$schema=field.schema(),type=_field$schema.type,subtype=_field$schema.subtype;return domainForLegend=domainForLegend.map(function(ele,i){var _ref,value=0,range=0;if(type===dist_datamodel.FieldType.MEASURE){range=[value=(+domainForLegend[i]).toFixed(0),(domainForLegend[i+1]?+domainForLegend[i+1]:+value).toFixed(0)]}else{var domainVal=domainForLegend[i];subtype===dist_datamodel.DimensionSubtype.TEMPORAL&&(domainVal=common_utils_formatTemporal(domainForLegend[i],field.minimumConsecutiveDifference())),value=domainVal,range=[domainVal]}return discrete_legend_defineProperty(_ref={},scaleType,scale[scaleFn](ele)),discrete_legend_defineProperty(_ref,"value",value),discrete_legend_defineProperty(_ref,"id",i),discrete_legend_defineProperty(_ref,"range",range),_ref}).filter(function(d){return null!==d.value}),domainForLegend="size"===scaleType?domainForLegend.sort(function(a,b){return a[scaleType]-b[scaleType]}):domainForLegend}},{key:"render",value:function render(){var firebolt=this.firebolt(),data=this.data(),classPrefix=this.config().classPrefix,legendContainer=discrete_legend_get(discrete_legend_getPrototypeOf(DiscreteLegend.prototype),"render",this).call(this,this.mount()),legendItem=renderer_createLegendSkeleton(this,legendContainer,classPrefix,data).legendItem;return function renderDiscreteItem(context,container){var labelManager=context._labelManager,_context$config2=context.config(),item=_context$config2.item,classPrefix=_context$config2.classPrefix,_context$measurement2=context.measurement(),maxIconWidth=_context$measurement2.maxIconWidth,padding=_context$measurement2.padding,_item$icon=item.icon,iconWidth=_item$icon.width,iconHeight=_item$icon.height,color=_item$icon.color,className=_item$icon.className,textOrientation=item.text.orientation,formatter=item.text.formatter;labelManager.useEllipsesOnOverflow(!0),applyStyle(container,{width:function width(d){return renderer_applyItemStyle(d,"width",!1,context)},height:function height(d){return renderer_applyItemStyle(d,"height",!1,context)},"text-align":"center",padding:"".concat(padding,"px")}),labelManager.setStyle(context._computedStyle),container.each(function(d,i){d[0]===VALUE?renderer_utils_selectElement(this).text(formatter(d[1])).style("padding-".concat("right"===textOrientation?"left":"right"),"0px"):(renderer_utils_selectElement(this).classed("".concat(classPrefix,"-").concat(className),!0),renderer_utils_selectElement(this).classed("".concat(classPrefix,"-").concat(className,"-").concat(i),!0),renderer_renderIcon("circle",renderer_utils_selectElement(this),d,{classPrefix:classPrefix,iconWidth:iconWidth,iconHeight:iconHeight,maxIconWidth:maxIconWidth,padding:padding,color:color}))})}(this,renderer_createItemSkeleton(this,legendItem).itemSkeleton),legendContainer.selectAll("div").style("float","left"),firebolt.mapActionsAndBehaviour(),firebolt.createSelectionSet(this.data().map(function(d){return d.id})),legendContainer}}],[{key:"create",value:function create(dependencies){return new DiscreteLegend(dependencies)}},{key:"type",value:function type(){return"discrete"}}]),DiscreteLegend}(),getGradientDomain=function getGradientDomain(data){return"number"==typeof data[0].value?data.reduce(function(accumulator,currentValue){return[Math.min(currentValue.value,accumulator[0]),Math.max(currentValue.value,accumulator[1])]},[Number.MAX_VALUE,Number.MIN_VALUE]):data.map(function(e){return e.value})},gradient_helper_createLegendSkeleton=function createLegendSkeleton(container,classPrefix,data){var domain=getGradientDomain(data),legendContainer=makeElement(container,"div",[1],"".concat(classPrefix,"-legend-body")),legendGradSvg=makeElement(legendContainer,"svg",[1],"".concat(classPrefix,"-gradient")),legendGradCont=makeElement(legendGradSvg,"g",[1],"".concat(classPrefix,"-gradient-group"));return{legendContainer:legendContainer,legendGradCont:legendGradCont,legendGradSvg:legendGradSvg,linearGradient:function makeLinearGradient(container,data,domain){var defs=makeElement(container,"defs",[1]),linearGradient=makeElement(defs,"linearGradient",[1]).attr("id","linear-gradient").attr("x1","0%").attr("y2","0%");return makeElement(linearGradient,"stop",data,"stop-gradient").attr("offset",function(d){return"".concat(100*(d.value-domain[0])/(domain[1]-domain[0]),"%")}).attr("stop-color",function(d){return d.color}),linearGradient}(legendGradSvg,data,domain),legendRect:makeElement(legendGradCont,"rect",[1],"".concat(classPrefix,"-gradient-rect"))}},gradient_helper_renderAxis=function renderAxis(context,container,height,width){var axis=context.axis();axis.setAvailableSpace(width,height),axis.render(container.node()),axis.source().render()};function gradient_legend_typeof(obj){return(gradient_legend_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function gradient_legend_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function gradient_legend_toConsumableArray(arr){return function gradient_legend_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function gradient_legend_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function gradient_legend_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function gradient_legend_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function gradient_legend_possibleConstructorReturn(self,call){return!call||"object"!==gradient_legend_typeof(call)&&"function"!=typeof call?function gradient_legend_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function gradient_legend_get(target,property,receiver){return(gradient_legend_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function gradient_legend_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=gradient_legend_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function gradient_legend_getPrototypeOf(o){return(gradient_legend_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function gradient_legend_setPrototypeOf(o,p){return(gradient_legend_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var gradient_legend_GradientLegend=function(_SimpleLegend){function GradientLegend(){return function gradient_legend_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GradientLegend),gradient_legend_possibleConstructorReturn(this,gradient_legend_getPrototypeOf(GradientLegend).apply(this,arguments))}return function gradient_legend_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&gradient_legend_setPrototypeOf(subClass,superClass)}(GradientLegend,simple_legend_SimpleLegend),function gradient_legend_createClass(Constructor,protoProps,staticProps){return protoProps&&gradient_legend_defineProperties(Constructor.prototype,protoProps),staticProps&&gradient_legend_defineProperties(Constructor,staticProps),Constructor}(GradientLegend,[{key:"axis",value:function axis(){return arguments.length?(this._axis=arguments.length<=0?void 0:arguments[0],this):this._axis}},{key:"dataFromScale",value:function dataFromScale(scale){var domainForLegend=[],_getScaleInfo=legend_helper_getScaleInfo(scale),scaleType=_getScaleInfo.scaleType,domain=_getScaleInfo.domain,steps=_getScaleInfo.steps,scaleFn=_getScaleInfo.scaleFn;return steps instanceof Array?(domain[0]<steps[0]&&(domainForLegend[0]=domain[0]),domainForLegend=[].concat(gradient_legend_toConsumableArray(domainForLegend),gradient_legend_toConsumableArray(steps)),domain[domain.length-1]>steps[steps.length-1]&&domainForLegend.push(domain[1])):domainForLegend=legend_helper_getInterpolatedData(domain,steps-1),(domainForLegend=gradient_legend_toConsumableArray(new Set(domainForLegend)).sort(function(a,b){return a-b})).map(function(ele,i){var _ref,value=domainForLegend[i];return gradient_legend_defineProperty(_ref={},scaleType,"size"===scaleType?scale[scaleFn](ele)*scale.getScaleFactor():scale[scaleFn](Math.floor(ele))),gradient_legend_defineProperty(_ref,"value",+value.toFixed(2)),gradient_legend_defineProperty(_ref,"id",i),_ref}).filter(function(d){return null!==d.value})}},{key:"getLabelSpaces",value:function getLabelSpaces(effPadding){this.config({item:{text:{orientation:this.config().position}}});var axis=function createAxis(context){var data=context.data(),align=context.config().align,AxisCell=context._cells.AxisCell,newAxis=new continous_axis_ContinousAxis({id:"legend-".concat(context._id),orientation:align===ALIGN_VERTICAL?"right":"bottom",style:context._computedStyle,nice:!1,showAxisName:!1,tickValues:data.map(function(d){return d.value}),fixedBaseline:!1,labels:{rotation:0}},{labelManager:context._labelManager});return newAxis.domain(getGradientDomain(data)),newAxis.range([1,1]),(new AxisCell).source(newAxis).config({margin:{left:0,bottom:0,top:0,right:0}})}(this),axisSpace=axis.getLogicalSpace(),space={width:axisSpace.width-effPadding,height:axisSpace.height-effPadding},axisDomainLength=axis.source().domain().length,labelSpaces=new Array(axisDomainLength).fill(space);return this.axis(axis),labelSpaces}},{key:"getDrawingContext",value:function getDrawingContext(){return{svgContainer:this._legendGradientSvg}}},{key:"render",value:function render(){var firebolt=this.firebolt(),legendContainer=gradient_legend_get(gradient_legend_getPrototypeOf(GradientLegend.prototype),"render",this).call(this,this.mount());return function renderGradient(context,container){var gradHeight,gradWidth,_context$config2=context.config(),align=_context$config2.align,classPrefix=_context$config2.classPrefix,item=_context$config2.item,data=context.data(),_createLegendSkeleton=gradient_helper_createLegendSkeleton(container,classPrefix,data),legendContainer=_createLegendSkeleton.legendContainer,legendGradSvg=_createLegendSkeleton.legendGradSvg,legendGradCont=_createLegendSkeleton.legendGradCont,linearGradient=_createLegendSkeleton.linearGradient,legendRect=_createLegendSkeleton.legendRect,labelDim=context.axis().source().getAxisDimensions().tickDimensions,_context$measurement=context.measurement(),padding=_context$measurement.padding,margin=_context$measurement.margin,border=_context$measurement.border,titleSpaces=_context$measurement.titleSpaces,maxItemSpaces=_context$measurement.maxItemSpaces,maxHeight=_context$measurement.maxHeight,maxWidth=_context$measurement.maxWidth,height=_context$measurement.height,width=_context$measurement.width,gradientDimensions={};gradHeight=Math.floor(height-(titleSpaces.height+2*margin+2*border)),gradWidth=Math.floor(width-(2*margin+2*border)),align===ALIGN_HORIZONTAL?(gradientDimensions.height=item.icon.height,gradientDimensions.width=gradWidth-2*padding-labelDim.width/2,linearGradient.attr("x2","100%").attr("y1","0%"),legendGradCont.attr("transform","translate( ".concat(labelDim.width/2," 0)")),gradient_helper_renderAxis(context,legendContainer,gradHeight-item.icon.height-padding,gradWidth-2*padding-1),legendContainer.classed("".concat(classPrefix,"-overflow-x"),width>maxWidth),applyStyle(legendContainer,{height:"".concat(maxItemSpaces.height+border+padding,"px"),width:"".concat(Math.min(width,maxWidth),"px"),padding:"".concat(padding,"px")}),legendRect.attr("height",gradientDimensions.height),legendRect.attr("width",gradientDimensions.width-labelDim.width/2)):(gradientDimensions.height=gradHeight-2*padding-labelDim.height/2,gradientDimensions.width=item.icon.width,linearGradient.attr("x2","0%").attr("y1","100%"),legendGradCont.attr("transform","translate(0 ".concat(labelDim.height/2,")")),gradient_helper_renderAxis(context,legendContainer,gradHeight-2*padding-1,gradWidth-item.icon.width-2*padding),legendContainer.classed("".concat(classPrefix,"-overflow-y"),height>maxHeight),applyStyle(legendContainer,{height:"".concat(Math.min(height,maxHeight),"px"),width:"".concat(width,"px"),padding:"".concat(padding,"px")}),legendRect.attr("height",gradientDimensions.height-labelDim.height/2),legendRect.attr("width",gradientDimensions.width)),applyStyle(legendGradSvg,{height:"".concat(gradientDimensions.height,"px"),width:"".concat(gradientDimensions.width,"px")}),applyStyle(legendRect,{fill:"url(#linear-gradient)"}),legendGradSvg.attr("height",gradientDimensions.height),legendGradSvg.attr("width",gradientDimensions.width),context.measurement({gradientDimensions:gradientDimensions}),context._legendGradientSvg=legendGradSvg}(this,legendContainer),legendContainer.selectAll("div").style("float","left"),firebolt.mapActionsAndBehaviour(),firebolt.createSelectionSet(this.data().map(function(d){return d.id})),legendContainer}},{key:"getCriteriaFromData",value:function getCriteriaFromData(data){return[[this.fieldName()],[data.value]]}}],[{key:"create",value:function create(dependencies){return new GradientLegend(dependencies)}},{key:"type",value:function type(){return"gradient"}}]),GradientLegend}();function step_legend_typeof(obj){return(step_legend_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function step_legend_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function step_legend_toConsumableArray(arr){return function step_legend_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function step_legend_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function step_legend_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function step_legend_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function step_legend_possibleConstructorReturn(self,call){return!call||"object"!==step_legend_typeof(call)&&"function"!=typeof call?function step_legend_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function step_legend_get(target,property,receiver){return(step_legend_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function step_legend_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=step_legend_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function step_legend_getPrototypeOf(o){return(step_legend_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function step_legend_setPrototypeOf(o,p){return(step_legend_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var _LEGEND_TYPE_MAP,step_legend_StepLegend=function(_SimpleLegend){function StepLegend(){return function step_legend_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StepLegend),step_legend_possibleConstructorReturn(this,step_legend_getPrototypeOf(StepLegend).apply(this,arguments))}return function step_legend_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&step_legend_setPrototypeOf(subClass,superClass)}(StepLegend,simple_legend_SimpleLegend),function step_legend_createClass(Constructor,protoProps,staticProps){return protoProps&&step_legend_defineProperties(Constructor.prototype,protoProps),staticProps&&step_legend_defineProperties(Constructor,staticProps),Constructor}(StepLegend,[{key:"dataFromScale",value:function dataFromScale(scale){var domainLeg=[],_getScaleInfo=legend_helper_getScaleInfo(scale),scaleType=_getScaleInfo.scaleType,domain=_getScaleInfo.domain,steps=_getScaleInfo.steps,scaleFn=_getScaleInfo.scaleFn,formatter=this.config().formatter,domainBounds={lower:null,upper:null};if(steps instanceof Array?(domain[0]<steps[0]&&(domainBounds.lower=["".concat(formatter.bounds.lower," ").concat(steps[0])]),domainLeg=[].concat(step_legend_toConsumableArray(domainLeg),step_legend_toConsumableArray(steps)),domain[domain.length-1]>steps[steps.length-1]&&(domainBounds.upper=["".concat(formatter.bounds.upper," ").concat(steps[steps.length-1])])):domainLeg=legend_helper_getInterpolatedData(domain,steps),domainLeg=(domainLeg=step_legend_toConsumableArray(new Set(domainLeg)).sort(function(a,b){return a-b})).map(function(ele,i){var _ref,value=null;return i<domainLeg.length-1&&(value="".concat(ele.toFixed(1)," - ").concat(+domainLeg[i+1].toFixed(1))),step_legend_defineProperty(_ref={},scaleType,"size"===scaleType?scale[scaleFn](ele)*scale.getScaleFactor():scale[scaleFn](ele)),step_legend_defineProperty(_ref,"value",value),step_legend_defineProperty(_ref,"id",i+1),step_legend_defineProperty(_ref,"range",[ele,domainLeg[i+1]]),_ref}).filter(function(d){return null!==d.value}),domainBounds.lower){var lowerBounds=getDomainBounds("lower",{scale:scale,scaleFn:scaleFn,scaleType:scaleType},{domain:domain,steps:steps,domainBounds:domainBounds});domainLeg=[lowerBounds].concat(step_legend_toConsumableArray(domainLeg))}if(domainBounds.upper){var upperBounds=getDomainBounds("upper",{scale:scale,scaleFn:scaleFn,scaleType:scaleType},{domain:domain,steps:steps,domainBounds:domainBounds,domainLeg:domainLeg});domainLeg=[].concat(step_legend_toConsumableArray(domainLeg),[upperBounds])}return domainLeg}},{key:"getLabelSpaces",value:function getLabelSpaces(effPadding,align){return this.config({item:{text:{orientation:this.config().position}}}),step_legend_get(step_legend_getPrototypeOf(StepLegend.prototype),"getLabelSpaces",this).call(this,effPadding,align)}},{key:"elemType",value:function elemType(){return"rect"}},{key:"render",value:function render(){var firebolt=this.firebolt(),_this$config2=this.config(),classPrefix=_this$config2.classPrefix,position=_this$config2.position,data=function stepData(data){var _ref;return position_config_defineProperty(_ref={},"left",data.reverse()),position_config_defineProperty(_ref,"right",data.reverse()),position_config_defineProperty(_ref,"top",data),position_config_defineProperty(_ref,"bottom",data),_ref}(this.data())[position],legendContainer=step_legend_get(step_legend_getPrototypeOf(StepLegend.prototype),"render",this).call(this,this.mount()),legendItem=renderer_createLegendSkeleton(this,legendContainer,classPrefix,data).legendItem;return function renderStepItem(context,container){var labelManager=context._labelManager,_context$config3=context.config(),item=_context$config3.item,position=_context$config3.position,classPrefix=_context$config3.classPrefix,_context$measurement3=context.measurement(),maxItemSpaces=_context$measurement3.maxItemSpaces,maxIconWidth=_context$measurement3.maxIconWidth,padding=_context$measurement3.padding,_item$icon2=item.icon,width=_item$icon2.width,height=_item$icon2.height,color=_item$icon2.color,formatter=item.text.formatter;labelManager.useEllipsesOnOverflow(!0);var _positionConfig$posit=positionConfig[position].getStepSpacesInfo({maxItemSpaces:maxItemSpaces,height:height,width:width}),iconHeight=_positionConfig$posit.iconHeight,iconWidth=_positionConfig$posit.iconWidth,stepPadding=_positionConfig$posit.stepPadding;applyStyle(container,{width:function width(d){return renderer_applyItemStyle(d,"width",stepPadding.horizontal,context)},height:function height(d){return renderer_applyItemStyle(d,"height",stepPadding.vertical,context)},"text-align":"center",padding:"".concat(padding,"px")}),labelManager.setStyle(context._computedStyle),container.each(function(d){d[0]===VALUE?renderer_utils_selectElement(this).text(formatter(d[1])):renderer_renderIcon("rect",renderer_utils_selectElement(this),d,{classPrefix:classPrefix,iconWidth:iconWidth,iconHeight:iconHeight,maxIconWidth:maxIconWidth,color:color})})}(this,renderer_createItemSkeleton(this,legendItem).itemSkeleton),legendContainer.selectAll("div").style("float","left"),firebolt.mapActionsAndBehaviour(),firebolt.createSelectionSet(this.data().map(function(d){return d.id})),legendContainer}},{key:"getCriteriaFromData",value:function getCriteriaFromData(data){return step_legend_defineProperty({},this.fieldName(),data.range)}}],[{key:"create",value:function create(dependencies){return new StepLegend(dependencies)}},{key:"type",value:function type(){return"step"}}]),StepLegend}();function constants_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var PADDING="padding",BORDER="border",MARGIN="margin",TITLE_TEMPLATE_NOT_ALLOWED_TAGS=["script","style"],LEGEND_TYPE_MAP=(constants_defineProperty(_LEGEND_TYPE_MAP={},"".concat("ordinal","-",!0,"-").concat("color"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("ordinal","-",!0,"-").concat("size"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("ordinal","-",!0,"-").concat("shape"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("ordinal","-",!1,"-").concat("color"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("ordinal","-",!1,"-").concat("shape"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("ordinal","-",!1,"-").concat("size"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("linear","-",!1,"-").concat("size"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("linear","-",!0,"-").concat("size"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("linear","-",!1,"-").concat("shape"),discrete_legend_DiscreteLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("linear","-",!0,"-").concat("color"),step_legend_StepLegend),constants_defineProperty(_LEGEND_TYPE_MAP,"".concat("linear","-",!1,"-").concat("color"),gradient_legend_GradientLegend),_LEGEND_TYPE_MAP);function operators_construct(Parent,args,Class){return(operators_construct=function operators_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&operators_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function operators_setPrototypeOf(o,p){return(operators_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function operators_toConsumableArray(arr){return function operators_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function operators_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function operators_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var operators_share=function share(){for(var _len=arguments.length,vars=new Array(_len),_key=0;_key<_len;_key++)vars[_key]=arguments[_key];return operators_construct(composed_vars,operators_toConsumableArray(vars.map(function(variable){return new simple_var_SimpleVariable(variable)})))};function operators_html(strings){for(var htmlCode="",expLn=arguments.length<=1?0:arguments.length-1,i=0;i<expLn;++i)htmlCode+=strings[i]+(i+1<1||arguments.length<=i+1?void 0:arguments[i+1]);htmlCode+=strings[i];var frag=document.createDocumentFragment(),wrapper=document.createElement("div");frag.appendChild(wrapper),wrapper.innerHTML=htmlCode,function treeShakeNode(node){if(node.nodeType===Node.ELEMENT_NODE)if(-1!==TITLE_TEMPLATE_NOT_ALLOWED_TAGS.indexOf(node.tagName.toLowerCase()))node.parentNode.removeChild(node);else{var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=node.childNodes[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)treeShakeNode(_step.value)}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}(wrapper);var innerHTML=wrapper.innerHTML;return function(){return innerHTML}}function action_model_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _localOptions,_canvasOptions,action_model_canvasIterator=function canvasIterator(canvases,iteratorFn,cFn){canvases.forEach(function(canvas){canvas.composition().visualGroup.matrixInstance().value.each(function(cell){return iteratorFn(cell.valueOf().firebolt())}),cFn&&cFn(canvas),canvas._throwback.registerImmediateListener([common_props.MATRIX_CREATED],function listenerFn(canvas,fn){return function(){canvas.composition().visualGroup.matrixInstance().value.each(function(cell){return fn(cell.valueOf().firebolt())})}}(canvas,iteratorFn))})},actionModel=new(function(){function ActionModel(){!function action_model_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ActionModel),this._registrableComponents=[]}return function action_model_createClass(Constructor,protoProps,staticProps){return protoProps&&action_model_defineProperties(Constructor.prototype,protoProps),staticProps&&action_model_defineProperties(Constructor,staticProps),Constructor}(ActionModel,[{key:"for",value:function _for(){for(var _len=arguments.length,components=new Array(_len),_key=0;_key<_len;_key++)components[_key]=arguments[_key];return this._registrableComponents=components,this}},{key:"registerPhysicalActions",value:function registerPhysicalActions(action){return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.registerPhysicalActions(action)},function(canvas){canvas.firebolt().registerPhysicalActions(action)}),this}},{key:"registerBehaviouralActions",value:function registerBehaviouralActions(){for(var _len2=arguments.length,actions=new Array(_len2),_key2=0;_key2<_len2;_key2++)actions[_key2]=arguments[_key2];return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.registerBehaviouralActions(actions)},function(canvas){canvas.firebolt().registerBehaviouralActions(actions)}),this}},{key:"registerPhysicalBehaviouralMap",value:function registerPhysicalBehaviouralMap(map){return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.registerPhysicalBehaviouralMap(map)},function(canvas){canvas.firebolt().registerPhysicalBehaviouralMap(map)}),this}},{key:"registerPropagationBehaviourMap",value:function registerPropagationBehaviourMap(map){return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.registerPropagationBehaviourMap(map)},function(canvas){canvas.firebolt().registerPropagationBehaviourMap(map)}),this}},{key:"mapSideEffects",value:function mapSideEffects(map){return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.mapSideEffects(map)},function(canvas){canvas.firebolt().mapSideEffects(map)}),this}},{key:"registerSideEffects",value:function registerSideEffects(){for(var _len3=arguments.length,sideEffects=new Array(_len3),_key3=0;_key3<_len3;_key3++)sideEffects[_key3]=arguments[_key3];return action_model_canvasIterator(this._registrableComponents,function(firebolt){firebolt.registerSideEffects(sideEffects)},function(canvas){canvas.firebolt().registerSideEffects(sideEffects)}),this}},{key:"dissociateBehaviour",value:function dissociateBehaviour(){for(var _len4=arguments.length,maps=new Array(_len4),_key4=0;_key4<_len4;_key4++)maps[_key4]=arguments[_key4];return action_model_canvasIterator(this._registrableComponents,function(firebolt){maps.forEach(function(val){return firebolt.dissociateBehaviour(val[0],val[1])})},function(canvas){maps.forEach(function(val){return canvas.firebolt().dissociateBehaviour(val[0],val[1])})}),this}},{key:"dissociateSideEffect",value:function dissociateSideEffect(){for(var _len5=arguments.length,maps=new Array(_len5),_key5=0;_key5<_len5;_key5++)maps[_key5]=arguments[_key5];return action_model_canvasIterator(this._registrableComponents,function(firebolt){maps.forEach(function(val){return firebolt.dissociateSideEffect(val[0],val[1])})},function(canvas){maps.forEach(function(val){return canvas.firebolt().dissociateSideEffect(val[0],val[1])})}),this}},{key:"enableCrossInteractivity",value:function enableCrossInteractivity(){var policy=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},registrableComponents=this._registrableComponents,mergedPolicy=mergeRecursive(mergeRecursive({},function defaultPolicy(registrableComponents){var aliases=registrableComponents.map(function(comp){return comp.alias()});return{behaviours:{"*":function _(propagationPayload){var propagationCanvas=propagationPayload.sourceCanvas;return!propagationCanvas||-1!==aliases.indexOf(propagationCanvas)}}}}(registrableComponents)),policy);return registrableComponents.forEach(function(canvas){canvas.firebolt().crossInteractionPolicy(mergedPolicy)}),this}}]),ActionModel}()),TITLE_CONFIG={position:"top",align:"left",padding:3,className:"".concat("muze","-title-container")},SUB_TITLE_CONFIG={position:"top",align:"left",padding:16,maxLines:2,className:"".concat("muze","-subtitle-container")},LAYOUT_ALIGN_LEFT="left";function canvas_local_options_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var localOptions=(canvas_local_options_defineProperty(_localOptions={},"rows",{value:null,meta:{typeCheck:"constructor",typeExpected:"Array"}}),canvas_local_options_defineProperty(_localOptions,"columns",{value:null,meta:{typeCheck:"constructor",typeExpected:"Array"}}),canvas_local_options_defineProperty(_localOptions,"color",{value:null,meta:{typeCheck:"constructor",typeExpected:"Object",sanitization:function sanitization(config){return"string"==typeof config||null===config?{field:config}:config}}}),canvas_local_options_defineProperty(_localOptions,"shape",{value:null,meta:{typeCheck:"constructor",typeExpected:"Object",sanitization:function sanitization(config){return"string"==typeof config||null===config?{field:config}:config}}}),canvas_local_options_defineProperty(_localOptions,"size",{value:null,meta:{typeCheck:"constructor",typeExpected:"Object",sanitization:function sanitization(config){return"string"==typeof config||null===config?{field:config}:config}}}),canvas_local_options_defineProperty(_localOptions,"detail",{value:[],meta:{typeCheck:"constructor",typeExpected:"Array"}}),canvas_local_options_defineProperty(_localOptions,"layers",{value:[],meta:{typeCheck:"constructor",typeExpected:"Array"}}),canvas_local_options_defineProperty(_localOptions,"transform",{value:null,meta:{typeCheck:"constructor",typeExpected:"Object"}}),_localOptions),canvasOptions=(canvas_local_options_defineProperty(_canvasOptions={},"title",{value:[null,null],meta:{typeCheck:["constructor","constructor"],typeExpected:["Function","Object"],spreadParams:!0,sanitization:[function(title){if("string"==typeof title){var t=function t(){return title};return t._sanitized=!0,t}return title},function(titleConfig){var defConfig=mergeRecursive({},TITLE_CONFIG);return mergeRecursive(defConfig,titleConfig)}]}}),canvas_local_options_defineProperty(_canvasOptions,"subtitle",{value:[null,null],meta:{typeCheck:["constructor","constructor"],typeExpected:["Function","Object"],spreadParams:!0,sanitization:[function(subtitle){if("string"==typeof subtitle){var sub=function sub(){return subtitle};return sub._sanitized=!0,sub}return subtitle},function(subtitleConfig){var defConfig=mergeRecursive({},SUB_TITLE_CONFIG);return mergeRecursive(defConfig,subtitleConfig)}]}}),_canvasOptions);function layoutComponent_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var LayoutComponent=function(){function LayoutComponent(name,dimensions,seed){!function layoutComponent_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LayoutComponent),this._seed=seed,this._boundBox={height:dimensions.height,width:dimensions.width,top:null,left:null},this._renderAt=null,this._alignWith=null,this._alignment=null,this._target=null,this._position=null,this._componentName=name,this._className=null}return function layoutComponent_createClass(Constructor,protoProps,staticProps){return protoProps&&layoutComponent_defineProperties(Constructor.prototype,protoProps),staticProps&&layoutComponent_defineProperties(Constructor,staticProps),Constructor}(LayoutComponent,[{key:"getLogicalSpace",value:function getLogicalSpace(){throw new Error("getLogicalSpace is not defined")}},{key:"setSpatialConfig",value:function setSpatialConfig(){throw new Error("setSpatialSpace is not defined")}},{key:"name",value:function name(param){return param&&(this._componentName=param),this._componentName}},{key:"target",value:function target(param){return param&&(this._target=param),this._target}},{key:"position",value:function position(param){return param&&(this._position=param),this._position}},{key:"alignment",value:function alignment(param){return param&&(this._alignment=param),this._alignment}},{key:"alignWith",value:function alignWith(param){return param&&(this._alignWith=param),this._alignWith}},{key:"renderAt",value:function renderAt(param){return param&&(this._renderAt=param),this._renderAt}},{key:"boundBox",value:function boundBox(param){return param&&Object.assign(this._boundBox,param),this._boundBox}},{key:"className",value:function className(param){return param&&(this._className=param),this._className}},{key:"draw",value:function draw(){throw new Error("draw is not defined")}}]),LayoutComponent}();function dummy_component_typeof(obj){return(dummy_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function dummy_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function dummy_component_possibleConstructorReturn(self,call){return!call||"object"!==dummy_component_typeof(call)&&"function"!=typeof call?function dummy_component_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function dummy_component_getPrototypeOf(o){return(dummy_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function dummy_component_setPrototypeOf(o,p){return(dummy_component_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var dummy_component=function(_LayoutComponent){function DummyComponent(){return function dummy_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DummyComponent),dummy_component_possibleConstructorReturn(this,dummy_component_getPrototypeOf(DummyComponent).apply(this,arguments))}return function dummy_component_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&dummy_component_setPrototypeOf(subClass,superClass)}(DummyComponent,LayoutComponent),function dummy_component_createClass(Constructor,protoProps,staticProps){return protoProps&&dummy_component_defineProperties(Constructor.prototype,protoProps),staticProps&&dummy_component_defineProperties(Constructor,staticProps),Constructor}(DummyComponent,[{key:"getLogicalSpace",value:function getLogicalSpace(){return{width:this.boundBox().width,height:this.boundBox().height}}},{key:"setSpatialConfig",value:function setSpatialConfig(conf){return this.boundBox({top:conf.y,left:conf.x}),this.newDimensions={width:conf.width,height:conf.height},this.renderAt(conf.renderAt),this}},{key:"draw",value:function draw(){if(!this.component)throw new Error("Component not set for ".concat(this.componentName));return this.component.mount(document.getElementById(this.renderAt)),this}}]),DummyComponent}(),src_defaults_DEFAULT_CONFIG={classPrefix:"muze",interaction:{sideEffect:"individual"},pagination:"scroll",scrollBar:{thickness:10,speed:2,vertical:{align:"right"},horizontal:{align:"bottom"}},legend:{position:"right",color:{show:!0,padding:1,margin:3,border:1,height:20,width:20},shape:{show:!0,padding:1,margin:3,border:1,height:20,width:20},size:{show:!0,padding:1,margin:3,border:1,height:20,width:20}},showHeaders:!1,minWidth:100,minHeight:100,facet:{rows:{minCharacters:3},columns:{maxLines:2,verticalAlign:"middle",minCharacters:1}},border:{style:"solid",color:"#d6d6d6",width:2,collapse:!0,spacing:0},autoGroupBy:{disabled:!1}},DEFAULT_WIDTH=600,DEFAULT_HEIGHT=400,DEFAULT_CLASS_NAME="".concat(src_defaults_DEFAULT_CONFIG.classPrefix,"-layout-container-component"),NODE_PREFIX="".concat(src_defaults_DEFAULT_CONFIG.classPrefix,"-layout-container");function definitionModel_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var DefinitionModel=function(){function DefinitionModel(config){!function definitionModel_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DefinitionModel),this._host=config.host||null,this._cut=config.cut||null,this._ratioWeight=0===config.ratioWeight?0:config.ratioWeight||1,this._preferred=config.preferred||!1,this._lanes=config.lanes||[],this._remainingHeight=0,this._remainingWidth=0}return function definitionModel_createClass(Constructor,protoProps,staticProps){return protoProps&&definitionModel_defineProperties(Constructor.prototype,protoProps),staticProps&&definitionModel_defineProperties(Constructor,staticProps),Constructor}(DefinitionModel,[{key:"host",value:function host(_host){return _host&&(this._host=_host),this._host}},{key:"preferred",value:function preferred(_preferred){return _preferred&&(this._preferred=_preferred),this._preferred}},{key:"cut",value:function cut(_cut){return _cut&&(this._cut=_cut),this._cut}},{key:"ratioWeight",value:function ratioWeight(_ratioWeight){return _ratioWeight&&(this._ratioWeight=_ratioWeight),this._ratioWeight}},{key:"lanes",value:function lanes(_lanes){return _lanes&&(this._lanes=_lanes),this._lanes}},{key:"remainingHeight",value:function remainingHeight(_remainingHeight){return _remainingHeight&&(this._remainingHeight=_remainingHeight),this._remainingHeight}},{key:"remainingWidth",value:function remainingWidth(_remainingWidth){return _remainingWidth&&(this._remainingWidth=_remainingWidth),this._remainingWidth}}]),DefinitionModel}();var getNodeId=function(){var _uid=0;return function(){return"".concat(NODE_PREFIX,"-").concat(++_uid)}}();function yExtraSpace(node){var smallestHeight=0;if("v"===node.getCutType())smallestHeight=function smallestExtraHeightHorizontally(node){var smallestHeight=Number.MAX_SAFE_INTEGER;return node.children().forEach(function(child){var h=yExtraSpace(child);h<smallestHeight&&(smallestHeight=h)}),smallestHeight}(node);else if("h"===node.getCutType())node.children().forEach(function(child){smallestHeight+=yExtraSpace(child)});else if(node.model().host()&&node.model().host().getLogicalSpace){var containerHeight=node.boundBox().height,hostHeight=node.model().host().getLogicalSpace().height;(smallestHeight=containerHeight-hostHeight)<0&&(smallestHeight=0)}else smallestHeight=0;return smallestHeight}function xExtraSpace(node){var smallestWidth=0;if("h"===node.getCutType())smallestWidth=function smallestExtraWidthVertically(node){var smallestWidth=Number.MAX_SAFE_INTEGER;return node.children().forEach(function(child){var w=xExtraSpace(child);w<smallestWidth&&(smallestWidth=w)}),smallestWidth}(node);else if("v"===node.getCutType())node.children().forEach(function(child){smallestWidth+=xExtraSpace(child)});else if(node.model().host()&&node.model().host().getLogicalSpace){var containerWidth=node.boundBox().width,hostWidth=node.model().host().getLogicalSpace().width;(smallestWidth=containerWidth-hostWidth)<0&&(smallestWidth=0)}else smallestWidth=0;return smallestWidth}function createPlaceHolderComponent(height,width,position){var comp=new dummy_component(0,{height:height,width:width});return comp.name("placeHolder"),comp.position(position),comp}function placeComponent(definitionModel,component){var leftOvercomponentRationWidth,isPreferred=arguments.length>2&&void 0!==arguments[2]&&arguments[2],isGridComponent=arguments.length>3&&void 0!==arguments[3]&&arguments[3],cut="",componentRatioWidth=1,leftHeight=0,leftWidth=0;if(!component)return{first:definitionModel,second:definitionModel};var _component$getLogical=component.getLogicalSpace(),componentHeight=_component$getLogical.height,componentWidth=_component$getLogical.width,position=component.position();"top"===position||"bottom"===position?(cut="h",componentRatioWidth=componentHeight/definitionModel.remainingHeight(),leftHeight=definitionModel.remainingHeight()-componentHeight,leftWidth=definitionModel.remainingWidth()):(cut="v",componentRatioWidth=componentWidth/definitionModel.remainingWidth(),leftWidth=definitionModel.remainingWidth()-componentWidth,leftHeight=definitionModel.remainingHeight()),leftOvercomponentRationWidth=1-componentRatioWidth,definitionModel.cut(cut);var firstLaneConfig={host:component.name(),cut:null,ratioWeight:componentRatioWidth,preferred:!isGridComponent&&isPreferred,lanes:[]},firstLane=new DefinitionModel(firstLaneConfig);firstLane.remainingHeight(componentHeight),firstLane.remainingWidth(componentWidth);var secondLane=new DefinitionModel({host:null,cut:null,ratioWeight:leftOvercomponentRationWidth,preferred:!isGridComponent&&!isPreferred,lanes:[]});return secondLane.remainingHeight(leftHeight),secondLane.remainingWidth(leftWidth),isPreferred?definitionModel.lanes([firstLane]):"top"===position||"left"===position?definitionModel.lanes([firstLane,secondLane]):definitionModel.lanes([secondLane,firstLane]),{first:firstLane,second:secondLane}}function tree_toConsumableArray(arr){return function tree_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function tree_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function tree_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function tree_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var layout_definition_tree=function(){function Node(data){!function tree_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Node),this._model=data,this._parent=null,this._children=[],this._parentCut=null,this._boundBox={top:null,left:null,height:null,width:null},this._id=this._model.host()instanceof LayoutComponent&&this._model.host().renderAt()?this._model.host().renderAt():getNodeId()}return function tree_createClass(Constructor,protoProps,staticProps){return protoProps&&tree_defineProperties(Constructor.prototype,protoProps),staticProps&&tree_defineProperties(Constructor,staticProps),Constructor}(Node,[{key:"addChildren",value:function addChildren(entries){var _this$_children,_this=this;(_this$_children=this._children).push.apply(_this$_children,tree_toConsumableArray(entries)),entries.forEach(function(e){e.parent(_this)})}},{key:"isRoot",value:function isRoot(){return null===this._parent}},{key:"isLeaf",value:function isLeaf(){return!this._children.length}},{key:"getCutType",value:function getCutType(){return this._model.cut()}},{key:"isPreferred",value:function isPreferred(){return!!this._model.preferred()}},{key:"children",value:function children(_children){return _children&&(this._children=_children),this._children}},{key:"parent",value:function parent(_parent){return _parent&&(this._parent=_parent),this._parent}},{key:"parentCut",value:function parentCut(_parentCut){return _parentCut&&(this._parentCut=_parentCut),this._parentCut}},{key:"id",value:function id(_id){return _id&&(this._id=_id),this._id}},{key:"model",value:function model(_model){return _model&&(this._model=_model),this._model}},{key:"boundBox",value:function boundBox(bound){return bound&&(this._boundBox={top:bound.top,left:bound.left,height:bound.height,width:bound.width}),this._boundBox}},{key:"updateNode",value:function updateNode(nodeconfig){var _this2=this;this._id===nodeconfig._id?(this._model.cut(nodeconfig.cut),this._model.ratioWeight(nodeconfig.ratioWeight)):this._children.forEach(function(node){if(node._id===nodeconfig._id)return node.model.cut(nodeconfig.cut),void node.model.ratioWeight(nodeconfig.ratioWeight);_this2.searchNode(node,nodeconfig)})}},{key:"searchNode",value:function searchNode(node,nodeconfig){var _this3=this;node.children().forEach(function(childNode){childNode.id()===nodeconfig._id?(childNode.model().cut(nodeconfig.cut),childNode.model().ratioWeight(nodeconfig.ratioWeight)):_this3.searchNode(childNode,nodeconfig)})}},{key:"delete",value:function _delete(nodeId){var _this4=this;this._children.forEach(function(node){if(node.id()===nodeId){var index=_this4._children.indexOf(node);_this4._model.lanes().splice(index,1)}_this4.deleteSearchNode(node,nodeId)})}},{key:"deleteSearchNode",value:function deleteSearchNode(node,nodeId){var _this5=this;node.children().forEach(function(childNode){if(childNode.id()===nodeId){var index=node.children().indexOf(childNode);node.model().lanes().splice(index,1)}else _this5.deleteSearchNode(childNode,nodeId)})}}]),Node}();function layout_model_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var layout_model_LayoutModel=function(){function LayoutModel(measurements,config){!function layout_model_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LayoutModel),this._measurements=measurements,this._config=config,this._root=this.createTree(this._config,null),this.setBoundBox()}return function layout_model_createClass(Constructor,protoProps,staticProps){return protoProps&&layout_model_defineProperties(Constructor.prototype,protoProps),staticProps&&layout_model_defineProperties(Constructor,staticProps),Constructor}(LayoutModel,[{key:"createTree",value:function createTree(config,parent){var node=new layout_definition_tree(config);parent?(node.parentCut(parent.getCutType()),parent.addChildren([node])):this._root=node;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=config.lanes()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var lane=_step.value;this.createTree(lane,node)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return this._root}},{key:"setBoundBox",value:function setBoundBox(){this._root.boundBox({top:0,left:0,width:this._measurements.width,height:this._measurements.height}),function allocateBoundingBox(node){var totalWeight=node.children().map(function(child){return child.model().ratioWeight()}).reduce(function(carry,val){return carry+val},0);node.children().forEach(function(child,i,children){var lastSibling=children[i-1],ratio=child.model().ratioWeight()/totalWeight;"h"===child.parentCut()?child.boundBox({top:i?lastSibling.boundBox().top+lastSibling.boundBox().height:0,left:child.parent().boundBox().left,height:child.parent().boundBox().height*ratio,width:child.parent().boundBox().width}):child.boundBox({top:child.parent().boundBox().top,left:i?lastSibling.boundBox().left+lastSibling.boundBox().width:0,height:child.parent().boundBox().height,width:child.parent().boundBox().width*ratio}),allocateBoundingBox(child)})}(this._root)}},{key:"setHostPosition",value:function setHostPosition(node){var _this=this;node.children().forEach(function(child){LayoutModel.setHostSpatialConfig(child),_this.setHostPosition(child)})}},{key:"negotiate",value:function negotiate(){return function negotiateDimension(node){for(var preferred,alteredDim,nonAlteredDim,cumultiveExtraSpaceAmt=0,childrenLength=node.children().length,index=0;index<childrenLength;index++){var extraSpaceAmt,fn=void 0,child=node.children()[index];"h"===child.parentCut()?(fn=yExtraSpace,alteredDim="height",nonAlteredDim="width"):(fn=xExtraSpace,alteredDim="width",nonAlteredDim="height"),child.isPreferred()?preferred=child:(cumultiveExtraSpaceAmt+=extraSpaceAmt=fn(child),child.boundBox()[alteredDim]-=extraSpaceAmt,child.boundBox()[nonAlteredDim]=child.parent().boundBox()[nonAlteredDim],negotiateDimension(child))}preferred&&(preferred.boundBox()[alteredDim]+=cumultiveExtraSpaceAmt,preferred.boundBox()[nonAlteredDim]=preferred.parent().boundBox()[nonAlteredDim],negotiateDimension(preferred))}(this._root),function computePosition(node){node.children().forEach(function(child,i,children){var boundBox=function determineBoundBox(bb,i,arr,instance){if(i){var _lastSibling$boundBox=arr[i-1].boundBox(),_top2=_lastSibling$boundBox.top,_left2=_lastSibling$boundBox.left,_height=_lastSibling$boundBox.height,_width=_lastSibling$boundBox.width;return{width:bb.width,height:bb.height,top:"h"===instance.parentCut()?_top2+_height:_top2,left:"h"===instance.parentCut()?_left2:_left2+_width}}var _instance$parent$boun=instance.parent().boundBox(),_top=_instance$parent$boun.top,_left=_instance$parent$boun.left;return{width:bb.width,height:bb.height,top:_top,left:_left}}(child.boundBox(),i,children,child);child.boundBox(boundBox),computePosition(child)})}(this._root),this}},{key:"broadcast",value:function broadcast(){return this.setHostPosition(this._root),this}},{key:"tree",value:function tree(){return this._root}}],[{key:"setHostSpatialConfig",value:function setHostSpatialConfig(node){var bb=node.boundBox(),host=node.model().host();if(host&&host.setSpatialConfig){var conf={x:bb.left,y:bb.top,width:bb.width,height:bb.height,renderAt:node.id()};host.setSpatialConfig(conf)}}}]),LayoutModel}();function utils_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Utils=function(){function Utils(){!function utils_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Utils)}return function utils_createClass(Constructor,protoProps,staticProps){return protoProps&&utils_defineProperties(Constructor.prototype,protoProps),staticProps&&utils_defineProperties(Constructor,staticProps),Constructor}(Utils,null,[{key:"isDOMElement",value:function isDOMElement(element){return element instanceof Element}},{key:"getID",value:function getID(element){return element.id}},{key:"getElement",value:function getElement(id){return document.getElementById(id)}},{key:"findContainer",value:function findContainer(data){return data.filter(function(coordinate){return null==coordinate.parent})[0]}},{key:"removeDiv",value:function removeDiv(divId){null!==document.getElementById(divId)&&document.getElementById(divId).remove()}}]),Utils}();function data_point_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var data_point_DataPoint=function(){function DataPoint(node){!function data_point_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DataPoint),this._node=node,this._className=node.model().host()instanceof LayoutComponent?node.model().host().className():DEFAULT_CLASS_NAME}return function data_point_createClass(Constructor,protoProps,staticProps){return protoProps&&data_point_defineProperties(Constructor.prototype,protoProps),staticProps&&data_point_defineProperties(Constructor,staticProps),Constructor}(DataPoint,[{key:"node",value:function node(){return this._node}},{key:"hasHost",value:function hasHost(){return this._node.model().host()instanceof LayoutComponent}},{key:"className",value:function className(){return this._className||DEFAULT_CLASS_NAME}}]),DataPoint}();function data_parser_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var data_parser_DataParser=function(){function DataParser(data){!function data_parser_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DataParser),this._data=data}return function data_parser_createClass(Constructor,protoProps,staticProps){return protoProps&&data_parser_defineProperties(Constructor.prototype,protoProps),staticProps&&data_parser_defineProperties(Constructor,staticProps),Constructor}(DataParser,[{key:"defaultDataPointLogic",value:function defaultDataPointLogic(){var nodepoints=[];return function getnodePoints(node,nodepoints){var datapoint=new data_point_DataPoint(node);nodepoints.push(datapoint),node.children().forEach(function(child){getnodePoints(child,nodepoints)})}(this._data,nodepoints),nodepoints}}]),DataParser}();function html_data_typeof(obj){return(html_data_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function html_data_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function html_data_possibleConstructorReturn(self,call){return!call||"object"!==html_data_typeof(call)&&"function"!=typeof call?function html_data_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function html_data_get(target,property,receiver){return(html_data_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function html_data_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=html_data_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function html_data_getPrototypeOf(o){return(html_data_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function html_data_setPrototypeOf(o,p){return(html_data_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var HTMLDataAdapter=function(_DataParser){function HTMLDataAdapter(){return function html_data_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HTMLDataAdapter),html_data_possibleConstructorReturn(this,html_data_getPrototypeOf(HTMLDataAdapter).apply(this,arguments))}return function html_data_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&html_data_setPrototypeOf(subClass,superClass)}(HTMLDataAdapter,data_parser_DataParser),function html_data_createClass(Constructor,protoProps,staticProps){return protoProps&&html_data_defineProperties(Constructor.prototype,protoProps),staticProps&&html_data_defineProperties(Constructor,staticProps),Constructor}(HTMLDataAdapter,[{key:"getCoordinates",value:function getCoordinates(){return html_data_get(html_data_getPrototypeOf(HTMLDataAdapter.prototype),"defaultDataPointLogic",this).call(this)}}]),HTMLDataAdapter}();function renderer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Renderer=function(){function Renderer(){!function renderer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Renderer)}return function renderer_createClass(Constructor,protoProps,staticProps){return protoProps&&renderer_defineProperties(Constructor.prototype,protoProps),staticProps&&renderer_defineProperties(Constructor,staticProps),Constructor}(Renderer,[{key:"initRenderer",value:function initRenderer(node,tree){node.__logicalTree=tree}}]),Renderer}();function html_renderer_typeof(obj){return(html_renderer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){html_renderer_defineProperty(target,key,source[key])})}return target}function html_renderer_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function html_renderer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function html_renderer_possibleConstructorReturn(self,call){return!call||"object"!==html_renderer_typeof(call)&&"function"!=typeof call?function html_renderer_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function html_renderer_get(target,property,receiver){return(html_renderer_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function html_renderer_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=html_renderer_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function html_renderer_getPrototypeOf(o){return(html_renderer_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function html_renderer_setPrototypeOf(o,p){return(html_renderer_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var html_renderer_HTMLRenderer=function(_Renderer){function HTMLRenderer(data){var _this;return function html_renderer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HTMLRenderer),(_this=html_renderer_possibleConstructorReturn(this,html_renderer_getPrototypeOf(HTMLRenderer).call(this)))._data=data,_this._coordinates=new HTMLDataAdapter(_this._data).getCoordinates(),_this}return function html_renderer_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&html_renderer_setPrototypeOf(subClass,superClass)}(HTMLRenderer,Renderer),function html_renderer_createClass(Constructor,protoProps,staticProps){return protoProps&&html_renderer_defineProperties(Constructor.prototype,protoProps),staticProps&&html_renderer_defineProperties(Constructor,staticProps),Constructor}(HTMLRenderer,[{key:"createhtml",value:function createhtml(mount,className){var _this2=this,mainDiv=mount;html_renderer_get(html_renderer_getPrototypeOf(HTMLRenderer.prototype),"initRenderer",this).call(this,mainDiv,this._data),this.parentDiv=this.createAndCustomiseParent(className),this._coordinates.forEach(function(node){if(node.hasHost()){var host=node.node();_this2.parentDiv.appendChild(_this2.createAndPositionDiv(_objectSpread({},host.boundBox(),{id:host.id(),className:node.className()})))}}),mainDiv.appendChild(this.parentDiv)}},{key:"createAndPositionDiv",value:function createAndPositionDiv(config){var top=config.top,left=config.left,height=config.height,width=config.width,className=config.className,id=config.id,div=document.getElementById(id)||document.createElement("div");return div.style.position="absolute",div.style.left="".concat(left,"px"),div.style.top="".concat(top,"px"),div.style.height="".concat(height,"px"),div.style.width="".concat(width,"px"),div.id=id,div.className=className,div}},{key:"createAndCustomiseParent",value:function createAndCustomiseParent(className){var container=Utils.findContainer(this._coordinates),host=container.node(),parentDiv=this.createAndPositionDiv(_objectSpread({},host.boundBox(),{id:host.id(),className:container.className()}));return parentDiv.className=className,parentDiv.style.position="relative",parentDiv}},{key:"coordinates",value:function coordinates(){return this._coordinates}}]),HTMLRenderer}(),findNode=function findNode(context,nodeID){return context.renderer().coordinates().find(function(point){return point.node().id()===nodeID})},helper_renderHTML=function renderHTML(context){context.renderer(new html_renderer_HTMLRenderer(context.data())),context.renderer().createhtml(context.mount(),context.className())};function drawing_manager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var drawing_manager_DrawingManager=function(){function DrawingManager(data,renderer,container){!function drawing_manager_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DrawingManager),this._data=data.tree,this._componentMap=data.componentMap,this._layoutClassName=data.layoutClassName,this._renderer=renderer,this._mount=Utils.isDOMElement(container)?container:Utils.getElement(container)}return function drawing_manager_createClass(Constructor,protoProps,staticProps){return protoProps&&drawing_manager_defineProperties(Constructor.prototype,protoProps),staticProps&&drawing_manager_defineProperties(Constructor,staticProps),Constructor}(DrawingManager,[{key:"draw",value:function draw(){return function drawLayout(context){switch(context.renderer()){case"html":helper_renderHTML(context);break;default:helper_renderHTML(context)}}(this),function resolveAligment(context,componentData){componentData.children().forEach(function(component){var host=component.model().host();if(host instanceof LayoutComponent&&host.alignWith()){var newNodeConfig={},point=findNode(context,component.id()).node(),node=point.boundBox(),refNode=findNode(context,context.componentMap().get(host.alignWith()).renderAt()).node().boundBox();switch(host.alignment()){case"left":newNodeConfig={top:node.top,left:refNode.left,height:node.height,width:Math.abs(node.width-Math.abs(refNode.left-node.left))};break;case"right":newNodeConfig={top:node.top,left:node.left,height:node.height,width:Math.abs(node.width-Math.abs(node.left+node.width-(refNode.left+refNode.width)))};break;case"top":newNodeConfig={top:refNode.top,left:node.left,height:Math.abs(node.height-Math.abs(refNode.top-node.top)),width:node.width};break;case"bottom":newNodeConfig={top:node.top,left:node.left,height:Math.abs(node.top-refNode.top+refNode.height),width:node.width};break;case"h-center":newNodeConfig={top:node.top,left:refNode.left,height:node.height,width:refNode.width};break;case"v-center":newNodeConfig={top:refNode.top,left:node.left,height:refNode.height,width:node.width}}Object.assign(newNodeConfig,{id:point.id(),className:host.className()}),context.renderer().createAndPositionDiv(newNodeConfig),context.componentMap().get(host.name()).renderAt(component.id()),context.componentMap().get(host.name()).boundBox({height:newNodeConfig.height,width:newNodeConfig.width})}resolveAligment(context,component)})}(this,this._data),function drawComponent(componentData){componentData.children().forEach(function(node){var host=node.model().host();host instanceof LayoutComponent&&host.draw(),drawComponent(node)})}(this._data),this}},{key:"data",value:function data(_data){return _data&&(this._data=_data),this._data}},{key:"componentMap",value:function componentMap(param){return param&&(this._componentMap=param),this._componentMap}},{key:"className",value:function className(param){return param&&(this._layoutClassName=param),this._layoutClassName}},{key:"renderer",value:function renderer(param){return param&&(this._renderer=param),this._renderer}},{key:"mount",value:function mount(param){return param&&(this._mount=param),this._mount}}]),DrawingManager}();function definition_manager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var definition_manager_DefinitionManager=function(){function DefinitionManager(componentMap,sequence,totalHeight,totalWidth){!function definition_manager_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DefinitionManager),this._componentMap=componentMap,this._prioritySequence=sequence,this._totalHeight=totalHeight,this._totalWidth=totalWidth,this._targetComponentMap=null}return function definition_manager_createClass(Constructor,protoProps,staticProps){return protoProps&&definition_manager_defineProperties(Constructor.prototype,protoProps),staticProps&&definition_manager_defineProperties(Constructor,staticProps),Constructor}(DefinitionManager,[{key:"generateConfigModel",value:function generateConfigModel(){!function prepareTargetComponentMap(context){context.targetComponentMap(new Map),context.componentMap().forEach(function(value){if(context.targetComponentMap().has(value.target()))context.targetComponentMap().get(value.target()).push(value);else{var temp=[];temp.push(value),context.targetComponentMap().set(value.target(),temp)}})}(this);var canvasComponent=this._targetComponentMap.get("canvas"),definitionModel=new DefinitionModel({}),tempDefModel=definitionModel;definitionModel.remainingHeight(this._totalHeight),definitionModel.remainingWidth(this._totalWidth);var componentRef=null;return this._prioritySequence.forEach(function(name){componentRef=function getComponent(canvasComponent,componentName){var comp=canvasComponent.find(function(component){return component.name()===componentName});return comp&&-1!==comp?comp:null}(canvasComponent,name),tempDefModel="grid"!==name?placeComponent(tempDefModel,componentRef).second:function placeGridComponent(definitionModel,gridComponents){for(var tempDefModel=definitionModel,rows=gridComponents.length,column=rows?gridComponents[0].length:0,height=gridComponents.reduce(function(acc,val){return acc+val[0].getLogicalSpace().height},0),i=0;i<column;i++){var iscolumnPreffered=i===column-1,_placeComponent=placeComponent(tempDefModel,createPlaceHolderComponent(height,gridComponents[0][i].getLogicalSpace().width,"left"),iscolumnPreffered),first=_placeComponent.first,second=_placeComponent.second;tempDefModel=first;for(var j=0;j<rows;j++){var rowpreffred=j===rows-1;tempDefModel=placeComponent(tempDefModel,gridComponents[j][i],rowpreffred,!0).second}tempDefModel=second}return tempDefModel}(tempDefModel,componentRef.component)}),definitionModel}},{key:"componentMap",value:function componentMap(param){return param&&(this._componentMap=param),this._componentMap}},{key:"targetComponentMap",value:function targetComponentMap(param){return param&&(this._targetComponentMap=param),this._targetComponentMap}}]),DefinitionManager}();function layout_def_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var layout_def_LayoutDef=function(){function LayoutDef(){!function layout_def_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LayoutDef),this._componentMap=new Map,this._layoutDefinition=null}return function layout_def_createClass(Constructor,protoProps,staticProps){return protoProps&&layout_def_defineProperties(Constructor.prototype,protoProps),staticProps&&layout_def_defineProperties(Constructor,staticProps),Constructor}(LayoutDef,[{key:"addComponent",value:function addComponent(component){this._componentMap.set(component.name(),component)}},{key:"layoutDefinition",value:function layoutDefinition(def){return def&&(this._layoutDefinition=def),this._layoutDefinition}},{key:"addMultipleComponent",value:function addMultipleComponent(componentArray){var _this=this;componentArray.forEach(function(comp){_this.addComponent(comp)})}},{key:"sanitizedDefinition",value:function sanitizedDefinition(){return function sanitizeConfig(context,hostObj){var hostID=hostObj.host();hostObj.lanes()&&hostObj.lanes().length&&hostObj.lanes().forEach(function(childHost){return sanitizeConfig(context,childHost)}),null!=hostID&&"string"==typeof hostID&&void 0!==context.componentMap().get(hostID)&&hostObj.host(context.componentMap().get(hostID))}(this,this._layoutDefinition),this.layoutDefinition()}},{key:"componentMap",value:function componentMap(){return this._componentMap}},{key:"resetComponentMap",value:function resetComponentMap(){this._componentMap.clear()}}]),LayoutDef}();function layout_manager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var layout_manager_LayoutManager=function(){function LayoutManager(conf){!function layout_manager_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LayoutManager),this._renderAt=conf.renderAt,this._layoutClassName=conf.className,this._dimension={width:conf.width||DEFAULT_WIDTH,height:conf.height||DEFAULT_HEIGHT},this._skeletonType=conf.skeletonType||"html",this._layoutDefinition=null,this._layoutDef=new layout_def_LayoutDef,this._drawingManager=null,this._prioritySequence=[],this.tree=null,this._rootNodeID=null}return function layout_manager_createClass(Constructor,protoProps,staticProps){return protoProps&&layout_manager_defineProperties(Constructor.prototype,protoProps),staticProps&&layout_manager_defineProperties(Constructor,staticProps),Constructor}(LayoutManager,[{key:"layoutDef",value:function layoutDef(param){return param&&(this._layoutDef=param),this._layoutDef}},{key:"prioritySequence",value:function prioritySequence(param){return param&&(this._prioritySequence=param),this._prioritySequence}},{key:"dimension",value:function dimension(param){return param&&Object.assign(this._dimension,param),this._dimension}},{key:"addComponent",value:function addComponent(component){this._layoutDef.addComponent(component)}},{key:"addMultipleComponent",value:function addMultipleComponent(componentArray){this._layoutDef.addMultipleComponent(componentArray)}},{key:"resetNode",value:function resetNode(node){this.con&&this.con.resetNode(node)}},{key:"updateNode",value:function updateNode(config){this.tree.updateNode(config),this._layoutDefinition=this.tree.model,this.compute()}},{key:"compute",value:function compute(){Utils.isDOMElement(this._renderAt)?this._renderAt._layout=this:document.getElementById(this._renderAt)._layout=this,this._layoutDefinition=function calLayOutDef(context){var _context$dimension=context.dimension(),height=_context$dimension.height,width=_context$dimension.width;return new definition_manager_DefinitionManager(context.layoutDef().componentMap(),context.prioritySequence(),height,width).generateConfigModel()}(this),this._layoutDef.layoutDefinition(this._layoutDefinition),this._layoutDefinition=this._layoutDef.sanitizedDefinition(),this._layout=new layout_model_LayoutModel({width:this._dimension.width,height:this._dimension.height},this._layoutDefinition),this.tree=this._layout.negotiate().tree(),this._layout.broadcast(),this._drawingManager=new drawing_manager_DrawingManager({tree:this.tree,componentMap:this._layoutDef.componentMap(),layoutClassName:this._layoutClassName},this._skeletonType,this._renderAt),this._rootNodeID?this.tree.id(this._rootNodeID):this._rootNodeID=this.tree.id(),this._drawingManager.draw()}},{key:"getRootNodeId",value:function getRootNodeId(){return this._rootNodeID}},{key:"registerComponents",value:function registerComponents(layoutComponents){var _this=this;return this._prioritySequence.length=0,this._layoutDef.resetComponentMap(),layoutComponents.forEach(function(container){container&&(_this._prioritySequence.push(container.name()),_this.addComponent(container),"grid"===container.name()&&container.component.forEach(function(componentArr){componentArr.forEach(function(compo){_this.addComponent(compo)})}))}),this}},{key:"getComponent",value:function getComponent(componentName){return this._layoutDef.componentMap().get(componentName)}},{key:"renderAt",value:function renderAt(mount){return mount&&(this._renderAt=mount),this._renderAt}}]),LayoutManager}();function canvas_helper_slicedToArray(arr,i){return function canvas_helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function canvas_helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function canvas_helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function canvas_helper_toConsumableArray(arr){return function canvas_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function canvas_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function canvas_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var helper_setupChangeListener=function setupChangeListener(context){var store=context._store,allOptions=Object.keys(context._allOptions),props=[].concat(canvas_helper_toConsumableArray(allOptions),canvas_helper_toConsumableArray(Object.keys(canvasOptions))),nameSpaceProps=[].concat(canvas_helper_toConsumableArray(allOptions),canvas_helper_toConsumableArray(Object.keys(canvasOptions))).map(function(prop){return"".concat(namespace_namespaceObject.CANVAS_LOCAL_NAMESPACE,".").concat(prop)});store.registerChangeListener(nameSpaceProps,function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];!function equalityChecker(props,params){var checker=function checker(){return!1};props.every(function(option,i){switch(option){case"rows":case"columns":case"detail":checker=common_utils_isEqual("Array");break;case"shape":case"size":case"color":case"data":case"config":checker=common_utils_isEqual("Object");break;default:checker=function checker(){return!0}}var oldVal=params[i][0],newVal=params[i][1];return checker(oldVal,newVal)})}(props,params);(function updateChecker(props,params){return props.every(function(option,i){var val=params[i][1];switch(option){case"rows":case"columns":return null!==val;case"data":return val&&!val.isEmpty();default:return!0}})})(props,params)&&context.mount()&&(!function dispatchProps(context){var lifeCycleManager=context.dependencies().lifeCycleManager;lifeCycleManager.notify({client:context,action:"beforeupdate"});var visualGroup=context.composition().visualGroup,allOptions=context._allOptions;for(var key in allOptions){var value=context[key]();null!==value&&visualGroup[key]&&visualGroup[key](value)}visualGroup.createMatrices(),context._cachedProps={},lifeCycleManager.notify({client:context,action:"initialized"}),lifeCycleManager.notify({client:context,action:"updated"})}(context),context.render()),function notifyAnimationEnd(context){var centerMatrix=context.layout().viewInfo().viewMatricesInfo.matrices.center[1]||[],promises=[];centerMatrix.forEach(function(cellArr){cellArr.forEach(function(cell){promises.push(cell.valueOf().done())})});var lifeCycleManager=context.lifeCycle();promises.length?Promise.all(promises).then(function(){lifeCycleManager.notify({client:context,action:"drawn"});var animDonePromises=[];centerMatrix.forEach(function(cellArr){cellArr.forEach(function(cell){cell.valueOf().layers().forEach(function(layer){animDonePromises.push(layer.animationDone())})})}),[context.xAxes(),context.yAxes()].forEach(function(axisArr){(axisArr=axisArr||[]).forEach(function(axes){axes.forEach(function(axisInst){animDonePromises.push(axisInst.animationDone())})})}),Promise.all(animDonePromises).then(function(){lifeCycleManager.notify({client:context,action:"animationend"})})}):lifeCycleManager.notify({client:context,action:"animationend"})}(context)},!0)},applyInteractionPolicy=function applyInteractionPolicy(firebolt){var visualGroup=firebolt.context.composition().visualGroup;if(visualGroup){var valueMatrix=visualGroup.matrixInstance().value;(0,firebolt._interactionPolicy)(valueMatrix,firebolt);var crossInteractionPolicy=firebolt._crossInteractionPolicy,behaviours=crossInteractionPolicy.behaviours,sideEffects=crossInteractionPolicy.sideEffects;valueMatrix.each(function(cell){var unitFireBolt=cell.valueOf().firebolt();for(var key in behaviours)unitFireBolt.changeBehaviourStateOnPropagation(key,behaviours[key]);for(var _key2 in sideEffects)unitFireBolt.changeSideEffectStateOnPropagation(_key2,sideEffects[_key2])})}},helper_createLayoutManager=function createLayoutManager(){return new layout_manager_LayoutManager({className:"muze-group-container"})},src_options={data:{value:null,meta:{typeCheck:function typeCheck(d){return d instanceof datamodel_default.a}}},width:{value:0,meta:{sanitization:intSanitizer,typeCheck:Number.isInteger}},height:{value:0,meta:{sanitization:intSanitizer,typeCheck:Number.isInteger}},minUnitWidth:{value:50,meta:{sanitization:intSanitizer,typeCheck:Number.isInteger}},minUnitHeight:{value:50,meta:{sanitization:intSanitizer,typeCheck:Number.isInteger}},config:{value:null,meta:{typeCheck:"constructor",typeExpected:"Object",sanitization:function sanitization(config,oldConfig){var oldConf=mergeRecursive({},null===config?{}:oldConfig),defConfig=mergeRecursive(oldConf,src_defaults_DEFAULT_CONFIG),newConf=mergeRecursive(defConfig,config);return newConf=function fixScrollBarConfig(config){return config.scrollBar.thickness=Math.min(50,Math.max(10,config.scrollBar.thickness)),config}(newConf)}}}},VIEW_INDEX={top:0,center:1,bottom:2},ROW_MATRIX_INDEX={0:"top",1:"center",2:"bottom"},COLUMN_MATRIX_INDEX={0:"left",1:"middle",2:"right"},enums_constants_HEIGHT="height",ROW_ROOT="rowRoot",COLUMN_ROOT="columnRoot";function generic_layout_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _FieldNames$BORDER,_DEFAULT_CONFIGURATIO,_DEFAULT_MEASUREMENTS,generic_layout_GenericLayout=function(){function GenericLayout(mountPoint,measurement,config,dependencies){!function generic_layout_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GenericLayout),this._config={},this._measurement={},this._matrices=[],this._dependencies=dependencies,this.measurement(measurement),this.mountPoint(mountPoint),this.config(config)}return function generic_layout_createClass(Constructor,protoProps,staticProps){return protoProps&&generic_layout_defineProperties(Constructor.prototype,protoProps),staticProps&&generic_layout_defineProperties(Constructor,staticProps),Constructor}(GenericLayout,[{key:"serialize",value:function serialize(){return{measurement:this.measurement(),config:this.config(),matrices:this.matrices()}}},{key:"config",value:function config(_config){return _config?(this._config=mergeRecursive(this._config||{},_config),this):this._config}},{key:"measurement",value:function measurement(_measurement){return _measurement?(this._measurement=mergeRecursive(this._measurement||{},_measurement),this):this._measurement}},{key:"matrices",value:function matrices(_matrices){return _matrices?(this._matrices=sanitizeIP_typeObj(["top","center","bottom"],_matrices),this):this._matrices}},{key:"rowMatrix",value:function rowMatrix(matrix){return matrix?(this._rowMatrix=matrix,this):this._rowMatrix}},{key:"columnMatrix",value:function columnMatrix(matrix){return matrix?(this._columnMatrix=matrix,this):this._columnMatrix}},{key:"centerMatrix",value:function centerMatrix(matrix){return matrix?(this._centerMatrix=matrix,this):this._centerMatrix}},{key:"mountPoint",value:function mountPoint(_mountPoint){return _mountPoint?(this._mountPoint=_mountPoint,this):this._mountPoint}}]),GenericLayout}();function grid_layout_defaults_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var DEFAULT_CONFIGURATION=(grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO={},"border",(grid_layout_defaults_defineProperty(_FieldNames$BORDER={},"style","solid"),grid_layout_defaults_defineProperty(_FieldNames$BORDER,"color","#d6d6d6"),grid_layout_defaults_defineProperty(_FieldNames$BORDER,"width",2),grid_layout_defaults_defineProperty(_FieldNames$BORDER,"collapse",!0),grid_layout_defaults_defineProperty(_FieldNames$BORDER,"spacing",0),_FieldNames$BORDER)),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"pagination","scroll"),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"buffer",20),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"gutterSpace",{rows:[],columns:[]}),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"distribution",{rows:[],columns:[]}),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"breakPage",{rows:[],columns:[]}),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"isRowSizeEqual",!1),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"isColumnSizeEqual",!1),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"columnPointer",0),grid_layout_defaults_defineProperty(_DEFAULT_CONFIGURATIO,"rowPointer",0),_DEFAULT_CONFIGURATIO),DEFAULT_MEASUREMENTS=(grid_layout_defaults_defineProperty(_DEFAULT_MEASUREMENTS={},"width",100),grid_layout_defaults_defineProperty(_DEFAULT_MEASUREMENTS,"height",100),grid_layout_defaults_defineProperty(_DEFAULT_MEASUREMENTS,"unitWidth",100),grid_layout_defaults_defineProperty(_DEFAULT_MEASUREMENTS,"unitHeight",100),_DEFAULT_MEASUREMENTS);function utils_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function utils_toConsumableArray(arr){return function utils_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function utils_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function utils_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var utils_nest=Symbols.nest,findInPage=function findInPage(i,page){var count=0;for(var x in page)if(i<page[x]){count=x;break}return count},combineMatrices=function combineMatrices(matrix,config){var isTransposed=config.isTransposed,joinedMatrix=matrix[0].length>0?matrix[0]:matrix[1];return isTransposed?(joinedMatrix=matrix[0].length>0?utils_toConsumableArray(matrix[0]):[],joinedMatrix=matrix[1].length>0?[].concat(utils_toConsumableArray(joinedMatrix),utils_toConsumableArray(matrix[1])):joinedMatrix):joinedMatrix=joinedMatrix.map(function(row,rowIndex){var rowData=[];return matrix[0].length>0&&(rowData=utils_toConsumableArray(matrix[0][rowIndex])),matrix[1].length>0&&(rowData=[].concat(utils_toConsumableArray(rowData),utils_toConsumableArray(matrix[1][rowIndex]))),rowData}),joinedMatrix},utils_computeLogicalSpace=function computeLogicalSpace(){var item=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},config=arguments.length>1?arguments[1]:void 0,maxMeasures=arguments.length>2?arguments[2]:void 0,_config$isTransposed=config.isTransposed,isTransposed=void 0!==_config$isTransposed&&_config$isTransposed,unitMeasures=config.unitMeasures,_getMeasureInfo=function getMeasureInfo(isTransposed){return isTransposed?{firstMeasure:enums_constants_HEIGHT,secondMeasure:"width"}:{firstMeasure:"width",secondMeasure:enums_constants_HEIGHT}}(isTransposed),firstMeasure=_getMeasureInfo.firstMeasure,secondMeasure=_getMeasureInfo.secondMeasure,values=item.values,minMeasures=function getMinMeasures(isTransposed,unitMeasures){return isTransposed?{height:0,width:unitMeasures.width}:{height:unitMeasures.height,width:0}}(isTransposed,unitMeasures);if(values[0].key){var _logicalSpace,logicalSpace=(utils_defineProperty(_logicalSpace={},firstMeasure,0),utils_defineProperty(_logicalSpace,secondMeasure,0),_logicalSpace);return values.forEach(function(valueItem){var space=computeLogicalSpace(valueItem,config,maxMeasures);logicalSpace[firstMeasure]=Math.max(logicalSpace[firstMeasure],space[firstMeasure],minMeasures[firstMeasure]),logicalSpace[secondMeasure]+=+space[secondMeasure]}),item.space=logicalSpace,logicalSpace}return function getLogicalSpace(item,measures,minMeasures){var _ref,maxMeasure=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],firstMeasure=measures.firstMeasure,secondMeasure=measures.secondMeasure,firstMeasureValue=0,secondMeasureValue=0;return item.values.forEach(function(valueArray){var _item$space,fMeasure=0,sMeasure=0;valueArray.forEach(function(placeholder,colIndex){placeholder.setAvailableSpace();var space=placeholder.getLogicalSpace();sMeasure=Math.max(sMeasure,+space[secondMeasure],minMeasures[secondMeasure]),maxMeasure[colIndex]=Math.max(maxMeasure[colIndex]||0,space[firstMeasure]),fMeasure+=+maxMeasure[colIndex]}),secondMeasureValue+=sMeasure,firstMeasureValue=Math.max(firstMeasureValue,fMeasure),item.space=(utils_defineProperty(_item$space={},secondMeasure,Math.ceil(secondMeasureValue)),utils_defineProperty(_item$space,firstMeasure,Math.ceil(firstMeasureValue)),_item$space)}),utils_defineProperty(_ref={},secondMeasure,secondMeasureValue),utils_defineProperty(_ref,firstMeasure,firstMeasureValue),_ref}(item,{firstMeasure:firstMeasure,secondMeasure:secondMeasure},minMeasures,maxMeasures)},createMatrixEachLevel=function createMatrixEachLevel(item,isTransposed){if(item.values[0].key){var arr=[];return item.values.forEach(function(child){isTransposed?createMatrixEachLevel(child,isTransposed).forEach(function(e,i){var _arr$i;arr[i]=arr[i]||[],(_arr$i=arr[i]).push.apply(_arr$i,utils_toConsumableArray(e))}):arr.push.apply(arr,utils_toConsumableArray(createMatrixEachLevel(child,isTransposed)))}),item.matrix=arr,arr}return item.matrix=isTransposed?item.values[0].map(function(col,colIndex){return item.values.map(function(row){return row[colIndex]})}):item.values,item.matrix},extraCellsRemover=function extraCellsRemover(arr,beg,end){return arr.slice(beg,-end)},visual_matrix_props_PROPS={config:{sanitization:function sanitization(context,value){return mergeRecursive(context._config||{},value)}},maxMeasures:{},availableSpace:{},logicalSpace:{}},visual_matrix_default_config_defaultConfig={distribution:[],classPrefix:"muze",isDistributionEqual:!0,unitMeasures:{height:100,width:100,border:1},isTransposed:!1,facet:"primary",extraCellLengths:[]};function visual_matrix_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var visual_matrix_VisualMatrix=function(){function VisualMatrix(matrix){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function visual_matrix_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VisualMatrix),this._lastLevelKey=0,this._primaryMatrix=matrix[0]||[],this._secondaryMatrix=matrix[1]||[],this._maxMeasures=[],this._availableSpace={},generateGetterSetters(this,visual_matrix_props_PROPS);var defCon=Object.assign({},this.constructor.defaultConfig());this.config(mergeRecursive(defCon,config)),this._layoutMatrix=combineMatrices([matrix[0]||[],matrix[1]||[]],this.config())}return function visual_matrix_createClass(Constructor,protoProps,staticProps){return protoProps&&visual_matrix_defineProperties(Constructor.prototype,protoProps),staticProps&&visual_matrix_defineProperties(Constructor,staticProps),Constructor}(VisualMatrix,[{key:"computeLogicalSpace",value:function computeLogicalSpace(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"computeViewableSpaces",value:function computeViewableSpaces(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"removeExtraCells",value:function removeExtraCells(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getPriorityDistribution",value:function getPriorityDistribution(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"calculateDepth",value:function calculateDepth(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"redistributeSpaces",value:function redistributeSpaces(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"redistributeViewSpaces",value:function redistributeViewSpaces(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getCellDimensions",value:function getCellDimensions(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"primaryMatrix",value:function primaryMatrix(){return arguments.length?this:this._primaryMatrix}},{key:"secondaryMatrix",value:function secondaryMatrix(){return arguments.length?this:this._secondaryMatrix}},{key:"tree",value:function tree(){return arguments.length?this:this._tree}},{key:"createTree",value:function createTree(){var _createTree2=function createTree(context){var matrixTree={},lastLevelKey=0,facet="primary",nestFn=utils_nest(),keys=[],layoutMatrix=context._layoutMatrix,primaryMatrix=context.primaryMatrix(),secondaryMatrix=context.secondaryMatrix(),_context$config=context.config(),isTransposed=_context$config.isTransposed,breakPage=_context$config.breakPage;if(isTransposed){if(facet=0===primaryMatrix.length?"primary":0===secondaryMatrix.length?"secondary":primaryMatrix.length>=secondaryMatrix.length?"primary":"secondary",primaryMatrix.length>0){for(var _i2=0;_i2<primaryMatrix.length-1;_i2++)keys.push(_i2);keys.push(primaryMatrix.length-1),"secondary"===facet&&(lastLevelKey=primaryMatrix.length-1)}if(secondaryMatrix.length>0){for(var primaryMatrixLength=primaryMatrix.length,_i3=secondaryMatrix.length-1;_i3>0;_i3--)keys.push(_i3+primaryMatrixLength);keys.push(primaryMatrixLength),"primary"===facet&&(lastLevelKey=primaryMatrixLength)}var newMatrix;keys.forEach(function(key){var counter=-1;return nestFn.key(function(d){return counter++,"".concat(d[key].valueOf(),"-").concat(findInPage(counter,breakPage))})}),newMatrix=layoutMatrix[0].map(function(col,colIndex){return layoutMatrix.map(function(row){return row[colIndex]})}),matrixTree=nestFn.entries(newMatrix)}else{if(facet=0===primaryMatrix.length?"primary":0===secondaryMatrix.length?"secondary":primaryMatrix.length>=secondaryMatrix.length?"primary":"secondary",primaryMatrix.length>0){for(var i=0;i<primaryMatrix[0].length-1;i++)keys.push(i);keys.push(primaryMatrix[0].length-1),"secondary"!==facet&&0!==secondaryMatrix.length||(lastLevelKey=primaryMatrix[0].length-1)}if(secondaryMatrix.length>0){for(var keyLength=primaryMatrix.length>0?primaryMatrix[0].length:0,_i=secondaryMatrix[0].length-1;_i>0;_i--)keys.push(_i+keyLength);keys.push(keyLength),"primary"===facet&&(lastLevelKey=keyLength)}else lastLevelKey=primaryMatrix.length>0?primaryMatrix[0].length-1:0;keys.forEach(function(key){var counter=-1;return nestFn.key(function(d){return counter++,"".concat(d[key].valueOf(),"-").concat(findInPage(counter,breakPage))})}),matrixTree=nestFn.entries(layoutMatrix)}return{tree:matrixTree,lastLevelKey:lastLevelKey}}(this),tree=_createTree2.tree,lastLevelKey=_createTree2.lastLevelKey;return this._lastLevelKey=lastLevelKey,tree}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()}},{key:"setAvailableSpace",value:function setAvailableSpace(width,height){this.availableSpace({width:width,height:height});var tree=this.tree(),heightMeasures=this.populateMaxMeasures(enums_constants_HEIGHT,tree),widthMeasures=this.populateMaxMeasures("width",tree),depth=this.calculateDepth(widthMeasures,heightMeasures);return this.viewableMatrix=this.createViewPortMatrix(depth),this.viewableMeasures=this.redistributeSpaces(width,height),this}},{key:"populateMaxMeasures",value:function populateMaxMeasures(type,matrixTree){var _this=this,depth=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,measures=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(measures[depth]=Math.max(measures[depth]||0,matrixTree.space[type]),matrixTree.values){var childDepth=depth+1;matrixTree.values.forEach(function(child){child.space&&(measures=_this.populateMaxMeasures(type,child,childDepth,measures))})}return measures}},{key:"getViewableSpaces",value:function getViewableSpaces(){return this.viewableMeasures}},{key:"getViewableMatrices",value:function getViewableMatrices(){return this.viewableMatrix}},{key:"createViewPortMatrix",value:function createViewPortMatrix(depth){var arr=[];return function createMatrixInstances(){var arr=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],depth=arguments.length>1?arguments[1]:void 0,matrixInfo=arguments.length>2?arguments[2]:void 0,layout=arguments.length>3?arguments[3]:void 0,breakPointer=layout._breakPointer,isTransposed=layout.config().isTransposed,tree=matrixInfo.tree,layoutMatrix=matrixInfo.layoutMatrix;if(0===depth){var brokenMatrix=function breakMatrix(matrix,isTransposed,breakPointer){var primaryMatrix=[],secondaryMatrix=[];return isTransposed?matrix.forEach(function(row,rowIndex){rowIndex>=breakPointer?secondaryMatrix.push(row):primaryMatrix.push(row)}):matrix.forEach(function(row,rowIndex){row.forEach(function(column,columnIndex){columnIndex>=breakPointer?(secondaryMatrix[rowIndex]=secondaryMatrix[rowIndex]||[],secondaryMatrix[rowIndex].push(column)):(primaryMatrix[rowIndex]=primaryMatrix[rowIndex]||[],primaryMatrix[rowIndex].push(column))})}),[primaryMatrix,secondaryMatrix]}(tree.matrix,isTransposed,breakPointer);return arr.push({matrix:tree.matrix,primaryMatrix:brokenMatrix[0],secondaryMatrix:brokenMatrix[1],space:tree.space}),arr}var nextLevel=depth-1;return tree.values.forEach(function(e){createMatrixInstances(arr,nextLevel,{tree:e,layoutMatrix:layoutMatrix},layout)}),arr}(arr,depth,this.removeExtraCells(),this),arr}}],[{key:"defaultConfig",value:function defaultConfig(){return visual_matrix_default_config_defaultConfig}}]),VisualMatrix}();function row_matrix_typeof(obj){return(row_matrix_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function row_matrix_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function row_matrix_possibleConstructorReturn(self,call){return!call||"object"!==row_matrix_typeof(call)&&"function"!=typeof call?function row_matrix_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function row_matrix_getPrototypeOf(o){return(row_matrix_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function row_matrix_setPrototypeOf(o,p){return(row_matrix_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var row_matrix_RowVisualMatrix=function(_VisualMatrix){function RowVisualMatrix(matrix){var _this,config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function row_matrix_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,RowVisualMatrix),(_this=row_matrix_possibleConstructorReturn(this,row_matrix_getPrototypeOf(RowVisualMatrix).call(this,matrix,config)))._breakPointer=matrix[0].length>0?matrix[0][0].length:0,_this._layoutMatrix=combineMatrices([matrix[0]||[],matrix[1]||[]],_this.config()),_this._tree={key:ROW_ROOT,values:_this.createTree()},_this._logicalSpace=_this.computeLogicalSpace(),_this}return function row_matrix_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&row_matrix_setPrototypeOf(subClass,superClass)}(RowVisualMatrix,visual_matrix_VisualMatrix),function row_matrix_createClass(Constructor,protoProps,staticProps){return protoProps&&row_matrix_defineProperties(Constructor.prototype,protoProps),staticProps&&row_matrix_defineProperties(Constructor,staticProps),Constructor}(RowVisualMatrix,[{key:"computeLogicalSpace",value:function computeLogicalSpace(){var matrixTree=this.tree();return createMatrixEachLevel(matrixTree,!1),utils_computeLogicalSpace(matrixTree,this.config(),this.maxMeasures())}},{key:"computeViewableSpaces",value:function computeViewableSpaces(measures){var _this2=this,maxHeights=measures.maxHeights,maxWidths=measures.maxWidths,height=measures.height;return this.viewableMatrix.map(function(matrixInst,i){var cellDimOptions={matrixInst:matrixInst,maxWidths:maxWidths,maxHeights:maxHeights,matrixIndex:i},_this2$getCellDimensi=_this2.getCellDimensions(cellDimOptions),widths=_this2$getCellDimensi.widths,rowHeights=_this2$getCellDimensi.rowHeights,columnWidths=_this2$getCellDimensi.columnWidths,heightMeasures=[height,height],columnMeasures=widths;return{rowHeights:{primary:rowHeights[0],secondary:rowHeights[1]},columnWidths:{primary:columnWidths[0],secondary:columnWidths[1]},height:{primary:heightMeasures[0],secondary:heightMeasures[1]},width:{primary:columnMeasures[0],secondary:columnMeasures[1]}}})}},{key:"removeExtraCells",value:function removeExtraCells(){var _this$config=this.config(),isTransposed=_this$config.isTransposed,extraCellLengths=_this$config.extraCellLengths,matrix=this._layoutMatrix,tree=mergeRecursive({},this.tree()),begCellLen=extraCellLengths[0],endCellLen=extraCellLengths[1]||Number.NEGATIVE_INFINITY,layoutMatrix=isTransposed?matrix.slice(0).map(function(e){return extraCellsRemover(e,begCellLen,endCellLen)}):extraCellsRemover(matrix,begCellLen,endCellLen);return tree.values=extraCellsRemover(tree.values,begCellLen,endCellLen),tree.matrix=extraCellsRemover(tree.matrix,begCellLen,endCellLen),{tree:tree,layoutMatrix:layoutMatrix}}},{key:"getPriorityDistribution",value:function getPriorityDistribution(measures){var remainaingAvailWidth,remainaingWidth,cWidths=[],conditions=[],maxPrioritySpace=0,matrix=measures.matrix,availableWidth=measures.width,maxWidths=measures.maxMeasures,currentWidth=measures.maxWidth,height=measures.height,priority=this.config().priority,primaryMatrixLength=this.primaryMatrix().length?this.primaryMatrix()[0].length:0,dist=[];remainaingAvailWidth=availableWidth,remainaingWidth=currentWidth,(conditions=2===priority?[primaryMatrixLength-1,primaryMatrixLength]:0===priority?[primaryMatrixLength-1]:[primaryMatrixLength]).forEach(function(i){dist[i]=maxWidths[i],maxPrioritySpace+=maxWidths[i],remainaingAvailWidth-=dist[i],remainaingWidth-=dist[i]}),matrix[0].forEach(function(e,i){-1===conditions.indexOf(i)&&(dist[i]=remainaingAvailWidth*(maxWidths[i]/remainaingWidth))}),matrix.forEach(function(row){return row.forEach(function(col,cIdx){-1===conditions.indexOf(cIdx)?(col.setAvailableSpace(dist[cIdx],height),cWidths[cIdx]=Math.max(cWidths[cIdx]||0,Math.floor(col.getLogicalSpace().width))):cWidths[cIdx]=0})});var prioritySpace=availableWidth-cWidths.reduce(function(t,n){return t+n});return prioritySpace<0?cWidths=cWidths.map(function(){return 0}):conditions.forEach(function(i){cWidths[i]=Math.floor(prioritySpace*(dist[i]/maxPrioritySpace||1))}),cWidths}},{key:"calculateDepth",value:function calculateDepth(widthMeasures,heightMeasures){var i,height=this.availableSpace().height;for(i=0;i<heightMeasures.length&&!(heightMeasures[i]<=height);i++);return Math.min(widthMeasures.length-1,i)}},{key:"redistributeSpaces",value:function redistributeSpaces(width,height){var _this3=this,maxHeights=[],maxWidths=[],maxMeasures=this.maxMeasures(),maxWidth=maxMeasures.reduce(function(t,n){return t+=n}),logicalWidths=this.getPriorityDistribution({matrix:this._layoutMatrix,maxWidth:maxWidth,maxMeasures:maxMeasures,width:width,height:height});return this.viewableMatrix.forEach(function(matrixInst){var options={mWidth:0,mHeight:0,matrix:matrixInst.matrix,width:width,height:height,maxHeights:maxHeights,maxWidths:maxWidths,logicalWidths:logicalWidths},measures=_this3.redistributeViewSpaces(options);maxWidths=measures.maxWidths,maxHeights=measures.maxHeights}),this.computeViewableSpaces({height:height,width:width,maxHeights:maxHeights,maxWidths:maxWidths})}},{key:"redistributeViewSpaces",value:function redistributeViewSpaces(measures){var rHeights,mHeight,cWidths=[],maxMeasures=this.maxMeasures(),_this$config2=this.config(),isDistributionEqual=_this$config2.isDistributionEqual,distribution=_this$config2.distribution,isTransposed=_this$config2.isTransposed,gutter=_this$config2.gutter,matrix=measures.matrix,height=measures.height,maxHeights=measures.maxHeights,maxWidths=measures.maxWidths,logicalWidths=measures.logicalWidths;mHeight=function spaceTakenByColumn(matrix,colIndex){var height=0,width=0;return matrix.forEach(function(row){var spaces=row[colIndex].getLogicalSpace();width=Math.max(width,spaces.width),height+=spaces.height}),{width:width,height:height}}(matrix,this._lastLevelKey).height;var maxWidth=maxMeasures.reduce(function(t,n){return t+=n});measures.maxMeasures=maxMeasures,measures.maxWidth=maxWidth,cWidths=maxWidth>0?logicalWidths:maxMeasures.map(function(){return 0}),rHeights=function getDistributedHeight(context){var heightWithoutGutter,distSum=0,gutterSum=0,isTransposed=context.isTransposed,distribution=context.distribution,availableHeight=context.availableHeight,height=context.height,isDistributionEqual=context.isDistributionEqual,gutter=context.gutter,matrix=context.matrix,cIdx=context.cIdx;distribution&&void 0!==distribution[0]&&(distSum=distribution.reduce(function(t,n){return t+=n})),gutter&&void 0!==gutter[0]&&(gutterSum=gutter.reduce(function(t,n){return t+=n})),heightWithoutGutter=availableHeight-Math.floor(availableHeight*gutterSum);var colLen=matrix.length;return matrix.map(function(row,rIdx){var space=row[cIdx].getLogicalSpace().height,distHeight=space+space/height*(heightWithoutGutter-height);return isTransposed||(distribution.length>0&&colLen===distribution.length?distHeight=heightWithoutGutter*distribution[rIdx]/distSum:(isDistributionEqual||0===context.height)&&(distHeight=heightWithoutGutter/colLen)),Math.floor(distHeight)})}({matrix:matrix,cIdx:this._lastLevelKey,height:mHeight,availableHeight:height,isDistributionEqual:isDistributionEqual,distribution:distribution,isTransposed:isTransposed,gutter:gutter}),maxWidths.length>0&&(cWidths=cWidths.map(function(e,i){return Math.max(e,maxWidths[0][i]||0)})),maxWidths.push(cWidths);for(var x=0;x<maxWidths.length;x++)maxWidths[x]=cWidths;return maxHeights.push(rHeights),{maxWidths:maxWidths,maxHeights:maxHeights}}},{key:"getCellDimensions",value:function getCellDimensions(measures){var _this4=this,borderWidth=this.config().unitMeasures.border,matrixInst=measures.matrixInst,maxWidths=measures.maxWidths,maxHeights=measures.maxHeights,matrixIndex=measures.matrixIndex,matrix=matrixInst.matrix,rowHeights=[[0],[0]],columnWidths=[[0],[0]],widths=[0,0],breakPointer=this._breakPointer;return matrix.forEach(function(row,rIdx){row.forEach(function(cell,cIdx){var colHeight=maxHeights[matrixIndex][rIdx]||0,colWidth=maxWidths[matrixIndex][cIdx];cell.setAvailableSpace(colWidth,colHeight-borderWidth),0===rIdx&&cIdx<breakPointer?(columnWidths[0][cIdx]=colWidth,widths[0]=(widths[0]||0)+colWidth):0===rIdx&&cIdx>=breakPointer&&(columnWidths[1][cIdx-breakPointer]=colWidth,widths[1]=(widths[1]||0)+colWidth),cIdx===_this4._lastLevelKey&&(rowHeights[0][rIdx]=colHeight,rowHeights[1][rIdx]=colHeight)})}),{heights:[0,0],widths:widths,rowHeights:rowHeights,columnWidths:columnWidths}}}]),RowVisualMatrix}();function column_matrix_typeof(obj){return(column_matrix_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function column_matrix_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function column_matrix_possibleConstructorReturn(self,call){return!call||"object"!==column_matrix_typeof(call)&&"function"!=typeof call?function column_matrix_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function column_matrix_getPrototypeOf(o){return(column_matrix_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function column_matrix_setPrototypeOf(o,p){return(column_matrix_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var column_matrix_ColumnVisualMatrix=function(_VisualMatrix){function ColumnVisualMatrix(matrix){var _this,config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function column_matrix_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ColumnVisualMatrix),(_this=column_matrix_possibleConstructorReturn(this,column_matrix_getPrototypeOf(ColumnVisualMatrix).call(this,matrix,config)))._breakPointer=matrix[0].length,_this._tree={key:COLUMN_ROOT,values:_this.createTree()},_this._logicalSpace=_this.computeLogicalSpace(),_this}return function column_matrix_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&column_matrix_setPrototypeOf(subClass,superClass)}(ColumnVisualMatrix,visual_matrix_VisualMatrix),function column_matrix_createClass(Constructor,protoProps,staticProps){return protoProps&&column_matrix_defineProperties(Constructor.prototype,protoProps),staticProps&&column_matrix_defineProperties(Constructor,staticProps),Constructor}(ColumnVisualMatrix,[{key:"computeLogicalSpace",value:function computeLogicalSpace(){var matrixTree=this.tree();return createMatrixEachLevel(matrixTree,!0),utils_computeLogicalSpace(matrixTree,this.config(),this.maxMeasures())}},{key:"computeViewableSpaces",value:function computeViewableSpaces(measures){var _this2=this,maxHeights=measures.maxHeights,maxWidths=measures.maxWidths,height=measures.height,width=measures.width;return this.viewableMatrix.map(function(matrixInst,i){var cellDimOptions={matrixInst:matrixInst,maxWidths:maxWidths,maxHeights:maxHeights,matrixIndex:i,height:height},_this2$getCellDimensi=_this2.getCellDimensions(cellDimOptions),heights=_this2$getCellDimensi.heights,rowHeights=_this2$getCellDimensi.rowHeights,columnWidths=_this2$getCellDimensi.columnWidths,heightMeasures=heights,columnMeasures=[width,width];return{rowHeights:{primary:rowHeights[0],secondary:rowHeights[1]},columnWidths:{primary:columnWidths[0],secondary:columnWidths[1]},height:{primary:heightMeasures[0],secondary:heightMeasures[1]},width:{primary:columnMeasures[0],secondary:columnMeasures[1]}}})}},{key:"removeExtraCells",value:function removeExtraCells(){var _this$config=this.config(),isTransposed=_this$config.isTransposed,extraCellLengths=_this$config.extraCellLengths,matrix=this._layoutMatrix,tree=mergeRecursive({},this.tree()),begCellLen=extraCellLengths[0],endCellLen=extraCellLengths[1]||Number.NEGATIVE_INFINITY,layoutMatrix=isTransposed?matrix.slice(0).map(function(e){return extraCellsRemover(e,begCellLen,endCellLen)}):extraCellsRemover(matrix,begCellLen,endCellLen);return tree.values=extraCellsRemover(tree.values,begCellLen,endCellLen),tree.matrix=tree.matrix.map(function(e){return extraCellsRemover(e,begCellLen,endCellLen)}),{tree:tree,layoutMatrix:layoutMatrix}}},{key:"getPriorityDistribution",value:function getPriorityDistribution(measures){var height=measures.height,maxHeights=measures.maxHeights,remainaingHeight=height,heightDist=[],conditions=[],divider=2,priority=this.config().priority,primaryMatrixLength=this.primaryMatrix().length;return 2===priority?(conditions=[primaryMatrixLength-1,primaryMatrixLength],divider=2):(conditions=0===priority?[primaryMatrixLength-1]:[primaryMatrixLength],divider=1),maxHeights.forEach(function(e,i){-1===conditions.indexOf(i)&&(heightDist[i]=e,remainaingHeight-=e)}),remainaingHeight<0?heightDist=heightDist.map(function(){return 0}):conditions.forEach(function(e){remainaingHeight/divider<maxHeights[e]?heightDist[e]=0:heightDist[e]=Math.min(maxHeights[e],remainaingHeight/divider)}),heightDist}},{key:"calculateDepth",value:function calculateDepth(widthMeasures){var j,width=this.availableSpace().width;for(j=0;j<widthMeasures.length&&!(widthMeasures[j]<=width);j++);return Math.min(widthMeasures.length-1,j)}},{key:"redistributeSpaces",value:function redistributeSpaces(width,height){var _this3=this,maxHeights=[],maxWidths=[];return this.viewableMatrix.forEach(function(matrixInst){var options={mWidth:0,mHeight:0,matrix:matrixInst.matrix,width:width,height:height,maxHeights:maxHeights,maxWidths:maxWidths},maxMeasures=_this3.redistributeViewSpaces(options);maxWidths=maxMeasures.maxWidths,maxHeights=maxMeasures.maxHeights}),this.computeViewableSpaces({height:height,width:width,maxHeights:maxHeights,maxWidths:maxWidths})}},{key:"redistributeViewSpaces",value:function redistributeViewSpaces(measures){var rHeights=[],matrix=measures.matrix,width=measures.width,maxHeights=measures.maxHeights,maxWidths=measures.maxWidths,borderWidth=this.config().unitMeasures.border,mWidth=function spaceTakenByRow(row){var height=0,width=0;return row.forEach(function(col){var spaces=col.getLogicalSpace();height=Math.max(height,spaces.height),width+=spaces.width}),{width:width,height:height}}(matrix[this._lastLevelKey]).width,cWidths=function getDistributedWidth(context,layoutConfig){var availableWidth=context.availableWidth,width=context.width,row=context.row,isDistributionEqual=layoutConfig.isDistributionEqual,isTransposed=layoutConfig.isTransposed,distribution=layoutConfig.distribution,distSum=0;return distribution&&distribution[0]&&(distSum=distribution.reduce(function(t,n){return t+=n})),row.map(function(col,colIndex){var space=col.getLogicalSpace().width,distWidth=space+space/width*(availableWidth-width);if(isTransposed)if(distribution.length>0)distWidth=availableWidth*distribution[colIndex]/distSum;else if(isDistributionEqual||0===width){var rowLen=row.length;distWidth=availableWidth/rowLen}return Math.floor(distWidth)})}({row:matrix[this._lastLevelKey],width:mWidth,availableWidth:width},this.config());matrix.forEach(function(row,rIdx){return row.forEach(function(col,cIdx){var oldLogicalSpace=col.getLogicalSpace();col.setAvailableSpace(cWidths[cIdx]-borderWidth,oldLogicalSpace.height),rHeights[rIdx]=Math.max(rHeights[rIdx]||0,Math.floor(col.getLogicalSpace().height))})}),maxHeights.length>0&&(rHeights=rHeights.map(function(e,i){return Math.max(e,maxHeights[0][i])})),maxHeights.push(rHeights);for(var x=0;x<maxHeights.length;x++)maxHeights[x]=rHeights;return maxWidths.push(cWidths),{maxHeights:maxHeights,maxWidths:maxWidths}}},{key:"getCellDimensions",value:function getCellDimensions(measures){var _this4=this,borderWidth=this.config().unitMeasures.border,matrixInst=measures.matrixInst,height=measures.height,maxWidths=measures.maxWidths,maxHeights=measures.maxHeights,matrixIndex=measures.matrixIndex,matrix=matrixInst.matrix,rowHeights=[[0],[0]],columnWidths=[[0],[0]],heights=[0,0],breakPointer=this._breakPointer,heightDistribution=this.getPriorityDistribution({height:height,maxHeights:maxHeights[0]||[]});return matrix.forEach(function(row,rIdx){row.forEach(function(cell,cIdx){var colHeight=heightDistribution[rIdx]||0,colWidth=maxWidths[matrixIndex][cIdx];cell.setAvailableSpace(colWidth-borderWidth,colHeight),0===cIdx&&rIdx<breakPointer?(rowHeights[0][rIdx]=colHeight,heights[0]=(heights[0]||0)+colHeight):0===cIdx&&rIdx>=breakPointer&&(rowHeights[1][rIdx-breakPointer]=colHeight,heights[1]=(heights[1]||0)+colHeight),rIdx===_this4._lastLevelKey&&(columnWidths[0][cIdx]=colWidth,columnWidths[1][cIdx]=colWidth)})}),{heights:heights,widths:[0,0],rowHeights:rowHeights,columnWidths:columnWidths}}}]),ColumnVisualMatrix}();function layout_helper_toConsumableArray(arr){return function layout_helper_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function layout_helper_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function layout_helper_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function layout_helper_slicedToArray(arr,i){return function layout_helper_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function layout_helper_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function layout_helper_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function computations_toConsumableArray(arr){return function computations_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function computations_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function computations_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function computations_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function getMatrixMeasurement(matrix,type){return matrix?matrix.getLogicalSpace()[type]:0}var computations_setAvailableSpace=function setAvailableSpace(matrix,widths,heights){matrix.forEach(function(row,rIdx){row.forEach(function(placeholder,cIdx){placeholder.setAvailableSpace(widths[cIdx],heights[rIdx])})})},setViewSpaces=function setViewSpaces(layout,pointerType,viewSpaces){var pointer=layout.config()["".concat(pointerType,"Pointer")];return viewSpaces.length-1<pointer&&(pointer=0,layout.config(computations_defineProperty({},"".concat(pointerType,"Pointer"),pointer))),pointer},paginationDetailsMap={column:{maxMeasure:"maxWidthAvailableForColumnMatrix",matrix:"columnMatrix",measureType:"width",scrollType:"horizontal"},row:{maxMeasure:"maxHeightAvailableForRowMatrix",matrix:"rowMatrix",measureType:enums_constants_HEIGHT,scrollType:"vertical"}},paginationMeasureGetter=function paginationMeasureGetter(layout,matrixType,relatedMaxMeasure){return function getMatrixMeasureForPagination(layout,measureDetails,maxMeasure){var _layout$config2=layout.config(),pagination=_layout$config2.pagination,buffer=_layout$config2.buffer,matrix=measureDetails.matrix,measureType=measureDetails.measureType,scrollType=measureDetails.scrollType;switch(pagination){case"holistic":return maxMeasure;default:var actualMeasure=getMatrixMeasurement(layout[matrix](),measureType);return actualMeasure>maxMeasure&&layout.scrollInfo(computations_defineProperty({},scrollType,!0)),Math.max(maxMeasure-buffer,actualMeasure)}}(layout,paginationDetailsMap[matrixType],relatedMaxMeasure)},measureSum=function measureSum(measureArr){return measureArr.reduce(function(total,measure){return total+measure},0)};function layout_typeof(obj){return(layout_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function layout_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function layout_possibleConstructorReturn(self,call){return!call||"object"!==layout_typeof(call)&&"function"!=typeof call?function layout_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function layout_get(target,property,receiver){return(layout_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function layout_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=layout_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function layout_getPrototypeOf(o){return(layout_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function layout_setPrototypeOf(o,p){return(layout_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var _borderMap,layout_GridLayout=function(_GenericLayout){function GridLayout(matrices,mountPoint,measurement,config){var _this;return function layout_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GridLayout),(_this=layout_possibleConstructorReturn(this,layout_getPrototypeOf(GridLayout).call(this,mountPoint,measurement,config))).matrices(matrices),_this.config(_this.constructor.defaultConfig()),_this._layoutId=getUniqueId(),_this._viewInfo=_this.constructor.defaultViewInfo(),_this._scrollInfo={horizontal:!1,vertical:!1},_this}return function layout_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&layout_setPrototypeOf(subClass,superClass)}(GridLayout,generic_layout_GenericLayout),function layout_createClass(Constructor,protoProps,staticProps){return protoProps&&layout_defineProperties(Constructor.prototype,protoProps),staticProps&&layout_defineProperties(Constructor,staticProps),Constructor}(GridLayout,[{key:"matrices",value:function matrices(_matrices){return _matrices?(this._matrices=function generateVisualMatrices(context,matrices){var begColCells,endColCells,leftMatrix=[],rightMatrix=[],topMatrix=[],bottomMatrix=[],_context$config=context.config(),isRowSizeEqual=_context$config.isRowSizeEqual,isColumnSizeEqual=_context$config.isColumnSizeEqual,gutterSpace=_context$config.gutterSpace,distribution=_context$config.distribution,border=_context$config.border,breakPage=_context$config.breakPage,priority=_context$config.priority,_context$measurement=context.measurement(),minUnitHeight=_context$measurement.minUnitHeight,minUnitWidth=_context$measurement.minUnitWidth,top=matrices.top,center=matrices.center,bottom=matrices.bottom,_top=layout_helper_slicedToArray(top,3),topLeft=_top[0],topColumns=_top[1],topRight=_top[2],_center=layout_helper_slicedToArray(center,3),leftRows=_center[0],valueMatrix=_center[1],rightRows=_center[2],_bottom=layout_helper_slicedToArray(bottom,3),bottomLeft=_bottom[0],bottomColumns=_bottom[1],bottomRight=_bottom[2];return leftRows.length>0&&(leftMatrix=[].concat(layout_helper_toConsumableArray(topLeft),layout_helper_toConsumableArray(leftRows),layout_helper_toConsumableArray(bottomLeft))),rightRows.length>0&&(rightMatrix=[].concat(layout_helper_toConsumableArray(topRight),layout_helper_toConsumableArray(rightRows),layout_helper_toConsumableArray(bottomRight))),topColumns.length>0&&topColumns[0].length>0&&(topMatrix=topColumns.map(function(d,i){return[].concat(layout_helper_toConsumableArray(topLeft[i]),layout_helper_toConsumableArray(d),layout_helper_toConsumableArray(topRight[i]))})),bottomColumns.length>0&&bottomColumns[0].length>0&&(bottomMatrix=bottomColumns.map(function(d,i){return[].concat(layout_helper_toConsumableArray(bottomLeft[i]),layout_helper_toConsumableArray(d),layout_helper_toConsumableArray(bottomRight[i]))})),context.rowMatrix(new row_matrix_RowVisualMatrix([leftMatrix,rightMatrix],{isDistributionEqual:isRowSizeEqual,distribution:distribution.rows,gutter:gutterSpace.rows,unitMeasures:{width:minUnitWidth,height:minUnitHeight,border:border.width},priority:priority.row,breakPage:breakPage.rows.map(function(e){return e+Math.max(topLeft.length,topRight.length)}),extraCellLengths:[topLeft.length,bottomLeft.length]})),begColCells=topLeft.length>0?topLeft[0].length:bottomLeft.length>0?bottomLeft[0].length:0,endColCells=topRight.length>0?topRight[0].length:bottomRight.length>0?bottomRight[0].length:0,context.columnMatrix(new column_matrix_ColumnVisualMatrix([topMatrix,bottomMatrix],{isDistributionEqual:isColumnSizeEqual,distribution:distribution.columns,gutter:gutterSpace.columns,isTransposed:!0,unitMeasures:{width:minUnitWidth,height:minUnitHeight,border:border.width},priority:priority.col,breakPage:breakPage.columns,extraCellLengths:[begColCells,endColCells]})),context.centerMatrix(valueMatrix),matrices}(this,_matrices),this):layout_get(layout_getPrototypeOf(GridLayout.prototype),"matrices",this).call(this,_matrices)}},{key:"triggerReflow",value:function triggerReflow(){var _computeLayoutMeasure=function computeLayoutMeasurements(layout){var _ref,_ref2,_ref3,_ref4,_ref5,rowMatrix=layout.rowMatrix(),columnMatrix=layout.columnMatrix(),centerMatrix=layout.centerMatrix(),_layout$measurement=layout.measurement(),width=_layout$measurement.width,height=_layout$measurement.height,_layout$config3=layout.config(),border=_layout$config3.border,buffer=_layout$config3.buffer,pagination=_layout$config3.pagination,matrices=layout.matrices(),top=matrices.top,bottom=matrices.bottom,actualBuffer="holistic"===pagination?0:buffer,rowMatrixWidth=getMatrixMeasurement(rowMatrix,"width"),maxRowMatrixWidth=Math.min(rowMatrixWidth,width/2),borderWidth=border.width,maxWidthAvailableForColumnMatrix=width-maxRowMatrixWidth-border.width,columnMatrixWidth=paginationMeasureGetter(layout,"column",maxWidthAvailableForColumnMatrix),maxColumnMatrixHeight=Math.min(columnMatrix.getLogicalSpace().height,height/2);columnMatrix.setAvailableSpace(columnMatrixWidth,maxColumnMatrixHeight);var columnViewPages=columnMatrix.getViewableSpaces();setViewSpaces(layout,"column",columnViewPages);var columnViewSpace=columnViewPages[layout.config().columnPointer],columnMatrixHeight=columnViewSpace.height.primary+columnViewSpace.height.secondary,maxHeightAvailableForRowMatrix=height-maxColumnMatrixHeight,rowMatrixHeight=paginationMeasureGetter(layout,"row",maxHeightAvailableForRowMatrix);rowMatrix.setAvailableSpace(maxRowMatrixWidth,rowMatrixHeight);var rowViewableSpaces=rowMatrix.getViewableSpaces();setViewSpaces(layout,"row",rowViewableSpaces);var rowHeights=(_ref=[]).concat.apply(_ref,computations_toConsumableArray(rowViewableSpaces.map(function(e){return e.rowHeights.primary}))),rowWidthsPrimary=(_ref2=[]).concat.apply(_ref2,computations_toConsumableArray(rowViewableSpaces.map(function(e){return e.columnWidths.primary}))),rowWidthsSecondary=(_ref3=[]).concat.apply(_ref3,computations_toConsumableArray(rowViewableSpaces.map(function(e){return e.columnWidths.secondary}))),columnViewableSpaces=columnMatrix.getViewableSpaces(),columnWidths=(_ref4=[]).concat.apply(_ref4,computations_toConsumableArray(columnViewableSpaces.map(function(e){return e.columnWidths.primary}))),columnHeightsPrimary=columnViewableSpaces[0].rowHeights.primary,columnHeightsSecondary=(_ref5=[]).concat.apply(_ref5,computations_toConsumableArray(columnViewableSpaces.map(function(e){return e.rowHeights.secondary})));return centerMatrix.forEach(function(matrix,rIdx){matrix.forEach(function(placeholder,cIdx){placeholder.setAvailableSpace(columnWidths[cIdx]-borderWidth,rowHeights[rIdx]-borderWidth)})}),computations_setAvailableSpace(top[0],rowWidthsPrimary,columnHeightsPrimary),computations_setAvailableSpace(top[2],rowWidthsSecondary,columnHeightsPrimary),computations_setAvailableSpace(bottom[0],rowWidthsPrimary,columnHeightsSecondary),computations_setAvailableSpace(bottom[2],rowWidthsSecondary,columnHeightsSecondary),{rowMatrixHeight:rowMatrixHeight,rowMatrixWidth:rowMatrixWidth,maxHeightAvailableForRowMatrix:maxHeightAvailableForRowMatrix-actualBuffer,columnMatrixHeight:columnMatrixHeight,columnMatrixWidth:columnMatrixWidth,maxWidthAvailableForColumnMatrix:maxWidthAvailableForColumnMatrix-actualBuffer}}(this),maxHeightAvailableForRowMatrix=_computeLayoutMeasure.maxHeightAvailableForRowMatrix,maxWidthAvailableForColumnMatrix=_computeLayoutMeasure.maxWidthAvailableForColumnMatrix;return this.setViewInformation(maxHeightAvailableForRowMatrix,maxWidthAvailableForColumnMatrix),this}},{key:"gotoPage",value:function gotoPage(type,pageNumber){var pageType=type.toLowerCase(),totalPages=this.viewInfo().viewMatricesInfo["".concat(pageType,"Pages")],pointer=Math.min(Math.max(1,pageNumber),totalPages);return this.config(function layout_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},"".concat(pageType,"Pointer"),pointer-1)),this.setViewInformation(),this.renderGrid(),this}},{key:"pages",value:function pages(type){var viewMatricesInfo=this.viewInfo().viewMatricesInfo,pageType=type.toLowerCase();return{totalPages:viewMatricesInfo["".concat(pageType,"Pages")],currentPage:this.config()["".concat(pageType,"Pointer")]+1}}},{key:"viewInfo",value:function viewInfo(){return arguments.length?(this._viewInfo=arguments.length<=0?void 0:arguments[0],this):this._viewInfo}},{key:"scrollInfo",value:function scrollInfo(){return arguments.length?(this._scrollInfo=mergeRecursive(this._scrollInfo,arguments.length<=0?void 0:arguments[0]),this):this._scrollInfo}},{key:"setViewInformation",value:function setViewInformation(maxRowHeight,maxColWidth){var _this$config2=this.config(),rowPointer=_this$config2.rowPointer,columnPointer=_this$config2.columnPointer,border=_this$config2.border,viewMatricesInfo=function getViewMatrices(layout,rowPointer,columnPointer){for(var rowMatrix=layout.rowMatrix(),columnMatrix=layout.columnMatrix(),centerMatrix=layout.centerMatrix(),matrices=layout.matrices(),rowMatrices=rowMatrix.getViewableMatrices(),columnMatrices=columnMatrix.getViewableMatrices(),centralMatrixPointer={row:0,column:0},i=rowPointer-1;i>=0;i--){var length=Math.max(rowMatrices[i].primaryMatrix.length,rowMatrices[i].secondaryMatrix.length);centralMatrixPointer.row+=length}for(var _i=columnPointer-1;_i>=0;_i--){var matrix=columnMatrices[_i],primaryMatrix=matrix.primaryMatrix,secondaryMatrix=matrix.secondaryMatrix,_length=Math.max(primaryMatrix[0]?primaryMatrix[0].length:0,secondaryMatrix[0]?secondaryMatrix[0].length:0);centralMatrixPointer.column+=_length}matrices.top[1]=columnMatrices[columnPointer].primaryMatrix,matrices.bottom[1]=columnMatrices[columnPointer].secondaryMatrix,matrices.center[0]=rowMatrices[rowPointer].primaryMatrix,matrices.center[2]=rowMatrices[rowPointer].secondaryMatrix;var rowMatrixLen=Math.max(matrices.center[0].length,matrices.center[2].length),columnMatrixLen=Math.max(matrices.top[1][0]?matrices.top[1][0].length:0,matrices.bottom[1][0]?matrices.bottom[1][0].length:0);return matrices.center[1]=centerMatrix.slice(centralMatrixPointer.row,centralMatrixPointer.row+rowMatrixLen).map(function(matrix){return matrix.slice(centralMatrixPointer.column,centralMatrixPointer.column+columnMatrixLen)}),{matrices:matrices,rowPages:rowMatrices.length,columnPages:columnMatrices.length}}(this,rowPointer,columnPointer),layoutDimensions=function getViewMeasurements(layout,maxRowHeight,maxColWidth){var rowMatrix=layout.rowMatrix(),columnMatrix=layout.columnMatrix(),_layout$config4=layout.config(),columnPointer=_layout$config4.columnPointer,rowPointer=_layout$config4.rowPointer,rowSpaces=rowMatrix.getViewableSpaces()[rowPointer],colSpaces=columnMatrix.getViewableSpaces()[columnPointer],rowHeights=rowSpaces.rowHeights,rowMatrixWidth=rowSpaces.width,columnWidths=colSpaces.columnWidths,columnMatrixHeight=colSpaces.height,leftWidth=rowMatrixWidth.primary,rightWidth=rowMatrixWidth.secondary,topHeight=columnMatrixHeight.primary,bottomHeight=columnMatrixHeight.secondary,centerHeight=measureSum(rowHeights.primary),centerWidth=measureSum(columnWidths.primary),viewWidth=[leftWidth,Math.min(centerWidth,maxColWidth),rightWidth],viewHeight=[topHeight,Math.min(centerHeight,maxRowHeight),bottomHeight];return{viewWidth:viewWidth,viewHeight:viewHeight,actualCenterMeasures:{height:centerHeight,width:centerWidth},totalMeasures:{width:measureSum(viewWidth),height:measureSum(viewHeight)},unitHeights:rowHeights,unitWidths:columnWidths}}(this,maxRowHeight,maxColWidth);return layoutDimensions.border=border,this.viewInfo({viewMatricesInfo:viewMatricesInfo,layoutDimensions:layoutDimensions}),this}}],[{key:"defaultViewInfo",value:function defaultViewInfo(){return Object.assign({},{layoutDimensions:{border:this.defaultConfig().border,viewHeight:[0,0,0],viewWidth:[0,0,0]},viewMatricesInfo:{columnPages:0,rowPages:0,matrices:{top:[],center:[],bottom:[]}}})}},{key:"defaultMeasurement",value:function defaultMeasurement(){return DEFAULT_MEASUREMENTS}},{key:"defaultConfig",value:function defaultConfig(){return DEFAULT_CONFIGURATION}},{key:"create",value:function create(){return new GridLayout(null,null,this.defaultMeasurement(),this.defaultConfig())}}]),GridLayout}();function border_helper_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _matrixSpanGeneratorM,_spanApplierMap,borderMap=(border_helper_defineProperty(_borderMap={},"".concat("top","-").concat("left"),null),border_helper_defineProperty(_borderMap,"".concat("top","-").concat("middle"),"column"),border_helper_defineProperty(_borderMap,"".concat("top","-").concat("right"),null),border_helper_defineProperty(_borderMap,"".concat("center","-").concat("left"),"row"),border_helper_defineProperty(_borderMap,"".concat("center","-").concat("middle"),"center"),border_helper_defineProperty(_borderMap,"".concat("center","-").concat("right"),"row"),border_helper_defineProperty(_borderMap,"".concat("right","-").concat("left"),null),border_helper_defineProperty(_borderMap,"".concat("right","-").concat("middle"),"column"),border_helper_defineProperty(_borderMap,"".concat("right","-").concat("right"),null),_borderMap),border_helper_specificBorderApplier=function specificBorderApplier(borderTypes,showBorders,cells,borderInfo){var color=borderInfo.color,width=borderInfo.width,style=borderInfo.style,borderStyle="".concat(width,"px ").concat(style);borderTypes.forEach(function(borderType){!function applySpecificBorder(cells,color,type,style){cells.style("border-".concat(type),"".concat(style," ").concat(color))}(cells,showBorders[borderType]?color:"rgba(0,0,0,0)",borderType,borderStyle)})},border_helper_applyBorders=function applyBorders(cells,border,row,column){var borderApplierFn=function borderApplier(cells,borderInfo){var showRowBorders=borderInfo.showRowBorders,showColBorders=borderInfo.showColBorders,showValueBorders=borderInfo.showValueBorders;return{row:function row(){return border_helper_specificBorderApplier(["top","bottom"],showRowBorders,cells,borderInfo)},column:function column(){return border_helper_specificBorderApplier(["left","right"],showColBorders,cells,borderInfo)},center:function center(){return border_helper_specificBorderApplier(["left","right","top","bottom"],showValueBorders,cells,borderInfo)}}}(cells,border),borderMapVal=borderMap["".concat(ROW_MATRIX_INDEX[VIEW_INDEX[row]],"-").concat(COLUMN_MATRIX_INDEX[column])];borderMapVal&&borderApplierFn[borderMapVal]()};function span_maker_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var orderMaker=function orderMaker(arr){return Array.from(Array(arr.length).keys())},nestByStack=function nestByStack(stack,updateArr){var optionalParams=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},order=optionalParams.order,keyFn=optionalParams.keyFn,arr=updateArr.slice(),currStack=stack.slice(),prevStack=currStack.slice();if(order=order||Array.from(Array(arr.length).keys()),keyFn=keyFn||function(v){return v},0===currStack.length){var _newArr=[];return order.forEach(function(e){_newArr.push(arr[e])}),{prevStack:prevStack,currStack:arr,arr:_newArr}}for(var arrVal="",stackVal="",newArr=[],i=order.length-1;i>=0;i--){var currElemIndex=order[i];if((arrVal+=keyFn(arr[currElemIndex]))===(stackVal+=keyFn(currStack[currElemIndex])))newArr[currElemIndex]=null;else{stackVal="";for(var j=i;j<order.length;j++){var newElem=order[j],arrElem=arr[newElem];newArr[newElem]=arrElem,currStack[newElem]=arrElem,stackVal=arrVal}}}var returnArr=[];return order.forEach(function(e){returnArr.push(newArr[e])}),{prevStack:prevStack,currStack:currStack,arr:returnArr}},spanCalculator=function spanCalculator(colData,colIdx,matrix,rIdx){if(!colData)return function(){return 1};var conditions={row:function row(count){return matrix[rIdx+count]&&matrix[rIdx+count][colIdx]},column:function column(count){return matrix[rIdx][colIdx+count]}};return function(type){for(var count=1,isNull=!1;!isNull;)null===conditions[type](count)?count+=1:isNull=!0;return count}},maskCreator=function maskCreator(matrix,order){return{row:function row(){var stack=[];return matrix.map(function(e){var _nestByStack=nestByStack(stack,e,{keyFn:function keyFn(val){return val.valueOf()},order:order}),currStack=_nestByStack.currStack,arr=_nestByStack.arr;return stack=currStack,arr})},column:function column(){var stack=[],viewMatrix=[];return matrix.length&&matrix[0].forEach(function(cell,colIndex){var hierarchy=[];matrix.forEach(function(row){hierarchy.push(row[colIndex])});var _nestByStack2=nestByStack(stack,hierarchy,{keyFn:function keyFn(val){return val.valueOf()},order:order}),currStack=_nestByStack2.currStack,arr=_nestByStack2.arr;stack=currStack,matrix.forEach(function(row,rowIndex){viewMatrix[rowIndex]=viewMatrix[rowIndex]||[],viewMatrix[rowIndex][colIndex]=arr[rowIndex]})}),viewMatrix}}},spanGenerator=function spanGenerator(viewMatrix){return{row:function row(){var spans=[];return viewMatrix.forEach(function(row,ridx){spans[ridx]=spans[ridx]||[],row.forEach(function(col,i){if(viewMatrix[ridx][i]){var currSpan=spanCalculator(col,i,viewMatrix,ridx)("row");currSpan&&spans[ridx].push(currSpan)}})}),spans},column:function column(){return viewMatrix.map(function(row,ridx){return row.map(function(col,i){return spanCalculator(col,i,viewMatrix,ridx)("column")}).filter(function(col){return 1!==col})})}}},getOrder=function getOrder(isReverse){return{row:function row(matrix){return isReverse?orderMaker(matrix[0]).reverse():orderMaker(matrix[0])},column:function column(matrix){return isReverse?orderMaker(matrix).reverse():orderMaker(matrix)}}},matrixSpanGeneratorMap=(span_maker_defineProperty(_matrixSpanGeneratorM={},"".concat("top","-1"),{orderGetter:getOrder(!1).column,viewMatrixMaker:function viewMatrixMaker(){return maskCreator.apply(void 0,arguments).column},spanMaker:function spanMaker(){return spanGenerator.apply(void 0,arguments).column}}),span_maker_defineProperty(_matrixSpanGeneratorM,"".concat("bottom","-1"),{orderGetter:getOrder(!0).column,viewMatrixMaker:function viewMatrixMaker(){return maskCreator.apply(void 0,arguments).column},spanMaker:function spanMaker(){return spanGenerator.apply(void 0,arguments).column}}),span_maker_defineProperty(_matrixSpanGeneratorM,"".concat("center","-0"),{orderGetter:getOrder(!1).row,viewMatrixMaker:function viewMatrixMaker(){return maskCreator.apply(void 0,arguments).row},spanMaker:function spanMaker(){return spanGenerator.apply(void 0,arguments).row}}),span_maker_defineProperty(_matrixSpanGeneratorM,"".concat("center","-2"),{orderGetter:getOrder(!0).row,viewMatrixMaker:function viewMatrixMaker(){return maskCreator.apply(void 0,arguments).row},spanMaker:function spanMaker(){return spanGenerator.apply(void 0,arguments).row}}),_matrixSpanGeneratorM),matrixSpanGenerator=function matrixSpanGenerator(type){var generator=matrixSpanGeneratorMap[type];return generator||{orderGetter:function orderGetter(){return null},viewMatrixMaker:function viewMatrixMaker(matrix){return function(){return matrix}},spanMaker:function spanMaker(){return function(){return null}}}};var spanApplier=function spanApplier(cells,spans,config,type){var borderWidth=config.border.width;cells.attr(type,function(cell,colIndex){var span=spans[cell.rowIndex][colIndex];return function spaceAllocationDueToSpan(span,placeholder,borderWidth){var _ref,height=placeholder.availHeight(),width=placeholder.availWidth();return span_maker_defineProperty(_ref={},"rowSpan",function(){renderer_utils_selectElement(this).style("height","".concat(height+borderWidth,"px")),span>1&&(renderer_utils_selectElement(this).style("height","".concat(height*span+borderWidth*span,"px")),placeholder.setAvailableSpace(width,height*span))}),span_maker_defineProperty(_ref,"colSpan",function(){span>1&&placeholder.setAvailableSpace(width*span+borderWidth*(span-1),height),renderer_utils_selectElement(this).style("height","".concat(height,"px"))}),_ref}(span,cell.placeholder,borderWidth)[type].bind(this)(),span})},spanApplierMap=(span_maker_defineProperty(_spanApplierMap={},"".concat("top","-0"),null),span_maker_defineProperty(_spanApplierMap,"".concat("top","-1"),function _(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return spanApplier.apply(void 0,params.concat(["colSpan"]))}),span_maker_defineProperty(_spanApplierMap,"".concat("top","-2"),null),span_maker_defineProperty(_spanApplierMap,"".concat("center","-0"),function _(){for(var _len2=arguments.length,params=new Array(_len2),_key2=0;_key2<_len2;_key2++)params[_key2]=arguments[_key2];return spanApplier.apply(void 0,params.concat(["rowSpan"]))}),span_maker_defineProperty(_spanApplierMap,"".concat("center","-1"),null),span_maker_defineProperty(_spanApplierMap,"".concat("center","-2"),function _(){for(var _len3=arguments.length,params=new Array(_len3),_key3=0;_key3<_len3;_key3++)params[_key3]=arguments[_key3];return spanApplier.apply(void 0,params.concat(["rowSpan"]))}),span_maker_defineProperty(_spanApplierMap,"".concat("bottom","-0"),null),span_maker_defineProperty(_spanApplierMap,"".concat("bottom","-1"),function _(){for(var _len4=arguments.length,params=new Array(_len4),_key4=0;_key4<_len4;_key4++)params[_key4]=arguments[_key4];return spanApplier.apply(void 0,params.concat(["colSpan"]))}),span_maker_defineProperty(_spanApplierMap,"".concat("bottom","-2"),null),_spanApplierMap);function transaction_support_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var transaction_support_TransactionSupport=function(){function TransactionSupport(){!function transaction_support_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TransactionSupport)}return function transaction_support_createClass(Constructor,protoProps,staticProps){return protoProps&&transaction_support_defineProperties(Constructor.prototype,protoProps),staticProps&&transaction_support_defineProperties(Constructor,staticProps),Constructor}(TransactionSupport,[{key:"data",value:function data(){throw new Error(ERROR_MSG.INTERFACE_IMPl)}},{key:"width",value:function width(){throw new Error(ERROR_MSG.INTERFACE_IMPl)}},{key:"height",value:function height(){throw new Error(ERROR_MSG.INTERFACE_IMPl)}},{key:"config",value:function config(){throw new Error(ERROR_MSG.INTERFACE_IMPl)}}]),TransactionSupport}();function component_resolver_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var visual_cell_src_enums_constants_LEFT="left",visual_cell_src_enums_constants_RIGHT="right",visual_cell_src_enums_constants_BOTTOM="bottom",visual_cell_src_enums_constants_TOP="top",visual_cell_src_enums_constants_CLASSPREFIX="muze",constants_HEADER="header",enums_constants_DATA="data",enums_constants_AXES="axes",constants_FACET_BY_FIELDS="facetByFields",constants_FIELDS="fields",enums_constants_TRANSFORM="transform",LAYER_DEF="layerDef",src_enums_constants_CONFIG="config",DETAIL_FIELDS="detailFields",cell_type_TEXT="text",cell_type_AXIS="axis",GEOM="geom",BLANK="blank";function simple_cell_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _CONSTANTS$MARGIN,_DEFAULT_CONFIG,simple_cell=function(){function SimpleCell(config){!function simple_cell_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SimpleCell),this._id=getUniqueId();var defConfig=mergeRecursive({},this.constructor.defaultConfig());this._config=mergeRecursive(defConfig,config||{}),this._mount=null}return function simple_cell_createClass(Constructor,protoProps,staticProps){return protoProps&&simple_cell_defineProperties(Constructor.prototype,protoProps),staticProps&&simple_cell_defineProperties(Constructor,staticProps),Constructor}(SimpleCell,[{key:"valueOf",value:function valueOf(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"id",value:function id(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"serialize",value:function serialize(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"getLogicalSpace",value:function getLogicalSpace(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"setAvailableSpace",value:function setAvailableSpace(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"render",value:function render(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"remove",value:function remove(){throw new Error(ERROR_MSG.INTERFACE_IMPL)}},{key:"type",get:function get(){return"simple"}}],[{key:"defaultConfig",value:function defaultConfig(){return{}}}]),SimpleCell}();function enums_defaults_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var visual_cell_src_props_PROPS,enums_defaults_DEFAULT_CONFIG=(enums_defaults_defineProperty(_DEFAULT_CONFIG={},"margin",(enums_defaults_defineProperty(_CONSTANTS$MARGIN={},visual_cell_src_enums_constants_LEFT,0),enums_defaults_defineProperty(_CONSTANTS$MARGIN,visual_cell_src_enums_constants_RIGHT,0),enums_defaults_defineProperty(_CONSTANTS$MARGIN,visual_cell_src_enums_constants_TOP,0),enums_defaults_defineProperty(_CONSTANTS$MARGIN,visual_cell_src_enums_constants_BOTTOM,0),_CONSTANTS$MARGIN)),enums_defaults_defineProperty(_DEFAULT_CONFIG,"spaceFixer",2),enums_defaults_defineProperty(_DEFAULT_CONFIG,"isOffset",!1),enums_defaults_defineProperty(_DEFAULT_CONFIG,"verticalAlign",null),enums_defaults_defineProperty(_DEFAULT_CONFIG,"textAlign","center"),enums_defaults_defineProperty(_DEFAULT_CONFIG,"show",!0),enums_defaults_defineProperty(_DEFAULT_CONFIG,"maxLines",0),enums_defaults_defineProperty(_DEFAULT_CONFIG,"minCharacters",0),enums_defaults_defineProperty(_DEFAULT_CONFIG,"rotation",null),_DEFAULT_CONFIG);function src_props_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var DEFAULT_PROPS={mount:{},availHeight:{},availWidth:{},config:{sanitization:function sanitization(context,value){return mergeRecursive(context._config,value)}},logicalSpace:{},minSpacing:{},source:{}},packages_visual_cell_src_props_PROPS=(src_props_defineProperty(visual_cell_src_props_PROPS={},GEOM,mergeRecursive({data:{},caption:{},config:{},axes:{sanitization:function sanitization(context,value){return Object.assign(context._axes,value)}},facetByFields:{},fields:{},transform:{},layerDef:{},detailFields:{}},DEFAULT_PROPS)),src_props_defineProperty(visual_cell_src_props_PROPS,cell_type_TEXT,mergeRecursive({smartText:{}},DEFAULT_PROPS)),src_props_defineProperty(visual_cell_src_props_PROPS,cell_type_AXIS,DEFAULT_PROPS),src_props_defineProperty(visual_cell_src_props_PROPS,BLANK,DEFAULT_PROPS),visual_cell_src_props_PROPS);function axis_cell_typeof(obj){return(axis_cell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function axis_cell_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function axis_cell_getPrototypeOf(o){return(axis_cell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function axis_cell_setPrototypeOf(o,p){return(axis_cell_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function axis_cell_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var axis_cell=function(_SimpleCell){function AxisCell(config){var _this;return function axis_cell_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,AxisCell),(_this=function axis_cell_possibleConstructorReturn(self,call){return!call||"object"!==axis_cell_typeof(call)&&"function"!=typeof call?axis_cell_assertThisInitialized(self):call}(this,axis_cell_getPrototypeOf(AxisCell).call(this,config)))._axis=null,_this._availHeight=null,_this._availWidth=null,_this._logicalSpace=null,generateGetterSetters(axis_cell_assertThisInitialized(axis_cell_assertThisInitialized(_this)),packages_visual_cell_src_props_PROPS[cell_type_AXIS]),_this}return function axis_cell_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&axis_cell_setPrototypeOf(subClass,superClass)}(AxisCell,simple_cell),function axis_cell_createClass(Constructor,protoProps,staticProps){return protoProps&&axis_cell_defineProperties(Constructor.prototype,protoProps),staticProps&&axis_cell_defineProperties(Constructor,staticProps),Constructor}(AxisCell,[{key:"valueOf",value:function valueOf(){return this.source().id}},{key:"serialize",value:function serialize(){return{type:cell_type_AXIS,axis:this.source().serialize()}}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||this.logicalSpace(function computeAxisSpace(context){var logicalWidth,logicalHeight,axis=context.source(),_context$config=context.config(),spaceFixer=_context$config.spaceFixer,margin=_context$config.margin,_axis$getLogicalSpace=axis.getLogicalSpace(),width=_axis$getLogicalSpace.width,height=_axis$getLogicalSpace.height;return!0===axis.config().show?(logicalHeight=Math.floor(height+margin.top+margin.bottom+spaceFixer),logicalWidth=Math.floor(width+margin.left+margin.right+spaceFixer)):(logicalWidth=width,logicalHeight=height),{width:logicalWidth,height:logicalHeight}}(this)),this.logicalSpace()}},{key:"setAvailableSpace",value:function setAvailableSpace(width,height){this.availWidth(width),this.availHeight(height);var _this$config=this.config(),margin=_this$config.margin,isOffset=_this$config.isOffset;return width||height?(this.source().setAvailableSpace(width,height,margin,isOffset),this.source().logicalSpace(null)):this.source().resetLogicalSpace(),this.logicalSpace(null),this}},{key:"render",value:function render(mount){if(!mount)return this;var axis=this.source(),availHeight=this.availHeight(),availWidth=this.availWidth(),margin=this.config().margin,top=margin.top,bottom=margin.bottom,left=margin.left,right=margin.right,_axis$config2=axis.config(),show=_axis$config2.show,orientation=_axis$config2.orientation,wrapperDiv=makeElement(renderer_utils_selectElement(mount),"div",[this],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat("axis-cell")),selection=makeElement(wrapperDiv,"svg",[1],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-axis-container"));return selection.classed("".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-axis-container-").concat(orientation),!0),this.mount(mount),availWidth||selection.attr("width","".concat(0,"px")),availHeight||selection.attr("height","".concat(0,"px")),wrapperDiv.style("width","".concat(show?Math.floor(availWidth):0,"px")).style("height","".concat(show?Math.floor(availHeight):0,"px")).style("margin-top",top).style("margin-bottom",bottom).style("margin-left",left).style("margin-right",right),axis.mount(selection.node()),selection}},{key:"remove",value:function remove(){return this.source()&&this.source().remove(),this.mount()&&this.mount().remove(),this}},{key:"type",get:function get(){return cell_type_AXIS}},{key:"id",get:function get(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return enums_defaults_DEFAULT_CONFIG}}]),AxisCell}();function blank_cell_typeof(obj){return(blank_cell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function blank_cell_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function blank_cell_getPrototypeOf(o){return(blank_cell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function blank_cell_setPrototypeOf(o,p){return(blank_cell_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function blank_cell_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var blank_cell=function(_SimpleCell){function BlankCell(config){var _this;return function blank_cell_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BlankCell),_this=function blank_cell_possibleConstructorReturn(self,call){return!call||"object"!==blank_cell_typeof(call)&&"function"!=typeof call?blank_cell_assertThisInitialized(self):call}(this,blank_cell_getPrototypeOf(BlankCell).call(this,config)),generateGetterSetters(blank_cell_assertThisInitialized(blank_cell_assertThisInitialized(_this)),packages_visual_cell_src_props_PROPS[BLANK]),_this}return function blank_cell_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&blank_cell_setPrototypeOf(subClass,superClass)}(BlankCell,simple_cell),function blank_cell_createClass(Constructor,protoProps,staticProps){return protoProps&&blank_cell_defineProperties(Constructor.prototype,protoProps),staticProps&&blank_cell_defineProperties(Constructor,staticProps),Constructor}(BlankCell,[{key:"valueOf",value:function valueOf(){return this.id}},{key:"serialize",value:function serialize(){return{type:BLANK}}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()?this.logicalSpace():{width:this.width||0,height:this.height||0}}},{key:"setAvailableSpace",value:function setAvailableSpace(width,height){return this.availWidth(width),this.availHeight(height),this.logicalSpace(null),this}},{key:"render",value:function render(mount){if(mount){var style=this.config().style;this.mount(mount);var container=renderer_utils_selectElement(mount),elem=makeElement(container,"div",[this.id]);elem.classed("".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat("blank-cell"),!0),elem.style("width","".concat(this.availWidth(),"px")),elem.style("height","".concat(this.availHeight(),"px")),elem.html(""),style&&applyStyle(elem,style)}return this}},{key:"remove",value:function remove(){return this.mount()&&this.mount().remove(),this}},{key:"type",get:function get(){return BLANK}},{key:"id",get:function get(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return enums_defaults_DEFAULT_CONFIG}}]),BlankCell}();__webpack_require__(24);function text_cell_typeof(obj){return(text_cell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function text_cell_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function text_cell_getPrototypeOf(o){return(text_cell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function text_cell_setPrototypeOf(o,p){return(text_cell_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function text_cell_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var setSmartText=function setSmartText(context){var source=context.source(),_context$minSpacing=context.minSpacing(),minHeightSpace=_context$minSpacing.height,minWidthSpace=_context$minSpacing.width,_context$config=context.config(),margin=_context$config.margin,rotation=_context$config.rotation,left=margin.left,right=margin.right,paddedHeight=margin.top+margin.bottom+minHeightSpace,paddedWidth=left+right+minWidthSpace,availHeight=context.availHeight()-paddedHeight,availWidth=context.availWidth()-paddedWidth,labelManager=context.dependencies().labelManager;return labelManager.setStyle(context._computedStyle),!rotation&&context.smartText(labelManager.getSmartText(source,availWidth,availHeight,!1)),rotation&&context.smartText(labelManager.getSmartText(source,availHeight,availWidth,!0)),context},src_text_cell=function(_SimpleCell){function TextCell(config,dependencies){var _this;!function text_cell_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,TextCell),(_this=function text_cell_possibleConstructorReturn(self,call){return!call||"object"!==text_cell_typeof(call)&&"function"!=typeof call?text_cell_assertThisInitialized(self):call}(this,text_cell_getPrototypeOf(TextCell).call(this,config)))._dependencies=dependencies,_this._className=_this._config.className||(_this._config.type===constants_HEADER?"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat(constants_HEADER,"-cell"):"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat(cell_type_TEXT,"-cell")),_this._computedStyle=renderer_utils_getSmartComputedStyle(renderer_utils_selectElement("body"),_this._className),_this._dependencies.labelManager.setStyle(_this._computedStyle),generateGetterSetters(text_cell_assertThisInitialized(text_cell_assertThisInitialized(_this)),packages_visual_cell_src_props_PROPS[cell_type_TEXT]);var space=_this._dependencies.labelManager.getOriSize("w");return _this.minSpacing({width:Math.floor(3*space.width/4),height:Math.floor(space.height/2)}),setSmartText(text_cell_assertThisInitialized(text_cell_assertThisInitialized(_this))),_this}return function text_cell_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&text_cell_setPrototypeOf(subClass,superClass)}(TextCell,simple_cell),function text_cell_createClass(Constructor,protoProps,staticProps){return protoProps&&text_cell_defineProperties(Constructor.prototype,protoProps),staticProps&&text_cell_defineProperties(Constructor,staticProps),Constructor}(TextCell,[{key:"valueOf",value:function valueOf(){return this.source()}},{key:"dependencies",value:function dependencies(){return this._dependencies}},{key:"serialize",value:function serialize(){return{text:this.source(),type:cell_type_TEXT}}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||this.logicalSpace(function computeTextSpace(context){var labelManager=context.dependencies().labelManager,_context$minSpacing2=context.minSpacing(),minHeightSpace=_context$minSpacing2.height,minWidthSpace=_context$minSpacing2.width,_context$config2=context.config(),margin=_context$config2.margin,show=_context$config2.show,maxLines=_context$config2.maxLines,minCharacters=_context$config2.minCharacters,left=margin.left,right=margin.right,paddedHeight=margin.top+margin.bottom+minHeightSpace,paddedWidth=left+right+minWidthSpace,availHeight=context.availHeight()-paddedHeight,availWidth=context.availWidth()-paddedWidth,source=context.source(),space=context.smartText(),minText=new Array(minCharacters).fill("W").join(""),_minTextSpace=labelManager.getOriSize(minText);if(context.config({rotation:!1}),space.width>(availWidth||0)&&maxLines&&(space.height=space.oriTextHeight*maxLines),availWidth&&availWidth<space.width&&(space.width=_minTextSpace.width),availWidth&&availWidth<Math.min(_minTextSpace.width,space.oriTextWidth)){var smartSpace=labelManager.getSmartText(source,availHeight,_minTextSpace.height,!0);space.width=smartSpace.height,space.height=smartSpace.width,context.config({rotation:!0}),context.smartText(smartSpace)}return show?{width:Math.ceil(space.width)+paddedWidth,height:Math.ceil(space.height)+paddedHeight}:{width:0,height:0}}(this)),this.logicalSpace()}},{key:"setAvailableSpace",value:function setAvailableSpace(width,height){return this.availWidth(width),this.availHeight(height),setSmartText(this),this.logicalSpace(null),this}},{key:"render",value:function render(mount){var availWidth=this.availWidth(),availHeight=this.availHeight(),_this$config=this.config(),margin=_this$config.margin,show=_this$config.show,verticalAlign=_this$config.verticalAlign,textAlign=_this$config.textAlign,rotation=_this$config.rotation;if(this.mount(mount),show){var container=renderer_utils_selectElement(mount),elem=makeElement(container,"div",[this.id],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat("text-cell")),vAlign=verticalAlign||rotation?"middle":"top",_this$smartText=this.smartText(),width=_this$smartText.width,height=_this$smartText.height,minHeightSpace=this.minSpacing().height,translation={top:width+minHeightSpace/2,middle:width/2+minHeightSpace,bottom:minHeightSpace};container.style("vertical-align",vAlign),elem.classed(this._className,!0),elem.style("text-align",textAlign),elem.style("display","inline"),elem.style("transform",rotation?"translate(".concat(height/2,"px,\n                ").concat(translation[vAlign],"px) rotate(-90deg)"):""),elem.style("width",availWidth?"".concat(availWidth,"px"):"100%"),[visual_cell_src_enums_constants_TOP,visual_cell_src_enums_constants_BOTTOM,visual_cell_src_enums_constants_LEFT,visual_cell_src_enums_constants_RIGHT].forEach(function(type){elem.style("padding-".concat(type),"".concat(margin[type],"px"))}),elem.style("text-align",textAlign),elem.style("display","inline"),this._dependencies.labelManager.setStyle(this._computedStyle),elem.html(this._dependencies.labelManager.getSmartText(this.source(),availWidth,availHeight,!0).text)}return this}},{key:"remove",value:function remove(){return this.mount()&&this.mount().remove(),this}},{key:"type",get:function get(){return cell_type_TEXT}},{key:"id",get:function get(){return this._id}}],[{key:"defaultConfig",value:function defaultConfig(){return enums_defaults_DEFAULT_CONFIG}}]),TextCell}();function geom_cell_typeof(obj){return(geom_cell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function geom_cell_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function geom_cell_getPrototypeOf(o){return(geom_cell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function geom_cell_setPrototypeOf(o,p){return(geom_cell_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function geom_cell_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var _DEFAULT_PLACEHOLDERS,geom_cell=function(_SimpleCell){function GeomCell(config){var _this;return function geom_cell_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GeomCell),(_this=function geom_cell_possibleConstructorReturn(self,call){return!call||"object"!==geom_cell_typeof(call)&&"function"!=typeof call?geom_cell_assertThisInitialized(self):call}(this,geom_cell_getPrototypeOf(GeomCell).call(this,config)))._unit=null,_this._layers=null,_this._axes={},_this._datamodel={},_this._facetByFields={},_this._fields=null,_this._transform=null,_this._caption=null,generateGetterSetters(geom_cell_assertThisInitialized(geom_cell_assertThisInitialized(_this)),packages_visual_cell_src_props_PROPS[GEOM]),_this}return function geom_cell_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&geom_cell_setPrototypeOf(subClass,superClass)}(GeomCell,simple_cell),function geom_cell_createClass(Constructor,protoProps,staticProps){return protoProps&&geom_cell_defineProperties(Constructor.prototype,protoProps),staticProps&&geom_cell_defineProperties(Constructor,staticProps),Constructor}(GeomCell,[{key:"valueOf",value:function valueOf(){return this.source()}},{key:"serialize",value:function serialize(){return{type:GEOM,unit:this.source().serialize(),caption:this.caption()}}},{key:"updateModel",value:function updateModel(){var _this2=this,unit=this.source();return unit.lockModel(),[LAYER_DEF,enums_constants_TRANSFORM,enums_constants_AXES,constants_FIELDS,src_enums_constants_CONFIG,enums_constants_DATA,enums_constants_AXES,constants_FACET_BY_FIELDS,DETAIL_FIELDS].forEach(function(prop){_this2[prop]()&&unit[prop](_this2[prop]())}),unit.unlockModel(),this}},{key:"getCaptionSpace",value:function getCaptionSpace(){var caption=this.caption(),captionSpace={width:0,height:0};return caption&&(captionSpace=caption.getLogicalSpace()),captionSpace}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()||this.logicalSpace(function computeGeomSpace(context){var config=context.source().config(),width=config.width,height=config.height;return{width:Math.ceil(width),height:Math.ceil(height+context.getCaptionSpace().height)}}(this)),this.logicalSpace()}},{key:"setAvailableSpace",value:function setAvailableSpace(width,height){var unit=this.source();return this.availWidth(width),this.availHeight(height),unit.lockModel(),unit.width(width).height(height-this.getCaptionSpace().height),unit.unlockModel(),this.logicalSpace(null),this}},{key:"render",value:function render(mount){if(mount){this.mount(mount);var availHeight=this.availHeight(),availWidth=this.availWidth(),caption=this.caption(),wrapperDiv=makeElement(renderer_utils_selectElement(mount),"div",[1],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-").concat("geom-cell"));if(caption){var captionDom=makeElement(wrapperDiv,"div",[caption],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-unit-caption")).node();caption.render(captionDom)}var selection=makeElement(wrapperDiv,"div",[1],"".concat(visual_cell_src_enums_constants_CLASSPREFIX,"-unit"));wrapperDiv.style("width","".concat(availWidth,"px")).style("height","".concat(availHeight,"px")),selection.style("width","".concat(availWidth,"px")).style("height","".concat(availHeight-this.getCaptionSpace().height,"px")),this.source().mount(selection.node())}return this}},{key:"remove",value:function remove(){return this.mount()&&this.mount().remove(),this.source().remove(),this}},{key:"type",get:function get(){return GEOM}},{key:"id",get:function get(){return this.source().id()}}],[{key:"defaultConfig",value:function defaultConfig(){return enums_defaults_DEFAULT_CONFIG}}]),GeomCell}();function src_defaults_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var DEFAULT_PLACEHOLDERS=(src_defaults_defineProperty(_DEFAULT_PLACEHOLDERS={},"SimpleCell",simple_cell),src_defaults_defineProperty(_DEFAULT_PLACEHOLDERS,"TextCell",src_text_cell),src_defaults_defineProperty(_DEFAULT_PLACEHOLDERS,"AxisCell",axis_cell),src_defaults_defineProperty(_DEFAULT_PLACEHOLDERS,"GeomCell",geom_cell),src_defaults_defineProperty(_DEFAULT_PLACEHOLDERS,"BlankCell",blank_cell),_DEFAULT_PLACEHOLDERS),cell_registry=function cellRegistry(){var reg=DEFAULT_PLACEHOLDERS;return{set:function set(key,def){return key in reg&&(reg[key]=def),cellRegistry},get:function get(){return reg}}},createHeading=function createHeading(config,type,labelManager,prevCell){return config?function headerCreator(config,cellType,labelManager,prevCell){var content=config.content,classPrefix=config.classPrefix,maxLines=config.maxLines,cell=prevCell||new src_text_cell({type:"title"===cellType?"header":"text",className:"".concat(classPrefix,"-").concat(cellType,"-cell")},{labelManager:labelManager}).config({maxLines:maxLines}).minSpacing({width:0,height:0});cell.source(content),cell._minTickDiff={height:0,width:0};var margin={};return margin="top"===config.position?{top:0,bottom:config.padding}:{top:config.padding,bottom:0},cell.config({margin:margin}),{height:cell.getLogicalSpace().height,cell:cell}}(config,type,labelManager,prevCell):""},legend_maker_legendInitializer=function legendInitializer(legendConfig,canvas,measurement,prevLegends){var legends=[],height=measurement.height,width=measurement.width,headerHeight=measurement.headerHeight,position=legendConfig.position,align=legendConfig.align;return function legendCreator(canvas){var LegendCls,dataset=[],axes=canvas.getRetinalAxes();return Object.entries(axes).forEach(function(axisInfo){var scale=axisInfo[1][0],scaleType=axisInfo[0],scaleProps=canvas[scaleType]();if(scaleProps.field&&scale){var _scale$config=scale.config(),type=_scale$config.type,step=_scale$config.step,stepMapper="boolean"==typeof step&&step;LegendCls=LEGEND_TYPE_MAP["".concat(type,"-").concat(stepMapper,"-").concat(scaleType)],dataset.push({scale:scale,canvas:canvas,fieldName:scaleProps.field,LegendCls:LegendCls,scaleType:scaleType})}}),dataset}(canvas).forEach(function(dataInfo,index){var legend={},legendMeasures={},LegendCls=dataInfo.LegendCls,scale=dataInfo.scale,fieldName=dataInfo.fieldName,scaleType=dataInfo.scaleType,config=legendConfig[scaleType]||{},title=config.title||{};title.text=title.text||fieldName,config.show&&(config.position=position,config.align=align,legend=prevLegends[index]?prevLegends[index].legend:LegendCls.create({labelManager:canvas._dependencies.smartlabel,cells:{AxisCell:axis_cell,TextCell:src_text_cell}}),legendMeasures.maxHeight="vertical"===align?height-headerHeight:.2*height,legendMeasures.maxWidth="horizontal"===align?width:.2*width,legendMeasures.width=Math.min(legendMeasures.maxWidth,config.width),legendMeasures.height=Math.min(legendMeasures.maxHeight,config.height),[PADDING,BORDER,MARGIN].forEach(function(e){legendMeasures[e]=config[e]}),legend.scale(scale).title(title).fieldName(fieldName).config(config).metaData(canvas.composition().visualGroup.getGroupByData().project([fieldName])).measurement(legendMeasures).canvasAlias(canvas.alias()).setLegendMeasures(),legends.push({canvas:canvas,legend:legend,scaleType:scaleType}))}),legends};function muze_chart_component_typeof(obj){return(muze_chart_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function muze_chart_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function muze_chart_component_possibleConstructorReturn(self,call){return!call||"object"!==muze_chart_component_typeof(call)&&"function"!=typeof call?function muze_chart_component_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function muze_chart_component_getPrototypeOf(o){return(muze_chart_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function muze_chart_component_setPrototypeOf(o,p){return(muze_chart_component_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var MuzeComponent=function(_LayoutComponent){function MuzeComponent(){return function muze_chart_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MuzeComponent),muze_chart_component_possibleConstructorReturn(this,muze_chart_component_getPrototypeOf(MuzeComponent).apply(this,arguments))}return function muze_chart_component_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&muze_chart_component_setPrototypeOf(subClass,superClass)}(MuzeComponent,LayoutComponent),function muze_chart_component_createClass(Constructor,protoProps,staticProps){return protoProps&&muze_chart_component_defineProperties(Constructor.prototype,protoProps),staticProps&&muze_chart_component_defineProperties(Constructor,staticProps),Constructor}(MuzeComponent,[{key:"getLogicalSpace",value:function getLogicalSpace(){var _this$boundBox=this.boundBox();return{width:_this$boundBox.width,height:_this$boundBox.height}}},{key:"setSpatialConfig",value:function setSpatialConfig(conf){this.boundBox({top:conf.y,left:conf.x}),this.newDimensions={width:conf.width,height:conf.height},this.renderAt(conf.renderAt)}},{key:"getBoundBox",value:function getBoundBox(){return this.boundBox()}},{key:"updateWrapper",value:function updateWrapper(){throw Error("Update is not implemented")}},{key:"setParams",value:function setParams(){throw Error("set params is not implemented")}}]),MuzeComponent}();function headerComponent_typeof(obj){return(headerComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function headerComponent_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function headerComponent_possibleConstructorReturn(self,call){return!call||"object"!==headerComponent_typeof(call)&&"function"!=typeof call?function headerComponent_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function headerComponent_getPrototypeOf(o){return(headerComponent_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function headerComponent_setPrototypeOf(o,p){return(headerComponent_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var headerComponent_HeaderComponent=function(_MuzeComponent){function HeaderComponent(params){var _this;return function headerComponent_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HeaderComponent),(_this=headerComponent_possibleConstructorReturn(this,headerComponent_getPrototypeOf(HeaderComponent).call(this,params.name,params.component.getLogicalSpace(),0))).setParams(params),_this}return function headerComponent_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&headerComponent_setPrototypeOf(subClass,superClass)}(HeaderComponent,MuzeComponent),function headerComponent_createClass(Constructor,protoProps,staticProps){return protoProps&&headerComponent_defineProperties(Constructor.prototype,protoProps),staticProps&&headerComponent_defineProperties(Constructor,staticProps),Constructor}(HeaderComponent,[{key:"renderHeader",value:function renderHeader(container){var layoutConfig=this.params.config;container=renderer_utils_selectElement(container);var align=layoutConfig.align,sel=container.selectAll(".".concat(layoutConfig.classPrefix,"-inner-container")).data([this.name]);sel.exit().remove();var cont=sel.enter().append("div").merge(sel);cont.classed("".concat(layoutConfig.classPrefix,"-inner-container"),!0);var _this$boundBox=this.boundBox(),height=_this$boundBox.height,width=_this$boundBox.width;this.component.setAvailableSpace(width,height),this.component&&this.component.render(cont.node()),cont.selectAll("div").classed("".concat(layoutConfig.classPrefix,"-inner-content"),!0),cont.style("width","".concat(100,"%")),layoutConfig&&this.component&&cont.style("float","left").style("text-align",align)}},{key:"draw",value:function draw(container){this.renderHeader(container||document.getElementById(this.renderAt()))}},{key:"updateWrapper",value:function updateWrapper(params){return this.name(params.name),this.boundBox(params.component.getLogicalSpace()),this}},{key:"setParams",value:function setParams(params){this.component=params.component,this.params=params,this.target(params.config.target),this.position(params.config.position),this.className(params.config.className),this.alignWith(params.config.alignWith),this.alignment(params.config.alignment)}}]),HeaderComponent}();function legendComponent_typeof(obj){return(legendComponent_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function legendComponent_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function legendComponent_possibleConstructorReturn(self,call){return!call||"object"!==legendComponent_typeof(call)&&"function"!=typeof call?function legendComponent_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function legendComponent_getPrototypeOf(o){return(legendComponent_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function legendComponent_setPrototypeOf(o,p){return(legendComponent_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var legendComponent_LegendComponent=function(_MuzeComponent){function LegendComponent(params){var _this;return function legendComponent_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LegendComponent),(_this=legendComponent_possibleConstructorReturn(this,legendComponent_getPrototypeOf(LegendComponent).call(this,params.name,params.config.measurement.legendSpace,0))).setParams(params),_this}return function legendComponent_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&legendComponent_setPrototypeOf(subClass,superClass)}(LegendComponent,MuzeComponent),function legendComponent_createClass(Constructor,protoProps,staticProps){return protoProps&&legendComponent_defineProperties(Constructor.prototype,protoProps),staticProps&&legendComponent_defineProperties(Constructor,staticProps),Constructor}(LegendComponent,[{key:"renderLegend",value:function renderLegend(container){container=renderer_utils_selectElement(container);var sectionComponents=[],_this$params$config$m=this.params.config.measurement,legendSpace=_this$params$config$m.legendSpace,height=_this$params$config$m.height,width=_this$params$config$m.width,_this$params$config=this.params.config,position=_this$params$config.position,classPrefix=_this$params$config.classPrefix,legendMount=makeElement(container,"div",[this.components],"".concat(classPrefix,"-inner-content"),{},function(d){return d});legendMount.classed("".concat(classPrefix,"-legend"),!0);var align="left"===position||"right"===position?"vertical":"horizontal",legWidth="vertical"===align?legendSpace.width:width,legHeight="vertical"===align?height:legendSpace.height;if([container,legendMount].forEach(function(elem){elem.style("width","".concat(Math.floor(legWidth),"px")).style("height","".concat(legHeight,"px")).style("float","left")}),"vertical"===align){var sections=-1,currHeight=legHeight,currWidth=0;this.components.forEach(function(legendInfo){var leg=legendInfo.legend;leg.measurement().height>currHeight?(sections++,currWidth=0,currHeight=legHeight):sections<0&&sections++,sectionComponents[sections]=sectionComponents[sections]||[],currHeight-=Math.min(leg.measurement().height,currHeight),currWidth=Math.max(Math.min(leg.measurement().width,leg.measurement().maxWidth),currWidth),sectionComponents[sections].push({legend:leg,legendHeight:legHeight,legendWidth:currWidth})});var mount=makeElement(legendMount,["div"],sectionComponents,"".concat(classPrefix,"-legend-section"));mount.classed("".concat(classPrefix,"-legend-vertical-section"),!0).style("width",function(d){return"".concat(d[0].legendWidth,"px")}),makeElement(mount,["div"],function(d){return d},"".concat(classPrefix,"-legend-components"),{},function(d){return d.legend.id()}).each(function(d){d.legend.mount(this)}).style("width",function(d){return"".concat(d.legendWidth,"px")})}else{var _mount=makeElement(legendMount,"div",[1],"".concat(classPrefix,"-legend-section"));_mount.classed("".concat(classPrefix,"-legend-horizontal-section"),!0),_mount.classed("".concat(classPrefix,"-legend-section-",0),!0).style("width","".concat(legWidth,"px")),makeElement(_mount,"div",this.components,"".concat(classPrefix,"-legend-components"),{},function(d){return d.legend.id()}).each(function(d){d.legend.mount(this)}).style("width",function(d){return"".concat(d.legend.measurement().width,"px")})}}},{key:"draw",value:function draw(container){this.renderLegend(container||document.getElementById(this.renderAt()))}},{key:"updateWrapper",value:function updateWrapper(params){return this.name(params.name),this.boundBox(params.config.measurement.legendSpace),this.setParams(params),this}},{key:"setParams",value:function setParams(params){this.components=params.component,this.params=params,this.target(params.config.target),this.position(params.config.position),this.className(params.config.className),this.alignWith(params.config.alignWith),this.alignment(params.config.alignment)}}]),LegendComponent}(),helper_d3Drag=(__webpack_require__(25),renderer_utils_getD3Drag()),arrowSizeMap={left:"width",right:"width",top:"height",bottom:"height"},getUnitPositions=function getUnitPositions(unitMeasures,totalLength,viewLength){var currentLen=0;return(unitMeasures.primary&&unitMeasures.primary.length?unitMeasures.primary:unitMeasures.secondary).map(function(e){var unitPosition=100*currentLen/(totalLength-viewLength);return currentLen+=e,unitPosition})},helper_createScrollBarArrow=function createScrollBarArrow(mount,type,config){var classPrefix=config.classPrefix,thickness=config.thickness,arrow=makeElement(mount,"div",[type],"".concat(classPrefix,"-scroll-arrow-").concat(type));return arrow.classed("".concat(classPrefix,"-scroll-arrow"),!0),arrow.style(arrowSizeMap[type],"".concat(thickness,"px")),makeElement(arrow,"div",[1],"".concat(classPrefix,"-scroll-arrow-chevron")).attr("id","".concat(classPrefix,"-scroll-arrow-chevron-").concat(type)),arrow},helper_createScrollBarRect=function createScrollBarRect(mount,config){var classPrefix=config.classPrefix,rect=makeElement(mount,"div",[1],"".concat(classPrefix,"-scroll-rect"));return{rect:rect,mover:makeElement(rect,"div",[1],"".concat(classPrefix,"-scroll-mover"))}},applyScrollMouseDownAction=function applyScrollMouseDownAction(moverRect,scrollMaker,speed){var mover=moverRect.mover,rect=moverRect.rect,_mover$node$getBoundi=mover.node().getBoundingClientRect(),x=_mover$node$getBoundi.x,y=_mover$node$getBoundi.y,_rect$node$getBoundin=rect.node().getBoundingClientRect(),rectX=_rect$node$getBoundin.x,rectY=_rect$node$getBoundin.y;scrollMaker.changeMoverPosition({x:x-rectX+speed,y:y-rectY+speed})},helper_registerListenerOnArrow=function registerListenerOnArrow(scrollMaker,moverRect,arrowType,speed){var timer="",arrow=scrollMaker._components[arrowType],isTouchDevice=hasTouch();arrow.on(isTouchDevice?"touchstart":"mousedown",function(){renderer_utils_getEvent().preventDefault(),timer=setInterval(function(){applyScrollMouseDownAction(moverRect,scrollMaker,speed)},100)}).on(isTouchDevice?"touchend":"mouseup",function(){renderer_utils_getEvent().preventDefault(),clearInterval(timer)}).on("click",function(){applyScrollMouseDownAction(moverRect,scrollMaker,speed)})},scroll_bar_maker_helper_registerListeners=function registerListeners(scrollMaker){var moverRect=scrollMaker._components.moverRect,speed=scrollMaker.config().speed;helper_registerListenerOnArrow(scrollMaker,moverRect,"prevArrow",-speed),function applyMoverDrag(scrollMaker,moverRect){var startPos={},moverStartPos=0,endPos={},mover=moverRect.mover,rectStartPos=moverRect.rect.node().getBoundingClientRect();mover.call(helper_d3Drag().on("start",function(){var event=renderer_utils_getEvent();moverStartPos=mover.node().getBoundingClientRect(),startPos={x:event.x,y:event.y}}).on("drag",function(){var event=renderer_utils_getEvent(),window=getWindow(),distanceMoved_x=(endPos={x:event.x,y:event.y}).x-startPos.x,distanceMoved_y=endPos.y-startPos.y,actualPosition={x:moverStartPos.x+distanceMoved_x-rectStartPos.x+window.pageXOffset,y:moverStartPos.y+distanceMoved_y-rectStartPos.y+window.pageYOffset};scrollMaker.changeMoverPosition(actualPosition)}))}(scrollMaker,moverRect),function applyRectClick(scrollMaker,moverRect){moverRect.rect.on("click",function(){var event=renderer_utils_getEvent();scrollMaker.emptyScrollAreaClick(event)})}(scrollMaker,moverRect),helper_registerListenerOnArrow(scrollMaker,moverRect,"nextArrow",speed)},scroll_bar_maker_props_PROPS={config:{sanitization:function sanitization(context,value){return value=mergeRecursive(context._config,value)}},manager:{},unitPositions:{},logicalSpace:{}};function scroll_maker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var scroll_maker_ScrollMaker=function(){function ScrollMaker(){!function scroll_maker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScrollMaker),this._components={},this._logicalSpace={},this._attachedScrollAction=function(){},this._config={thickness:10,speed:2},this._unitPositions=null,generateGetterSetters(this,scroll_bar_maker_props_PROPS)}return function scroll_maker_createClass(Constructor,protoProps,staticProps){return protoProps&&scroll_maker_defineProperties(Constructor.prototype,protoProps),staticProps&&scroll_maker_defineProperties(Constructor,staticProps),Constructor}(ScrollMaker,[{key:"emptyScrollAreaClick",value:function emptyScrollAreaClick(){throw new ERROR_MSG("Method not implemented")}},{key:"changeMoverPosition",value:function changeMoverPosition(){throw new ERROR_MSG("Method not implemented")}},{key:"scrollTo",value:function scrollTo(){throw new ERROR_MSG("Method not implemented")}},{key:"scrollDeltaTo",value:function scrollDeltaTo(){throw new ERROR_MSG("Method not implemented")}},{key:"createScroll",value:function createScroll(mountPoint){return{scrollBarContainer:function scrollContainerHelper(mountPoint,config,dimensions,type){var classPrefix=config.classPrefix,scrollBarContainer=makeElement(renderer_utils_selectElement(mountPoint),"div",[1],"#".concat(classPrefix,"-scroll-bar-").concat(type));return scrollBarContainer.classed("".concat(classPrefix,"-scroll-bar"),!0),scrollBarContainer.style("width","".concat(dimensions.width,"px")),scrollBarContainer.style("height","".concat(dimensions.height,"px")),scrollBarContainer}(mountPoint,this.config(),this.logicalSpace(),this.constructor.type())}}},{key:"attachScrollAction",value:function attachScrollAction(externalScrollAction){return this._attachedScrollAction=externalScrollAction,this}},{key:"detachScrollAction",value:function detachScrollAction(){return this._attachedScrollAction=function(){},this}},{key:"getLogicalSpace",value:function getLogicalSpace(){return this.logicalSpace()}},{key:"registerListeners",value:function registerListeners(){return scroll_bar_maker_helper_registerListeners(this),this}},{key:"remove",value:function remove(){return this._components.scrollBarContainer.remove(),this}}],[{key:"type",value:function type(){throw new ERROR_MSG("Method not implemented")}}]),ScrollMaker}();function horizontal_scroll_maker_typeof(obj){return(horizontal_scroll_maker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function horizontal_scroll_maker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function horizontal_scroll_maker_possibleConstructorReturn(self,call){return!call||"object"!==horizontal_scroll_maker_typeof(call)&&"function"!=typeof call?function horizontal_scroll_maker_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function horizontal_scroll_maker_get(target,property,receiver){return(horizontal_scroll_maker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function horizontal_scroll_maker_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=horizontal_scroll_maker_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function horizontal_scroll_maker_getPrototypeOf(o){return(horizontal_scroll_maker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function horizontal_scroll_maker_setPrototypeOf(o,p){return(horizontal_scroll_maker_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function vertical_scroll_maker_typeof(obj){return(vertical_scroll_maker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function vertical_scroll_maker_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function vertical_scroll_maker_possibleConstructorReturn(self,call){return!call||"object"!==vertical_scroll_maker_typeof(call)&&"function"!=typeof call?function vertical_scroll_maker_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function vertical_scroll_maker_get(target,property,receiver){return(vertical_scroll_maker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function vertical_scroll_maker_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=vertical_scroll_maker_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function vertical_scroll_maker_getPrototypeOf(o){return(vertical_scroll_maker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function vertical_scroll_maker_setPrototypeOf(o,p){return(vertical_scroll_maker_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function scroll_component_typeof(obj){return(scroll_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function scroll_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function scroll_component_possibleConstructorReturn(self,call){return!call||"object"!==scroll_component_typeof(call)&&"function"!=typeof call?function scroll_component_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function scroll_component_getPrototypeOf(o){return(scroll_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function scroll_component_setPrototypeOf(o,p){return(scroll_component_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var scrollMakerMap={horizontal:function(_ScrollMaker){function HorizontalScrollMaker(){return function horizontal_scroll_maker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HorizontalScrollMaker),horizontal_scroll_maker_possibleConstructorReturn(this,horizontal_scroll_maker_getPrototypeOf(HorizontalScrollMaker).apply(this,arguments))}return function horizontal_scroll_maker_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&horizontal_scroll_maker_setPrototypeOf(subClass,superClass)}(HorizontalScrollMaker,scroll_maker_ScrollMaker),function horizontal_scroll_maker_createClass(Constructor,protoProps,staticProps){return protoProps&&horizontal_scroll_maker_defineProperties(Constructor.prototype,protoProps),staticProps&&horizontal_scroll_maker_defineProperties(Constructor,staticProps),Constructor}(HorizontalScrollMaker,[{key:"createScroll",value:function createScroll(mountPoint){var dimensions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.logicalSpace(),config=this.config(),scrollBarContainer=horizontal_scroll_maker_get(horizontal_scroll_maker_getPrototypeOf(HorizontalScrollMaker.prototype),"createScroll",this).call(this,mountPoint,config,dimensions).scrollBarContainer,prevArrow=helper_createScrollBarArrow(scrollBarContainer,"left",config),moverRect=helper_createScrollBarRect(scrollBarContainer,config),nextArrow=helper_createScrollBarArrow(scrollBarContainer,"right",config),mover=moverRect.mover,rect=moverRect.rect,_this$logicalSpace=this.logicalSpace(),height=_this$logicalSpace.height,width=_this$logicalSpace.width,totalLength=_this$logicalSpace.totalLength,viewLength=_this$logicalSpace.viewLength,unitWidths=_this$logicalSpace.unitWidths,scrollBarWithouArrowLength=width-2*height;rect.style("width","".concat(dimensions.width-2*height,"px")),rect.style("height","".concat(100,"%")),mover.style("width","".concat(viewLength*scrollBarWithouArrowLength/totalLength,"px")),mover.style("height","".concat(100,"%")),mover.style("left","".concat(0,"px")),this._components={prevArrow:prevArrow,nextArrow:nextArrow,moverRect:moverRect,scrollBarContainer:scrollBarContainer},this._scrollBarWithouArrowLength=scrollBarWithouArrowLength,this.unitPositions(getUnitPositions(unitWidths,totalLength,viewLength)),this.registerListeners()}},{key:"emptyScrollAreaClick",value:function emptyScrollAreaClick(event){var _this$_components$mov=this._components.moverRect,mover=_this$_components$mov.mover,rect=_this$_components$mov.rect,speed=this.config().speed,_mover$node$getBoundi=mover.node().getBoundingClientRect(),x=_mover$node$getBoundi.x,y=_mover$node$getBoundi.y,_rect$node$getBoundin=rect.node().getBoundingClientRect(),rectX=_rect$node$getBoundin.x,rectY=_rect$node$getBoundin.y,positionAdjuster=10*speed;event.x<x&&(positionAdjuster=10*-speed),this.changeMoverPosition({x:x-rectX+positionAdjuster,y:y-rectY+positionAdjuster})}},{key:"changeMoverPosition",value:function changeMoverPosition(newPosition){var currentPos,_this$_components$mov2=this._components.moverRect,mover=_this$_components$mov2.mover,rectStartPos=_this$_components$mov2.rect.node().getBoundingClientRect(),moverPos=mover.node().getBoundingClientRect(),totalLength=this.logicalSpace().totalLength;currentPos=newPosition.x<0?0:newPosition.x+moverPos.width>rectStartPos.width?rectStartPos.width-moverPos.width:newPosition.x,mover.style("left","".concat(currentPos,"px"));var movedViewLength=currentPos*totalLength/this._scrollBarWithouArrowLength;this.manager().performAttachedScrollFunction(this.constructor.type(),movedViewLength)}},{key:"scrollDeltaTo",value:function scrollDeltaTo(delta){var _this$_components$mov3=this._components.moverRect,mover=_this$_components$mov3.mover,rect=_this$_components$mov3.rect,moverPos=mover.node().getBoundingClientRect(),rectStartPos=rect.node().getBoundingClientRect();return this.changeMoverPosition({y:0,x:moverPos.x-rectStartPos.x-delta}),this}},{key:"scrollTo",value:function scrollTo(scrollPercentage){var moverPos=this._components.moverRect.mover.node().getBoundingClientRect(),movement=scrollPercentage*(this._scrollBarWithouArrowLength-moverPos.width)/100;return this.changeMoverPosition({y:0,x:movement}),this}}],[{key:"type",value:function type(){return"horizontal"}}]),HorizontalScrollMaker}(),vertical:function(_ScrollMaker){function VerticalScrollMaker(){return function vertical_scroll_maker_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,VerticalScrollMaker),vertical_scroll_maker_possibleConstructorReturn(this,vertical_scroll_maker_getPrototypeOf(VerticalScrollMaker).apply(this,arguments))}return function vertical_scroll_maker_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&vertical_scroll_maker_setPrototypeOf(subClass,superClass)}(VerticalScrollMaker,scroll_maker_ScrollMaker),function vertical_scroll_maker_createClass(Constructor,protoProps,staticProps){return protoProps&&vertical_scroll_maker_defineProperties(Constructor.prototype,protoProps),staticProps&&vertical_scroll_maker_defineProperties(Constructor,staticProps),Constructor}(VerticalScrollMaker,[{key:"createScroll",value:function createScroll(mountPoint){var dimensions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.logicalSpace(),config=this.config(),scrollBarContainer=vertical_scroll_maker_get(vertical_scroll_maker_getPrototypeOf(VerticalScrollMaker.prototype),"createScroll",this).call(this,mountPoint,dimensions).scrollBarContainer,prevArrow=helper_createScrollBarArrow(scrollBarContainer,"top",config),moverRect=helper_createScrollBarRect(scrollBarContainer,config),nextArrow=helper_createScrollBarArrow(scrollBarContainer,"bottom",config),mover=moverRect.mover,rect=moverRect.rect,_this$logicalSpace=this.logicalSpace(),height=_this$logicalSpace.height,width=_this$logicalSpace.width,totalLength=_this$logicalSpace.totalLength,viewLength=_this$logicalSpace.viewLength,unitHeights=_this$logicalSpace.unitHeights,scrollBarWithouArrowLength=height-2*width;rect.style("height","".concat(scrollBarWithouArrowLength,"px")),rect.style("width","".concat(100,"%")),mover.style("width","".concat(100,"%")),mover.style("height","".concat(viewLength*scrollBarWithouArrowLength/totalLength,"px")),mover.style("top","".concat(0,"px")),this._components={prevArrow:prevArrow,nextArrow:nextArrow,moverRect:moverRect,scrollBarContainer:scrollBarContainer},this._scrollBarWithouArrowLength=scrollBarWithouArrowLength,this.unitPositions(getUnitPositions(unitHeights,totalLength,viewLength)),this.registerListeners()}},{key:"emptyScrollAreaClick",value:function emptyScrollAreaClick(event){var _this$_components$mov=this._components.moverRect,mover=_this$_components$mov.mover,rect=_this$_components$mov.rect,speed=this.config().speed,_mover$node$getBoundi=mover.node().getBoundingClientRect(),x=_mover$node$getBoundi.x,y=_mover$node$getBoundi.y,_rect$node$getBoundin=rect.node().getBoundingClientRect(),rectX=_rect$node$getBoundin.x,rectY=_rect$node$getBoundin.y,positionAdjuster=10*speed;event.y<y&&(positionAdjuster=10*-speed),this.changeMoverPosition({x:x-rectX+positionAdjuster,y:y-rectY+positionAdjuster})}},{key:"changeMoverPosition",value:function changeMoverPosition(newPosition){var currentPos,_this$_components$mov2=this._components.moverRect,mover=_this$_components$mov2.mover,rect=_this$_components$mov2.rect,totalLength=this.logicalSpace().totalLength,rectStartPos=rect.node().getBoundingClientRect(),moverPos=mover.node().getBoundingClientRect();currentPos=newPosition.y<0?0:newPosition.y+moverPos.height>rectStartPos.height?rectStartPos.height-moverPos.height:newPosition.y,mover.style("top","".concat(currentPos,"px"));var movedViewLength=currentPos*totalLength/this._scrollBarWithouArrowLength;this.manager().performAttachedScrollFunction(this.constructor.type(),movedViewLength)}},{key:"scrollDeltaTo",value:function scrollDeltaTo(delta){var _this$_components$mov3=this._components.moverRect,mover=_this$_components$mov3.mover,rect=_this$_components$mov3.rect,moverPos=mover.node().getBoundingClientRect(),rectStartPos=rect.node().getBoundingClientRect();return this.changeMoverPosition({y:moverPos.y-rectStartPos.y-delta,x:0}),this}},{key:"scrollTo",value:function scrollTo(scrollPercentage){var moverPos=this._components.moverRect.mover.node().getBoundingClientRect(),movement=scrollPercentage*(this._scrollBarWithouArrowLength-moverPos.height)/100;return this.changeMoverPosition({x:0,y:movement}),this}}],[{key:"type",value:function type(){return"vertical"}}]),VerticalScrollMaker}()},ScrollComponent=function(_MuzeComponent){function ScrollComponent(params){var _this;!function scroll_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScrollComponent);var ScrollMaker=scrollMakerMap[params.config.type];return params.component=new ScrollMaker,params.component.config(params.config.scrollBarComponentConfig),params.component.logicalSpace(params.dimensions),(_this=scroll_component_possibleConstructorReturn(this,scroll_component_getPrototypeOf(ScrollComponent).call(this,params.name,params.component.getLogicalSpace(),0))).setParams(params),_this}return function scroll_component_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&scroll_component_setPrototypeOf(subClass,superClass)}(ScrollComponent,MuzeComponent),function scroll_component_createClass(Constructor,protoProps,staticProps){return protoProps&&scroll_component_defineProperties(Constructor.prototype,protoProps),staticProps&&scroll_component_defineProperties(Constructor,staticProps),Constructor}(ScrollComponent,[{key:"manager",value:function manager(){return arguments.length?(this.component.manager(arguments.length<=0?void 0:arguments[0]),this):this.component.manager()}},{key:"scrollDeltaTo",value:function scrollDeltaTo(delta){return this.component.scrollDeltaTo(delta),this}},{key:"scrollTo",value:function scrollTo(scrollPercentage){return this.component.scrollTo(scrollPercentage),this}},{key:"scrollToUnitIndex",value:function scrollToUnitIndex(unitIndex){var unitPositions=this.component.unitPositions(),sanitizedUnitIndex=Math.min(Math.max(0,unitIndex),unitPositions.length-1);return this.component.scrollTo(unitPositions[sanitizedUnitIndex]),this}},{key:"getScrollPositionsForUnits",value:function getScrollPositionsForUnits(){return this.component.unitPositions()}},{key:"draw",value:function draw(container){return this.component.createScroll(container||document.getElementById(this.renderAt())),this}},{key:"attachScrollAction",value:function attachScrollAction(externalAction){return this.component.attachScrollAction(externalAction),this}},{key:"detachScrollAction",value:function detachScrollAction(){return this.component.detachScrollAction(),this}},{key:"updateWrapper",value:function updateWrapper(params){return this.name(params.name),this.component.config(params.config.scrollBarComponentConfig),this.component.logicalSpace(params.dimensions),this.boundBox(this.component.getLogicalSpace()),this.setParams(params),this}},{key:"setParams",value:function setParams(params){this.component=params.component||this.component,this.params=params,this.target(params.config.target),this.position(params.config.position),this.className(params.config.className),this.alignWith(params.config.alignWith),this.alignment(params.config.alignment)}},{key:"remove",value:function remove(){this.component.remove()}}]),ScrollComponent}();function matrix_component_typeof(obj){return(matrix_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function matrix_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function matrix_component_possibleConstructorReturn(self,call){return!call||"object"!==matrix_component_typeof(call)&&"function"!=typeof call?function matrix_component_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function matrix_component_getPrototypeOf(o){return(matrix_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function matrix_component_setPrototypeOf(o,p){return(matrix_component_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var matrix_component_MatrixComponent=function(_MuzeComponent){function MatrixComponent(params){var _this;return function matrix_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,MatrixComponent),(_this=matrix_component_possibleConstructorReturn(this,matrix_component_getPrototypeOf(MatrixComponent).call(this,params.name,params.config.dimensions,0))).setParams(params),_this.className(params.config.className),_this}return function matrix_component_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&matrix_component_setPrototypeOf(subClass,superClass)}(MatrixComponent,MuzeComponent),function matrix_component_createClass(Constructor,protoProps,staticProps){return protoProps&&matrix_component_defineProperties(Constructor.prototype,protoProps),staticProps&&matrix_component_defineProperties(Constructor,staticProps),Constructor}(MatrixComponent,[{key:"applyScroll",value:function applyScroll(container){var row=this.params.config.row,column=this.params.config.column,_this$params$config$s=this.params.config.scrollInfo,horizontal=_this$params$config$s.horizontal,vertical=_this$params$config$s.vertical;horizontal&&1===column&&(container.style("overflow-x","hidden"),container.style("width","100%")),vertical&&"center"===row&&(container.style("overflow-y","hidden"),container.style("height","100%"))}},{key:"renderMatrix",value:function renderMatrix(mountPoint){var classPrefix=this.params.config.classPrefix,row=this.params.config.row,column=this.params.config.column,dimensions=this.params.config.dimensions,border=this.params.config.border,containerForMatrix=makeElement(mountPoint,"div",[1],"".concat(classPrefix,"-grid-").concat(row,"-").concat(column+1)).classed("".concat(classPrefix,"-grid-").concat(row),!0).classed("".concat(classPrefix,"-grid"),!0);this.applyScroll(containerForMatrix);var _cellSpanMaker=function cellSpanMaker(matrix,type,index){var spans=null,viewMatrix=matrix,_matrixSpanGenerator=matrixSpanGenerator("".concat(type,"-").concat(index)),orderGetter=_matrixSpanGenerator.orderGetter,viewMatrixMaker=_matrixSpanGenerator.viewMatrixMaker,spanMaker=_matrixSpanGenerator.spanMaker;return matrix.length&&(spans=spanMaker(viewMatrix=viewMatrixMaker(matrix,orderGetter(matrix))())()),{viewMatrix:viewMatrix,spans:spans}}(this.component,row,column),viewMatrix=_cellSpanMaker.viewMatrix,spans=_cellSpanMaker.spans,cells=this.renderTable(containerForMatrix,"".concat(classPrefix,"-grid"),viewMatrix).cells;!function applySpans(cells,spans,config,type){var applier=spanApplierMap[type];applier&&applier(cells,spans,config)}(cells,spans,{dimensions:dimensions,border:border},"".concat(row,"-").concat(column)),function renderPlaceholders(cells){cells.each(function(cell){cell.placeholder.render(this)})}(cells),cells.exit().each(function(cell){cell.placeholder.remove()}),border_helper_applyBorders(cells,border,row,column)}},{key:"renderTable",value:function renderTable(mount,className,rowData){var table=makeElement(mount,"table",["layout"],"".concat(className,"-table")),body=makeElement(table,"tbody",["layout"],"".concat(className,"-body")),rows=makeElement(body,"tr",rowData,"".concat(className,"-tr"));return{table:table,body:body,rows:rows,cells:makeElement(rows,"td",function(d,i){return d.filter(function(e){return null!==e}).map(function(e){return{placeholder:e,rowIndex:i}})},"".concat(className,"-td"),{},function(key){return key.placeholder.id})}}},{key:"draw",value:function draw(container){this.renderMatrix(container||document.getElementById(this.renderAt()))}},{key:"updateWrapper",value:function updateWrapper(params){return this.name(params.name),this.boundBox(params.config.dimensions),this.setParams(params),this}},{key:"setParams",value:function setParams(params){this.component=params.component,this.params=params,this.target(params.config.target),this.position("top"),this.className(params.config.className)}}]),MatrixComponent}();function grid_component_typeof(obj){return(grid_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function grid_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function grid_component_possibleConstructorReturn(self,call){return!call||"object"!==grid_component_typeof(call)&&"function"!=typeof call?function grid_component_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function grid_component_getPrototypeOf(o){return(grid_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function grid_component_setPrototypeOf(o,p){return(grid_component_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}var grid_component_applyScrollAction=function applyScrollAction(elem,classPrefix,scollDistance,type){renderer_utils_selectElement(elem).selectAll(".".concat(classPrefix,"-grid")).property(type,scollDistance)},grid_component_GridComponent=function(_MuzeComponent){function GridComponent(params){var _this;return function grid_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GridComponent),(_this=grid_component_possibleConstructorReturn(this,grid_component_getPrototypeOf(GridComponent).call(this,params.name,params.config.dimensions,0))).gridComponents=[],_this.setParams(params),_this}return function grid_component_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&grid_component_setPrototypeOf(subClass,superClass)}(GridComponent,MuzeComponent),function grid_component_createClass(Constructor,protoProps,staticProps){return protoProps&&grid_component_defineProperties(Constructor.prototype,protoProps),staticProps&&grid_component_defineProperties(Constructor,staticProps),Constructor}(GridComponent,[{key:"sanitizeGrid",value:function sanitizeGrid(){for(var height=0,width=0,_this$component$viewI=this.component.viewInfo(),viewMatricesInfo=_this$component$viewI.viewMatricesInfo,layoutDimensions=_this$component$viewI.layoutDimensions,scrollInfo=this.component.scrollInfo(),i=0;i<3;i++){this.gridComponents.length&&this.gridComponents[i]instanceof Array||(this.gridComponents[i]=[]);for(var j=0;j<3;j++){var matrixDim={height:layoutDimensions.viewHeight[i],width:layoutDimensions.viewWidth[j]},matrix=viewMatricesInfo.matrices["".concat(ROW_MATRIX_INDEX[i])][j],matrixName="".concat(ROW_MATRIX_INDEX[i],"-").concat(COLUMN_MATRIX_INDEX[j]),matrixConfig={dimensions:matrixDim,border:layoutDimensions.border,classPrefix:this.params.config.classPrefix,scrollInfo:scrollInfo,row:ROW_MATRIX_INDEX[i],column:j};if(this.gridComponents[i][j]instanceof MuzeComponent)this.gridComponents[i][j].updateWrapper({name:matrixName,component:matrix,config:matrixConfig});else{var matrixWrapper=new matrix_component_MatrixComponent({name:matrixName,component:matrix,config:matrixConfig});this.gridComponents[i].push(matrixWrapper)}0===i&&(width+=matrixDim.width),0===j&&(height+=matrixDim.height)}}this.boundBox({height:height,width:width}),this.component=this.gridComponents,this.allComponents=this.gridComponents}},{key:"scrollBarManager",value:function scrollBarManager(){return arguments.length?(this._scrollBarManager=arguments.length<=0?void 0:arguments[0],this):this._scrollBarManager}},{key:"attachScrollListener",value:function attachScrollListener(){var _this2=this;return renderer_utils_selectElement("#".concat(this.component[1][1].renderAt())).on("wheel",function(){var event=renderer_utils_getEvent(),wheelDeltaX=event.wheelDeltaX,wheelDeltaY=event.wheelDeltaY;event.preventDefault(),event.stopPropagation(),0!==wheelDeltaX&&Math.abs(wheelDeltaX)>Math.abs(wheelDeltaY)&&_this2.scrollBarManager().triggerScrollBarAction("horizontal",wheelDeltaX),0!==wheelDeltaY&&Math.abs(wheelDeltaX)<Math.abs(wheelDeltaY)&&_this2.scrollBarManager().triggerScrollBarAction("vertical",wheelDeltaY)}),this}},{key:"performScrollAction",value:function performScrollAction(direction,movedView){return function scrollActionApplier(movement,context){var classPrefix=context.params.config.classPrefix;return{horizontal:function horizontal(){[0,1,2].forEach(function(e){return grid_component_applyScrollAction("#".concat(context.component[e][1].renderAt()),classPrefix,movement,"scrollLeft")})},vertical:function vertical(){[0,1,2].forEach(function(e){return grid_component_applyScrollAction("#".concat(context.component[1][e].renderAt()),classPrefix,movement,"scrollTop")})}}}(movedView,this)[direction](),this}},{key:"getBoundBox",value:function getBoundBox(){var _this$component$0$0$b=this.component[0][0].boundBox(),top=_this$component$0$0$b.top,left=_this$component$0$0$b.left,_this$boundBox=this.boundBox();return{top:top,left:left,height:_this$boundBox.height,width:_this$boundBox.width}}},{key:"updateWrapper",value:function updateWrapper(params){return this.name(params.name),this.boundBox(params.config.dimensions),this.setParams(params),this}},{key:"setParams",value:function setParams(params){return this.component=params.component,this.params=params,this.target(params.config.target),this.className(params.config.className),this.sanitizeGrid(),this}}]),GridComponent}();function component_wrapper_maker_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){component_wrapper_maker_defineProperty(target,key,source[key])})}return target}function component_wrapper_maker_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var headerMap={title:{headerCell:"titleCell",configType:TITLE_CONFIG},subtitle:{headerCell:"subtitleCell",configType:SUB_TITLE_CONFIG}},component_wrapper_maker_createHeaderWrapper=function createHeaderWrapper(headerType,layoutManager,renderDetails){var wrapper=null,components=renderDetails.components,layoutConfig=renderDetails.layoutConfig,_headerMap$headerType=headerMap[headerType],headerCell=_headerMap$headerType.headerCell,configType=_headerMap$headerType.configType,target={target:"canvas"};if(components.headers&&components.headers[headerCell]){var headerConfig=layoutConfig[headerType],wrapperParams={name:headerType,component:components.headers[headerCell],config:headerConfig=Object.assign({},headerConfig,component_wrapper_maker_objectSpread({classPrefix:layoutConfig.classPrefix},target,{alignWith:"".concat(ROW_MATRIX_INDEX[0],"-").concat(COLUMN_MATRIX_INDEX[1]),alignment:LAYOUT_ALIGN_LEFT,className:configType.className}))};wrapper=layoutManager.getComponent(headerType)?layoutManager.getComponent(headerType).updateWrapper(wrapperParams):new headerComponent_HeaderComponent(wrapperParams)}return wrapper},component_wrapper_maker_createScrollBarWrapper=function createScrollBarWrapper(scrollBarType,layoutManager,renderDetails,grid){var scrollBarWrapper=null,layoutConfig=renderDetails.layoutConfig,target={target:"canvas"},scrollBar=layoutConfig.scrollBar,layoutDimensions=grid.viewInfo().layoutDimensions,actualCenterMeasures=layoutDimensions.actualCenterMeasures,unitHeights=layoutDimensions.unitHeights,unitWidths=layoutDimensions.unitWidths,_scrollBarMap$scrollB=function scrollBarMap(config){return{vertical:{componentName:"verticalScrollBar",width:"thickness",height:"layoutBasedMeasure",layoutBasedMeasure:"height",viewMeasure:"viewHeight",rowAlign:1,colAlign:"right"===config.align?2:0,position:config.align,alignment:"top"},horizontal:{componentName:"horizontalScrollBar",width:"layoutBasedMeasure",layoutBasedMeasure:"width",viewMeasure:"viewWidth",height:"thickness",rowAlign:"top"===config.align?0:2,colAlign:1,position:config.align,alignment:"left"}}}(scrollBar[scrollBarType])[scrollBarType],componentName=_scrollBarMap$scrollB.componentName,layoutBasedMeasure=_scrollBarMap$scrollB.layoutBasedMeasure,width=_scrollBarMap$scrollB.width,height=_scrollBarMap$scrollB.height,rowAlign=_scrollBarMap$scrollB.rowAlign,colAlign=_scrollBarMap$scrollB.colAlign,viewMeasure=_scrollBarMap$scrollB.viewMeasure,position=_scrollBarMap$scrollB.position,alignment=_scrollBarMap$scrollB.alignment,dimensions={thickness:scrollBar.thickness,layoutBasedMeasure:layoutDimensions[viewMeasure][1]},totalLength=actualCenterMeasures[layoutBasedMeasure],viewLength=layoutDimensions[viewMeasure][1],wrapperParams={name:componentName,config:Object.assign({},component_wrapper_maker_objectSpread({classPrefix:layoutConfig.classPrefix},target,{scrollBarComponentConfig:component_wrapper_maker_objectSpread({},scrollBar,{classPrefix:layoutConfig.classPrefix}),type:scrollBarType,alignWith:"".concat(ROW_MATRIX_INDEX[rowAlign],"-").concat(COLUMN_MATRIX_INDEX[colAlign]),alignment:alignment,position:position})),dimensions:{width:dimensions[width],height:dimensions[height],totalLength:totalLength,viewLength:viewLength,unitHeights:unitHeights,unitWidths:unitWidths}};return layoutManager.getComponent(componentName)?(scrollBarWrapper=layoutManager.getComponent(componentName).updateWrapper(wrapperParams),viewLength>=totalLength&&layoutManager.getComponent(componentName).remove()):scrollBarWrapper=new ScrollComponent(wrapperParams),viewLength>=totalLength?null:scrollBarWrapper},component_wrapper_maker_componentWrapperMaker=function componentWrapperMaker(layoutManager,grid,renderDetails){return{title:component_wrapper_maker_createHeaderWrapper("title",layoutManager,renderDetails),subtitle:component_wrapper_maker_createHeaderWrapper("subtitle",layoutManager,renderDetails),legend:function createLegendWrapper(layoutManager,renderDetails){var legendWrapper=null,components=renderDetails.components,layoutConfig=renderDetails.layoutConfig,measurement=renderDetails.measurement,target={target:"canvas"};if(components.legends&&components.legends.length){var legendConfig=component_wrapper_maker_objectSpread({},layoutConfig.legend,target,{measurement:measurement}),wrapperParams={name:"legend",component:components.legends,config:legendConfig};legendWrapper=layoutManager.getComponent("legend")?layoutManager.getComponent("legend").updateWrapper(wrapperParams):new legendComponent_LegendComponent(wrapperParams)}return legendWrapper}(layoutManager,renderDetails),grid:function gridLayoutWrapper(layoutManager,renderDetails,grid){var target={target:"canvas"},layoutConfig=renderDetails.layoutConfig,wrapperParams={name:"grid",component:grid,config:component_wrapper_maker_objectSpread({},target,{pagination:layoutConfig.pagination,classPrefix:layoutConfig.classPrefix,dimensions:{height:0,width:0}})};return layoutManager.getComponent("grid")?layoutManager.getComponent("grid").updateWrapper(wrapperParams):new grid_component_GridComponent(wrapperParams)}(layoutManager,renderDetails,grid),verticalScrollBar:component_wrapper_maker_createScrollBarWrapper("vertical",layoutManager,renderDetails,grid),horizontalScrollBar:component_wrapper_maker_createScrollBarWrapper("horizontal",layoutManager,renderDetails,grid)}};function scroll_manager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var ScrollManager=function(){function ScrollManager(){!function scroll_manager_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ScrollManager),this._scrollBarComponents={},this._attachedComponents={}}return function scroll_manager_createClass(Constructor,protoProps,staticProps){return protoProps&&scroll_manager_defineProperties(Constructor.prototype,protoProps),staticProps&&scroll_manager_defineProperties(Constructor,staticProps),Constructor}(ScrollManager,[{key:"scrollBarComponents",value:function scrollBarComponents(){return arguments.length?(this._scrollBarComponents=arguments.length<=0?void 0:arguments[0],this):this._scrollBarComponents}},{key:"attachedComponents",value:function attachedComponents(){return arguments.length?(this._attachedComponents=arguments.length<=0?void 0:arguments[0],this):this._attachedComponents}},{key:"performAttachedScrollFunction",value:function performAttachedScrollFunction(type,movedViewLength){Object.values(this.attachedComponents()).forEach(function(e){e.performScrollAction(type,movedViewLength)})}},{key:"triggerScrollBarAction",value:function triggerScrollBarAction(type,delta){this.scrollBarComponents()[type]&&this.scrollBarComponents()[type].scrollDeltaTo(delta)}}]),ScrollManager}(),layout_maker_getRenderDetails=function getRenderDetails(context,mount){var layoutConfig=mergeRecursive({},context.config()),_mount$getBoundingCli=mount.getBoundingClientRect(),height=_mount$getBoundingCli.height,width=_mount$getBoundingCli.width,heightAttr=context.height(),widthAttr=context.width(),visGroup=context.composition().visualGroup,_visGroup$placeholder=visGroup.placeholderInfo(),isColumnSizeEqual=_visGroup$placeholder.isColumnSizeEqual,isRowSizeEqual=_visGroup$placeholder.isRowSizeEqual,priority=_visGroup$placeholder.priority,rows=_visGroup$placeholder.rows,columns=_visGroup$placeholder.columns,values=_visGroup$placeholder.values,_context$config=context.config(),minWidth=_context$config.minWidth,minHeight=_context$config.minHeight,classPrefix=_context$config.classPrefix,showHeaders=_context$config.showHeaders,legend=_context$config.legend,pagination=_context$config.pagination,scrollBar=_context$config.scrollBar,titleConfig=context.title()[1],subtitleConfig=context.subtitle()[1],legendPosition=legend.position,layoutArrangement=function arrangeComponents(context){var _titleLayouts,legendConfig=context.config().legend,titleConfig=context.title()[1],subtitleConfig=context.subtitle()[1],titleLayouts=(component_resolver_defineProperty(_titleLayouts={},"".concat("top","-").concat("top"),["title","subtitle","group"]),component_resolver_defineProperty(_titleLayouts,"".concat("bottom","-").concat("bottom"),["group","subtitle","title"]),component_resolver_defineProperty(_titleLayouts,"".concat("top","-").concat("bottom"),["title","group","subtitle"]),component_resolver_defineProperty(_titleLayouts,"".concat("bottom","-").concat("top"),["subtitle","group","title"]),_titleLayouts),legendLayouts=[["legend","layout"],["layout","legend"]],titlePosition=titleConfig.position||"top",subtitlePosition=subtitleConfig.position||"top";return{headers:titleLayouts["".concat(titlePosition,"-").concat(subtitlePosition)],legends:"left"===legendConfig.position||"top"===legendConfig.position?legendLayouts[0]:legendLayouts[1]}}(context);height=Math.floor(height),width=Math.floor(width);var availableHeightForCanvas=Math.max(heightAttr>0?heightAttr:height,minHeight),availableWidthForCanvas=Math.max(widthAttr>0?widthAttr:width,minWidth),_createHeaders=function createHeaders(context,canvasHeight,canvasWidth){var headerHeight=0,headers={};return canvasHeight>=200&&canvasWidth>=200&&["title","subtitle"].forEach(function(type){var headerOptions=context[type](),content=function resolveTitleSubTitleContent(rawContent){return"function"!=typeof rawContent||rawContent._sanitize?function escapeHTML(str){var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return"".concat(str).replace(/[&<>"'/]/g,function(match){return htmlEscapes[match]})}(rawContent()):rawContent()}(headerOptions[0]);if(content.length){var config=headerOptions[1];config.width=context.width(),config.height=context.height(),config.classPrefix=context.config().classPrefix,config.content=content,config.classPrefix=context.config().classPrefix;var _createHeading=createHeading(config,type,context.dependencies().smartlabel,context["".concat(type,"Cell")]),height=_createHeading.height,cell=_createHeading.cell;headers["".concat(type,"Cell")]=cell,context._composition[type]=cell,headerHeight+=height+config.padding}}),{headerHeight:headerHeight,headers:headers}}(context,availableHeightForCanvas,availableWidthForCanvas),headers=_createHeaders.headers,headerHeight=_createHeaders.headerHeight,legends=function createLegend(context,headerHeight,height,width){var measurement={height:height,width:width,headerHeight:headerHeight},legend=context.config().legend,show=legend.show,position=legend.position;legend.classPrefix=context.config().classPrefix;var align="left"===position||"right"===position?"vertical":"horizontal";return legend.show=show?"vertical"===align&&width>200||"horizontal"===align&&height>200:show,legend.align=align,legend_maker_legendInitializer(legend,context,measurement,context.legends||[])}(context,headerHeight,availableHeightForCanvas,availableWidthForCanvas);context._composition.legend={},legends.forEach(function(e){context._composition.legend[e.scaleType]=e.legend});var legendSpace=function getLegendSpace(legends,legendConfig,availableHeight,availableWidth){var legendSpace={width:0,height:0};return legends.map(function(legendInfo){return legendInfo.legend.measurement()}).forEach(function(space){var height,width;width=Math.min(space.width,space.maxWidth),height=Math.min(space.height,space.maxHeight),"horizontal"===legendConfig.align?legendSpace.width+width>availableWidth?(legendSpace.width=availableWidth,legendSpace.height+=height):(legendSpace.width+=width,legendSpace.height=Math.max(legendSpace.height,height)):legendSpace.height+height>availableHeight?(legendSpace.height=height,legendSpace.width+=width):(legendSpace.height+=height,legendSpace.width=Math.max(legendSpace.width,width))}),"horizontal"===legendConfig.align&&(legendSpace.width=availableWidth),legendSpace}(legends,legend,availableHeightForCanvas,availableWidthForCanvas),legendWidth="left"===legendPosition||"right"===legendPosition?legendSpace.width:0,legendHeight="top"===legendPosition||"bottom"===legendPosition?legendSpace.height:0,components={headers:headers,legends:legends,canvases:[context],rows:rows,columns:columns,values:values,cornerMatrices:visGroup.cornerMatrices()},measurement={mountSpace:{height:height,width:width},headerHeight:headerHeight,legendSpace:legendSpace,canvasWidth:availableWidthForCanvas,canvasHeight:availableHeightForCanvas,width:availableWidthForCanvas-legendWidth,height:availableHeightForCanvas-headerHeight-legendHeight,minUnitHeight:context.minUnitHeight(),minUnitWidth:context.minUnitWidth()};return{layoutConfig:layoutConfig=mergeRecursive(layoutConfig,{classPrefix:classPrefix,showHeaders:showHeaders,border:mergeRecursive(visGroup.metaData().border,context.config().border),layoutArrangement:layoutArrangement,legend:legend,buffer:scrollBar.thickness,pagination:pagination,title:titleConfig,subtitle:subtitleConfig,isColumnSizeEqual:isColumnSizeEqual,isRowSizeEqual:isRowSizeEqual,mount:mount,priority:priority}),components:components,measurement:measurement}},componentIndexes={title:0,subtitle:1,legend:2,verticalScrollBar:3,horizontalScrollBar:4,grid:5},layout_maker_renderLayout=function renderLayout(canvas,renderDetails){var layoutManager=canvas._layoutManager,gridLayout=canvas.layout(),grid=componentIndexes.grid,compWrappers=component_wrapper_maker_componentWrapperMaker(layoutManager,gridLayout,renderDetails),componentWrappers=Object.keys(componentIndexes).map(function(e){return compWrappers[e]}),gridWrapper=componentWrappers[grid];!function createScrollManager(componentWrappers,canvas){var verticalScrollBar=componentIndexes.verticalScrollBar,grid=componentIndexes.grid,horizontalScrollWrapper=componentWrappers[componentIndexes.horizontalScrollBar],verticalScrollWrapper=componentWrappers[verticalScrollBar],gridWrapper=componentWrappers[grid],scrollBarManager=new ScrollManager,scrollBarComponents={};verticalScrollWrapper&&(scrollBarComponents.vertical=verticalScrollWrapper),horizontalScrollWrapper&&(scrollBarComponents.horizontal=horizontalScrollWrapper),scrollBarManager.scrollBarComponents(scrollBarComponents).attachedComponents({grid:gridWrapper}),canvas.composition().hScrollBar=horizontalScrollWrapper,canvas.composition().vScrollBar=verticalScrollWrapper,[horizontalScrollWrapper,verticalScrollWrapper].forEach(function(wrapper){wrapper&&wrapper.manager(scrollBarManager)}),gridWrapper.scrollBarManager(scrollBarManager)}(componentWrappers,canvas),layoutManager.registerComponents(componentWrappers).compute(),gridWrapper.attachScrollListener()};function group_firebolt_typeof(obj){return(group_firebolt_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function group_firebolt_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function group_firebolt_possibleConstructorReturn(self,call){return!call||"object"!==group_firebolt_typeof(call)&&"function"!=typeof call?function group_firebolt_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self):call}function group_firebolt_getPrototypeOf(o){return(group_firebolt_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function group_firebolt_setPrototypeOf(o,p){return(group_firebolt_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function group_firebolt_toConsumableArray(arr){return function group_firebolt_arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function group_firebolt_iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function group_firebolt_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _defaultInteractionPolicy=function defaultInteractionPolicy(valueMatrix,firebolt){var _ref,_ref2,isMeasure=function isMeasure(field){return field.type()===dist_datamodel.FieldType.MEASURE},visualGroup=firebolt.context.composition().visualGroup,xFields=(_ref=[]).concat.apply(_ref,group_firebolt_toConsumableArray(visualGroup.getFieldsFromChannel("x"))),yFields=(_ref2=[]).concat.apply(_ref2,group_firebolt_toConsumableArray(visualGroup.getFieldsFromChannel("y"))),colDim=xFields.every(function(field){return field.type()===dist_datamodel.FieldType.DIMENSION}),fieldInf=visualGroup.resolver().getAllFields(),rowFacets=fieldInf.rowFacets,colFacets=fieldInf.colFacets;valueMatrix.each(function(cell){var unitFireBolt=cell.valueOf().firebolt();if(!xFields.every(isMeasure)||!yFields.every(isMeasure)){var propFields,facetFields=cell.valueOf().facetByFields()[0],unitColFacets=facetFields.filter(function(d){return-1!==colFacets.findIndex(function(v){return v.equals(d)})}),unitRowFacets=facetFields.filter(function(d){return-1!==rowFacets.findIndex(function(v){return v.equals(d)})});propFields=colDim?unitColFacets.map(function(d){return"".concat(d)}):unitRowFacets.map(function(d){return"".concat(d)}),unitFireBolt.propagateWith("*",propFields,!0)}})},_defaultCrossInteractionPolicy={behaviours:{"*":function _(propagationPayload,context){var propagationCanvasAlias=propagationPayload.sourceCanvas,canvasAlias=context.parentAlias();return!propagationCanvasAlias||canvasAlias===propagationCanvasAlias}},sideEffects:{tooltip:function tooltip(propagationPayload,context){var propagationUnit=propagationPayload.sourceUnit,propagationCanvas=propagationPayload.sourceCanvas,unitId=context.id(),canvasAlias=context.parentAlias();return!propagationCanvas||(propagationCanvas!==canvasAlias||unitId===propagationUnit)}}},canvas_firebolt=function(_Firebolt){function GroupFireBolt(){var _getPrototypeOf2,_this;!function group_firebolt_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,GroupFireBolt);for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];return(_this=group_firebolt_possibleConstructorReturn(this,(_getPrototypeOf2=group_firebolt_getPrototypeOf(GroupFireBolt)).call.apply(_getPrototypeOf2,[this].concat(params))))._interactionPolicy=_this.constructor.defaultInteractionPolicy(),_this.crossInteractionPolicy(_this.constructor.defaultCrossInteractionPolicy()),_this}return function group_firebolt_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&group_firebolt_setPrototypeOf(subClass,superClass)}(GroupFireBolt,firebolt_Firebolt),function group_firebolt_createClass(Constructor,protoProps,staticProps){return protoProps&&group_firebolt_defineProperties(Constructor.prototype,protoProps),staticProps&&group_firebolt_defineProperties(Constructor,staticProps),Constructor}(GroupFireBolt,[{key:"interactionPolicy",value:function interactionPolicy(){return arguments.length?(this._interactionPolicy=(arguments.length<=0?void 0:arguments[0])||this.constructor.defaultInteractionPolicy(),this):this._interactionPolicy}},{key:"crossInteractionPolicy",value:function crossInteractionPolicy(){var _this2=this;if(arguments.length){this._crossInteractionPolicy=mergeRecursive(mergeRecursive({},this.constructor.defaultCrossInteractionPolicy()),(arguments.length<=0?void 0:arguments[0])||{});var context=this.context;return applyInteractionPolicy(this),context._throwback.registerImmediateListener([common_props.MATRIX_CREATED],function(){applyInteractionPolicy(_this2)}),this}return this._crossInteractionPolicy}},{key:"dispatchBehaviour",value:function dispatchBehaviour(behaviour,payload){var propPayload=Object.assign(payload),criteria=propPayload.criteria,data=this.context.composition().visualGroup.getGroupByData(),fieldsConfig=data.getFieldsConfig(),model=common_utils_getDataModelFromIdentifiers(data,criteria),behaviouralAction=this._actions.behavioural[behaviour];if(behaviouralAction){var validFields=(isSimpleObject(criteria)?Object.keys(criteria):criteria?criteria[0]:[]).filter(function(field){return field in fieldsConfig}),mutates=behaviouralAction.constructor.mutates(),propConfig={payload:propPayload,action:behaviour,criteria:model,sourceId:this.context.alias(),isMutableAction:mutates,propagateInterpolatedValues:validFields.every(function(field){return fieldsConfig[field].def.type===dist_datamodel.FieldType.MEASURE})};data.propagate(model,propConfig,!0)}return this}},{key:"registerSideEffects",value:function registerSideEffects(sideEffects){for(var key in sideEffects)this._sideEffectDefinitions[sideEffects[key].formalName()]=sideEffects[key];return this}}],[{key:"defaultInteractionPolicy",value:function defaultInteractionPolicy(){return _defaultInteractionPolicy}},{key:"defaultCrossInteractionPolicy",value:function defaultCrossInteractionPolicy(){return _defaultCrossInteractionPolicy}}]),GroupFireBolt}(),APP_INITIAL_STATE={app:{group:{},units:{},layers:{},canvas:{}},local:{canvas:{},group:{},units:{},layers:{}}};function canvas_typeof(obj){return(canvas_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function canvas_slicedToArray(arr,i){return function canvas_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function canvas_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function canvas_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function canvas_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function canvas_getPrototypeOf(o){return(canvas_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function canvas_setPrototypeOf(o,p){return(canvas_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function canvas_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var canvas_Canvas=function(_TransactionSupport){function Canvas(globalDependencies){var _this;!function canvas_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Canvas),(_this=function canvas_possibleConstructorReturn(self,call){return!call||"object"!==canvas_typeof(call)&&"function"!=typeof call?canvas_assertThisInitialized(self):call}(this,canvas_getPrototypeOf(Canvas).call(this)))._allOptions=Object.assign({},src_options,localOptions),_this._registry={},_this._composition={},_this._cachedProps={},_this._alias=null,_this._renderedResolve=null,_this._renderedPromise=new Promise(function(resolve){_this._renderedResolve=resolve}),_this._composition.layout=new layout_GridLayout,_this._store=new common_utils_Store(APP_INITIAL_STATE),_this._throwback=new common_utils_Store(function canvas_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},common_props.MATRIX_CREATED,!1));var namespace=namespace_namespaceObject.CANVAS_LOCAL_NAMESPACE,store=canvas_slicedToArray(common_utils_transactor(canvas_assertThisInitialized(canvas_assertThisInitialized(_this)),src_options,_this._store.model,{namespace:namespace}),2)[1];return common_utils_transactor(canvas_assertThisInitialized(canvas_assertThisInitialized(_this)),localOptions,store,{namespace:namespace}),common_utils_transactor(canvas_assertThisInitialized(canvas_assertThisInitialized(_this)),canvasOptions,store,{namespace:namespace}),_this.dependencies(Object.assign({},globalDependencies,_this._dependencies)),_this.firebolt(new canvas_firebolt(canvas_assertThisInitialized(canvas_assertThisInitialized(_this)),{behavioural:behavioural_namespaceObject,physical:physicalActions,physicalBehaviouralMap:{}},side_effects_namespaceObject,behaviour_effect_map_behaviourEffectMap)),_this.alias("canvas-".concat(getUniqueId())),_this.title("",{}),_this.subtitle("",{}),_this.legend({}),_this.color({}),_this.shape({}),_this.size({}),helper_setupChangeListener(canvas_assertThisInitialized(canvas_assertThisInitialized(_this))),_this._layoutManager=helper_createLayoutManager(),_this}return function canvas_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&canvas_setPrototypeOf(subClass,superClass)}(Canvas,transaction_support_TransactionSupport),function canvas_createClass(Constructor,protoProps,staticProps){return protoProps&&canvas_defineProperties(Constructor.prototype,protoProps),staticProps&&canvas_defineProperties(Constructor,staticProps),Constructor}(Canvas,[{key:"layout",value:function layout(){return arguments.length?this:this.composition().layout}},{key:"composition",value:function composition(){return arguments.length?this:this._composition}},{key:"done",value:function done(){return this._renderedPromise}},{key:"alias",value:function alias(){if(arguments.length){var visualGroup=this.composition().visualGroup;return this._alias=arguments.length<=0?void 0:arguments[0],visualGroup&&visualGroup.alias(this.alias()),this}return this._alias}},{key:"firebolt",value:function firebolt(){return arguments.length?(this._firebolt=arguments.length<=0?void 0:arguments[0],this):this._firebolt}},{key:"registry",value:function registry(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];if(params.length){var components=Object.assign({},params[0].components),componentSubRegistry=Object.assign({},params[0].componentSubRegistry);this._registry={components:components,componentSubRegistry:componentSubRegistry};var initedComponents=function initCanvas(context){return[new context._registry.components.VisualGroup(context._registry,Object.assign({throwback:context._throwback},context.dependencies()))]}(this);return this._composition.visualGroup=initedComponents[0],function createGroupState(context){var _VisualGroup$getState2=canvas_helper_slicedToArray(visual_group.getState(),2),globalState=_VisualGroup$getState2[0],localState=_VisualGroup$getState2[1],store=context._store;store.append("app.group",globalState),store.append("local.group",localState)}(this),this.composition().visualGroup.alias(this.alias()).store(this._store),this}return this._registry}},{key:"dependencies",value:function dependencies(){return arguments.length?(this._dependencies=arguments.length<=0?void 0:arguments[0],this):this._dependencies}},{key:"lifeCycle",value:function lifeCycle(lifeCycles){var lifeCycleManager=this.dependencies().lifeCycleManager;return lifeCycles?(lifeCycleManager.register(lifeCycles),this):lifeCycleManager}},{key:"legend",value:function legend(){return arguments.length?this:this.composition().legend}},{key:"once",value:function once(eventName){return this.dependencies().lifeCycleManager.retrieve(eventName)}},{key:"render",value:function render(){var mount=this.mount(),lifeCycleManager=this.dependencies().lifeCycleManager,renderDetails=layout_maker_getRenderDetails(this,mount);lifeCycleManager.notify({client:this,action:"beforedraw"}),function prepareLayout(layout,renderDetails){var components=renderDetails.components,layoutConfig=renderDetails.layoutConfig,measurement=renderDetails.measurement,rows=components.rows,columns=components.columns,values=components.values,cornerMatrices=components.cornerMatrices,topLeft=cornerMatrices.topLeft,topRight=cornerMatrices.topRight,bottomLeft=cornerMatrices.bottomLeft,bottomRight=cornerMatrices.bottomRight;rows&&columns&&layout.measurement(measurement).config(layoutConfig).matrices({top:[topLeft,columns[0],topRight],center:[rows[0],values,rows[1]],bottom:[bottomLeft,columns[1],bottomRight]}).triggerReflow()}(this.layout(),renderDetails),this._layoutManager.dimension({height:renderDetails.measurement.canvasHeight,width:renderDetails.measurement.canvasWidth}),this._layoutManager.renderAt(mount),layout_maker_renderLayout(this,renderDetails),function setLayoutInfForUnits(context){var layoutManager=context._layoutManager,boundBox=layoutManager.getComponent("grid").getBoundBox(),valueMatrix=context.composition().visualGroup.matrixInstance().value,parentContainer=renderer_utils_selectElement("#".concat(layoutManager.getRootNodeId())).node();valueMatrix.each(function(cell){cell.valueOf().parentContainerInf({el:parentContainer,dimensions:boundBox})})}(this),function setLabelRotationForAxes(context){var rotation=0,xAxes=context.xAxes()||[];!function(){for(var i=0;i<xAxes.length;i++)for(var j=0;j<xAxes[i].length;j++){var rotationVal=xAxes[i][j].renderConfig().labels.rotation;if(rotationVal&&0!==rotationVal)return void(rotation=rotationVal)}}(),rotation&&xAxes.forEach(function(axes){axes.forEach(function(axis){axis.renderConfig({labels:{rotation:rotation}}),axis.smartTicks(axis.setTickConfig())})})}(this)}},{key:"xAxes",value:function xAxes(){return this.composition().visualGroup.getAxes("x")}},{key:"yAxes",value:function yAxes(){return this.composition().visualGroup.getAxes("y")}},{key:"getRetinalAxes",value:function getRetinalAxes(){return this.composition().visualGroup.getAxes("retinal")}},{key:"mount",value:function mount(){if(arguments.length){var value=arguments.length<=0?void 0:arguments[0];return"string"==typeof(arguments.length<=0?void 0:arguments[0])&&(value=renderer_utils_selectElement(arguments.length<=0?void 0:arguments[0]).node()),this._mount=value,this}return this._mount}}],[{key:"withSettings",value:function withSettings(initialSettings,regEntry,globalDependencies){var instance=new Canvas(globalDependencies);for(var key in initialSettings)instance[key](initialSettings[key]);return instance.registry(regEntry),instance}},{key:"formalName",value:function formalName(){return"canvas"}}]),Canvas}(),COMPONENTS={VisualGroup:visual_group,VisualUnit:visual_unit_VisualUnit},SUBREGISTRIES={cellRegistry:cell_registry,layerRegistry:function(){var reg=DEFAULT_LAYERS,regObj={set:function set(key,def){return reg[key]=def,regObj},get:function get(){return reg}};return regObj}};__webpack_require__(26);function muze_slicedToArray(arr,i){return function muze_arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function muze_iterableToArrayLimit(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function muze_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var globalCache={},defaultRegistry=COMPONENTS,overrideRegistryDefinitions=function overrideRegistryDefinitions(overrideRegistry,registry){for(var prop in overrideRegistry)registry.set(prop,overrideRegistry[prop])},muze_muze=function muze(){var _transactor2=muze_slicedToArray(common_utils_transactor({},src_options),2),env=_transactor2[0],globalStore=_transactor2[1],components=Object.assign({},COMPONENTS),componentSubRegistryDef=Object.assign(SUBREGISTRIES),componentSubRegistry={};for(var prop in componentSubRegistryDef)componentSubRegistry[prop]=componentSubRegistryDef[prop]();return env.canvas=function(){var settings=globalStore.serialize(),canvas=canvas_Canvas.withSettings(settings,{components:components,componentSubRegistry:componentSubRegistry},env.globalDependencies());return function enableChainedTransaction(transactionModel,transactionEndpoint,transactionItems){transactionItems.forEach(function(item){return transactionModel.on(item,function(_ref3){var newVal=_slicedToArray(_ref3,2)[1];return transactionEndpoint[item](newVal)})})}(globalStore,canvas,Object.keys(settings)),canvas},env.globalDependencies=function(){return globalCache.smartlabel||(globalCache.smartlabel=new SmartlabelManager_default.a(1,"body")),{smartlabel:globalCache.smartlabel,lifeCycleManager:new lifecycle_manager}},env.settings=function(){return globalStore.serialize()},env.registry=function(){for(var _len=arguments.length,overrideRegistry=new Array(_len),_key=0;_key<_len;_key++)overrideRegistry[_key]=arguments[_key];if(overrideRegistry.length){for(var _prop in overrideRegistry)_prop in defaultRegistry&&(components[_prop]=overrideRegistry[_prop]);return env}return components},env.cellRegistry=function(){var cellRegistry=componentSubRegistry.cellRegistry;return arguments.length?(overrideRegistryDefinitions(arguments.length<=0?void 0:arguments[0],cellRegistry),env):cellRegistry.get()},env.layerRegistry=function(){var layerRegistry=componentSubRegistry.layerRegistry;return arguments.length?(overrideRegistryDefinitions(arguments.length<=0?void 0:arguments[0],layerRegistry),env):layerRegistry.get()},env},SideEffects={sideEffects:side_effects_namespaceObject,standards:{SurrogateSideEffect:SurrogateSideEffect,SpawnableSideEffect:spawnable_SpawnableSideEffect,GenericSideEffect:generic}},Behaviours={behaviouralActions:behavioural_namespaceObject,standards:{GenericBehaviour:generic_GenericBehaviour,PersistentBehaviour:persistent_PersistentBehaviour,VolatileBehaviour:volatile_VolatileBehaviour}};muze_muze.DataModel=datamodel_default.a,muze_muze.version=muze_package.version,muze_muze.SideEffects=SideEffects,muze_muze.ActionModel=actionModel,muze_muze.layerFactory=src_layer_factory,muze_muze.Operators=operators_namespaceObject,muze_muze.Behaviours=Behaviours,muze_muze.utils={getClientPoint:renderer_utils_getClientPoint,getEvent:renderer_utils_getEvent,makeElement:makeElement,selectElement:renderer_utils_selectElement,DateTimeFormatter:dist_datamodel.DateTimeFormatter,require:function require(lookupWhat,lookupDetails){return{resolvable:function resolvable(store){var lookupTarget=store[lookupWhat],depArr=lookupDetails.slice(0,lookupDetails.length-1),fn=lookupDetails[lookupDetails.length-1],deps=depArr.map(function(str){return lookupTarget[str]});return{fn:fn.apply(void 0,_toConsumableArray(deps)),depArr:depArr}}}}};__webpack_exports__.default=muze_muze}])});
//# sourceMappingURL=muze.js.map